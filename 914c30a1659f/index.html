<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Three.js 进阶教程：从核心概念到高级应用 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Three.js 不仅仅是一个库，它是一个通往 3D 世界的大门。通过它，我们可以在 Web 浏览器中构建出令人惊叹的交互式体验。本教程将带你超越入门，深入了解 Three.js 的核心组件、工作原理以及一些高级技巧，助你构建更复杂、更酷炫的 3D 应用。  “深入 Three.js，你将发现 Web 前端的无限可能性。”   一、Three.js 核心工作流回顾与进阶在入门教程中，我们介绍了">
<meta property="og:type" content="article">
<meta property="og:title" content="Three.js 进阶教程：从核心概念到高级应用">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/914c30a1659f/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="Three.js 不仅仅是一个库，它是一个通往 3D 世界的大门。通过它，我们可以在 Web 浏览器中构建出令人惊叹的交互式体验。本教程将带你超越入门，深入了解 Three.js 的核心组件、工作原理以及一些高级技巧，助你构建更复杂、更酷炫的 3D 应用。  “深入 Three.js，你将发现 Web 前端的无限可能性。”   一、Three.js 核心工作流回顾与进阶在入门教程中，我们介绍了">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-14.jpg">
<meta property="article:published_time" content="2025-07-13T22:24:00.000Z">
<meta property="article:modified_time" content="2025-12-18T06:51:26.846Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="前端技术">
<meta property="article:tag" content="2025">
<meta property="article:tag" content="WebGL">
<meta property="article:tag" content="Three.js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-14.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Three.js 进阶教程：从核心概念到高级应用",
  "url": "https://blog.tbf1211.xx.kg/914c30a1659f/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-14.jpg",
  "datePublished": "2025-07-13T22:24:00.000Z",
  "dateModified": "2025-12-18T06:51:26.846Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/914c30a1659f/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Three.js 进阶教程：从核心概念到高级应用',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">388</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">213</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">76</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-14.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">Three.js 进阶教程：从核心概念到高级应用</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Three.js 进阶教程：从核心概念到高级应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-07-13T22:24:00.000Z" title="发表于 2025-07-14 06:24:00">2025-07-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%BA%93/">库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="umamiPV" data-path="/914c30a1659f/"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p>Three.js 不仅仅是一个库，它是一个通往 3D 世界的大门。通过它，我们可以在 Web 浏览器中构建出令人惊叹的交互式体验。本教程将带你超越入门，深入了解 Three.js 的核心组件、工作原理以及一些高级技巧，助你构建更复杂、更酷炫的 3D 应用。</p>
</blockquote>
<div class="note info flat"><p>“深入 Three.js，你将发现 Web 前端的无限可能性。”</p>
</div>
<hr>
<h2 id="一、Three-js-核心工作流回顾与进阶"><a href="#一、Three-js-核心工作流回顾与进阶" class="headerlink" title="一、Three.js 核心工作流回顾与进阶"></a>一、Three.js 核心工作流回顾与进阶</h2><p>在入门教程中，我们介绍了 Three.js 的“四大件”：<strong>场景 (Scene)</strong>、<strong>相机 (Camera)</strong>、<strong>渲染器 (Renderer)</strong> 和<strong>物体 (Object &#x3D; Geometry + Material)</strong>。它们是构建任何 Three.js 应用的基础。</p>
<h3 id="1-1-渲染管线概览"><a href="#1-1-渲染管线概览" class="headerlink" title="1.1 渲染管线概览"></a>1.1 渲染管线概览</h3><div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TD
    A[JavaScript Code （Three.js）] --&gt; B(初始化: Scene, Camera, Renderer);
    B --&gt; C(创建 Mesh: Geometry + Material);
    C --&gt; D(添加 Lights);
    C --&gt; E(Objects to Scene);
    E --&gt; F{Renderer.render（Scene, Camera）};
    F --&gt; G(WebGL 渲染管线);
    G --&gt; H(GPU 处理);
    H --&gt; I(绘制到 Canvas);
    J[用户交互 &#x2F; 动画逻辑] --&gt; K(更新 Scene &#x2F; Camera &#x2F; Objects);
    K --&gt; F;
    F -- Repeatedly via --&gt; L[requestAnimationFrame Loop];
  </pre></div>

<p>这个流程图展示了 Three.js 应用的核心渲染循环：</p>
<ol>
<li><strong>初始化</strong>：设置场景、相机和渲染器。</li>
<li><strong>构建场景</strong>：创建几何体、材质，组合成网格物体，并添加到场景中。添加灯光。</li>
<li><strong>渲染</strong>：在 <code>requestAnimationFrame</code> 循环中，每次迭代都调用 <code>renderer.render(scene, camera)</code>，将相机视角下的场景绘制到 <code>canvas</code> 上。</li>
<li><strong>交互&#x2F;动画</strong>：在每次渲染前，更新物体位置、旋转、相机位置等，实现动画和响应用户交互。</li>
</ol>
<hr>
<h2 id="二、深入-Three-js-核心组件"><a href="#二、深入-Three-js-核心组件" class="headerlink" title="二、深入 Three.js 核心组件"></a>二、深入 Three.js 核心组件</h2><h3 id="2-1-场景-Scene"><a href="#2-1-场景-Scene" class="headerlink" title="2.1 场景 (Scene)"></a>2.1 场景 (Scene)</h3><p><code>THREE.Scene</code> 是所有 3D 对象的容器，包括几何体、灯光、相机（有时相机也添加到场景中以方便管理，但渲染时仍需独立传入 <code>renderer.render</code>）。</p>
<p><strong>常用属性&#x2F;方法</strong>：</p>
<ul>
<li><code>scene.add(object)</code>: 将对象添加到场景中。</li>
<li><code>scene.remove(object)</code>: 从场景中移除对象。</li>
<li><code>scene.children</code>: 包含场景中所有子对象的数组。</li>
<li><code>scene.traverse(callback)</code>: 遍历场景中的所有对象及其子对象。</li>
<li><code>scene.background</code>: 设置场景的背景，可以是颜色、纹理、立方体纹理（用于全景天空盒）。</li>
<li><code>scene.fog</code>: 添加雾效。</li>
</ul>
<p><strong>示例：设置背景和雾效</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置纯色背景</span></span><br><span class="line">scene.<span class="property">background</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xF0F0F0</span>); <span class="comment">// 浅灰色背景</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置纹理背景 (假设你有一个背景图片)</span></span><br><span class="line"><span class="comment">// const textureLoader = new THREE.TextureLoader();</span></span><br><span class="line"><span class="comment">// const bgTexture = textureLoader.load(&#x27;path/to/your-background.jpg&#x27;);</span></span><br><span class="line"><span class="comment">// scene.background = bgTexture;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加线性雾效</span></span><br><span class="line"><span class="comment">// 参数: 颜色, 近距离, 远距离</span></span><br><span class="line">scene.<span class="property">fog</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Fog</span>(<span class="number">0xCCCCCC</span>, <span class="number">10</span>, <span class="number">50</span>); <span class="comment">// 从10单位开始，到50单位完全被雾覆盖</span></span><br><span class="line"><span class="comment">// 或者指数雾效 (更浓重)</span></span><br><span class="line"><span class="comment">// scene.fog = new THREE.FogExp2(0xCCCCCC, 0.05); // 颜色, 密度</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-相机-Camera"><a href="#2-2-相机-Camera" class="headerlink" title="2.2 相机 (Camera)"></a>2.2 相机 (Camera)</h3><p>相机决定了场景如何被观察。</p>
<h4 id="2-2-1-PerspectiveCamera-透视相机"><a href="#2-2-1-PerspectiveCamera-透视相机" class="headerlink" title="2.2.1 PerspectiveCamera (透视相机)"></a>2.2.1 <code>PerspectiveCamera</code> (透视相机)</h4><p>最常用的相机，模拟人眼观察效果。</p>
<ul>
<li><code>fov</code> (Field of View): 视野角度，垂直方向，单位度。</li>
<li><code>aspect</code> (Aspect Ratio): 视口宽高比 (通常是 <code>width / height</code>)。</li>
<li><code>near</code> (Near Clipping Plane): 近裁剪面，此距离以外的物体可见。</li>
<li><code>far</code> (Far Clipping Plane): 远裁剪面，此距离以内且在近裁剪面以外的物体可见。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建透视相机</span></span><br><span class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">75</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</span><br><span class="line">camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>); <span class="comment">// x, y, z</span></span><br><span class="line">camera.<span class="title function_">lookAt</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 让相机看向场景中心</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-OrthographicCamera-正交相机"><a href="#2-2-2-OrthographicCamera-正交相机" class="headerlink" title="2.2.2 OrthographicCamera (正交相机)"></a>2.2.2 <code>OrthographicCamera</code> (正交相机)</h4><p>用于 2D 场景或不需要透视效果的场景（如 CAD 工具、游戏俯视图）。</p>
<ul>
<li><code>left</code>, <code>right</code>, <code>top</code>, <code>bottom</code>: 定义了裁剪面的范围。</li>
<li><code>near</code>, <code>far</code>: 同透视相机。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建正交相机</span></span><br><span class="line"><span class="comment">// 参数: left, right, top, bottom, near, far</span></span><br><span class="line"><span class="keyword">const</span> size = <span class="number">5</span>; <span class="comment">// 视口大小</span></span><br><span class="line"><span class="keyword">const</span> aspectRatio = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line"><span class="keyword">const</span> cameraOrtho = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">OrthographicCamera</span>(</span><br><span class="line">    -size * aspectRatio, <span class="comment">// left</span></span><br><span class="line">    size * aspectRatio,  <span class="comment">// right</span></span><br><span class="line">    size,                <span class="comment">// top</span></span><br><span class="line">    -size,               <span class="comment">// bottom</span></span><br><span class="line">    <span class="number">0.1</span>,                 <span class="comment">// near</span></span><br><span class="line">    <span class="number">1000</span>                 <span class="comment">// far</span></span><br><span class="line">);</span><br><span class="line">cameraOrtho.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">cameraOrtho.<span class="title function_">lookAt</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当窗口大小变化时，需要更新正交相机的裁剪面</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> aspectRatio = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    cameraOrtho.<span class="property">left</span> = -size * aspectRatio;</span><br><span class="line">    cameraOrtho.<span class="property">right</span> = size * aspectRatio;</span><br><span class="line">    cameraOrtho.<span class="title function_">updateProjectionMatrix</span>(); <span class="comment">// 必须调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-相机助手-CameraHelper"><a href="#2-2-3-相机助手-CameraHelper" class="headerlink" title="2.2.3 相机助手 (CameraHelper)"></a>2.2.3 相机助手 (<code>CameraHelper</code>)</h4><p>用于可视化相机视锥体，方便调试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> helper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CameraHelper</span>(camera);</span><br><span class="line">scene.<span class="title function_">add</span>(helper);</span><br></pre></td></tr></table></figure>

<h3 id="2-3-渲染器-Renderer"><a href="#2-3-渲染器-Renderer" class="headerlink" title="2.3 渲染器 (Renderer)"></a>2.3 渲染器 (Renderer)</h3><p><code>THREE.WebGLRenderer</code> 是将场景渲染到 <code>canvas</code> 的核心。</p>
<p><strong>常用属性&#x2F;方法</strong>：</p>
<ul>
<li><code>renderer.setSize(width, height)</code>: 设置渲染器尺寸。</li>
<li><code>renderer.setPixelRatio(window.devicePixelRatio)</code>: 解决高清屏模糊问题，通常设置为设备的像素比。</li>
<li><code>renderer.setClearColor(color, alpha)</code>: 设置每次渲染前清除画布的颜色和透明度。</li>
<li><code>renderer.render(scene, camera)</code>: 执行渲染操作。</li>
<li><code>renderer.domElement</code>: 渲染器创建的 <code>canvas</code> 元素。</li>
</ul>
<p><strong>示例：初始化渲染器</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(&#123;</span><br><span class="line">    <span class="attr">antialias</span>: <span class="literal">true</span> <span class="comment">// 启用抗锯齿，使边缘更平滑</span></span><br><span class="line">&#125;);</span><br><span class="line">renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">renderer.<span class="title function_">setPixelRatio</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>); <span class="comment">// 适配Retina屏</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确保在 animate 循环中调用 renderer.render(scene, camera);</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-几何体-Geometry"><a href="#2-4-几何体-Geometry" class="headerlink" title="2.4 几何体 (Geometry)"></a>2.4 几何体 (Geometry)</h3><p>几何体定义了 3D 对象的形状。</p>
<p><strong>常用几何体</strong>：</p>
<ul>
<li><code>BoxGeometry(width, height, depth)</code>: 立方体</li>
<li><code>SphereGeometry(radius, widthSegments, heightSegments)</code>: 球体</li>
<li><code>CylinderGeometry(radiusTop, radiusBottom, height, radialSegments)</code>: 圆柱体</li>
<li><code>PlaneGeometry(width, height, widthSegments, heightSegments)</code>: 平面</li>
<li><code>TorusGeometry(radius, tube, radialSegments, tubularSegments)</code>: 圆环体</li>
<li><code>BufferGeometry</code>: 更底层、更高效的几何体，可以手动定义顶点、法线等数据。大多数内置几何体最终都是 <code>BufferGeometry</code> 的实例。</li>
</ul>
<p><strong>示例：创建不同几何体</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> boxGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> sphereGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">0.75</span>, <span class="number">32</span>, <span class="number">32</span>); <span class="comment">// 半径, 水平分段, 垂直分段</span></span><br><span class="line"><span class="keyword">const</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">5</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-5-材质-Material"><a href="#2-5-材质-Material" class="headerlink" title="2.5 材质 (Material)"></a>2.5 材质 (Material)</h3><p>材质定义了 3D 对象的表面外观，以及它如何与光照互动。</p>
<p><strong>常用材质</strong>：</p>
<ul>
<li><code>MeshBasicMaterial</code>: 基础材质，不受光照影响，常用于非写实或调试。<ul>
<li><code>color</code>: 颜色。</li>
<li><code>map</code>: 纹理贴图。</li>
<li><code>transparent</code>, <code>opacity</code>: 透明度。</li>
<li><code>wireframe</code>: 线框模式。</li>
</ul>
</li>
<li><code>MeshLambertMaterial</code>: 兰伯特材质，模拟无光泽表面，对漫反射光照有反应。<ul>
<li><code>color</code>, <code>map</code>, <code>transparent</code>, <code>opacity</code>, <code>wireframe</code>。</li>
</ul>
</li>
<li><code>MeshPhongMaterial</code>: 冯氏材质，模拟有光泽表面，对漫反射和镜面反射光照都有反应。<ul>
<li><code>color</code>, <code>map</code>, <code>transparent</code>, <code>opacity</code>, <code>wireframe</code>。</li>
<li><code>specular</code>: 镜面反射颜色。</li>
<li><code>shininess</code>: 镜面反射光泽度。</li>
</ul>
</li>
<li><code>MeshStandardMaterial</code>: 标准材质（物理渲染材质），基于PBR（Physically Based Rendering）模型，更真实地模拟物理世界的光照。<ul>
<li><code>color</code>, <code>map</code>, <code>transparent</code>, <code>opacity</code>。</li>
<li><code>metalness</code>: 金属度 (0-1)。</li>
<li><code>roughness</code>: 粗糙度 (0-1)。</li>
<li>支持更多高级贴图：<code>normalMap</code>(法线贴图), <code>aoMap</code>(环境光遮蔽贴图), <code>displacementMap</code>(置换贴图), <code>envMap</code>(环境贴图) 等。</li>
</ul>
</li>
<li><code>LineBasicMaterial</code>, <code>PointsMaterial</code>: 用于渲染线段和点。</li>
</ul>
<p><strong>示例：使用物理渲染材质和纹理</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设你有一个图片文件作为纹理</span></span><br><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="keyword">const</span> texture = textureLoader.<span class="title function_">load</span>(<span class="string">&#x27;path/to/texture.jpg&#x27;</span>);</span><br><span class="line">texture.<span class="property">colorSpace</span> = <span class="variable constant_">THREE</span>.<span class="property">SRGBColorSpace</span>; <span class="comment">// 告诉threejs纹理的颜色空间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="number">0xffffff</span>, <span class="comment">// 基本颜色 (白色，由纹理覆盖)</span></span><br><span class="line">    <span class="attr">map</span>: texture,    <span class="comment">// 纹理贴图</span></span><br><span class="line">    <span class="attr">metalness</span>: <span class="number">0.5</span>,  <span class="comment">// 半金属</span></span><br><span class="line">    <span class="attr">roughness</span>: <span class="number">0.7</span>   <span class="comment">// 比较粗糙</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(boxGeometry, material);</span><br></pre></td></tr></table></figure>

<h3 id="2-6-灯光-Light"><a href="#2-6-灯光-Light" class="headerlink" title="2.6 灯光 (Light)"></a>2.6 灯光 (Light)</h3><p>灯光是让场景栩栩如生的关键。</p>
<p><strong>常用灯光类型</strong>：</p>
<ul>
<li><code>AmbientLight(color, intensity)</code>: 环境光。均匀地照亮场景中的所有物体，没有方向性，使物体不会完全变黑。</li>
<li><code>DirectionalLight(color, intensity)</code>: 平行光。模拟太阳光。光线是平行的，有方向，没有衰减。<ul>
<li><code>light.position.set(x, y, z)</code>: 设置光源位置。</li>
</ul>
</li>
<li><code>PointLight(color, intensity, distance, decay)</code>: 点光源。模拟灯泡，从一个点向所有方向发光，有衰减。<ul>
<li><code>light.position.set(x, y, z)</code>: 设置光源位置。</li>
</ul>
</li>
<li><code>SpotLight(color, intensity, distance, angle, penumbra, decay)</code>: 聚光灯。类似手电筒，从一个点沿一个方向发光，有一个锥形区域和衰减。<ul>
<li><code>light.position.set(x, y, z)</code>: 设置光源位置。</li>
<li><code>light.target</code>: 控制灯光指向的目标对象（默认为 <code>(0,0,0)</code>）。</li>
</ul>
</li>
<li><code>HemisphereLight(skyColor, groundColor, intensity)</code>: 半球光。模拟户外环境光，<code>skyColor</code> 模拟天空光，<code>groundColor</code> 模拟地面反射光。</li>
</ul>
<p><strong>示例：组合不同灯光</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">scene.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0xffffff</span>, <span class="number">0.4</span>)); <span class="comment">// 柔和的环境光</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dirLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(<span class="number">0xffffff</span>, <span class="number">0.8</span>);</span><br><span class="line">dirLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">7.5</span>);</span><br><span class="line">dirLight.<span class="property">castShadow</span> = <span class="literal">true</span>; <span class="comment">// 启用投射阴影 (详见下面阴影部分)</span></span><br><span class="line">scene.<span class="title function_">add</span>(dirLight);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pointLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointLight</span>(<span class="number">0xff9900</span>, <span class="number">1</span>, <span class="number">10</span>); <span class="comment">// 橘黄色点光源，衰减距离10</span></span><br><span class="line">pointLight.<span class="property">position</span>.<span class="title function_">set</span>(-<span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">scene.<span class="title function_">add</span>(pointLight);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 灯光助手 (LightHelper) 调试</span></span><br><span class="line"><span class="comment">// scene.add(new THREE.DirectionalLightHelper(dirLight, 1));</span></span><br><span class="line"><span class="comment">// scene.add(new THREE.PointLightHelper(pointLight, 0.5));</span></span><br></pre></td></tr></table></figure>

<h4 id="2-6-1-阴影-Shadows"><a href="#2-6-1-阴影-Shadows" class="headerlink" title="2.6.1 阴影 (Shadows)"></a>2.6.1 阴影 (Shadows)</h4><p>实现真实的阴影需要几个步骤：</p>
<ol>
<li><strong>渲染器启用阴影</strong>：<code>renderer.shadowMap.enabled = true;</code></li>
<li><strong>灯光启用投射阴影</strong>：<code>light.castShadow = true;</code> (仅 <code>DirectionalLight</code>, <code>PointLight</code>, <code>SpotLight</code> 支持)<ul>
<li>对这些灯光，还需要配置其阴影相机的参数 (<code>light.shadow.camera.near</code>, <code>far</code>, <code>left</code>, <code>right</code>, <code>top</code>, <code>bottom</code>) 和阴影贴图尺寸 (<code>light.shadow.mapSize.width</code>, <code>height</code>)。</li>
</ul>
</li>
<li><strong>物体启用投射&#x2F;接收阴影</strong>：<ul>
<li><code>mesh.castShadow = true;</code> (此物体投射阴影到其他物体上)</li>
<li><code>mesh.receiveShadow = true;</code> (此物体接收其他物体投射的阴影)</li>
</ul>
</li>
</ol>
<p><strong>示例：启用阴影</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>; <span class="comment">// 全局开启阴影</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (创建立方体和平面)</span></span><br><span class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0x00ff00</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material);</span><br><span class="line">cube.<span class="property">castShadow</span> = <span class="literal">true</span>; <span class="comment">// 立方体投射阴影</span></span><br><span class="line">scene.<span class="title function_">add</span>(cube);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">const</span> planeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0xcccccc</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry, planeMaterial);</span><br><span class="line">plane.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>; <span class="comment">// 将平面放到底部</span></span><br><span class="line">plane.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">0.5</span>;</span><br><span class="line">plane.<span class="property">receiveShadow</span> = <span class="literal">true</span>; <span class="comment">// 平面接收阴影</span></span><br><span class="line">scene.<span class="title function_">add</span>(plane);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... (创建定向光源)</span></span><br><span class="line"><span class="keyword">const</span> dirLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(<span class="number">0xffffff</span>, <span class="number">1</span>);</span><br><span class="line">dirLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">7.5</span>);</span><br><span class="line">dirLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置阴影相机参数 (根据场景大小调整)</span></span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="property">width</span> = <span class="number">1024</span>; <span class="comment">// 阴影贴图分辨率</span></span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="property">height</span> = <span class="number">1024</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">0.5</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">50</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">left</span> = -<span class="number">10</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">right</span> = <span class="number">10</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">top</span> = <span class="number">10</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">bottom</span> = -<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">scene.<span class="title function_">add</span>(dirLight);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以添加一个 DirectionalLightHelper 来查看阴影相机范围</span></span><br><span class="line"><span class="comment">// scene.add(new THREE.DirectionalLightHelper(dirLight, 1));</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、高级主题"><a href="#三、高级主题" class="headerlink" title="三、高级主题"></a>三、高级主题</h2><h3 id="3-1-动画-Animation"><a href="#3-1-动画-Animation" class="headerlink" title="3.1 动画 (Animation)"></a>3.1 动画 (<code>Animation</code>)</h3><p>除了简单地在 <code>animate</code> 循环中改变 <code>position</code> 或 <code>rotation</code>，Three.js 还支持更复杂的动画。</p>
<h4 id="3-1-1-requestAnimationFrame-循环"><a href="#3-1-1-requestAnimationFrame-循环" class="headerlink" title="3.1.1 requestAnimationFrame 循环"></a>3.1.1 <code>requestAnimationFrame</code> 循环</h4><p>这是最基本的动画方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每帧递增旋转</span></span><br><span class="line">    cube.<span class="property">rotation</span>.<span class="property">x</span> += <span class="number">0.01</span>;</span><br><span class="line">    cube.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.01</span>;</span><br><span class="line"></span><br><span class="line">    renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">animate</span>();</span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-外部动画库-GSAP"><a href="#3-1-2-外部动画库-GSAP" class="headerlink" title="3.1.2 外部动画库 (GSAP)"></a>3.1.2 外部动画库 (GSAP)</h4><p>对于复杂的缓动动画，通常会结合像 GSAP 这样的专业动画库。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设你已安装 GSAP 并引入</span></span><br><span class="line"><span class="comment">// npm install gsap</span></span><br><span class="line"><span class="comment">// import &#123; gsap &#125; from &#x27;gsap&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 让立方体在 2 秒内移动到 (2, 2, 0) 并旋转</span></span><br><span class="line">gsap.<span class="title function_">to</span>(cube.<span class="property">position</span>, &#123;</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">x</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">ease</span>: <span class="string">&quot;power2.out&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gsap.<span class="title function_">to</span>(cube.<span class="property">rotation</span>, &#123;</span><br><span class="line">    <span class="attr">duration</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">x</span>: <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="comment">// 旋转360度</span></span><br><span class="line">    <span class="attr">ease</span>: <span class="string">&quot;power2.out&quot;</span>,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;动画完成&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-骨骼动画-SkinnedMesh"><a href="#3-1-3-骨骼动画-SkinnedMesh" class="headerlink" title="3.1.3 骨骼动画 (SkinnedMesh)"></a>3.1.3 骨骼动画 (<code>SkinnedMesh</code>)</h4><p>对于加载的人体或角色模型，Three.js 支持骨骼动画，通过 <code>AnimationMixer</code> 和 <code>AnimationClip</code> 来控制。这通常涉及到从外部模型文件（如 <code>.gltf</code>）中导入动画数据。</p>
<h3 id="3-2-几何变换-Transformations"><a href="#3-2-几何变换-Transformations" class="headerlink" title="3.2 几何变换 (Transformations)"></a>3.2 几何变换 (<code>Transformations</code>)</h3><p>每个 <code>Object3D</code> (包括 <code>Mesh</code>, <code>Light</code>, <code>Camera</code> 等) 都有 <code>position</code>, <code>rotation</code>, <code>scale</code> 属性以及 <code>matrix</code> 等。</p>
<ul>
<li><code>object.position.set(x, y, z);</code></li>
<li><code>object.rotation.set(x, y, z, order);</code> (欧拉角，<code>order</code> 为旋转顺序，如 <code>&#39;XYZ&#39;</code>)</li>
<li><code>object.rotation.x += 0.01;</code></li>
<li><code>object.scale.set(x, y, z);</code></li>
<li><code>object.translateOnAxis(axis, distance);</code> (沿指定轴移动)</li>
<li><code>object.lookAt(targetVector);</code> (使对象看向目标点)</li>
</ul>
<h3 id="3-3-纹理与贴图-Textures"><a href="#3-3-纹理与贴图-Textures" class="headerlink" title="3.3 纹理与贴图 (Textures)"></a>3.3 纹理与贴图 (<code>Textures</code>)</h3><p>纹理是 3D 对象表面最常用的视觉增强方式。</p>
<ul>
<li><code>THREE.TextureLoader().load(url)</code>: 加载图片纹理。</li>
<li><code>texture.wrapS</code> &#x2F; <code>texture.wrapT</code>: 设置纹理在 S&#x2F;T 轴上的包裹方式 (<code>THREE.RepeatWrapping</code>, <code>THREE.ClampToEdgeWrapping</code>)。</li>
<li><code>texture.repeat.set(u, v)</code>: 设置纹理重复次数。</li>
<li><code>texture.offset.set(u, v)</code>: 设置纹理偏移。</li>
<li><code>texture.rotation</code>: 旋转纹理。</li>
</ul>
<p><strong>高级贴图</strong>：</p>
<ul>
<li><strong><code>normalMap</code> (法线贴图)</strong>: 模拟表面细节，让物体看起来有凹凸感而无需增加几何体顶点。</li>
<li><strong><code>aoMap</code> (环境光遮蔽贴图)</strong>: 模拟 crevices&#x2F;corners 处的阴影。</li>
<li><strong><code>displacementMap</code> (置换贴图)</strong>: 实际改变几何体的顶点位置以创建物理上的凹凸，需要更多几何细分。</li>
<li><strong><code>roughnessMap</code> &#x2F; <code>metalnessMap</code></strong>: 控制物理材质的粗糙度和金属度。</li>
<li><strong><code>envMap</code> (环境贴图 &#x2F; 反射贴图)</strong>: 模拟环境反射，常用于创建镜面反射或玻璃效果。通常使用 <code>CubeTextureLoader</code> 加载六张图片组成的环境贴图。</li>
</ul>
<p><strong>示例：加载法线贴图</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="keyword">const</span> colorTexture = textureLoader.<span class="title function_">load</span>(<span class="string">&#x27;path/to/texture_color.jpg&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> normalTexture = textureLoader.<span class="title function_">load</span>(<span class="string">&#x27;path/to/texture_normal.jpg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">map</span>: colorTexture,</span><br><span class="line">    <span class="attr">normalMap</span>: normalTexture, <span class="comment">// 应用法线贴图</span></span><br><span class="line">    <span class="attr">metalness</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">roughness</span>: <span class="number">1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-交互-Interactions"><a href="#3-4-交互-Interactions" class="headerlink" title="3.4 交互 (Interactions)"></a>3.4 交互 (<code>Interactions</code>)</h3><p>Three.js 交互通常通过以下方式实现：</p>
<ol>
<li><strong>控制器 (<code>Controls</code>)</strong>: 如 <code>OrbitControls</code> (轨道控制器)，<code>PointerLockControls</code> (第一人称射击游戏控制器) 等。<ul>
<li><strong>安装</strong>: <code>npm install three</code> 后，控制器在 <code>node_modules/three/examples/jsm/controls/</code> 目录下。</li>
<li><strong>CDN 引入</strong>: <code>import &#123; OrbitControls &#125; from &#39;https://unpkg.com/three@0.163.0/examples/jsm/controls/OrbitControls.js&#39;;</code></li>
</ul>
</li>
<li><strong>射线投射 (<code>Raycaster</code>)</strong>: 用于检测鼠标点击或触摸事件与 3D 场景中对象的交集，实现拾取、悬停等效果。</li>
</ol>
<p><strong>示例：使用 Raycaster 进行点击检测</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span><br><span class="line"><span class="comment">// ... 初始化场景、相机、渲染器等</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> raycaster = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Raycaster</span>();</span><br><span class="line"><span class="keyword">const</span> mouse = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存储可被射线检测的物体</span></span><br><span class="line"><span class="keyword">const</span> intersectableObjects = [];</span><br><span class="line"><span class="comment">// 假设你有一个立方体</span></span><br><span class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0x00ff00</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> cube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material);</span><br><span class="line">scene.<span class="title function_">add</span>(cube);</span><br><span class="line">intersectableObjects.<span class="title function_">push</span>(cube); <span class="comment">// 将它添加到可检测列表中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录上一次检测到的物体</span></span><br><span class="line"><span class="keyword">let</span> intersectedObject = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> originalMaterial = cube.<span class="property">material</span>.<span class="title function_">clone</span>(); <span class="comment">// 保存原始材质</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onMouseMove</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// 将鼠标坐标转换为标准化设备坐标 (NDC)</span></span><br><span class="line">    mouse.<span class="property">x</span> = (event.<span class="property">clientX</span> / <span class="variable language_">window</span>.<span class="property">innerWidth</span>) * <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">    mouse.<span class="property">y</span> = -(event.<span class="property">clientY</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>) * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新射线投射器</span></span><br><span class="line">    raycaster.<span class="title function_">setFromCamera</span>(mouse, camera);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算物体与射线的交点</span></span><br><span class="line">    <span class="keyword">const</span> intersects = raycaster.<span class="title function_">intersectObjects</span>(intersectableObjects, <span class="literal">false</span>); <span class="comment">// false表示不递归检测子对象</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (intersects.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 有物体被射线击中</span></span><br><span class="line">        <span class="keyword">if</span> (intersectedObject != intersects[<span class="number">0</span>].<span class="property">object</span>) &#123;</span><br><span class="line">            <span class="comment">// 新物体被击中，恢复旧物体的材质（如果有）</span></span><br><span class="line">            <span class="keyword">if</span> (intersectedObject) &#123;</span><br><span class="line">                intersectedObject.<span class="property">material</span> = originalMaterial;</span><br><span class="line">            &#125;</span><br><span class="line">            intersectedObject = intersects[<span class="number">0</span>].<span class="property">object</span>;</span><br><span class="line">            <span class="comment">// 改变新击中物体的材质</span></span><br><span class="line">            intersectedObject.<span class="property">material</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0xff0000</span> &#125;); <span class="comment">// 红色</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 没有物体被击中，恢复旧物体的材质（如果有）</span></span><br><span class="line">        <span class="keyword">if</span> (intersectedObject) &#123;</span><br><span class="line">            intersectedObject.<span class="property">material</span> = originalMaterial;</span><br><span class="line">            intersectedObject = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mousemove&#x27;</span>, onMouseMove);</span><br></pre></td></tr></table></figure>

<h3 id="3-5-模型加载-Model-Loading"><a href="#3-5-模型加载-Model-Loading" class="headerlink" title="3.5 模型加载 (Model Loading)"></a>3.5 模型加载 (<code>Model Loading</code>)</h3><p>将外部 3D 模型导入 Three.js 场景是高复杂度应用中不可或缺的一部分。</p>
<p><strong>最常用格式</strong>：<strong>GLTF&#x2F;GLB</strong> (Graphics Library Transmission Format)。它是 3D 资产的开放标准，支持几何体、材质、动画、骨骼等所有数据，且文件体积小。</p>
<p><strong>常用加载器</strong>：</p>
<ul>
<li><code>GLTFLoader</code>: 加载 <code>.gltf</code> 或 <code>.glb</code> 模型。</li>
<li><code>OBJLoader</code>: 加载 <code>.obj</code> 模型。</li>
<li><code>FBXLoader</code>: 加载 <code>.fbx</code> 模型。</li>
</ul>
<p><strong>示例：加载 GLTF 模型</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GLTFLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/loaders/GLTFLoader.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span><br><span class="line"></span><br><span class="line">loader.<span class="title function_">load</span>(</span><br><span class="line">    <span class="string">&#x27;path/to/your/model.glb&#x27;</span>, <span class="comment">// 模型的路径</span></span><br><span class="line">    <span class="keyword">function</span> (<span class="params">gltf</span>) &#123;</span><br><span class="line">        <span class="comment">// 模型加载成功后的回调</span></span><br><span class="line">        scene.<span class="title function_">add</span>(gltf.<span class="property">scene</span>); <span class="comment">// 将加载的场景添加到主场景中</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历模型中的所有网格，并启用阴影</span></span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="keyword">function</span> (<span class="params">child</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (child.<span class="property">isMesh</span>) &#123;</span><br><span class="line">                child.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">                child.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="comment">// 确保材质能接收阴影</span></span><br><span class="line">                <span class="keyword">if</span> (child.<span class="property">material</span>.<span class="property">isMeshStandardMaterial</span> || child.<span class="property">material</span>.<span class="property">isMeshPhongMaterial</span>) &#123;</span><br><span class="line">                    child.<span class="property">material</span>.<span class="property">needsUpdate</span> = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果模型包含动画，可以这样播放:</span></span><br><span class="line">        <span class="comment">// const mixer = new THREE.AnimationMixer(gltf.scene);</span></span><br><span class="line">        <span class="comment">// gltf.animations.forEach(clip =&gt; &#123;</span></span><br><span class="line">        <span class="comment">//     mixer.clipAction(clip).play();</span></span><br><span class="line">        <span class="comment">// &#125;);</span></span><br><span class="line">        <span class="comment">// // 记得在 animate 循环中更新 mixer: mixer.update(deltaTime);</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载进度回调</span></span><br><span class="line">    <span class="keyword">function</span> (<span class="params">xhr</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>((xhr.<span class="property">loaded</span> / xhr.<span class="property">total</span> * <span class="number">100</span>) + <span class="string">&#x27;% loaded&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 加载失败回调</span></span><br><span class="line">    <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;An error happened&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-性能优化"><a href="#3-6-性能优化" class="headerlink" title="3.6 性能优化"></a>3.6 性能优化</h3><p>大规模 3D 场景的性能优化至关重要。</p>
<ul>
<li><strong>减少绘制调用 (Draw Calls)</strong>：<ul>
<li>合并几何体 (<code>BufferGeometryUtils.mergeBufferGeometries</code>)。</li>
<li>使用多材质 (<code>Mesh.material</code> 属性可以是一个数组)。</li>
<li>使用实例化 (<code>InstancedMesh</code>) 绘制大量相同几何体。</li>
</ul>
</li>
<li><strong>优化几何体</strong>：<ul>
<li>使用低多边形模型。</li>
<li>移除不必要的面和顶点。</li>
<li>禁用背面剔除 (<code>material.side = THREE.FrontSide;</code>) 如果不必要。</li>
</ul>
</li>
<li><strong>优化纹理</strong>：<ul>
<li>使用合适尺寸的纹理。</li>
<li>开启 <code>texture.mipmaps</code>（默认开启，但需要了解）。</li>
<li>使用压缩纹理格式（如 KTX2）。</li>
</ul>
</li>
<li><strong>着色器优化</strong>：<ul>
<li>避免在着色器中进行复杂计算。</li>
<li>使用 <code>gl_Position</code> 代替 <code>position * matrix</code>（Three.js 会自动优化）。</li>
</ul>
</li>
<li><strong>阴影优化</strong>：<ul>
<li>调整 <code>shadow.mapSize</code> 和 <code>shadow.camera</code> 范围。</li>
<li>减少投射阴影的灯光数量。</li>
</ul>
</li>
<li><strong>Dispose 资源</strong>：在 <code>scene.remove()</code> 对象后，还需要手动释放其几何体、材质和纹理在 GPU 上的内存：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myMesh.<span class="property">geometry</span>.<span class="title function_">dispose</span>();</span><br><span class="line">myMesh.<span class="property">material</span>.<span class="title function_">dispose</span>();</span><br><span class="line"><span class="keyword">if</span> (myMesh.<span class="property">material</span>.<span class="property">map</span>) myMesh.<span class="property">material</span>.<span class="property">map</span>.<span class="title function_">dispose</span>();</span><br><span class="line">scene.<span class="title function_">remove</span>(myMesh); <span class="comment">// 移除实际对象</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="四、项目结构与开发实践"><a href="#四、项目结构与开发实践" class="headerlink" title="四、项目结构与开发实践"></a>四、项目结构与开发实践</h2><p>对于更复杂的 Three.js 项目，良好的结构至关重要。</p>
<ol>
<li><strong>模块化</strong>：将场景初始化、几何体创建、动画逻辑等分别放在不同的模块文件中。</li>
<li><strong>使用构建工具</strong>：Vite 或 Webpack 是处理 Three.js (包括其 <code>examples/jsm</code> 中的模块) 的理想选择。</li>
<li><strong>状态管理</strong>：对于复杂的交互，可以考虑使用简单的状态管理模式来协调各种组件。</li>
<li><strong>调试工具</strong>：<ul>
<li>浏览器开发者工具。</li>
<li><code>dat.gui</code> 或 <code>lil-gui</code> 用于创建可交互的调试 UI。</li>
<li>Three.js 提供的各类 <code>Helper</code> (如 <code>GridHelper</code>, <code>AxesHelper</code>, <code>CameraHelper</code>, <code>LightHelper</code>)。</li>
</ul>
</li>
</ol>
<p><strong>示例项目结构 (使用 Vite)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">my-threejs-app/</span><br><span class="line">├── public/                # 静态资源，如模型、纹理</span><br><span class="line">│   ├── models/</span><br><span class="line">│   │   └── chair.glb</span><br><span class="line">│   └── textures/</span><br><span class="line">│       └── wood.jpg</span><br><span class="line">├── src/</span><br><span class="line">│   ├── main.js            # 应用程序入口</span><br><span class="line">│   ├── scene.js           # 场景初始化和对象添加</span><br><span class="line">│   ├── camera.js          # 相机配置</span><br><span class="line">│   ├── renderer.js        # 渲染器配置</span><br><span class="line">│   ├── lights.js          # 灯光配置</span><br><span class="line">│   ├── assets/            # 其他组件或工具类</span><br><span class="line">│   │   └── CustomObject.js</span><br><span class="line">│   ├── styles/            # CSS样式</span><br><span class="line">│   └── utils/</span><br><span class="line">│       └── helpers.js</span><br><span class="line">├── index.html             # HTML 模板</span><br><span class="line">├── package.json</span><br><span class="line">└── vite.config.js         # Vite 配置</span><br></pre></td></tr></table></figure>

<p><strong><code>main.js</code> 示例</strong>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrbitControls</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/controls/OrbitControls.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GLTFLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/loaders/GLTFLoader.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. Scene</span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>();</span><br><span class="line">scene.<span class="property">background</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="number">0xefefef</span>); <span class="comment">// Light grey background</span></span><br><span class="line">scene.<span class="title function_">add</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)); <span class="comment">// 添加坐标轴助手</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. Camera</span></span><br><span class="line"><span class="keyword">const</span> camera = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">75</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">0.1</span>, <span class="number">1000</span>);</span><br><span class="line">camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">2</span>, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. Renderer</span></span><br><span class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(&#123; <span class="attr">antialias</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">renderer.<span class="title function_">setPixelRatio</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>);</span><br><span class="line">renderer.<span class="property">shadowMap</span>.<span class="property">enabled</span> = <span class="literal">true</span>; <span class="comment">// Enable shadows</span></span><br><span class="line">renderer.<span class="property">shadowMap</span>.<span class="property">type</span> = <span class="variable constant_">THREE</span>.<span class="property">PCFSoftShadowMap</span>; <span class="comment">// Softer shadows</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. Lights</span></span><br><span class="line"><span class="keyword">const</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="number">0xffffff</span>, <span class="number">0.5</span>);</span><br><span class="line">scene.<span class="title function_">add</span>(ambientLight);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dirLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">DirectionalLight</span>(<span class="number">0xffffff</span>, <span class="number">1.2</span>);</span><br><span class="line">dirLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">7</span>);</span><br><span class="line">dirLight.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// Configure shadow properties</span></span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="property">width</span> = <span class="number">1024</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">mapSize</span>.<span class="property">height</span> = <span class="number">1024</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">near</span> = <span class="number">0.5</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">far</span> = <span class="number">20</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">left</span> = -<span class="number">5</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">right</span> = <span class="number">5</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">top</span> = <span class="number">5</span>;</span><br><span class="line">dirLight.<span class="property">shadow</span>.<span class="property">camera</span>.<span class="property">bottom</span> = -<span class="number">5</span>;</span><br><span class="line">scene.<span class="title function_">add</span>(dirLight);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Optional: Light helper for debugging shadow camera</span></span><br><span class="line"><span class="comment">// scene.add(new THREE.DirectionalLightHelper(dirLight, 1));</span></span><br><span class="line"><span class="comment">// scene.add(new THREE.CameraHelper(dirLight.shadow.camera));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. Objects</span></span><br><span class="line"><span class="comment">// Create a ground plane</span></span><br><span class="line"><span class="keyword">const</span> planeGeometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">const</span> planeMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshStandardMaterial</span>(&#123; <span class="attr">color</span>: <span class="number">0xcccccc</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> plane = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry, planeMaterial);</span><br><span class="line">plane.<span class="property">rotation</span>.<span class="property">x</span> = -<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">2</span>;</span><br><span class="line">plane.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">0.5</span>;</span><br><span class="line">plane.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">scene.<span class="title function_">add</span>(plane);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load a GLTF model</span></span><br><span class="line"><span class="keyword">const</span> gltfLoader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span><br><span class="line">gltfLoader.<span class="title function_">load</span>(</span><br><span class="line">    <span class="string">&#x27;/models/chair.glb&#x27;</span>, <span class="comment">// Path relative to public folder</span></span><br><span class="line">    <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span>); <span class="comment">// Scale the model</span></span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="property">position</span>.<span class="property">y</span> = -<span class="number">0.5</span>; <span class="comment">// Place on the ground</span></span><br><span class="line">        gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function">(<span class="params">child</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (child.<span class="property">isMesh</span>) &#123;</span><br><span class="line">                child.<span class="property">castShadow</span> = <span class="literal">true</span>;</span><br><span class="line">                child.<span class="property">receiveShadow</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        scene.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Model loaded:&#x27;</span>, gltf.<span class="property">scene</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">undefined</span>,</span><br><span class="line">    <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error loading model:&#x27;</span>, error)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. Controls</span></span><br><span class="line"><span class="keyword">const</span> controls = <span class="keyword">new</span> <span class="title class_">OrbitControls</span>(camera, renderer.<span class="property">domElement</span>);</span><br><span class="line">controls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">controls.<span class="property">dampingFactor</span> = <span class="number">0.05</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. Animation Loop</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">animate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update controls (if damping is enabled)</span></span><br><span class="line">    controls.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">animate</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. Handle Window Resize</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">    renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">    renderer.<span class="title function_">setPixelRatio</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>); <span class="comment">// Re-apply pixel ratio</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>Three.js 是一个令人兴奋的库，它为 Web 带来了强大的 3D 能力。通过本教程，你应该对 Three.js 的核心组件、渲染管线、常用功能以及高级实践有了更深入的理解。</p>
<p>从简单的立方体到复杂的模型加载和交互，Three.js 的世界值得你去探索。不断实践，勇敢尝试新的功能和效果，你将能够构建出令人印象深刻的 3D Web 应用。</p>
<p><strong>记住，实践是最好的老师！</strong> 开始你的 Three.js 项目，利用这些知识，将你的创意变为现实吧！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/914c30a1659f/">https://blog.tbf1211.xx.kg/914c30a1659f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><a class="post-meta__tags" href="/tags/2025/">2025</a><a class="post-meta__tags" href="/tags/WebGL/">WebGL</a><a class="post-meta__tags" href="/tags/Three-js/">Three.js</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-14.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/fa69350b38ad/" title="Git Submodules 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-04.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Git Submodules 详解</div></div><div class="info-2"><div class="info-item-1"> Git Submodule (子模块) 是 Git 版本控制系统提供的一种机制，允许一个 Git 仓库 (称为主仓库或 superproject) 将另一个完整的 Git 仓库 (称为子模块) 作为其子目录嵌入。主仓库会记录子模块的特定提交 (specific commit)，而不是其最新的 HEAD 状态。这意味着，当你克隆主仓库时，你并不会自动获得子模块的所有历史，而是获得其在主仓库中被记录的那个确切版本。  核心思想：将一个独立的 Git 仓库作为另一个 Git 仓库的子目录进行管理，并追踪子模块的特定提交，以实现外部依赖管理、模块化或代码复用，同时保持各仓库的独立性。   一、为什么需要 Git Submodules？在软件开发中，经常会遇到以下场景：  管理外部依赖：你的项目依赖于一个由第三方维护的库或框架，你希望将其代码包含在自己的仓库中，但又不想复制粘贴或手动更新。 模块化大型项目：一个大型项目由多个相对独立的组件构成，这些组件各自有独立的开发生命周期和版本控制，但需要在一个主项目中统一协调。 代码复用：多个项目共享同一段代码或一个公共库，你希望这段共享代码能够独...</div></div></div></a><a class="pagination-related" href="/bbed291b42a9/" title="带婴儿出门旅游全方位注意事项指南"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-02.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">带婴儿出门旅游全方位注意事项指南</div></div><div class="info-2"><div class="info-item-1"> 带婴儿旅行，是将美好的世界介绍给新生命的开端，同时也是对父母规划、应变和协作能力的一次全面考验。它不再是一场说走就走的冒险，而是一项需要精心策划的“项目管理”。本指南旨在提供一个系统化、结构化的框架，帮助您从容应对挑战，享受亲子旅途的乐趣。  核心思想：充分的准备可以消除大部分的焦虑。成功的婴儿旅行，关键在于放慢节奏、灵活应变，并将婴儿的需求置于首位。   一、行前规划：成功旅途的基石规划阶段是整个旅程中最为关键的一环。周密的计划可以预见并规避大多数潜在问题。 1.1 选择合适的目的地并非所有目的地都适合婴儿。选择时应优先考虑以下因素：  飞行&#x2F;车程时间：首次长途旅行，建议选择飞行时间在4小时以内或车程在3小时以内的直达目的地。 医疗资源：确保目的地或周边地区有可靠的、可及的儿科医疗服务。 气候温和：避免极端炎热、寒冷或气候多变的地区，以减少婴儿生病的风险。 基础设施：目的地是否对婴儿推车友好（如无障碍通道），是否有母婴室等公共设施。 节奏与活动：选择节奏舒缓的度假地（如海岛、度假村）优于需要频繁移动和紧凑行程的城市观光。  1.2 确定旅行时间与时长 避开高峰：尽量...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/eb8d4a4bab0b/" title="TresJS详解：用Vue的方式构建Three.js场景"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-06</div><div class="info-item-2">TresJS详解：用Vue的方式构建Three.js场景</div></div><div class="info-2"><div class="info-item-1"> TresJS 是一个基于 Vue.js 和 Three.js 的声明式 3D 渲染框架。它允许开发者像编写 Vue 组件一样，通过声明式的方式构建复杂的 Three.js 场景，从而大大降低 Three.js 的学习曲线和开发复杂度，特别适合 Vue 开发者快速进入 3D 领域。  核心思想：将 Three.js 对象抽象为 Vue 组件，用 Vue 的响应式和组件化思维管理 3D 场景。   一、什么是 TresJS？Three.js 是一个强大的 JavaScript 3D 库，用于在浏览器中创建和渲染 3D 图形。然而，直接使用 Three.js API 需要编写大量的命令式（或说是“指令式”）代码来创建几何体、材质、网格、灯光、摄像机、场景以及设置渲染循环等。这对于不熟悉 3D 图形编程的开发者来说，上手较难，且代码维护复杂。 TresJS 的出现就是为了解决这个问题。它提供了一套 Vue 组件，每个组件都对应 Three.js 中的一个核心概念（如 &lt;TresCanvas&gt;, &lt;TresMesh&gt;, &lt;TresPerspectiveCam...</div></div></div></a><a class="pagination-related" href="/198b48a1edc3/" title="WebGL详解：浏览器中的3D图形魔法"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-09</div><div class="info-item-2">WebGL详解：浏览器中的3D图形魔法</div></div><div class="info-2"><div class="info-item-1"> WebGL (Web Graphics Library) 是一种 JavaScript API，用于在任何兼容的网页浏览器中渲染高性能的交互式 3D 和 2D 图形，而无需使用插件。它通过将 JavaScript 和 OpenGL ES 2.0 (或 3.0，对应 WebGL2) 的功能结合起来，直接在 HTML5 Canvas 元素中利用用户的 GPU 硬件加速进行渲染。  核心思想：WebGL 是一个基于 JavaScript 的浏览器 3D 图形 API，通过 HTML Canvas 元素将 OpenGL ES (2.0&#x2F;3.0) 硬件加速能力带到 Web 端，允许开发者直接与 GPU 交互，利用着色器程序渲染高性能、交互式的 3D 内容。   一、WebGL 简介1.1 什么是 WebGL？WebGL 是一种底层图形 API，它允许 Web 开发者在浏览器中直接访问和控制 GPU。简而言之，它是一个将 JavaScript 代码转换为 GPU 指令的桥梁。这意味着你可以用 JavaScript 编写程序来绘制复杂的 3D 模型、创建游戏、进行数据可视化等，而这...</div></div></div></a><a class="pagination-related" href="/f1d2005549f2/" title="HTMX详解：用HTML属性直接驱动AJAX、CSS过渡和WebSocket"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-08.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-28</div><div class="info-item-2">HTMX详解：用HTML属性直接驱动AJAX、CSS过渡和WebSocket</div></div><div class="info-2"><div class="info-item-1"> 在过去十年中，前端开发领域由 JavaScript 框架（如 React, Vue, Angular）占据主导地位，它们将整个用户界面放在客户端，通过 API 与后端交互。然而，这种“单页应用 (SPA)”模式并非总是最佳选择，它带来了复杂的构建流程、初始加载性能问题、SEO 挑战以及较高的开发和维护成本。 HTMX 的出现，挑战了这一主流范式。它主张将交互逻辑回归到服务器端，通过简单的 HTML 属性就能实现 AJAX 请求、CSS 过渡、WebSocket 和服务器发送事件 (SSE)，在不编写一行 JavaScript 代码的情况下，实现丰富的动态用户体验。  本文将深入探讨 HTMX 的核心理念、工作原理、主要特性、优缺点以及适用场景，帮助你理解这个“返璞归真”但又极具创新力的工具。   一、 HTMX 是什么？核心理念与哲学HTMX 是一个小型 (约 15KB gzipped) 的 JavaScript 库，它通过扩展 HTML 原生能力，允许你在 HTML 元素上直接指定 AJAX 请求、CSS 动画、WebSocket 和服务器发送事件 (SSE) 行为。 其核心...</div></div></div></a><a class="pagination-related" href="/b25babd84514/" title="Vue3 defineModel详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-01.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-03</div><div class="info-item-2">Vue3 defineModel详解</div></div><div class="info-2"><div class="info-item-1"> defineModel 是 Vue 3.4 版本中引入的一个新的宏 (macro)，旨在简化组件中双向绑定 v-model 的实现。在 Composition API 的 setup 语法糖 (&lt;script setup&gt;) 中使用时，它极大地减少了为组件实现 v-model 所需的样板代码，使其更加直观和便捷。  核心思想：defineModel 是 defineProps 和 defineEmits 的语法糖，它声明了一个可双向绑定的 props，并自动处理了 modelValue prop 的接收和相应的 update:modelValue 事件的触发，让自定义组件的 v-model 用法变得和原生表单元素一样简洁。   一、为什么需要 defineModel？在 defineModel 出现之前，如果你想在 Vue 3 的自定义组件中实现 v-model 双向绑定，你需要手动完成以下步骤：  通过 defineProps 声明一个名为 modelValue 的 prop 来接收父组件传递的值。 通过 defineEmits 声明一个名为 update:mod...</div></div></div></a><a class="pagination-related" href="/f200f6bfe5fa/" title="Golang 特殊注释 (Special Comments) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-15</div><div class="info-item-2">Golang 特殊注释 (Special Comments) 详解</div></div><div class="info-2"><div class="info-item-1"> 在 Go 语言中，除了我们日常用于解释代码逻辑的普通注释 // 和 /* */ 之外，还存在一些具有特殊含义的注释。这些特殊注释通常以 //go: 或 // + 开头，它们并不是为程序员阅读而生，而是作为指令直接与 Go 工具链（编译器、链接器、go generate 等）交互，用于控制编译行为、生成代码、导入 C 代码，或者提供额外的信息。  核心思想：特殊注释是 Go 工具链的“命令”，用于扩展 Go 语言的能力，例如嵌入文件、生成代码、与 C 语言交互或进行性能优化。   一、Go 特殊注释的分类与作用Go 的特殊注释大致可以分为几类：  编译器指令 (Build Constraints)：控制哪些文件或代码块在特定条件下编译。 代码生成指令 (go generate)：标记需要执行特定外部工具来生成代码的位置。 cgo 指令：用于 Go 和 C&#x2F;C++ 代码之间的互操作。 embed 指令：将静态文件嵌入到 Go 二进制文件中 (Go 1.16+)。 运行时或工具指令：用于性能分析、内存管理等内部或高级用途。  接下来的章节将详细介绍这些特殊注释。 二、//g...</div></div></div></a><a class="pagination-related" href="/2565d3c3db01/" title="Go语言embed包详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-12</div><div class="info-item-2">Go语言embed包详解</div></div><div class="info-2"><div class="info-item-1"> Go 标准库从 Go 1.16 版本开始引入了 embed 1 包。这个包提供了一种简单、声明式的方式，允许开发者将静态文件（如 HTML 模板、CSS、JavaScript、图片、配置文件等）直接嵌入到 Go 可执行文件中。这意味着你可以通过一个独立的二进制文件分发所有应用程序所需的资源，而无需额外管理外部文件，极大地简化了部署和分发过程。  核心思想：将应用程序的外部资源（静态文件）编译进最终的二进制文件，实现“单一二进制文件”的发布和部署，消除外部文件依赖带来的复杂性。   一、为什么需要 embed 包？在 embed 包之前，Go 语言应用程序处理静态资源通常有以下几种方式：  外部文件：将静态文件与可执行文件放在一起分发。这会带来：  部署复杂性：需要确保文件结构正确，并处理文件丢失或路径错误的问题。 文件篡改风险：外部文件容易被修改，可能影响程序的行为或安全性。 分发不便：每次更新都需要同步可执行文件和所有相关资源文件。   go:embed 第三方库：许多第三方库（如 go-bindata, packr）实现了文件嵌入功能。这些库虽然有效，但通常需要一些额外的构...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">388</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">213</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">76</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Three-js-%E6%A0%B8%E5%BF%83%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%9B%9E%E9%A1%BE%E4%B8%8E%E8%BF%9B%E9%98%B6"><span class="toc-text">一、Three.js 核心工作流回顾与进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF%E6%A6%82%E8%A7%88"><span class="toc-text">1.1 渲染管线概览</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%B7%B1%E5%85%A5-Three-js-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-text">二、深入 Three.js 核心组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9C%BA%E6%99%AF-Scene"><span class="toc-text">2.1 场景 (Scene)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%9B%B8%E6%9C%BA-Camera"><span class="toc-text">2.2 相机 (Camera)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-PerspectiveCamera-%E9%80%8F%E8%A7%86%E7%9B%B8%E6%9C%BA"><span class="toc-text">2.2.1 PerspectiveCamera (透视相机)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-OrthographicCamera-%E6%AD%A3%E4%BA%A4%E7%9B%B8%E6%9C%BA"><span class="toc-text">2.2.2 OrthographicCamera (正交相机)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E7%9B%B8%E6%9C%BA%E5%8A%A9%E6%89%8B-CameraHelper"><span class="toc-text">2.2.3 相机助手 (CameraHelper)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%B8%B2%E6%9F%93%E5%99%A8-Renderer"><span class="toc-text">2.3 渲染器 (Renderer)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%87%A0%E4%BD%95%E4%BD%93-Geometry"><span class="toc-text">2.4 几何体 (Geometry)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E6%9D%90%E8%B4%A8-Material"><span class="toc-text">2.5 材质 (Material)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E7%81%AF%E5%85%89-Light"><span class="toc-text">2.6 灯光 (Light)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-%E9%98%B4%E5%BD%B1-Shadows"><span class="toc-text">2.6.1 阴影 (Shadows)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98"><span class="toc-text">三、高级主题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%8A%A8%E7%94%BB-Animation"><span class="toc-text">3.1 动画 (Animation)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-requestAnimationFrame-%E5%BE%AA%E7%8E%AF"><span class="toc-text">3.1.1 requestAnimationFrame 循环</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E5%A4%96%E9%83%A8%E5%8A%A8%E7%94%BB%E5%BA%93-GSAP"><span class="toc-text">3.1.2 外部动画库 (GSAP)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB-SkinnedMesh"><span class="toc-text">3.1.3 骨骼动画 (SkinnedMesh)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%87%A0%E4%BD%95%E5%8F%98%E6%8D%A2-Transformations"><span class="toc-text">3.2 几何变换 (Transformations)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%BA%B9%E7%90%86%E4%B8%8E%E8%B4%B4%E5%9B%BE-Textures"><span class="toc-text">3.3 纹理与贴图 (Textures)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E4%BA%A4%E4%BA%92-Interactions"><span class="toc-text">3.4 交互 (Interactions)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E6%A8%A1%E5%9E%8B%E5%8A%A0%E8%BD%BD-Model-Loading"><span class="toc-text">3.5 模型加载 (Model Loading)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-text">3.6 性能优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5"><span class="toc-text">四、项目结构与开发实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">五、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/24ffc0bedb41/" title="IPFS (InterPlanetary File System) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IPFS (InterPlanetary File System) 详解"/></a><div class="content"><a class="title" href="/24ffc0bedb41/" title="IPFS (InterPlanetary File System) 详解">IPFS (InterPlanetary File System) 详解</a><time datetime="2025-12-16T22:24:00.000Z" title="发表于 2025-12-17 06:24:00">2025-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/bfcc84247c6a/" title="智能体 (Agent) 详解：深入 LangChain 开发实践"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-04.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="智能体 (Agent) 详解：深入 LangChain 开发实践"/></a><div class="content"><a class="title" href="/bfcc84247c6a/" title="智能体 (Agent) 详解：深入 LangChain 开发实践">智能体 (Agent) 详解：深入 LangChain 开发实践</a><time datetime="2025-12-10T22:24:00.000Z" title="发表于 2025-12-11 06:24:00">2025-12-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/28f993be5cfe/" title="Bun.js 深度解析：冷启动与边缘函数优化"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Bun.js 深度解析：冷启动与边缘函数优化"/></a><div class="content"><a class="title" href="/28f993be5cfe/" title="Bun.js 深度解析：冷启动与边缘函数优化">Bun.js 深度解析：冷启动与边缘函数优化</a><time datetime="2025-12-07T22:24:00.000Z" title="发表于 2025-12-08 06:24:00">2025-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/bcbe0f78ef1d/" title="Go Jaeger 深度解析：分布式追踪实践"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-15.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go Jaeger 深度解析：分布式追踪实践"/></a><div class="content"><a class="title" href="/bcbe0f78ef1d/" title="Go Jaeger 深度解析：分布式追踪实践">Go Jaeger 深度解析：分布式追踪实践</a><time datetime="2025-12-04T22:24:00.000Z" title="发表于 2025-12-05 06:24:00">2025-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/15920229f914/" title="Supabase 深度解析"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Supabase 深度解析"/></a><div class="content"><a class="title" href="/15920229f914/" title="Supabase 深度解析">Supabase 深度解析</a><time datetime="2025-12-02T22:24:00.000Z" title="发表于 2025-12-03 06:24:00">2025-12-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-14.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="📌 2023">📌 2023</a><a href="/archives/2024/" target="_blank" title="❓ 2024">❓ 2024</a><a href="/archives/2025/" target="_blank" title="🚀 2025">🚀 2025</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="分类">分类</a><a href="/tags/" target="_blank" title="标签">标签</a><a href="/categories/" target="_blank" title="时间线">时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="说说">说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2025 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><script>(() => {
  const option = null
  const config = {"site_uv":true,"site_pv":true,"page_pv":true,"token":"qTvz1SkmPDt785fgh6BpiA5qiFFIVUwxj8Ft+rPW+cdN59v1hXjwRgSmy0+ji9m+oLlcxvo2NfDSMa6epVl3NTlsN3ejCIwWeP8Y51aEJ0Sbem4UexGmJLspB7AkOBId2SdtT6QWEBlGmFIIQgchQ2zAKYxTmc/kpBED5aLSr+3uvmQ9/G7FJQeVFpveDkK0xM1hu36xq4a6/FSeROxtoEp5zabzTWiYTlLsQzIl/NlELnCq3nxK+oo/vl3UQo/oM/rae/gJX/MaVKsgIUCd2ABJogNkx2KTenBIBpbPki5FzOgPh6/z4GPa4HvhNO51DDVG1SEQZooqEYmt/gnybLBWFbN+7liZWw=="}

  const runTrack = () => {
    if (typeof umami !== 'undefined' && typeof umami.track === 'function') {
      umami.track(props => ({ ...props, url: window.location.pathname, title: GLOBAL_CONFIG_SITE.title }))
    } else {
      console.warn('Umami Analytics: umami.track is not available')
    }
  }

  const loadUmamiJS = () => {
    btf.getScript('https://umami.012700.xyz/script.js', {
      'data-website-id': '2a796d6c-6499-42d8-8eb4-d9a2930b0ff3',
      'data-auto-track': 'false',
      ...option
    }).then(() => {
      runTrack()
    }).catch(error => {
      console.error('Umami Analytics: Error loading script', error)
    })
  }

  const getData = async (isPost) => {
    try {
      const now = Date.now()
      const keyUrl = isPost ? `&url=${window.location.pathname}&path=${window.location.pathname}` : ''
      const headerList = { 'Accept': 'application/json' }

      if (true) {
        headerList['Authorization'] = `Bearer ${config.token}`
      } else {
        headerList['x-umami-api-key'] = config.token
      }

      const res = await fetch(`https://umami.012700.xyz/api/websites/2a796d6c-6499-42d8-8eb4-d9a2930b0ff3/stats?startAt=0000000000&endAt=${now}${keyUrl}`, {
        method: "GET",
        headers: headerList
      })

      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`)
      }

      return await res.json()
    } catch (error) {
      console.error('Umami Analytics: Failed to fetch data', error)
      throw error
    }
  }

  const insertData = async () => {
    try {
      if (GLOBAL_CONFIG_SITE.pageType === 'post' && config.page_pv) {
        const pagePV = document.getElementById('umamiPV')
        if (pagePV) {
          const data = await getData(true)
          if (data && data.pageviews) {
            pagePV.textContent = typeof data.pageviews.value !== 'undefined' ? data.pageviews.value : data.pageviews
          } else {
            console.warn('Umami Analytics: Invalid page view data received')
          }
        }
      }

      if (config.site_uv || config.site_pv) {
        const data = await getData(false)

        if (config.site_uv) {
          const siteUV = document.getElementById('umami-site-uv')
          if (siteUV && data && data.visitors) {
            siteUV.textContent = typeof data.visitors.value !== 'undefined' ? data.visitors.value : data.visitors
          } else if (siteUV) {
            console.warn('Umami Analytics: Invalid site UV data received')
          }
        }

        if (config.site_pv) {
          const sitePV = document.getElementById('umami-site-pv')
          if (sitePV && data && data.pageviews) {
            sitePV.textContent = typeof data.pageviews.value !== 'undefined' ? data.pageviews.value : data.pageviews
          } else if (sitePV) {
            console.warn('Umami Analytics: Invalid site PV data received')
          }
        }
      }
    } catch (error) {
      console.error('Umami Analytics: Failed to insert data', error)
    }
  }

  btf.addGlobalFn('pjaxComplete', runTrack, 'umami_analytics_run_track')
  btf.addGlobalFn('pjaxComplete', insertData, 'umami_analytics_insert')


  loadUmamiJS()

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', insertData)
  } else {
    setTimeout(insertData, 100)
  }
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.3"></script></div></div></body></html>