<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Ruff 详解：极速 Python 代码检查与格式化工具 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ruff 是一个用 Rust 编写的极速 Python 代码检查 (Lint) 和格式化工具。它旨在提供一个高性能的替代方案，结合了 Flake8、isort、Black 等多种工具的功能，以显著提升 Python 项目的代码质量检查和格式化效率。  Ruff 的核心优势在于其极致的速度：由于底层使用 Rust 编写，它比传统的 Python 代码检查工具快 10 到 100 倍，这对于大型项目">
<meta property="og:type" content="article">
<meta property="og:title" content="Ruff 详解：极速 Python 代码检查与格式化工具">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/55b69d9a9473/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="Ruff 是一个用 Rust 编写的极速 Python 代码检查 (Lint) 和格式化工具。它旨在提供一个高性能的替代方案，结合了 Flake8、isort、Black 等多种工具的功能，以显著提升 Python 项目的代码质量检查和格式化效率。  Ruff 的核心优势在于其极致的速度：由于底层使用 Rust 编写，它比传统的 Python 代码检查工具快 10 到 100 倍，这对于大型项目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-20.jpg">
<meta property="article:published_time" content="2025-01-30T22:24:00.000Z">
<meta property="article:modified_time" content="2026-01-31T15:14:58.493Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="项目构建">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Lint">
<meta property="article:tag" content="代码质量">
<meta property="article:tag" content="CI&#x2F;CD">
<meta property="article:tag" content="2025">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-20.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Ruff 详解：极速 Python 代码检查与格式化工具",
  "url": "https://blog.tbf1211.xx.kg/55b69d9a9473/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-20.jpg",
  "datePublished": "2025-01-30T22:24:00.000Z",
  "dateModified": "2026-01-31T15:14:58.493Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/55b69d9a9473/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ruff 详解：极速 Python 代码检查与格式化工具',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">536</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">229</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">84</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-20.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">Ruff 详解：极速 Python 代码检查与格式化工具</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Ruff 详解：极速 Python 代码检查与格式化工具</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-01-30T22:24:00.000Z" title="发表于 2025-01-31 06:24:00">2025-01-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/">项目构建</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>Ruff</strong> 是一个用 Rust 编写的极速 Python 代码检查 (Lint) 和格式化工具。它旨在提供一个高性能的替代方案，结合了 Flake8、isort、Black 等多种工具的功能，以显著提升 Python 项目的代码质量检查和格式化效率。</p>
</blockquote>
<div class="note info flat"><p>Ruff 的核心优势在于其<strong>极致的速度</strong>：由于底层使用 Rust 编写，它比传统的 Python 代码检查工具快 10 到 100 倍，这对于大型项目和 CI&#x2F;CD 流程来说是一个巨大的改进。</p>
</div>
<hr>
<h2 id="一、为什么选择-Ruff？"><a href="#一、为什么选择-Ruff？" class="headerlink" title="一、为什么选择 Ruff？"></a>一、为什么选择 Ruff？</h2><p>在 Python 开发中，我们通常会使用一系列工具来维护代码质量和风格：</p>
<ul>
<li><strong>Linter (代码检查器)</strong>：如 Flake8、Pylint，用于发现潜在的 bug、代码异味、不遵循最佳实践的代码。</li>
<li><strong>Formatter (代码格式化器)</strong>：如 Black、autopep8、YAPF，用于统一代码风格，使其符合 PEP 8 规范。</li>
<li><strong>Import Sorter (导入排序器)</strong>：如 isort，用于自动排序和整理 <code>import</code> 语句。</li>
</ul>
<p>管理和配置这些独立的工具会增加项目的复杂性。Ruff 的出现旨在简化这一过程，将这些核心功能整合到一个单一的、高性能的工具中，并通过单一配置即可管理。</p>
<p><strong>Ruff 带来的主要优势：</strong></p>
<ul>
<li><strong>极速性能</strong>：由 Rust 编写，其检查速度比现有 Python 工具快一个数量级。这使得在大型代码库上运行检查变得轻而易举，不会拖慢开发流程。</li>
<li><strong>一体化解决方案</strong>：它能替代 Flake8 (及其众多插件)、isort、pydocstyle、mccabe、Pyflakes 等一系列工具。</li>
<li><strong>内置格式化器</strong>：从 0.0.260 版本开始，Ruff 集成了自己的格式化功能，旨在成为 Black 的替代品，同样强调非侵入性和确定性。</li>
<li><strong>高度可配置</strong>：虽然默认配置已经很合理，但Ruff提供了丰富的配置选项，允许用户根据项目需求启用&#x2F;禁用特定规则、自定义规则行为等。</li>
<li><strong>易于集成</strong>：可轻松集成到 VS Code、PyCharm 等 IDE 以及各种 CI&#x2F;CD 工作流中。</li>
</ul>
<h2 id="二、Ruff-的主要功能"><a href="#二、Ruff-的主要功能" class="headerlink" title="二、Ruff 的主要功能"></a>二、Ruff 的主要功能</h2><p>Ruff 的功能主要包括代码检查 (Linting) 和代码格式化 (Formatting)。</p>
<h3 id="2-1-代码检查-Linting"><a href="#2-1-代码检查-Linting" class="headerlink" title="2.1 代码检查 (Linting)"></a>2.1 代码检查 (Linting)</h3><p>Ruff 可以检查代码的各种问题，包括但不限于：</p>
<ul>
<li><strong>语法错误和潜在 bug</strong>：如未使用的变量、重复的导入、语法错误。</li>
<li><strong>代码风格问题</strong>：遵循 PEP 8 规范，如行长、缩进、空白行等。</li>
<li><strong>复杂性检查</strong>：例如函数或方法的圈复杂度 (通过集成 Pylint 的 <code>C</code> 规则)。</li>
<li><strong>Docstring 检查</strong>：如缺少 docstring 或 docstring 格式不规范 (通过集成 pydocstyle 的 <code>D</code> 规则)。</li>
<li><strong>最佳实践检查</strong>：如使用 <code>assert</code> 而不是 <code>raise</code>、不必要的 <code>else</code> 块等。</li>
</ul>
<p>Ruff 通过一系列<strong>规则 (rules)</strong> 来执行这些检查，每条规则都有一个唯一的代码 (例如 <code>E501</code> 代表行长超限)。它支持数百条规则，涵盖了 Flake8、isort、Pylint、Pyflakes 等工具中的常见检查。</p>
<p><strong>Ruff 规则示例：</strong></p>
<ul>
<li><code>F401</code>: 未使用的导入</li>
<li><code>E501</code>: 行长超过最大限制</li>
<li><code>W292</code>: 文件末尾没有新行</li>
<li><code>I001</code>: 导入顺序不规范 (isort 风格)</li>
<li><code>D100</code>: 缺少模块 docstring</li>
</ul>
<h3 id="2-2-代码格式化-Formatting"><a href="#2-2-代码格式化-Formatting" class="headerlink" title="2.2 代码格式化 (Formatting)"></a>2.2 代码格式化 (Formatting)</h3><p>Ruff 的格式化器旨在提供与 Black 类似的非侵入式、确定性的格式化体验。它会根据一套固定的规则自动调整代码布局，目标是减少代码风格争议，让开发者专注于编写功能。</p>
<p><strong>特点：</strong></p>
<ul>
<li><strong>确定性</strong>：给定相同的输入，总是产生相同的输出。</li>
<li><strong>非侵入性</strong>：只修改必要的格式，尽量不改变代码的抽象语法树。</li>
<li><strong>与 Linting 紧密结合</strong>：格式化通常也能修复一些格式相关的 Lint 错误。</li>
</ul>
<h2 id="三、安装与基本使用"><a href="#三、安装与基本使用" class="headerlink" title="三、安装与基本使用"></a>三、安装与基本使用</h2><h3 id="3-1-安装"><a href="#3-1-安装" class="headerlink" title="3.1 安装"></a>3.1 安装</h3><p>Ruff 可以通过 pip 安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ruff</span><br></pre></td></tr></table></figure>

<h3 id="3-2-基本用法"><a href="#3-2-基本用法" class="headerlink" title="3.2 基本用法"></a>3.2 基本用法</h3><p>假设你有一个名为 <code>main.py</code> 的 Python 文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> os, sys <span class="comment"># F401</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>(<span class="params"></span></span><br><span class="line"><span class="params">        name</span>):</span><br><span class="line">    <span class="comment"># This is a comment that is intentionally long to trigger E501 if line limit is 88.</span></span><br><span class="line">    message = <span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    hello_world(<span class="string">&quot;Ruff User&quot;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-代码检查-Linting"><a href="#3-2-1-代码检查-Linting" class="headerlink" title="3.2.1 代码检查 (Linting)"></a>3.2.1 代码检查 (Linting)</h4><p>运行 Ruff 进行代码检查：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruff check main.py</span><br></pre></td></tr></table></figure>

<p>你可能会得到类似这样的输出（取决于你的配置和 Ruff 版本）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main.py:2:12: F401 &#x27;sys&#x27; imported but unused</span><br><span class="line">main.py:2:12: F401 &#x27;os&#x27; imported but unused</span><br><span class="line">main.py:2:1: I001 One import per line</span><br><span class="line">main.py:5:9: E501 Line too long (88 &gt; 79)</span><br><span class="line">Found 4 errors.</span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-自动修复-Auto-fix"><a href="#3-2-2-自动修复-Auto-fix" class="headerlink" title="3.2.2 自动修复 (Auto-fix)"></a>3.2.2 自动修复 (Auto-fix)</h4><p>Ruff 能够自动修复许多检查到的问题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruff check --fix main.py</span><br></pre></td></tr></table></figure>

<p>运行后，<code>main.py</code> 可能会变为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># F401</span></span><br><span class="line"><span class="keyword">import</span> sys <span class="comment"># F401</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>(<span class="params"></span></span><br><span class="line"><span class="params">        name</span>):</span><br><span class="line">    <span class="comment"># This is a comment that is intentionally long to trigger E501 if line limit is 88.</span></span><br><span class="line">    message = <span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    hello_world(<span class="string">&quot;Ruff User&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>请注意，<code>I001</code> (One import per line) 已经被修复，但 <code>F401</code> (unused imports) 仍然存在，因为它们需要在后续的 <code>fix</code> 批次中处理或者需要用户手动确认。<code>E501</code> 通常不会被自动修复，因为它涉及到代码逻辑或风格的选择。</p>
<h4 id="3-2-3-代码格式化-Formatting"><a href="#3-2-3-代码格式化-Formatting" class="headerlink" title="3.2.3 代码格式化 (Formatting)"></a>3.2.3 代码格式化 (Formatting)</h4><p>从 Ruff 0.0.260+ 版本开始，你可以使用 <code>format</code> 命令进行格式化：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruff format main.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> os <span class="comment"># F401</span></span><br><span class="line"><span class="keyword">import</span> sys <span class="comment"># F401</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="comment"># This is a comment that is intentionally long to trigger E501 if line limit is 88.</span></span><br><span class="line">    message = <span class="string">f&quot;Hello, <span class="subst">&#123;name&#125;</span>!&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    hello_world(<span class="string">&quot;Ruff User&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>格式化器可能对空行、括号位置等进行调整。<code>E501</code> 在格式化中可能会尝试缓解，但如果行太长且无法合理拆分，它仍将是一个 lint 错误。</p>
<h4 id="3-2-4-同时检查并格式化"><a href="#3-2-4-同时检查并格式化" class="headerlink" title="3.2.4 同时检查并格式化"></a>3.2.4 同时检查并格式化</h4><p>Ruff 推荐在 CI&#x2F;CD 中同时执行检查和格式化，以确保代码完全符合规范。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ruff check .</span><br><span class="line">ruff format . --check <span class="comment"># 在 CI/CD 中只检查是否需要格式化，不实际修改</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">ruff format . <span class="comment"># 在本地开发时直接格式化</span></span><br></pre></td></tr></table></figure>

<h2 id="四、配置-Ruff"><a href="#四、配置-Ruff" class="headerlink" title="四、配置 Ruff"></a>四、配置 Ruff</h2><p>Ruff 可以通过多种方式进行配置：</p>
<ul>
<li><strong><code>pyproject.toml</code> (推荐)</strong>：这是现代 Python 项目管理工具的标准配置文件。</li>
<li><code>ruff.toml</code></li>
<li><code>setup.cfg</code></li>
<li><code>flake8</code> 的兼容配置（有限支持）</li>
</ul>
<p>以下是一个 <code>pyproject.toml</code> 配置示例：</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pyproject.toml</span></span><br><span class="line"><span class="section">[tool.ruff]</span></span><br><span class="line"><span class="comment"># 要启用或禁用的规则代码列表，或者规则组。</span></span><br><span class="line"><span class="comment"># 示例：启用所有默认规则 (`E`, `F`, `W`, `I`)，并添加一些 `D` (pydocstyle) 和 `C` (复杂度) 规则。</span></span><br><span class="line"><span class="comment"># 使用 `ruff config` 命令查看所有可用的规则及其类别。</span></span><br><span class="line"><span class="attr">select</span> = [<span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;C&quot;</span>]</span><br><span class="line"><span class="attr">ignore</span> = [<span class="string">&quot;E501&quot;</span>] <span class="comment"># 忽略特定规则，例如忽略所有 E501 (行长超限) 错误</span></span><br><span class="line"><span class="attr">target-version</span> = <span class="string">&quot;py310&quot;</span> <span class="comment"># 指定目标 Python 版本，Ruff 将根据此版本检查语法和特性。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许自动修复的规则。如果未指定，所有选中的可修复规则都将进行修复。</span></span><br><span class="line"><span class="comment"># fixable = [&quot;I001&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不自动修复的规则。</span></span><br><span class="line"><span class="comment"># unfixable = []</span></span><br><span class="line"></span><br><span class="line"><span class="attr">extend-exclude</span> = [</span><br><span class="line">    <span class="string">&quot;.git&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__pycache__&quot;</span>,</span><br><span class="line">    <span class="string">&quot;venv&quot;</span>,</span><br><span class="line">    <span class="string">&quot;env&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;*.pyc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;*.egg-info&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.mypy_cache&quot;</span>,</span><br><span class="line">    <span class="string">&quot;.pytest_cache&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 针对特定文件或路径的配置。</span></span><br><span class="line"><span class="section">[tool.ruff.per-file-ignores]</span></span><br><span class="line"><span class="attr">&quot;__init__.py&quot;</span> = [<span class="string">&quot;F401&quot;</span>, <span class="string">&quot;D&quot;</span>] <span class="comment"># 针对 __init__.py 文件，忽略 F401 和所有 D (pydocstyle) 规则。</span></span><br><span class="line"><span class="attr">&quot;tests/*.py&quot;</span> = [<span class="string">&quot;D&quot;</span>] <span class="comment"># 针对测试文件，忽略所有 D 规则。</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.ruff.pydocstyle]</span></span><br><span class="line"><span class="comment"># 配置 pydocstyle 相关的规则</span></span><br><span class="line"><span class="attr">convention</span> = <span class="string">&quot;google&quot;</span> <span class="comment"># 例如，遵循 Google 风格的 docstring 规范</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.ruff.flake8-annotations]</span></span><br><span class="line"><span class="comment"># 配置 flake8-annotations 相关的规则</span></span><br><span class="line"><span class="attr">mypy-init-annotations</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.ruff.flake8-import-conventions]</span></span><br><span class="line"><span class="comment"># 配置 import-conventions</span></span><br><span class="line"><span class="comment"># 例如，允许 import pandas as pd 但禁止 import pandas as p</span></span><br><span class="line"><span class="attr">alias-modules</span> = &#123; <span class="string">&quot;pandas&quot;</span> = <span class="string">&quot;pd&quot;</span>, <span class="string">&quot;numpy&quot;</span> = <span class="string">&quot;np&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="section">[tool.ruff.isort]</span></span><br><span class="line"><span class="comment"># isort 行为配置</span></span><br><span class="line"><span class="attr">known-first-party</span> = [<span class="string">&quot;my_package&quot;</span>] <span class="comment"># 将 &#x27;my_package&#x27; 视为项目内部包</span></span><br><span class="line"><span class="attr">combine-as-imports</span> = <span class="literal">true</span> <span class="comment"># 合并如 `from foo import a, b` 为 `from foo import a; from foo import b`</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.ruff.format]</span></span><br><span class="line"><span class="comment"># 格式化器配置</span></span><br><span class="line"><span class="attr">docstring-code-format</span> = <span class="literal">true</span> <span class="comment"># 格式化 docstring 中的代码块</span></span><br><span class="line"><span class="comment"># line-length = 88 # 格式化器的行长，通常与 linting 的 E501 相关联</span></span><br></pre></td></tr></table></figure>

<p><strong>配置说明：</strong></p>
<ul>
<li><code>select</code>：指定要启用的规则组或单个规则代码。你可以使用 <code>ruff config</code> 命令查看所有可用的规则及其所属类别。</li>
<li><code>ignore</code>：指定要忽略的规则。</li>
<li><code>target-version</code>：Ruff 会根据此版本检查语法和特性，以避免在旧版本 Python 中使用新语法或在旧版本中检查新特性。</li>
<li><code>exclude</code>：指定要忽略的文件或目录。</li>
<li><code>per-file-ignores</code>：针对特定文件或文件模式应用不同的忽略规则。</li>
<li><code>[tool.ruff.pydocstyle]</code>、<code>[tool.ruff.isort]</code> 等：针对特定功能或插件进行更细粒度的配置。</li>
<li><code>[tool.ruff.format]</code>：配置内置格式化器的行为，例如行长。</li>
</ul>
<h2 id="五、Ruff-在-CI-CD-中的应用"><a href="#五、Ruff-在-CI-CD-中的应用" class="headerlink" title="五、Ruff 在 CI&#x2F;CD 中的应用"></a>五、Ruff 在 CI&#x2F;CD 中的应用</h2><p>Ruff 的极速特性使其非常适合集成到持续集成 (CI) 和持续部署 (CD) 流程中。</p>
<p><strong>典型的 CI&#x2F;CD 流程：</strong></p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TD
    A[代码提交] --&gt; B(触发 CI&#x2F;CD Pipeline);
    B --&gt; C{运行 Ruff Lint 检查};
    C -- 修复错误 --&gt; D(运行 Ruff Format 检查);
    D -- 格式化不一致 --&gt; E(格式化失败);
    D -- 格式化一致 --&gt; F(构建&#x2F;测试);
    F -- 成功 --&gt; G(部署);
    C -- 发现错误 --&gt; H(Lint 检查失败);
    H --&gt; I{发送报告&#x2F;通知};
    E --&gt; I;
  </pre></div>

<p>在 CI 阶段，通常会执行以下命令：</p>
<ol>
<li><p><strong>检查 Lint 错误 (不自动修复)</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruff check .</span><br></pre></td></tr></table></figure>
<p>如果检测到任何错误，CI 将失败，并提示开发者修复。</p>
</li>
<li><p><strong>检查格式化 (不自动修改)</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruff format . --check</span><br></pre></td></tr></table></figure>
<p>这将验证所有文件是否都已正确格式化。如果发现任何文件需要格式化，此命令将以非零退出代码退出，导致 CI 失败，强制开发者在提交前进行格式化。</p>
</li>
</ol>
<p>通过这种方式，Ruff 能够在代码合并之前强制执行代码质量和风格规范，从而保持代码库的整洁和一致性。</p>
<h2 id="六、Ruff-与传统工具的对比"><a href="#六、Ruff-与传统工具的对比" class="headerlink" title="六、Ruff 与传统工具的对比"></a>六、Ruff 与传统工具的对比</h2><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Ruff</th>
<th align="left">Flake8 (with plugins) + isort + Black</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>语言</strong></td>
<td align="left">Rust</td>
<td align="left">Python</td>
</tr>
<tr>
<td align="left"><strong>速度</strong></td>
<td align="left">极速 (10-100x 快)</td>
<td align="left">较慢</td>
</tr>
<tr>
<td align="left"><strong>功能整合</strong></td>
<td align="left">Linting, Formatting, Import Sorting (一体化)</td>
<td align="left">需多个独立工具配置和运行</td>
</tr>
<tr>
<td align="left"><strong>配置</strong></td>
<td align="left">单一 <code>pyproject.toml</code> 或 <code>ruff.toml</code></td>
<td align="left">多个工具的独立配置</td>
</tr>
<tr>
<td align="left"><strong>可扩展性</strong></td>
<td align="left">通过规则代码和自定义插件 (未来计划)</td>
<td align="left">通过 Flake8 插件系统</td>
</tr>
<tr>
<td align="left"><strong>安装</strong></td>
<td align="left">单一 <code>pip install ruff</code></td>
<td align="left">多个 <code>pip install</code></td>
</tr>
<tr>
<td align="left"><strong>内存占用</strong></td>
<td align="left">低</td>
<td align="left">相对较高</td>
</tr>
</tbody></table>
<h2 id="七、总结与展望"><a href="#七、总结与展望" class="headerlink" title="七、总结与展望"></a>七、总结与展望</h2><p>Ruff 作为 Python 生态系统中的新星，以其卓越的性能和功能整合能力，正在迅速改变 Python 代码检查和格式化的格局。它不仅仅是一个替代品，更是一个强大的整合器，极大地简化了工具链，提升了开发效率。</p>
<p>对于任何重视代码质量和开发效率的 Python 项目，Ruff 都值得尝试和推广。随着其功能的不断完善和社区生态的成熟，Ruff 很有可能成为未来 Python 项目中不可或缺的基石工具。</p>
<p><strong>未来展望：</strong></p>
<ul>
<li>更完善的 IDE 集成</li>
<li>更多定制化规则和插件支持</li>
<li>持续优化格式化器，实现与 Black 的完全对等甚至超越。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/55b69d9a9473/">https://blog.tbf1211.xx.kg/55b69d9a9473/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/">项目构建</a><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Lint/">Lint</a><a class="post-meta__tags" href="/tags/%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F/">代码质量</a><a class="post-meta__tags" href="/tags/CI-CD/">CI/CD</a><a class="post-meta__tags" href="/tags/2025/">2025</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-20.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/dd01f3539cef/" title="GORM (Go Object Relational Mapper) 深度解析"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-30.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">GORM (Go Object Relational Mapper) 深度解析</div></div><div class="info-2"><div class="info-item-1"> GORM 是 Go 语言中一个功能强大、对开发者友好的 ORM (Object Relational Mapper) 库。它旨在简化 Go 应用程序与数据库之间的交互，通过 Go 结构体（struct）来定义数据模型，并提供了一套丰富的 API 来执行数据库的 CRUD (Create, Read, Update, Delete) 操作、管理数据库迁移、处理关联关系、事务等。GORM 拥有广泛的数据库支持，包括 MySQL, PostgreSQL, SQLite, SQL Server 等。  核心思想：将数据库表映射为 Go 结构体，将数据库操作转换为 Go 对象的增删改查。 屏蔽了底层 SQL 的复杂性，提高了开发效率和代码可维护性。   一、为什么需要 ORM 及 GORM 的优势1.1 传统 SQL 操作的局限性在没有 ORM 的情况下，使用 Go 语言操作数据库通常涉及：  手动编写 SQL 语句：需要为每种操作（增、删、改、查）编写相应的 SQL 语句。 手动映射数据：从数据库查询结果集 (rows) 手动扫描到 Go 结构体中。 类型转换和错误处理：需要处理数据库...</div></div></div></a><a class="pagination-related" href="/6f6d3fe5250e/" title="fasthttp 深度解析"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">fasthttp 深度解析</div></div><div class="info-2"><div class="info-item-1"> fasthttp 是一个用 Go 语言编写的、高性能的 HTTP 服务器和客户端库。它旨在提供比 Go 标准库 net/http 更快的 HTTP 处理速度和更低的资源消耗。fasthttp 尤其适用于构建高性能的 API 服务、反向代理、负载均衡器以及任何对延迟和吞吐量有严苛要求的应用。  核心思想：fasthttp 通过零内存分配、请求&#x2F;响应对象重用、定制化的 HTTP 解析器以及对标准库的精简依赖，实现了极高的性能。它在设计上对性能进行了极致优化，但代价是与 net/http API 不完全兼容。   一、为什么选择 fasthttp？(与 Go 标准库 net/http 的对比)Go 语言标准库 net/http 提供了功能完善且易于使用的 HTTP 服务器和客户端，适用于绝大多数 Web 应用场景。然而，在某些对性能有极致要求的场景下，fasthttp 可以提供显著的优势：    特性 net/http (标准库) fasthttp    性能 良好，但在高并发下可能存在 GC 压力和额外开销。 卓越，旨在实现业界领先的性能 (通常比标准库快 5-10 倍)...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/312a685b1f28/" title="ESLint 与 Prettier 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-18.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-30</div><div class="info-item-2">ESLint 与 Prettier 详解</div></div><div class="info-2"><div class="info-item-1"> 在现代前端开发中，ESLint 和 Prettier 是两大不可或缺的工具，它们共同构成了代码质量和风格管理的核心。ESLint 专注于代码质量检查和规范强制，识别潜在 Bug 和不良实践；Prettier 则专注于代码格式化，确保代码外观的一致性。本文将深入探讨这两个工具的职责、工作原理，并提供如何将它们在项目中完美结合的最佳实践。  核心思想：  ESLint：检查代码质量，识别语法错误、潜在 Bug 和不推荐的编码模式。 Prettier：统一代码风格，自动格式化代码。两者分工明确，互为补充，共同提升代码质量和开发效率。    一、理解 ESLint：代码质量的守护者1.1 ESLint 是什么？ESLint 是一个可插拔的 JavaScript 和 TypeScript 代码检查工具。它通过解析代码的抽象语法树（AST），根据配置的规则来识别代码中潜在的问题。这些问题可以分为两类：  代码质量问题：语法错误、潜在的 Bug（如未使用的变量、未定义的变量、强制类型转换带来的问题）、不推荐的模式（如使用 eval、var 关键字）。 代码风格问题：例如缩进、引号使用、分号、...</div></div></div></a><a class="pagination-related" href="/4fb32da58385/" title="golangci-lint 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-11.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-31</div><div class="info-item-2">golangci-lint 详解</div></div><div class="info-2"><div class="info-item-1"> golangci-lint 是 Go 语言生态系统中一个快速、功能丰富的 linter 聚合器，它汇集了上百种静态代码分析工具 (linters)，并以并行、缓存和统一配置的方式运行它们。它的目标是帮助 Go 开发者在不牺牲性能的前提下，保持代码的高质量和一致性。  核心思想：将多个 Go 语言的静态分析工具整合到一个高效的命令行工具中，提供统一的配置和快速的执行，从而简化代码质量检查流程。   一、为什么需要 golangci-lint？Go 语言在代码风格和规范方面有 gofmt 和 go vet 等官方工具。然而，随着项目复杂度的增加，团队往往需要更全面的静态分析来捕捉潜在的 bug、性能问题、安全漏洞和违反最佳实践的代码。社区为此开发了大量的独立 linter 工具，例如 staticcheck、errcheck、gosec 等。 如果没有 golangci-lint，开发者将面临以下挑战：  管理复杂性：需要单独安装、配置和运行多个 linter 工具，这会增加工作流的复杂性。 性能问题：单独运行每个 linter 可能会导致重复解析源代码，从而降低效率，尤其是在大型...</div></div></div></a><a class="pagination-related" href="/193ee5c8eefc/" title="MarkdownLint 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-08.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-04</div><div class="info-item-2">MarkdownLint 详解</div></div><div class="info-2"><div class="info-item-1"> MarkdownLint 是一系列用于规范和检查 Markdown 文本格式的工具集合。它基于预定义的规则集（或用户自定义规则），自动扫描 Markdown 文件，识别出可能不符合规范、不一致、影响可读性或潜在渲染问题的语法或风格问题。通过 MarkdownLint，可以确保 Markdown 文档的质量、一致性和可维护性，特别是在团队协作或项目文档发布时。  核心思想：自动化检查 Markdown 文件的格式、风格和潜在错误，以确保文档质量和一致性。   一、为什么需要 MarkdownLint？Markdown 语言以其简洁性和易读性而广受欢迎，但其灵活的语法也可能导致以下问题：  风格不一致：团队成员可能有不同的 Markdown 写作习惯（例如，使用空格还是制表符缩进，标题与内容之间是否有空行，如何使用列表项符号等），导致文档风格混乱。 可读性下降：不规范的格式会影响文档的清晰度和可读性。 渲染问题：某些不标准的 Markdown 语法可能在不同的渲染器（如 GitHub、GitLab、Jupyter、各种 Markdown 编辑器）上呈现出不一致或错误的效果。 维护困...</div></div></div></a><a class="pagination-related" href="/18a421861554/" title="Golang 项目的 Makefile 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-17</div><div class="info-item-2">Golang 项目的 Makefile 详解</div></div><div class="info-2"><div class="info-item-1"> Makefile 是一种自动化构建工具，它通过定义文件之间的依赖关系和生成这些文件的命令，帮助开发者管理和自动化项目中的各种任务。尽管 Golang 自身提供了强大的内置工具链 (go build, go test, go run 等)，Makefile 在 Go 项目中依然扮演着重要角色，尤其是在需要协调多个任务、管理复杂构建流程、实现跨平台编译、集成外部工具或自动化部署脚本的场景下。  核心思想：将一系列 go 命令、Shell 脚本以及其他工具的调用封装成可复用的、有依赖关系的任务，实现一键式项目管理和自动化。   一、为什么 Go 项目需要 Makefile？Go 语言的工具链设计得非常出色，go build 能够自动处理依赖，go test 能够运行测试，go run 可以直接运行源代码。那么，为什么我们还需要 Makefile 呢？  任务编排与自动化： 一个 Go 项目通常不仅仅是编译代码。它可能涉及代码格式化 (go fmt)、静态分析 (go vet, golangci-lint)、代码生成 (go generate)、测试、构建 Docker 镜像、部署、清...</div></div></div></a><a class="pagination-related" href="/195d130ae5a4/" title="Ansible 深度解析"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-29</div><div class="info-item-2">Ansible 深度解析</div></div><div class="info-2"><div class="info-item-1"> Ansible 是一个开源的自动化引擎，用于配置管理 (Configuration Management)、应用部署 (Application Deployment)、任务自动化 (Task Automation) 和编排 (Orchestration)。它以其无代理 (Agentless)、简单易用和人性化的特点而广受欢迎。Ansible 使用标准的 SSH 协议连接到目标机器，并使用 YAML 语法编写自动化任务，使得编写、理解和维护自动化脚本变得直观。  核心思想：Ansible 通过 SSH 远程执行操作，无需在被管理节点上安装任何客户端或代理程序。它采用声明式 YAML 语言描述期望的状态，并确保系统达到该状态，同时保证操作的幂等性。   一、为什么选择 Ansible？传统的服务器管理和应用部署往往涉及大量重复、手工且容易出错的任务。随着 IT 基础设施的规模不断扩大，这种手工操作的弊端日益凸显：  效率低下：手动操作耗时且重复。 易出错：人为失误在重复性任务中难以避免。 配置漂移 (Configuration Drift)：不同服务器的配置可能因手工操作而逐渐不一...</div></div></div></a><a class="pagination-related" href="/53e63dc49a04/" title="PyInstaller 深度解析与指令详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-18.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-25</div><div class="info-item-2">PyInstaller 深度解析与指令详解</div></div><div class="info-2"><div class="info-item-1"> PyInstaller 是一个将 Python 应用程序及其所有依赖项（包括 Python 解释器本身、所有第三方库、数据文件等）打包成一个独立的、可执行的二进制文件的工具。其核心目标是简化 Python 应用程序的分发，使得最终用户无需安装 Python 环境或任何依赖即可直接运行程序。  核心思想：将 Python 应用程序及其所有运行时依赖“冻结”为一个独立的软件包，通常是一个可执行文件（.exe、可执行二进制文件等）或一个包含可执行文件和相关资源的目录。   一、为什么需要 PyInstaller？Python 应用程序的部署和分发常常面临以下挑战：  用户环境依赖：最终用户需要安装正确版本的 Python 解释器，并手动安装所有项目所需的第三方库。这对于非技术用户而言门槛较高。 环境差异性：不同操作系统、不同 Python 版本或不同库版本之间的兼容性问题可能导致应用程序在某些环境中无法正常运行。 依赖管理复杂性：应用程序依赖的库可能有很多，手动追踪和安装这些依赖既繁琐又容易出错。 源代码暴露：直接分发 Python 脚本会暴露源代码，这对于商业应用或知识产权保护而言...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">536</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">229</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">84</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-Ruff%EF%BC%9F"><span class="toc-text">一、为什么选择 Ruff？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Ruff-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-text">二、Ruff 的主要功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5-Linting"><span class="toc-text">2.1 代码检查 (Linting)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96-Formatting"><span class="toc-text">2.2 代码格式化 (Formatting)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85%E4%B8%8E%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">三、安装与基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%AE%89%E8%A3%85"><span class="toc-text">3.1 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text">3.2 基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5-Linting"><span class="toc-text">3.2.1 代码检查 (Linting)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E8%87%AA%E5%8A%A8%E4%BF%AE%E5%A4%8D-Auto-fix"><span class="toc-text">3.2.2 自动修复 (Auto-fix)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96-Formatting"><span class="toc-text">3.2.3 代码格式化 (Formatting)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-%E5%90%8C%E6%97%B6%E6%A3%80%E6%9F%A5%E5%B9%B6%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text">3.2.4 同时检查并格式化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE-Ruff"><span class="toc-text">四、配置 Ruff</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Ruff-%E5%9C%A8-CI-CD-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-text">五、Ruff 在 CI&#x2F;CD 中的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Ruff-%E4%B8%8E%E4%BC%A0%E7%BB%9F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-text">六、Ruff 与传统工具的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-text">七、总结与展望</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/8fc7e3e72510/" title="前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-30.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解"/></a><div class="content"><a class="title" href="/8fc7e3e72510/" title="前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解">前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解</a><time datetime="2026-01-27T22:24:00.000Z" title="发表于 2026-01-28 06:24:00">2026-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/5341a0037256/" title="CSS-in-JS 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-02.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS-in-JS 详解"/></a><div class="content"><a class="title" href="/5341a0037256/" title="CSS-in-JS 详解">CSS-in-JS 详解</a><time datetime="2026-01-25T22:24:00.000Z" title="发表于 2026-01-26 06:24:00">2026-01-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/0b52cb819619/" title="Git 核心对象：Commit, Tree, Blob 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git 核心对象：Commit, Tree, Blob 详解"/></a><div class="content"><a class="title" href="/0b52cb819619/" title="Git 核心对象：Commit, Tree, Blob 详解">Git 核心对象：Commit, Tree, Blob 详解</a><time datetime="2026-01-21T22:24:00.000Z" title="发表于 2026-01-22 06:24:00">2026-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1d2a942bda1e/" title="Terraform 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Terraform 详解"/></a><div class="content"><a class="title" href="/1d2a942bda1e/" title="Terraform 详解">Terraform 详解</a><time datetime="2026-01-19T22:24:00.000Z" title="发表于 2026-01-20 06:24:00">2026-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/26cdb2447b3d/" title="WebView 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WebView 详解"/></a><div class="content"><a class="title" href="/26cdb2447b3d/" title="WebView 详解">WebView 详解</a><time datetime="2026-01-17T22:24:00.000Z" title="发表于 2026-01-18 06:24:00">2026-01-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-20.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="🆕 2023">🆕 2023</a><a href="/archives/2024/" target="_blank" title="🆒 2024">🆒 2024</a><a href="/archives/2025/" target="_blank" title="👨‍👩‍👦 2025">👨‍👩‍👦 2025</a><a href="/archives/2026/" target="_blank" title="🆙 2026">🆙 2026</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="📁 分类">📁 分类</a><a href="/tags/" target="_blank" title="🔖 标签">🔖 标签</a><a href="/categories/" target="_blank" title="📽️ 时间线">📽️ 时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="💬 说说">💬 说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const parseViewBox = viewBox => {
    if (!viewBox) return null
    const parts = viewBox.trim().split(/[\s,]+/).map(n => Number(n))
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n))) return null
    return parts
  }

  const getSvgViewBox = svg => {
    const attr = parseViewBox(svg.getAttribute('viewBox'))
    if (attr) return attr

    // Fallback: use bbox to build a viewBox
    try {
      const bbox = svg.getBBox()
      if (bbox && bbox.width && bbox.height) return [bbox.x, bbox.y, bbox.width, bbox.height]
    } catch (e) {
      // getBBox may fail on some edge cases; ignore
    }

    const w = Number(svg.getAttribute('width')) || 0
    const h = Number(svg.getAttribute('height')) || 0
    if (w > 0 && h > 0) return [0, 0, w, h]
    return [0, 0, 100, 100]
  }

  const setSvgViewBox = (svg, vb) => {
    svg.setAttribute('viewBox', `${vb[0]} ${vb[1]} ${vb[2]} ${vb[3]}`)
  }

  const clamp = (v, min, max) => Math.max(min, Math.min(max, v))

  const openSvgInNewTab = ({ source, initViewBox }) => {
    const getClonedSvg = () => {
      if (typeof source === 'string') {
        const template = document.createElement('template')
        template.innerHTML = source.trim()
        const svg = template.content.querySelector('svg')
        return svg ? svg.cloneNode(true) : null
      }
      if (source && typeof source.cloneNode === 'function') {
        return source.cloneNode(true)
      }
      return null
    }

    const clone = getClonedSvg()
    if (!clone) return
    if (initViewBox && initViewBox.length === 4) {
      clone.setAttribute('viewBox', initViewBox.join(' '))
    }
    if (!clone.getAttribute('xmlns')) clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg')
    if (!clone.getAttribute('xmlns:xlink') && clone.outerHTML.includes('xlink:')) {
      clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink')
    }
    // inject background to match current theme
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
    const bg = getComputedStyle(document.body).backgroundColor || (isDark ? '#1e1e1e' : '#ffffff')
    if (!clone.style.background) clone.style.background = bg

    const serializer = new XMLSerializer()
    const svgSource = serializer.serializeToString(clone)
    const htmlSource = `<!doctype html><html><head><meta charset="utf-8" />
      <style>
        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${bg}; }
        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }
      </style>
      </head><body>${svgSource}</body></html>`
    const blob = new Blob([htmlSource], { type: 'text/html;charset=utf-8' })
    const url = URL.createObjectURL(blob)
    window.open(url, '_blank', 'noopener')
    setTimeout(() => URL.revokeObjectURL(url), 30000)
  }

  const attachMermaidViewerButton = wrap => {
    let btn = wrap.querySelector('.mermaid-open-btn')
    if (!btn) {
      btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'mermaid-open-btn'
      wrap.appendChild(btn)
    }

    btn.innerHTML = '<i class="fa fa-search fa-fw" aria-hidden="true"></i>'

    if (!btn.__mermaidViewerBound) {
      btn.addEventListener('click', e => {
        e.preventDefault()
        e.stopPropagation()
        const svg = wrap.__mermaidOriginalSvg || wrap.querySelector('svg')
        if (!svg) return
        const initViewBox = wrap.__mermaidInitViewBox
        if (typeof svg === 'string') {
          openSvgInNewTab({ source: svg, initViewBox })
          return
        }
        openSvgInNewTab({ source: svg, initViewBox })
      })
      btn.__mermaidViewerBound = true
    }
  }

  // Zoom around a point (px, py) in the SVG viewport (in viewBox coordinates)
  const zoomAtPoint = (vb, factor, px, py) => {
    const w = vb[2] * factor
    const h = vb[3] * factor
    const nx = px - (px - vb[0]) * factor
    const ny = py - (py - vb[1]) * factor
    return [nx, ny, w, h]
  }

  const initMermaidGestures = wrap => {
    const svg = wrap.querySelector('svg')
    if (!svg) return

    // Ensure viewBox exists so gestures always work
    const initVb = getSvgViewBox(svg)
    wrap.__mermaidInitViewBox = initVb
    wrap.__mermaidCurViewBox = initVb.slice()
    setSvgViewBox(svg, initVb)

    // Avoid binding multiple times on themeChange/pjax
    if (wrap.__mermaidGestureBound) return
    wrap.__mermaidGestureBound = true

    // Helper: map client (viewport) coordinate -> viewBox coordinate
    const clientToViewBox = (clientX, clientY) => {
      const rect = svg.getBoundingClientRect()
      const vb = wrap.__mermaidCurViewBox || getSvgViewBox(svg)
      const x = vb[0] + (clientX - rect.left) * (vb[2] / rect.width)
      const y = vb[1] + (clientY - rect.top) * (vb[3] / rect.height)
      return { x, y, rect, vb }
    }

    const state = {
      pointers: new Map(),
      startVb: null,
      startDist: 0,
      startCenter: null
    }

    const clampVb = vb => {
      const init = wrap.__mermaidInitViewBox || vb
      const minW = init[2] * 0.1
      const maxW = init[2] * 10
      const minH = init[3] * 0.1
      const maxH = init[3] * 10
      vb[2] = clamp(vb[2], minW, maxW)
      vb[3] = clamp(vb[3], minH, maxH)
      return vb
    }

    const setCurVb = vb => {
      vb = clampVb(vb)
      wrap.__mermaidCurViewBox = vb
      setSvgViewBox(svg, vb)
    }

    const onPointerDown = e => {
      // Allow only primary button for mouse
      if (e.pointerType === 'mouse' && e.button !== 0) return
      svg.setPointerCapture(e.pointerId)
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      if (state.pointers.size === 1) {
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      } else if (state.pointers.size === 2) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        state.startDist = Math.hypot(dx, dy)
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        state.startCenter = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 }
      }
    }

    const onPointerMove = e => {
      if (!state.pointers.has(e.pointerId)) return
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      // Pan with 1 pointer
      if (state.pointers.size === 1 && state.startVb) {
        const p = [...state.pointers.values()][0]
        const prev = { x: e.clientX - e.movementX, y: e.clientY - e.movementY }
        // movementX/Y unreliable on touch, compute from stored last position
        const last = wrap.__mermaidLastSinglePointer || p
        const dxClient = p.x - last.x
        const dyClient = p.y - last.y
        wrap.__mermaidLastSinglePointer = p

        const { rect } = clientToViewBox(p.x, p.y)
        const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        const dx = dxClient * (vb[2] / rect.width)
        const dy = dyClient * (vb[3] / rect.height)
        setCurVb([vb[0] - dx, vb[1] - dy, vb[2], vb[3]])
        return
      }

      // Pinch zoom with 2 pointers
      if (state.pointers.size === 2 && state.startVb && state.startDist > 0) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        const dist = Math.hypot(dx, dy)
        if (!dist) return
        const factor = state.startDist / dist // dist bigger => zoom in (viewBox smaller)

        const cx = (pts[0].x + pts[1].x) / 2
        const cy = (pts[0].y + pts[1].y) / 2
        const centerClient = { x: cx, y: cy }

        const pxy = clientToViewBox(centerClient.x, centerClient.y)
        const cpx = pxy.x
        const cpy = pxy.y

        const vb = zoomAtPoint(state.startVb, factor, cpx, cpy)
        setCurVb(vb)
      }
    }

    const onPointerUpOrCancel = e => {
      state.pointers.delete(e.pointerId)
      if (state.pointers.size === 0) {
        state.startVb = null
        state.startDist = 0
        state.startCenter = null
        wrap.__mermaidLastSinglePointer = null
      } else if (state.pointers.size === 1) {
        // reset single pointer baseline to avoid jump
        wrap.__mermaidLastSinglePointer = [...state.pointers.values()][0]
      }
    }

    // Wheel zoom (mouse/trackpad)
    const onWheel = e => {
      // ctrlKey on mac trackpad pinch; we treat both as zoom
      e.preventDefault()
      const delta = e.deltaY
      const zoomFactor = delta > 0 ? 1.1 : 0.9
      const { x, y } = clientToViewBox(e.clientX, e.clientY)
      const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      setCurVb(zoomAtPoint(vb, zoomFactor, x, y))
    }

    const onDblClick = () => {
      const init = wrap.__mermaidInitViewBox
      if (!init) return
      wrap.__mermaidCurViewBox = init.slice()
      setSvgViewBox(svg, init)
    }

    svg.addEventListener('pointerdown', onPointerDown)
    svg.addEventListener('pointermove', onPointerMove)
    svg.addEventListener('pointerup', onPointerUpOrCancel)
    svg.addEventListener('pointercancel', onPointerUpOrCancel)
    svg.addEventListener('wheel', onWheel, { passive: false })
    svg.addEventListener('dblclick', onDblClick)
  }

  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild

      // Clear old render (themeChange/pjax will rerun)
      const oldSvg = item.querySelector('svg')
      if (oldSvg) oldSvg.remove()
      item.__mermaidGestureBound = false

      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
        if (true) initMermaidGestures(item)
        item.__mermaidOriginalSvg = svg
        if (true) attachMermaidViewerButton(item)
      }


      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>