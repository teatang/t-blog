<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python神库Pydantic深度解析：数据验证与设置管理的利器 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pydantic 是一个 Python 库，用于数据验证和设置管理，它利用 Python 的类型提示 (type hints) 来定义数据模式。Pydantic 在运行时强制执行类型提示，并为您的数据提供友好的错误信息，使得数据模型更加健壮、可维护和自文档化。它广泛应用于 Web API (如 FastAPI)、数据科学、配置管理等领域。  核心思想：将 Python 的类型提示转化为强大的运行">
<meta property="og:type" content="article">
<meta property="og:title" content="Python神库Pydantic深度解析：数据验证与设置管理的利器">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/2025/2025-02-10_Python%E7%A5%9E%E5%BA%93Pydantic%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%A9%E5%99%A8/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="Pydantic 是一个 Python 库，用于数据验证和设置管理，它利用 Python 的类型提示 (type hints) 来定义数据模式。Pydantic 在运行时强制执行类型提示，并为您的数据提供友好的错误信息，使得数据模型更加健壮、可维护和自文档化。它广泛应用于 Web API (如 FastAPI)、数据科学、配置管理等领域。  核心思想：将 Python 的类型提示转化为强大的运行">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-13.jpg">
<meta property="article:published_time" content="2025-02-09T22:24:00.000Z">
<meta property="article:modified_time" content="2025-10-21T02:09:28.380Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="2025">
<meta property="article:tag" content="Pydantic">
<meta property="article:tag" content="数据校验">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-13.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python神库Pydantic深度解析：数据验证与设置管理的利器",
  "url": "https://blog.tbf1211.xx.kg/2025/2025-02-10_Python%E7%A5%9E%E5%BA%93Pydantic%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%A9%E5%99%A8/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-13.jpg",
  "datePublished": "2025-02-09T22:24:00.000Z",
  "dateModified": "2025-10-21T02:09:28.380Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/2025/2025-02-10_Python%E7%A5%9E%E5%BA%93Pydantic%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%A9%E5%99%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python神库Pydantic深度解析：数据验证与设置管理的利器',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">154</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">55</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-13.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">Python神库Pydantic深度解析：数据验证与设置管理的利器</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Python神库Pydantic深度解析：数据验证与设置管理的利器</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-02-09T22:24:00.000Z" title="发表于 2025-02-10 06:24:00">2025-02-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/%E5%BA%93/">库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="umamiPV" data-path="/2025/2025-02-10_Python%E7%A5%9E%E5%BA%93Pydantic%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%A9%E5%99%A8/"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>Pydantic</strong> 是一个 Python 库，用于<strong>数据验证</strong>和<strong>设置管理</strong>，它利用 Python 的<strong>类型提示 (type hints)</strong> 来定义数据模式。Pydantic 在运行时强制执行类型提示，并为您的数据提供友好的错误信息，使得数据模型更加健壮、可维护和自文档化。它广泛应用于 Web API (如 FastAPI)、数据科学、配置管理等领域。</p>
</blockquote>
<div class="note info flat"><p>核心思想：将 Python 的类型提示转化为强大的运行时数据验证和序列化工具，从而提高代码的健壮性和开发效率。</p>
</div>

<h2 id="一、为什么需要-Pydantic？"><a href="#一、为什么需要-Pydantic？" class="headerlink" title="一、为什么需要 Pydantic？"></a>一、为什么需要 Pydantic？</h2><p>在现代 Python 应用开发中，数据从外部来源（如 JSON API、数据库、配置文件、用户输入）进入系统是常态。这些外部数据往往不可信，结构复杂且容易出错。传统的 Python 处理方式存在一些问题：</p>
<ol>
<li><strong>缺乏数据验证</strong>：直接使用字典或弱类型对象，无法保证数据的结构和类型正确性，容易导致运行时错误。</li>
<li><strong>手动验证繁琐</strong>：编写大量的 <code>if/else</code> 语句进行数据类型检查和值验证，导致代码冗长、难以维护。</li>
<li><strong>序列化&#x2F;反序列化复杂</strong>：将 Python 对象转换为 JSON&#x2F;XML 或反之，需要手动处理字段映射和类型转换。</li>
<li><strong>配置管理混乱</strong>：应用配置往往散落在字典或环境变量中，缺乏统一的验证和管理机制。</li>
</ol>
<p>Pydantic 旨在解决这些问题，提供以下优势：</p>
<ul>
<li><strong>运行时类型检查</strong>：强制执行 Python 类型提示，在数据加载时即捕获类型错误。</li>
<li><strong>清晰的数据模型</strong>：使用 Python 类和类型提示直观定义数据结构，自文档化。</li>
<li><strong>自动数据转换</strong>：尝试将输入数据转换为模型中定义的正确类型（例如，将 “123” 转换为 <code>int</code>）。</li>
<li><strong>友好的错误报告</strong>：当数据不符合模型时，生成详细、易读的验证错误信息。</li>
<li><strong>兼容性好</strong>：兼容 Python 标准库 <code>typing</code> 模块，与其他类型提示工具（如 MyPy）配合良好。</li>
<li><strong>灵活的配置管理</strong>：轻松从环境变量、文件等加载配置。</li>
<li><strong>与 FastAPI 无缝集成</strong>：Pydantic 是 FastAPI 的核心组件，用于请求体、响应体、路径参数等的自动验证和序列化。</li>
</ul>
<h2 id="二、安装-Pydantic"><a href="#二、安装-Pydantic" class="headerlink" title="二、安装 Pydantic"></a>二、安装 Pydantic</h2><p><code>Pydantic</code> 可以通过 <code>pip</code> 安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pydantic</span><br></pre></td></tr></table></figure>

<h2 id="三、基本使用：定义数据模型-BaseModel"><a href="#三、基本使用：定义数据模型-BaseModel" class="headerlink" title="三、基本使用：定义数据模型 (BaseModel)"></a>三、基本使用：定义数据模型 (BaseModel)</h2><p>Pydantic 的核心是 <code>BaseModel</code>。通过继承 <code>BaseModel</code> 并使用标准 Python 类型提示定义类属性，即可创建一个数据模型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field, EmailStr, ValidationError</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span>, <span class="type">Dict</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 定义一个基本的用户模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="built_in">id</span>: <span class="built_in">int</span></span><br><span class="line">    name: <span class="built_in">str</span> = <span class="string">&quot;Anonymous&quot;</span> <span class="comment"># 默认值，如果未提供则使用</span></span><br><span class="line">    email: EmailStr         <span class="comment"># Pydantic 内置的 Email 类型验证器</span></span><br><span class="line">    age: <span class="type">Optional</span>[<span class="built_in">int</span>] = <span class="literal">None</span> <span class="comment"># Optional 表示可以是 int 或 None</span></span><br><span class="line">    is_active: <span class="built_in">bool</span> = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 从字典创建模型实例 (数据验证在此处发生)</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user_data = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;alice@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">    user = User(**user_data) <span class="comment"># **user_data 会将字典解包为关键字参数</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;用户 ID: <span class="subst">&#123;user.<span class="built_in">id</span>&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(user.<span class="built_in">id</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;用户姓名: <span class="subst">&#123;user.name&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(user.name)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;用户邮箱: <span class="subst">&#123;user.email&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(user.email)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;用户年龄: <span class="subst">&#123;user.age&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(user.age)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;用户是否活跃: <span class="subst">&#123;user.is_active&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(user.is_active)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;模型实例: <span class="subst">&#123;user.model_dump_json(indent=<span class="number">2</span>)&#125;</span>&quot;</span>) <span class="comment"># Pydantic v2: model_dump_json</span></span><br><span class="line">    <span class="comment"># Pydantic v1: user.json(indent=2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试创建不含 name 的实例，会使用默认值</span></span><br><span class="line">    user_no_name = User(<span class="built_in">id</span>=<span class="number">456</span>, email=<span class="string">&quot;bob@example.com&quot;</span>, age=<span class="number">25</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;不含 name 的用户: <span class="subst">&#123;user_no_name.name&#125;</span>&quot;</span>) <span class="comment"># Bob</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数据验证错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 数据验证失败示例</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    invalid_user_data = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;abc&quot;</span>, <span class="comment"># id 应该是 int</span></span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;invalid-email&quot;</span>, <span class="comment"># 无效的邮箱格式</span></span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="string">&quot;twenty&quot;</span> <span class="comment"># age 应该是 int</span></span><br><span class="line">    &#125;</span><br><span class="line">    invalid_user = User(**invalid_user_data)</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- 验证失败示例 ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(e.json(indent=<span class="number">2</span>)) <span class="comment"># 输出详细的 JSON 格式错误信息</span></span><br><span class="line">    <span class="comment"># [</span></span><br><span class="line">    <span class="comment">#   &#123;</span></span><br><span class="line">    <span class="comment">#     &quot;type&quot;: &quot;int_parsing&quot;,</span></span><br><span class="line">    <span class="comment">#     &quot;loc&quot;: [</span></span><br><span class="line">    <span class="comment">#       &quot;id&quot;</span></span><br><span class="line">    <span class="comment">#     ],</span></span><br><span class="line">    <span class="comment">#     &quot;msg&quot;: &quot;Input should be a valid integer, unable to parse string &#x27;abc&#x27;&quot;,</span></span><br><span class="line">    <span class="comment">#     &quot;input&quot;: &quot;abc&quot;</span></span><br><span class="line">    <span class="comment">#   &#125;,</span></span><br><span class="line">    <span class="comment">#   &#123;</span></span><br><span class="line">    <span class="comment">#     &quot;type&quot;: &quot;string_pattern_mismatch&quot;,</span></span><br><span class="line">    <span class="comment">#     &quot;loc&quot;: [</span></span><br><span class="line">    <span class="comment">#       &quot;email&quot;</span></span><br><span class="line">    <span class="comment">#     ],</span></span><br><span class="line">    <span class="comment">#     &quot;msg&quot;: &quot;String should match pattern &#x27;\\^.+@.+\\.\\S+\\$&#x27;&quot;, # 邮箱正则匹配失败</span></span><br><span class="line">    <span class="comment">#     &quot;input&quot;: &quot;invalid-email&quot;</span></span><br><span class="line">    <span class="comment">#   &#125;,</span></span><br><span class="line">    <span class="comment">#   &#123;</span></span><br><span class="line">    <span class="comment">#     &quot;type&quot;: &quot;int_parsing&quot;,</span></span><br><span class="line">    <span class="comment">#     &quot;loc&quot;: [</span></span><br><span class="line">    <span class="comment">#       &quot;age&quot;</span></span><br><span class="line">    <span class="comment">#     ],</span></span><br><span class="line">    <span class="comment">#     &quot;msg&quot;: &quot;Input should be a valid integer, unable to parse string &#x27;twenty&#x27;&quot;,</span></span><br><span class="line">    <span class="comment">#     &quot;input&quot;: &quot;twenty&quot;</span></span><br><span class="line">    <span class="comment">#   &#125;</span></span><br><span class="line">    <span class="comment"># ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 嵌套模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Address</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    street: <span class="built_in">str</span></span><br><span class="line">    city: <span class="built_in">str</span></span><br><span class="line">    zip_code: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserProfile</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    user_details: User</span><br><span class="line">    home_address: Address</span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>] = [] <span class="comment"># 列表类型</span></span><br><span class="line">    params: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>]] <span class="comment"># 字典类型，值可以是 int 或 str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    profile_data = &#123;</span><br><span class="line">        <span class="string">&quot;user_details&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: <span class="string">&quot;jane@example.com&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;home_address&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;street&quot;</span>: <span class="string">&quot;123 Main St&quot;</span>,</span><br><span class="line">            <span class="string">&quot;city&quot;</span>: <span class="string">&quot;Anytown&quot;</span>,</span><br><span class="line">            <span class="string">&quot;zip_code&quot;</span>: <span class="string">&quot;12345&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;tags&quot;</span>: [<span class="string">&quot;developer&quot;</span>, <span class="string">&quot;python&quot;</span>],</span><br><span class="line">        <span class="string">&quot;params&quot;</span>: &#123;<span class="string">&quot;level&quot;</span>: <span class="number">10</span>, <span class="string">&quot;status&quot;</span>: <span class="string">&quot;active&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    profile = UserProfile(**profile_data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- 嵌套模型示例 ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(profile.model_dump_json(indent=<span class="number">2</span>))</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;嵌套模型验证错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="关键点："><a href="#关键点：" class="headerlink" title="关键点："></a>关键点：</h3><ul>
<li><strong>类型提示</strong>：<code>id: int</code>, <code>name: str</code> 定义了字段的预期类型。</li>
<li><strong>默认值</strong>：<code>name: str = &quot;Anonymous&quot;</code> 为字段提供了默认值。</li>
<li><strong><code>Optional</code></strong>：<code>age: Optional[int] = None</code> 表示 <code>age</code> 字段可以为 <code>int</code> 类型，也可以为 <code>None</code>。</li>
<li><strong>内置类型和验证器</strong>：Pydantic 提供了像 <code>EmailStr</code> 这样的特殊类型，自动进行格式验证。</li>
<li><strong>数据转换</strong>：Pydantic 会尝试将传入的数据转换为目标类型。例如，如果 <code>id: int</code> 但传入 <code>&quot;123&quot;</code>，Pydantic 会自动将其转换为整数。</li>
<li><strong>错误信息</strong>：验证失败时，会抛出 <code>ValidationError</code> 并提供详细的错误列表。</li>
<li><strong>嵌套模型</strong>：模型可以相互嵌套，轻松构建复杂的数据结构。</li>
</ul>
<h2 id="四、字段验证-Field"><a href="#四、字段验证-Field" class="headerlink" title="四、字段验证 (Field)"></a>四、字段验证 (Field)</h2><p>除了基本的类型验证，Pydantic 还允许通过 <code>Field</code> 函数为字段添加更细粒度的验证规则、别名和元数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field, ValidationError</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = Field(min_length=<span class="number">3</span>, max_length=<span class="number">50</span>, description=<span class="string">&quot;商品的名称&quot;</span>)</span><br><span class="line">    price: <span class="built_in">float</span> = Field(gt=<span class="number">0</span>, description=<span class="string">&quot;商品的价格，必须大于0&quot;</span>) <span class="comment"># gt: greater than</span></span><br><span class="line">    rating: <span class="built_in">int</span> = Field(ge=<span class="number">1</span>, le=<span class="number">5</span>, description=<span class="string">&quot;商品的评分，1到5之间&quot;</span>) <span class="comment"># ge: greater equal, le: less equal</span></span><br><span class="line">    item_id: <span class="built_in">str</span> = Field(alias=<span class="string">&quot;id_&quot;</span>) <span class="comment"># 使用 id_ 作为别名，实际数据传入 id_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item_data_valid = &#123;</span><br><span class="line">        <span class="string">&quot;id_&quot;</span>: <span class="string">&quot;item001&quot;</span>, <span class="comment"># 注意这里传入的是别名</span></span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Laptop&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">999.99</span>,</span><br><span class="line">        <span class="string">&quot;rating&quot;</span>: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">    item = Item(**item_data_valid)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;有效商品: <span class="subst">&#123;item.model_dump_json(indent=<span class="number">2</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;访问 item.name: <span class="subst">&#123;item.name&#125;</span>&quot;</span>) <span class="comment"># 依然通过 name 访问</span></span><br><span class="line"></span><br><span class="line">    item_data_invalid_price = &#123;</span><br><span class="line">        <span class="string">&quot;id_&quot;</span>: <span class="string">&quot;item002&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Book&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: -<span class="number">10.0</span>, <span class="comment"># 无效价格</span></span><br><span class="line">        <span class="string">&quot;rating&quot;</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    invalid_item = Item(**item_data_invalid_price)</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- Field 验证失败示例 ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(e.json(indent=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    item_data_invalid_name = &#123;</span><br><span class="line">        <span class="string">&quot;id_&quot;</span>: <span class="string">&quot;item003&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="comment"># 长度小于3</span></span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="string">&quot;rating&quot;</span>: <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line">    invalid_item = Item(**item_data_invalid_name)</span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- Field 字符串长度验证失败示例 ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(e.json(indent=<span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Field-函数的常见参数："><a href="#Field-函数的常见参数：" class="headerlink" title="Field 函数的常见参数："></a><code>Field</code> 函数的常见参数：</h3><ul>
<li><code>default</code>: 默认值。</li>
<li><code>default_factory</code>: 默认为可调用对象，每次访问时生成新默认值。</li>
<li><code>alias</code>: 字段的别名，在数据加载时使用，但访问时仍用原字段名。</li>
<li><code>title</code>, <code>description</code>: 用于文档生成（如 FastAPI 的 OpenAPI 文档）。</li>
<li><code>min_length</code>, <code>max_length</code>: 字符串长度限制。</li>
<li><code>gt</code>, <code>ge</code>, <code>lt</code>, <code>le</code>: 数值大小限制 (大于, 大于等于, 小于, 小于等于)。</li>
<li><code>multiple_of</code>: 数值必须是某个数的倍数。</li>
<li><code>pattern</code>: 字符串必须匹配的正则表达式。</li>
</ul>
<h2 id="五、Pydantic-Settings-配置管理"><a href="#五、Pydantic-Settings-配置管理" class="headerlink" title="五、Pydantic Settings (配置管理)"></a>五、Pydantic <code>Settings</code> (配置管理)</h2><p>Pydantic 的 <code>BaseSettings</code>（Pydantic v2 中已解耦为 <code>pydantic-settings</code>）是其一大亮点，用于优雅地管理应用程序配置。它能够自动从环境变量、<code>.env</code> 文件等加载配置，并进行验证。</p>
<p>需要单独安装 <code>pydantic-settings</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pydantic-settings</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic_settings <span class="keyword">import</span> BaseSettings, SettingsConfigDict</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了方便演示，这里不实际创建 .env 文件，而是直接修改环境变量。</span></span><br><span class="line"><span class="comment"># 在实际项目中，通常会创建一个 .env 文件，内容如下：</span></span><br><span class="line"><span class="comment"># APP_NAME=My Awesome App</span></span><br><span class="line"><span class="comment"># DEBUG_MODE=True</span></span><br><span class="line"><span class="comment"># DATABASE_URL=postgresql://user:pass@host:port/db</span></span><br><span class="line"><span class="comment"># PORT=8000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 .env 文件加载 (如果存在)</span></span><br><span class="line"><span class="comment"># os.environ[&quot;APP_NAME&quot;] = &quot;TestApp&quot; # 模拟设置环境变量</span></span><br><span class="line"><span class="comment"># os.environ[&quot;DEBUG_MODE&quot;] = &quot;True&quot;</span></span><br><span class="line"><span class="comment"># os.environ[&quot;PORT&quot;] = &quot;8000&quot;</span></span><br><span class="line"><span class="comment"># os.environ[&quot;SECRET_KEY&quot;] = &quot;super-secret&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppSettings</span>(<span class="title class_ inherited__">BaseSettings</span>):</span><br><span class="line">    app_name: <span class="built_in">str</span> = <span class="string">&quot;Default App&quot;</span></span><br><span class="line">    debug_mode: <span class="built_in">bool</span> = <span class="literal">False</span></span><br><span class="line">    database_url: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    port: <span class="built_in">int</span> = <span class="number">8000</span></span><br><span class="line">    secret_key: <span class="built_in">str</span> <span class="comment"># 必需的配置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pydantic v2 配置模型来源</span></span><br><span class="line">    model_config = SettingsConfigDict(</span><br><span class="line">        env_file=<span class="string">&#x27;.env&#x27;</span>, <span class="comment"># 指定从 .env 文件加载</span></span><br><span class="line">        env_file_encoding=<span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">        extra=<span class="string">&#x27;ignore&#x27;</span>, <span class="comment"># 忽略 .env 中模型未定义的其他变量</span></span><br><span class="line">        case_sensitive=<span class="literal">False</span> <span class="comment"># 环境变量名称不区分大小写</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Pydantic v1 配置模型来源</span></span><br><span class="line">    <span class="comment"># class Config:</span></span><br><span class="line">    <span class="comment">#     env_file = &#x27;.env&#x27;</span></span><br><span class="line">    <span class="comment">#     env_file_encoding = &#x27;utf-8&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 模拟从环境变量加载 (Pydantic 会自动查找)</span></span><br><span class="line">    <span class="comment"># 假设环境变量已设置：</span></span><br><span class="line">    <span class="comment"># export APP_NAME=&quot;My_Production_App&quot;</span></span><br><span class="line">    <span class="comment"># export SECRET_KEY=&quot;very_secure_key&quot;</span></span><br><span class="line">    settings = AppSettings()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- 应用设置示例 ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;App Name: <span class="subst">&#123;settings.app_name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Debug Mode: <span class="subst">&#123;settings.debug_mode&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Database URL: <span class="subst">&#123;settings.database_url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Port: <span class="subst">&#123;settings.port&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Secret Key: <span class="subst">&#123;settings.secret_key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pydantic v2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;设置模型 JSON: <span class="subst">&#123;settings.model_dump_json(indent=<span class="number">2</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证失败示例: 如果 SECRET_KEY 未设置</span></span><br><span class="line"><span class="keyword">except</span> ValidationError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n--- 设置加载失败示例 ---&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;缺少必要的配置项: <span class="subst">&#123;e.json(indent=<span class="number">2</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="关键点：-1"><a href="#关键点：-1" class="headerlink" title="关键点："></a>关键点：</h3><ul>
<li><strong><code>BaseSettings</code></strong>：继承自 <code>BaseSettings</code>。</li>
<li><strong><code>SettingsConfigDict</code> (v2) &#x2F; <code>Config</code> (v1)</strong>：内部类用于配置设置的加载行为，如指定 <code>.env</code> 文件路径。</li>
<li><strong>加载优先级</strong>：Pydantic 会按一定优先级加载配置：<ol>
<li>直接作为参数传入 <code>AppSettings()</code>。</li>
<li>环境变量。</li>
<li><code>.env</code> 文件。</li>
<li>字段的默认值。</li>
</ol>
</li>
<li><strong>自动类型转换</strong>：环境变量的值（通常是字符串）会根据模型中的类型提示自动转换（例如 “TRUE” 自动转为 <code>True</code>，”8000” 自动转为 <code>8000</code>）。这省去了大量的 <code>os.getenv()</code> 和手动转换操作。</li>
</ul>
<h2 id="六、与-FastAPI-的集成"><a href="#六、与-FastAPI-的集成" class="headerlink" title="六、与 FastAPI 的集成"></a>六、与 FastAPI 的集成</h2><p>Pydantic 是 FastAPI 的核心，它几乎在所有数据处理环节都发挥作用：</p>
<ol>
<li><p><strong>请求体 (Request Body) 验证</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Optional</span>[<span class="built_in">float</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>): <span class="comment"># FastAPI 会自动使用 Pydantic 验证请求体 JSON</span></span><br><span class="line">    <span class="keyword">return</span> item.model_dump() <span class="comment"># Pydantic v2: item.model_dump()</span></span><br><span class="line">    <span class="comment"># Pydantic v1: item.dict()</span></span><br></pre></td></tr></table></figure>

<p>当接收到一个 POST 请求时，FastAPI 会尝试将请求体 JSON 数据验证为 <code>Item</code> 模型的实例。如果失败，会自动返回包含详细错误信息的 <code>422 Unprocessable Entity</code> 响应。</p>
</li>
<li><p><strong>响应模型 (Response Model)</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item</span>) </span><span class="comment"># 声明响应体应符合 Item 模型</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="comment"># 实际数据可能来自数据库或计算</span></span><br><span class="line">    fake_db_item = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>, <span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">return</span> fake_db_item <span class="comment"># FastAPI 会自动验证并序列化为 Item 模型</span></span><br></pre></td></tr></table></figure>

<p><code>response_model</code> 参数用于确保从 <code>read_item</code> 返回的数据符合 <code>Item</code> 模型的结构，并将其序列化。</p>
</li>
<li><p><strong>路径参数和查询参数验证</strong>：Pydantic 类型提示也会用于路径和查询参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&#123;user_id&#125;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user_items</span>(<span class="params">user_id: <span class="built_in">int</span>, q: <span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment"># user_id 会被验证为 int</span></span><br><span class="line">    <span class="comment"># q 会被验证为 str 或 None</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: user_id, <span class="string">&quot;q&quot;</span>: q&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="七、Pydantic-v2-的新特性-与-v1-对比"><a href="#七、Pydantic-v2-的新特性-与-v1-对比" class="headerlink" title="七、Pydantic v2 的新特性 (与 v1 对比)"></a>七、Pydantic v2 的新特性 (与 v1 对比)</h2><p>Pydantic v2 在性能和功能上带来了显著改进，主要基于 <code>Rust</code> 重写了核心验证逻辑，并引入了一些 API 变更：</p>
<ul>
<li><strong>性能提升</strong>：核心验证引擎用 Rust 编写，性能比 v1 提高了 5-50 倍。</li>
<li><strong>更一致的 API</strong>：<ul>
<li><code>dict()</code> -&gt; <code>model_dump()</code></li>
<li><code>json()</code> -&gt; <code>model_dump_json()</code></li>
<li><code>parse_obj()</code> -&gt; <code>model_validate()</code></li>
<li><code>parse_raw()</code> -&gt; <code>model_validate_json()</code></li>
<li><code>Config</code> -&gt; <code>model_config</code> (类属性) 和 <code>SettingsConfigDict</code> (用于 BaseSettings)。</li>
</ul>
</li>
<li><strong><code>Field</code> 变更</strong>：<code>Field(**extra_attrs)</code> 不再合法，应使用 <code>JsonSchemaExtra</code> 或 <code>extra</code> 字典。</li>
<li><strong>更强大的数据类型</strong>：引入更多内置类型。</li>
<li><strong>更灵活的验证器</strong>：支持更复杂的自定义验证逻辑。</li>
</ul>
<p><strong>迁移建议</strong>：对于新项目，强烈推荐直接使用 Pydantic v2。对于现有 v1 项目，可以先进行小的增量迁移，或使用 <code>pydantic-settings</code> 替代 <code>BaseSettings</code>。</p>
<h2 id="八、总结与进阶"><a href="#八、总结与进阶" class="headerlink" title="八、总结与进阶"></a>八、总结与进阶</h2><p>Pydantic 不仅仅是一个验证库，它更是一种编写健壮、可维护和自文档化 Python 代码的范式。通过统一数据模型、强制类型检查和自动化序列化&#x2F;反序列化，它极大地提高了开发效率和代码质量。</p>
<p><strong>进阶方向：</strong></p>
<ul>
<li><strong>自定义验证器 (<code>@model_validator</code>, <code>@field_validator</code>)</strong>：编写自己的验证逻辑。</li>
<li><strong><code>ComputedField</code> (v2)</strong>：根据其他字段计算得出新字段。</li>
<li><strong><code>model_post_init</code> (v2)</strong>：在模型初始化后执行额外逻辑。</li>
<li><strong><code>ConfigDict</code> (v2)</strong>：探索更多模型配置选项，如 <code>extra=&#39;allow&#39;/&#39;forbid&#39;/&#39;ignore&#39;</code>, <code>frozen=True</code>。</li>
<li><strong>泛型模型 (<code>GenericModel</code>)</strong>：创建可重用的泛型数据结构。</li>
<li><strong>与 ORM&#x2F;ODM 集成</strong>：结合 SQLAlchemy 等数据库工具。</li>
<li><strong>协议缓冲&#x2F;序列化</strong>：用于更高效的数据传输。</li>
</ul>
<p>无论你是在构建 Web API、处理数据管道还是管理复杂的应用程序配置，Pydantic 都是你工具箱中不可或缺的强大利器。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/2025/2025-02-10_Python%E7%A5%9E%E5%BA%93Pydantic%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%A9%E5%99%A8/">https://blog.tbf1211.xx.kg/2025/2025-02-10_Python%E7%A5%9E%E5%BA%93Pydantic%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%AE%A1%E7%90%86%E7%9A%84%E5%88%A9%E5%99%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/2025/">2025</a><a class="post-meta__tags" href="/tags/Pydantic/">Pydantic</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C/">数据校验</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-13.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/2025-02-11_%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86%E6%96%B9%E6%A1%88Loki%E8%AF%A6%E8%A7%A3%EF%BC%9A%E8%BD%BB%E9%87%8F%E3%80%81%E9%AB%98%E6%95%88%E3%80%81%E5%8F%AF%E6%89%A9%E5%B1%95/" title="日志采集方案Loki详解：轻量、高效、可扩展"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-14.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">日志采集方案Loki详解：轻量、高效、可扩展</div></div><div class="info-2"><div class="info-item-1"> Loki 是由 Grafana Labs 构建的一款开源的、多租户日志聚合系统，它与其他日志系统最大的不同在于它不索引日志内容，只索引日志的元数据 (labels)。这种设计思路使得 Loki 在存储和查询方面都非常高效和经济，尤其适合与 Prometheus 和 Grafana 配合使用，形成一个完整的可观测性栈。  核心理念：日志不是用来全文搜索的，而是用来从标签维度过滤的。   一、传统日志系统的痛点在理解 Loki 之前，我们先回顾一下传统日志系统（如 Elasticsearch + Logstash + Kibana，即 ELK 栈）在使用中可能遇到的问题：  存储成本高昂：为了实现全文搜索，ELK 会为每条日志的全部内容建立倒排索引。这导致索引数据量巨大，通常是原始日志的数倍，存储成本显著增加。 维护复杂：ELK 栈组件多，部署和维护复杂，对系统资源要求高。 计算资源消耗大：全文搜索对 CPU 和内存消耗巨大，尤其是在处理海量日志时。 实时性挑战：索引构建需要时间，查询实时性可能受影响。  Loki 的出现就是旨在解决这些痛点，提供一个更轻量、更经济的日志解决方案。...</div></div></div></a><a class="pagination-related" href="/2025/2025-02-04_PromQL%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Prometheus%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80/" title="PromQL详解：深入理解Prometheus查询语言"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-16.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">PromQL详解：深入理解Prometheus查询语言</div></div><div class="info-2"><div class="info-item-1"> PromQL (Prometheus Query Language) 是 Prometheus 监控系统中用于查询、聚合和分析时间序列数据的一种功能强大的查询语言。它是 Prometheus 核心价值的体现之一。无论你是要构建仪表盘、创建告警规则，还是进行故障排查，PromQL 都是你与 Prometheus 数据进行交互的唯一途径。掌握 PromQL 是有效利用 Prometheus 的关键。  “PromQL 让你能够将原始指标数据转化为有意义的洞察和可操作的智能信息。”   一、Prometheus 指标类型回顾在深入 PromQL 之前，我们先快速回顾一下 Prometheus 的四种核心指标类型，因为 PromQL 的查询行为会根据指标类型有所不同：  Counter (计数器)：一种累计型指标，只增不减（重置除外）。通常用于统计请求总数、错误总数等。 例子：http_requests_total 适用 PromQL 函数：rate()、irate()、increase()   Gauge (测量仪)：一种可任意上下变动的指标，反映当前状态。通常用于表示内存使用量、C...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/2025-05-12_Python%20%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%20uv%20%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%B8%8B%E4%B8%80%E4%BB%A3%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%8E%E6%9E%84%E5%BB%BA%E5%99%A8/" title="Python 打包工具 uv 详解：下一代包管理器与构建器"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-05.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">Python 打包工具 uv 详解：下一代包管理器与构建器</div></div><div class="info-2"><div class="info-item-1"> uv (通常读作 “yoo-vee”) 是由 Astral (Rye, Ruff, Linter 等工具的创造者) 开源的一个超快的 Python 包管理器和包安装器，旨在成为 pip 和 venv 的直接替代品。它使用 Rust 编写，专注于速度、可靠性和稳定性，正在迅速改变 Python 包管理的格局。  传统的 Python 包管理工具如 pip 和 venv 虽然功能完善，但在大规模项目或频繁操作时，其性能瓶颈日益凸显。例如，复杂的依赖解析可能耗时很久，创建虚拟环境也并非瞬间完成。uv 的出现正是为了解决这些痛点，它将速度提升了几个数量级，并且提供了更加一致和可靠的语义。   一、uv 简介与核心优势uv 的诞生是为了提供一个现代、高效的 Python 包管理解决方案，它集成了 包安装器、解析器和虚拟环境管理器 的功能。 uv 的核心优势：  极速性能：这是 uv 最突出的特点。由于使用 Rust 编写，并采用了先进的图算法进行依赖解析，uv 在安装、更新、解析依赖等操作上比 pip 和 venv 快 10-100 倍。 单一工具链：uv 不仅是一个安装器，还集成了虚拟...</div></div></div></a><a class="pagination-related" href="/2023/2023-02-09_Python%E5%85%83%E7%B1%BB(Metaclass)%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/" title="Python元类(Metaclass)深度解析"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-09.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-09</div><div class="info-item-2">Python元类(Metaclass)深度解析</div></div><div class="info-2"><div class="info-item-1">Python 元类深度解析：从概念到实战  “Everything is an object.” - Python之禅“Classes are objects too.” - 元类的核心思想  在 Python 中，万物皆对象。你用 class 关键字定义的类，例如 str、int、list，它们本身也是对象。那么，是谁创建了这些类对象呢？答案就是“元类”(Metaclass)。元类是创建类的类，它允许我们在类被创建时对其行为进行定制，是 Python 中进行高级面向对象编程的强大工具。 1. 什么是元类？在 Python 中，当你定义一个类 class MyClass: pass 的时候，Python 解释器会自动执行以下步骤：  定义一个类对象：解释器读取 MyClass 的定义，并创建一个名为 MyClass 的类对象。 将类对象绑定到命名空间：这个 MyClass 类对象被绑定到当前的命名空间中。  然后，当你通过 my_instance = MyClass() 来创建实例时，MyClass 这个类对象就会被调用，从而创建并返回一个实例对象。 元类就是用来创建这些类对象的...</div></div></div></a><a class="pagination-related" href="/2023/2023-02-15_Python%20NumPy%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E7%9A%84%E5%9F%BA%E7%9F%B3/" title="Python NumPy详解：科学计算的基石"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-04.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-15</div><div class="info-item-2">Python NumPy详解：科学计算的基石</div></div><div class="info-2"><div class="info-item-1"> NumPy (Numerical Python) 是 Python 中用于科学计算的核心库。它提供了一个高性能的多维数组对象 ndarray，以及用于处理这些数组的工具。NumPy 是 Python 数据科学和机器学习生态系统的基石，许多其他库（如 SciPy, Pandas, Matplotlib, Scikit-learn）都建立在 NumPy 数组之上。  核心思想：NumPy 引入了高效的 ndarray 数据结构，通过向量化操作显著提升了 Python 处理数值数据的性能。   一、为什么选择 NumPy？Python 语言本身处理列表等数据结构时效率较高，但对于大规模数值计算而言，原生的 Python 列表效率低下。NumPy 通过以下方式解决了这个问题：  高性能 ndarray 对象：ndarray 存储同类型数据，在内存中连续存储，相比 Python 列表，占用的内存更少，访问速度更快。 向量化操作：NumPy 允许对整个数组进行操作，而无需编写显式的循环。这些操作通常在 C 或 Fortran 中实现，执行速度远超 Python 循环。 广播 (Broadc...</div></div></div></a><a class="pagination-related" href="/2023/2023-02-28_Python%20Requests%E5%BA%93%E8%AF%A6%E8%A7%A3%EF%BC%9AHTTP%E8%AF%B7%E6%B1%82%E7%9A%84%E8%89%BA%E6%9C%AF/" title="Python Requests库详解：HTTP请求的艺术"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-25.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-28</div><div class="info-item-2">Python Requests库详解：HTTP请求的艺术</div></div><div class="info-2"><div class="info-item-1"> requests 库 是 Python 生态系统中最流行、最强大、也是最优雅的 HTTP 客户端库之一。它简化了复杂的 HTTP 请求操作，让开发者能够以极少量的代码发送各种类型的 HTTP 请求，并轻松处理响应。与 Python 内置的 urllib 模块相比，requests 提供了更友好、更直观的 API，被誉为“面向人类的 HTTP 服务”。  核心思想：requests 封装了底层 HTTP 协议的复杂性，提供简洁的 API，让开发者专注于业务逻辑而非网络通信的细节。   一、为什么选择 Requests？在 Python 中进行 HTTP 请求有多种方式，例如内置的 urllib 模块。但 requests 库之所以广受欢迎，主要得益于以下优势：  友好的 API：设计直观，易学易用，代码可读性高。 功能强大：支持几乎所有 HTTP 功能，包括 GET, POST, PUT, DELETE 等方法，以及请求头、数据、文件上传、Cookie、身份认证、代理、SSL 验证等。 自动处理：自动处理 URL 编码、重定向、会话管理等常见任务。 JSON 支持：内置 JSON...</div></div></div></a><a class="pagination-related" href="/2023/2023-02-21_Python%20Pandas%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E5%88%86%E6%9E%90%E7%9A%84%E7%91%9E%E5%A3%AB%E5%86%9B%E5%88%80/" title="Python Pandas详解：数据处理与分析的瑞士军刀"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-23.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-21</div><div class="info-item-2">Python Pandas详解：数据处理与分析的瑞士军刀</div></div><div class="info-2"><div class="info-item-1"> Pandas 是 Python 中用于数据分析和处理的核心库。它提供了一套高性能、易于使用的数据结构，最主要的是 DataFrame（二维表格数据）和 Series（一维带标签数组），用于快速处理和分析结构化数据（如 CSV、Excel、数据库表格数据）。Pandas 以其直观的语法和强大的功能，成为数据科学家和数据工程师的首选工具。  核心思想：Pandas 将表格数据抽象为 DataFrame 和 Series 对象，提供类似 SQL 和 Excel 的操作，通过向量化和 C&#x2F;Cython 实现的底层优化，极大提升了数据处理效率。   一、为什么选择 Pandas？在数据驱动的时代，我们经常需要处理各种形式的表格数据。Python 原生的数据结构（如列表、字典）虽然灵活，但在处理大量、复杂、异构的表格数据时显得力不从心。Pandas 解决了这些痛点：  直观的数据结构：DataFrame 和 Series 提供了强大的标签索引功能，使得数据操作更加直观，无需关注底层实现。 高效的数据操作：底层基于 NumPy 优化，利用 C 和 Cython 实现，对于大规模数据...</div></div></div></a><a class="pagination-related" href="/2023/2023-03-15_Python%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3/" title="Python多进程实现生产者-消费者模式详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-05.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-15</div><div class="info-item-2">Python多进程实现生产者-消费者模式详解</div></div><div class="info-2"><div class="info-item-1"> 生产者-消费者模式是并发编程中一个非常常见的设计模式，用于解决生产者和消费者之间由于生产和消费的速度不一致而导致的线程（或进程）同步问题。在 Python 中，可以使用 multiprocessing 模块实现多进程版的生产者-消费者模式，以充分利用多核 CPU 资源。  核心思想：利用共享队列作为缓冲，实现生产者与消费者解耦，并通过互斥锁和条件变量（或自带的线程安全队列）进行同步，避免数据不一致和资源竞争。   一、生产者-消费者模式概述模式构成：  生产者 (Producer)：负责生成数据，并将其放入共享的缓冲区（队列）中。 消费者 (Consumer)：负责从共享的缓冲区（队列）中取出数据进行处理。 缓冲区 (Buffer &#x2F; Queue)：一个共享的数据结构，通常是一个队列，用于存储生产者生产的数据和消费者消费的数据。它充当了生产者和消费者之间的桥梁。  解决的问题：  解耦：生产者和消费者可以独立运行，互不干扰，提高系统的灵活性。 并发：允许多个生产者和多个消费者同时存在，提高处理效率。 削峰填谷：当生产速度快于消费速度时，缓冲区可以存储多余的数据，防止数...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">157</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">154</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">55</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Pydantic%EF%BC%9F"><span class="toc-text">一、为什么需要 Pydantic？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85-Pydantic"><span class="toc-text">二、安装 Pydantic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%EF%BC%9A%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-BaseModel"><span class="toc-text">三、基本使用：定义数据模型 (BaseModel)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9%EF%BC%9A"><span class="toc-text">关键点：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AD%97%E6%AE%B5%E9%AA%8C%E8%AF%81-Field"><span class="toc-text">四、字段验证 (Field)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Field-%E5%87%BD%E6%95%B0%E7%9A%84%E5%B8%B8%E8%A7%81%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-text">Field 函数的常见参数：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Pydantic-Settings-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-text">五、Pydantic Settings (配置管理)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9%EF%BC%9A-1"><span class="toc-text">关键点：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%B8%8E-FastAPI-%E7%9A%84%E9%9B%86%E6%88%90"><span class="toc-text">六、与 FastAPI 的集成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Pydantic-v2-%E7%9A%84%E6%96%B0%E7%89%B9%E6%80%A7-%E4%B8%8E-v1-%E5%AF%B9%E6%AF%94"><span class="toc-text">七、Pydantic v2 的新特性 (与 v1 对比)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E8%BF%9B%E9%98%B6"><span class="toc-text">八、总结与进阶</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-16_%E5%B8%B8%E7%94%A8%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95%E7%9A%84Go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3/" title="常用限流算法的Go语言实现详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="常用限流算法的Go语言实现详解"/></a><div class="content"><a class="title" href="/2025/2025-10-16_%E5%B8%B8%E7%94%A8%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95%E7%9A%84Go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E8%AF%A6%E8%A7%A3/" title="常用限流算法的Go语言实现详解">常用限流算法的Go语言实现详解</a><time datetime="2025-10-15T22:24:00.000Z" title="发表于 2025-10-16 06:24:00">2025-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-10_NativeScript-Vue3%E8%AF%A6%E8%A7%A3/" title="NativeScript-Vue3详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NativeScript-Vue3详解"/></a><div class="content"><a class="title" href="/2025/2025-10-10_NativeScript-Vue3%E8%AF%A6%E8%A7%A3/" title="NativeScript-Vue3详解">NativeScript-Vue3详解</a><time datetime="2025-10-09T22:24:00.000Z" title="发表于 2025-10-10 06:24:00">2025-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-08_Hyper-V%20%E6%B7%B1%E5%BA%A6%E8%AF%A6%E8%A7%A3%EF%BC%9AWindows%20%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84%E4%B8%93%E4%B8%9A%E7%BA%A7%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/" title="Hyper-V 深度详解：Windows 平台上的专业级虚拟化技术"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-09.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hyper-V 深度详解：Windows 平台上的专业级虚拟化技术"/></a><div class="content"><a class="title" href="/2025/2025-10-08_Hyper-V%20%E6%B7%B1%E5%BA%A6%E8%AF%A6%E8%A7%A3%EF%BC%9AWindows%20%E5%B9%B3%E5%8F%B0%E4%B8%8A%E7%9A%84%E4%B8%93%E4%B8%9A%E7%BA%A7%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF/" title="Hyper-V 深度详解：Windows 平台上的专业级虚拟化技术">Hyper-V 深度详解：Windows 平台上的专业级虚拟化技术</a><time datetime="2025-10-07T22:24:00.000Z" title="发表于 2025-10-08 06:24:00">2025-10-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-06_TresJS%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8Vue%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9E%84%E5%BB%BAThree.js%E5%9C%BA%E6%99%AF/" title="TresJS详解：用Vue的方式构建Three.js场景"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-18.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TresJS详解：用Vue的方式构建Three.js场景"/></a><div class="content"><a class="title" href="/2025/2025-10-06_TresJS%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8Vue%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9E%84%E5%BB%BAThree.js%E5%9C%BA%E6%99%AF/" title="TresJS详解：用Vue的方式构建Three.js场景">TresJS详解：用Vue的方式构建Three.js场景</a><time datetime="2025-10-05T22:24:00.000Z" title="发表于 2025-10-06 06:24:00">2025-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-01_Go%E8%AF%AD%E8%A8%80%E6%8C%87%E5%90%91%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%88(Pointer%20to%20Pointer)%E8%AF%A6%E8%A7%A3/" title="Go语言指向指针的指针(Pointer to Pointer)详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-23.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go语言指向指针的指针(Pointer to Pointer)详解"/></a><div class="content"><a class="title" href="/2025/2025-10-01_Go%E8%AF%AD%E8%A8%80%E6%8C%87%E5%90%91%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%88(Pointer%20to%20Pointer)%E8%AF%A6%E8%A7%A3/" title="Go语言指向指针的指针(Pointer to Pointer)详解">Go语言指向指针的指针(Pointer to Pointer)详解</a><time datetime="2025-09-30T22:24:00.000Z" title="发表于 2025-10-01 06:24:00">2025-10-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-13.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/tags/2023/" target="_blank" title="📌 2023">📌 2023</a><a href="/tags/2024/" target="_blank" title="❓ 2024">❓ 2024</a><a href="/tags/2025/" target="_blank" title="🚀 2025">🚀 2025</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="分类">分类</a><a href="/tags/" target="_blank" title="标签">标签</a><a href="/categories/" target="_blank" title="时间线">时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="说说">说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2021 - 2025 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script>(() => {
  const option = null
  const config = {"site_uv":true,"site_pv":true,"page_pv":true,"token":"qTvz1SkmPDt785fgh6BpiA5qiFFIVUwxj8Ft+rPW+cdN59v1hXjwRgSmy0+ji9m+oLlcxvo2NfDSMa6epVl3NTlsN3ejCIwWeP8Y51aEJ0Sbem4UexGmJLspB7AkOBId2SdtT6QWEBlGmFIIQgchQ2zAKYxTmc/kpBED5aLSr+3uvmQ9/G7FJQeVFpveDkK0xM1hu36xq4a6/FSeROxtoEp5zabzTWiYTlLsQzIl/NlELnCq3nxK+oo/vl3UQo/oM/rae/gJX/MaVKsgIUCd2ABJogNkx2KTenBIBpbPki5FzOgPh6/z4GPa4HvhNO51DDVG1SEQZooqEYmt/gnybLBWFbN+7liZWw=="}

  const runTrack = () => {
    if (typeof umami !== 'undefined' && typeof umami.track === 'function') {
      umami.track(props => ({ ...props, url: window.location.pathname, title: GLOBAL_CONFIG_SITE.title }))
    } else {
      console.warn('Umami Analytics: umami.track is not available')
    }
  }

  const loadUmamiJS = () => {
    btf.getScript('https://umami.012700.xyz/script.js', {
      'data-website-id': '2a796d6c-6499-42d8-8eb4-d9a2930b0ff3',
      'data-auto-track': 'false',
      ...option
    }).then(() => {
      runTrack()
    }).catch(error => {
      console.error('Umami Analytics: Error loading script', error)
    })
  }

  const getData = async (isPost) => {
    try {
      const now = Date.now()
      const keyUrl = isPost ? `&url=${window.location.pathname}` : ''
      const headerList = { 'Accept': 'application/json' }

      if (true) {
        headerList['Authorization'] = `Bearer ${config.token}`
      } else {
        headerList['x-umami-api-key'] = config.token
      }

      const res = await fetch(`https://umami.012700.xyz/api/websites/2a796d6c-6499-42d8-8eb4-d9a2930b0ff3/stats?startAt=0000000000&endAt=${now}${keyUrl}`, {
        method: "GET",
        headers: headerList
      })

      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`)
      }

      return await res.json()
    } catch (error) {
      console.error('Umami Analytics: Failed to fetch data', error)
      throw error
    }
  }

  const insertData = async () => {
    try {
      if (GLOBAL_CONFIG_SITE.pageType === 'post' && config.page_pv) {
        const pagePV = document.getElementById('umamiPV')
        if (pagePV) {
          const data = await getData(true)
          if (data && data.pageviews && typeof data.pageviews.value !== 'undefined') {
            pagePV.textContent = data.pageviews.value
          } else {
            console.warn('Umami Analytics: Invalid page view data received')
          }
        }
      }

      if (config.site_uv || config.site_pv) {
        const data = await getData(false)

        if (config.site_uv) {
          const siteUV = document.getElementById('umami-site-uv')
          if (siteUV && data && data.visitors && typeof data.visitors.value !== 'undefined') {
            siteUV.textContent = data.visitors.value
          } else if (siteUV) {
            console.warn('Umami Analytics: Invalid site UV data received')
          }
        }

        if (config.site_pv) {
          const sitePV = document.getElementById('umami-site-pv')
          if (sitePV && data && data.pageviews && typeof data.pageviews.value !== 'undefined') {
            sitePV.textContent = data.pageviews.value
          } else if (sitePV) {
            console.warn('Umami Analytics: Invalid site PV data received')
          }
        }
      }
    } catch (error) {
      console.error('Umami Analytics: Failed to insert data', error)
    }
  }

  btf.addGlobalFn('pjaxComplete', runTrack, 'umami_analytics_run_track')
  btf.addGlobalFn('pjaxComplete', insertData, 'umami_analytics_insert')


  loadUmamiJS()

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', insertData)
  } else {
    setTimeout(insertData, 100)
  }
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div></body></html>