<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>基于TypeScript封装Axios成通用工具类 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在现代前端开发中，网络请求是任何应用不可或缺的一部分。Axios 作为一款流行的基于 Promise 的 HTTP 客户端，因其易用性和强大的功能而广受欢迎。然而，在大型项目中直接使用 Axios 可能会导致代码冗余、维护困难。结合 TypeScript 的类型优势，我们可以将 Axios 封装成一个强大且类型安全的通用工具类，从而提高代码的可维护性、可扩展性和开发效率。  “好的封装，是为了在">
<meta property="og:type" content="article">
<meta property="og:title" content="基于TypeScript封装Axios成通用工具类">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/2023/2023-05-01_%E5%9F%BA%E4%BA%8ETypeScript%E5%B0%81%E8%A3%85Axios%E6%88%90%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="在现代前端开发中，网络请求是任何应用不可或缺的一部分。Axios 作为一款流行的基于 Promise 的 HTTP 客户端，因其易用性和强大的功能而广受欢迎。然而，在大型项目中直接使用 Axios 可能会导致代码冗余、维护困难。结合 TypeScript 的类型优势，我们可以将 Axios 封装成一个强大且类型安全的通用工具类，从而提高代码的可维护性、可扩展性和开发效率。  “好的封装，是为了在">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-09.jpg">
<meta property="article:published_time" content="2023-04-30T22:24:00.000Z">
<meta property="article:modified_time" content="2025-10-08T08:23:41.987Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="2023">
<meta property="article:tag" content="前端技术">
<meta property="article:tag" content="TypeScript">
<meta property="article:tag" content="Axios">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-09.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "基于TypeScript封装Axios成通用工具类",
  "url": "https://blog.tbf1211.xx.kg/2023/2023-05-01_%E5%9F%BA%E4%BA%8ETypeScript%E5%B0%81%E8%A3%85Axios%E6%88%90%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-09.jpg",
  "datePublished": "2023-04-30T22:24:00.000Z",
  "dateModified": "2025-10-08T08:23:41.987Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/2023/2023-05-01_%E5%9F%BA%E4%BA%8ETypeScript%E5%B0%81%E8%A3%85Axios%E6%88%90%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '基于TypeScript封装Axios成通用工具类',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">99</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tags/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/tags/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/tags/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-09.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">基于TypeScript封装Axios成通用工具类</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/tags/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/tags/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/tags/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">基于TypeScript封装Axios成通用工具类</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-04-30T22:24:00.000Z" title="发表于 2023-05-01 06:24:00">2023-05-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/TypeScript/">TypeScript</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="umamiPV" data-path="/2023/2023-05-01_%E5%9F%BA%E4%BA%8ETypeScript%E5%B0%81%E8%A3%85Axios%E6%88%90%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p>在现代前端开发中，网络请求是任何应用不可或缺的一部分。Axios 作为一款流行的基于 Promise 的 HTTP 客户端，因其易用性和强大的功能而广受欢迎。然而，在大型项目中直接使用 Axios 可能会导致代码冗余、维护困难。结合 TypeScript 的类型优势，我们可以将 Axios 封装成一个强大且类型安全的通用工具类，从而提高代码的可维护性、可扩展性和开发效率。</p>
</blockquote>
<div class="note info flat"><p>“好的封装，是为了在自由和约束之间找到平衡，让开发更高效，代码更健壮。”</p>
</div>

<h2 id="一、为什么需要封装-Axios？"><a href="#一、为什么需要封装-Axios？" class="headerlink" title="一、为什么需要封装 Axios？"></a>一、为什么需要封装 Axios？</h2><p>直接使用 Axios 固然方便，但在实际项目中，我们通常面临以下问题：</p>
<ol>
<li><strong>公共请求配置</strong>： baseURL、超时时间、请求头（如 Authorization Token）等在多个请求中重复设置。</li>
<li><strong>请求&#x2F;响应拦截器</strong>：统一处理请求发送前的参数加密、Token 携带，以及响应返回后的状态码处理、错误提示、数据格式化等。</li>
<li><strong>错误处理</strong>：统一的错误捕获和提示机制，避免每个请求都写 <code>try...catch</code>。</li>
<li><strong>数据类型定义</strong>：使用 TypeScript 时，请求参数和响应数据的类型定义需要贯穿整个请求周期，直接使用 Axios 难以统一管理。</li>
<li><strong>代码重复</strong>：相似的请求逻辑散落在各处，不便于修改和维护。</li>
<li><strong>易于切换</strong>：未来如果需要切换 HTTP 库（虽然可能性较小），封装层可以提供一层抽象，减少切换成本。</li>
<li><strong>可测试性</strong>：封装后的服务更容易进行单元测试和 Mock。</li>
</ol>
<h2 id="二、需求分析与设计思路"><a href="#二、需求分析与设计思路" class="headerlink" title="二、需求分析与设计思路"></a>二、需求分析与设计思路</h2><p>我们的目标是封装出一个通用、类型安全、可扩展的 Axios 工具类。</p>
<h3 id="2-1-核心需求"><a href="#2-1-核心需求" class="headerlink" title="2.1 核心需求"></a>2.1 核心需求</h3><ul>
<li><strong>创建 Axios 实例</strong>：支持多实例，方便应对不同的 baseURL 或配置。</li>
<li><strong>统一请求前缀 (baseURL)</strong>：减少硬编码。</li>
<li><strong>统一请求超时时间 (timeout)</strong>。</li>
<li><strong>统一请求头 (headers)</strong>：如 Token。</li>
<li><strong>统一请求拦截器</strong>：添加 Token、显示 Loading 等。</li>
<li><strong>统一响应拦截器</strong>：处理服务器返回的状态码（如 401 登出）、数据格式化、错误提示等。</li>
<li><strong>支持 GET&#x2F;POST&#x2F;PUT&#x2F;DELETE 等常用方法</strong>。</li>
<li><strong>支持请求参数的类型约束</strong>。</li>
<li><strong>支持响应数据的类型约束</strong>。</li>
<li><strong>统一错误处理</strong>：返回封装后的错误对象。</li>
<li><strong>支持取消请求 (Cancel Token)</strong>。</li>
<li><strong>支持文件上传 (FormData)</strong>。</li>
</ul>
<h3 id="2-2-设计思路"><a href="#2-2-设计思路" class="headerlink" title="2.2 设计思路"></a>2.2 设计思路</h3><p>我们将创建一个 <code>HttpRequest</code> 类，内部管理 Axios 实例。</p>
<ol>
<li><strong>类封装</strong>：<code>HttpRequest</code> 类将包含 Axios 实例以及所有封装的 HTTP 方法。</li>
<li><strong>构造函数</strong>：接收基础配置，用于初始化 Axios 实例。</li>
<li><strong>拦截器方法</strong>：在构造函数中配置请求和响应拦截器。</li>
<li><strong>公共方法</strong>：提供 <code>get</code>, <code>post</code>, <code>put</code>, <code>del</code> 等方法，这些方法内部调用 Axios 实例。</li>
<li><strong>类型泛化</strong>：利用 TypeScript 泛型为请求参数和响应数据提供类型约束。</li>
<li><strong>错误处理封装</strong>：统一处理 Axios 抛出的错误。</li>
</ol>
<h2 id="三、代码实现"><a href="#三、代码实现" class="headerlink" title="三、代码实现"></a>三、代码实现</h2><h3 id="3-1-项目结构"><a href="#3-1-项目结构" class="headerlink" title="3.1 项目结构"></a>3.1 项目结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">├── api/</span><br><span class="line">│   └── index.ts        # 对外暴露的 HttpRequest 实例</span><br><span class="line">├── services/</span><br><span class="line">│   └── request/</span><br><span class="line">│       ├── index.ts    # HttpRequest 核心实现</span><br><span class="line">│       ├── type.ts     # 类型定义</span><br><span class="line">│       └── config.ts   # 默认配置</span><br><span class="line">└── main.ts             # 入口文件</span><br></pre></td></tr></table></figure>

<h3 id="3-2-定义类型-src-services-request-type-ts"><a href="#3-2-定义类型-src-services-request-type-ts" class="headerlink" title="3.2 定义类型 (src/services/request/type.ts)"></a>3.2 定义类型 (<code>src/services/request/type.ts</code>)</h3><p>首先，定义请求和响应相关的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AxiosRequestConfig</span>, <span class="title class_">AxiosResponse</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于自定义请求配置，继承AxiosRequestConfig，以便添加我们自己的属性</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RequestOptions</span> &#123;</span><br><span class="line">  <span class="comment">// 是否需要全局 loading</span></span><br><span class="line">  <span class="attr">isShowLoading</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// 是否需要对请求头进行特殊处理</span></span><br><span class="line">  <span class="attr">isTransformRequest</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// 是否需要对响应数据进行特殊处理</span></span><br><span class="line">  <span class="attr">isTransformResponse</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// 是否需要提示错误信息</span></span><br><span class="line">  <span class="attr">withErrorMessage</span>?: <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="comment">// 其他自定义选项...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 封装后的响应数据接口，通常后端会统一返回某种格式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ApiResponse</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">data</span>: T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义请求结果的 interface，用于统一返回，方便处理错误</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">RequestResult</span>&lt;T = <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">  <span class="attr">data</span>: T | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">ApiError</span> | <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义错误接口</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ApiError</span> &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">originalError</span>?: <span class="built_in">any</span>; <span class="comment">// 原始Axios或JsError</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展AxiosRequestConfig，加入我们的自定义选项</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CustomAxiosRequestConfig</span> <span class="keyword">extends</span> <span class="title class_">AxiosRequestConfig</span> &#123;</span><br><span class="line">  <span class="attr">requestOptions</span>?: <span class="title class_">RequestOptions</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展AxiosResponse，加入我们的自定义选项</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CustomAxiosResponse</span>&lt;T = <span class="built_in">any</span>&gt; <span class="keyword">extends</span> <span class="title class_">AxiosResponse</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="attr">requestOptions</span>?: <span class="title class_">RequestOptions</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-默认配置-src-services-request-config-ts"><a href="#3-3-默认配置-src-services-request-config-ts" class="headerlink" title="3.3 默认配置 (src/services/request/config.ts)"></a>3.3 默认配置 (<code>src/services/request/config.ts</code>)</h3><p>集中管理请求的默认配置。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">RequestOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./type&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认的 Axios 请求配置</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">DEFAULT_AXIOS_CONFIG</span>: <span class="title class_">AxiosRequestConfig</span> = &#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_APP_BASE_API</span>, <span class="comment">// 从环境变量获取</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">10000</span>, <span class="comment">// 超时时间 10 秒</span></span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认的自定义请求选项</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="attr">DEFAULT_REQUEST_OPTIONS</span>: <span class="title class_">RequestOptions</span> = &#123;</span><br><span class="line">  <span class="attr">isShowLoading</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">isTransformRequest</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isTransformResponse</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">withErrorMessage</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误码映射（示例）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">ERROR_CODE_MAP</span> = &#123;</span><br><span class="line">  <span class="number">400</span>: <span class="string">&#x27;请求错误&#x27;</span>,</span><br><span class="line">  <span class="number">401</span>: <span class="string">&#x27;未授权，请重新登录&#x27;</span>,</span><br><span class="line">  <span class="number">403</span>: <span class="string">&#x27;拒绝访问&#x27;</span>,</span><br><span class="line">  <span class="number">404</span>: <span class="string">&#x27;请求地址出错&#x27;</span>,</span><br><span class="line">  <span class="number">500</span>: <span class="string">&#x27;服务器内部错误&#x27;</span>,</span><br><span class="line">  <span class="number">502</span>: <span class="string">&#x27;网关错误&#x27;</span>,</span><br><span class="line">  <span class="comment">// ... 其他错误码</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-HttpRequest-核心实现-src-services-request-index-ts"><a href="#3-4-HttpRequest-核心实现-src-services-request-index-ts" class="headerlink" title="3.4 HttpRequest 核心实现 (src/services/request/index.ts)"></a>3.4 <code>HttpRequest</code> 核心实现 (<code>src/services/request/index.ts</code>)</h3><p>这是封装的核心部分。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">AxiosInstance</span>, <span class="title class_">AxiosError</span>, <span class="title class_">AxiosResponse</span>, <span class="title class_">AxiosRequestConfig</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_AXIOS_CONFIG</span>, <span class="variable constant_">DEFAULT_REQUEST_OPTIONS</span>, <span class="variable constant_">ERROR_CODE_MAP</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./config&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123;</span><br><span class="line">  <span class="title class_">RequestOptions</span>,</span><br><span class="line">  <span class="title class_">ApiResponse</span>,</span><br><span class="line">  <span class="title class_">ApiError</span>,</span><br><span class="line">  <span class="title class_">RequestResult</span>,</span><br><span class="line">  <span class="title class_">CustomAxiosRequestConfig</span>,</span><br><span class="line">  <span class="title class_">CustomAxiosResponse</span>,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;./type&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设我们有一个全局的 loading 状态管理函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">showLoading</span> = (<span class="params"></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;显示 Loading...&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hideLoading</span> = (<span class="params"></span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;隐藏 Loading...&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">showMessage</span> = (<span class="params"><span class="attr">msg</span>: <span class="built_in">string</span></span>) =&gt; <span class="title function_">alert</span>(msg); <span class="comment">// 简单的错误提示</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HttpRequest</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">instance</span>: <span class="title class_">AxiosInstance</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="attr">defaultOptions</span>: <span class="title class_">RequestOptions</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">config</span>: <span class="title class_">AxiosRequestConfig</span>, <span class="attr">options</span>?: <span class="title class_">RequestOptions</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span> = axios.<span class="title function_">create</span>(config);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">defaultOptions</span> = &#123; ...<span class="variable constant_">DEFAULT_REQUEST_OPTIONS</span>, ...options &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setupInterceptors</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置请求和响应拦截器</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">setupInterceptors</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 请求拦截器</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">      <span class="function">(<span class="params"><span class="attr">config</span>: <span class="title class_">CustomAxiosRequestConfig</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; requestOptions &#125; = config;</span><br><span class="line">        <span class="keyword">const</span> opts = &#123; ...<span class="variable language_">this</span>.<span class="property">defaultOptions</span>, ...requestOptions &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 统一添加 Token (示例)</span></span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">          config.<span class="property">headers</span> = &#123;</span><br><span class="line">            ...config.<span class="property">headers</span>,</span><br><span class="line">            <span class="title class_">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 是否显示 Loading</span></span><br><span class="line">        <span class="keyword">if</span> (opts.<span class="property">isShowLoading</span>) &#123;</span><br><span class="line">          <span class="title function_">showLoading</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 请求数据转换等自定义处理</span></span><br><span class="line">        <span class="keyword">if</span> (opts.<span class="property">isTransformRequest</span> &amp;&amp; config.<span class="property">data</span>) &#123;</span><br><span class="line">          <span class="comment">// 例如，将 CamelCase 转换为 snake_case 发送给后端</span></span><br><span class="line">          <span class="comment">// config.data = transformToSnakeCase(config.data);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">AxiosError</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">hideLoading</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 响应拦截器</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">      <span class="function">(<span class="params"><span class="attr">response</span>: <span class="title class_">CustomAxiosResponse</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">hideLoading</span>(); <span class="comment">// 无论成功失败，响应回来都隐藏 loading</span></span><br><span class="line">        <span class="keyword">const</span> &#123; data, config &#125; = response;</span><br><span class="line">        <span class="keyword">const</span> &#123; requestOptions &#125; = config;</span><br><span class="line">        <span class="keyword">const</span> opts = &#123; ...<span class="variable language_">this</span>.<span class="property">defaultOptions</span>, ...requestOptions &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对响应数据进行统一处理</span></span><br><span class="line">        <span class="keyword">if</span> (opts.<span class="property">isTransformResponse</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">code</span> === <span class="number">200</span>) &#123; <span class="comment">// 假设后端成功码是200</span></span><br><span class="line">            <span class="keyword">return</span> data; <span class="comment">// 返回后端实际的响应体</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 后端返回的业务错误</span></span><br><span class="line">            <span class="keyword">const</span> errorMessage = data?.<span class="property">message</span> || <span class="variable constant_">ERROR_CODE_MAP</span>[data?.<span class="property">code</span> <span class="keyword">as</span> keyof <span class="keyword">typeof</span> <span class="variable constant_">ERROR_CODE_MAP</span>] || <span class="string">&#x27;未知错误&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (opts.<span class="property">withErrorMessage</span>) &#123;</span><br><span class="line">              <span class="title function_">showMessage</span>(errorMessage);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 抛出自定义错误，以便调用方捕获</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(&#123;</span><br><span class="line">              <span class="attr">code</span>: data?.<span class="property">code</span> || -<span class="number">1</span>,</span><br><span class="line">              <span class="attr">message</span>: errorMessage,</span><br><span class="line">              <span class="attr">originalError</span>: response,</span><br><span class="line">            &#125; <span class="keyword">as</span> <span class="title class_">ApiError</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data; <span class="comment">// 如果不需要转换，直接返回原始数据</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">AxiosError</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">hideLoading</span>();</span><br><span class="line">        <span class="keyword">const</span> &#123; response, message &#125; = error;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">errorMessage</span>: <span class="built_in">string</span> = <span class="string">&#x27;网络异常，请稍后重试！&#x27;</span>;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">errorCode</span>: <span class="built_in">number</span> | <span class="built_in">string</span> = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">          errorCode = response.<span class="property">status</span>;</span><br><span class="line">          errorMessage = <span class="variable constant_">ERROR_CODE_MAP</span>[errorCode <span class="keyword">as</span> keyof <span class="keyword">typeof</span> <span class="variable constant_">ERROR_CODE_MAP</span>] || response.<span class="property">data</span>?.<span class="property">message</span> || errorMessage;</span><br><span class="line">          <span class="comment">// 特殊错误码处理，如 401</span></span><br><span class="line">          <span class="keyword">if</span> (response.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">            <span class="comment">// 清除 token，跳转登录页</span></span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">            <span class="comment">// router.push(&#x27;/login&#x27;); // 假设有路由</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 请求超时或网络中断</span></span><br><span class="line">          <span class="keyword">if</span> (message.<span class="title function_">includes</span>(<span class="string">&#x27;timeout&#x27;</span>)) &#123;</span><br><span class="line">            errorMessage = <span class="string">&#x27;请求超时，请检查网络或稍后重试！&#x27;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (message.<span class="title function_">includes</span>(<span class="string">&#x27;Network Error&#x27;</span>)) &#123;</span><br><span class="line">            errorMessage = <span class="string">&#x27;网络连接失败，请检查网络！&#x27;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// 获取当前请求的 options，判断是否显示错误提示</span></span><br><span class="line">        <span class="keyword">const</span> currentRequestOptions = (error.<span class="property">config</span> <span class="keyword">as</span> <span class="title class_">CustomAxiosRequestConfig</span>)?.<span class="property">requestOptions</span> || <span class="variable language_">this</span>.<span class="property">defaultOptions</span>;</span><br><span class="line">        <span class="keyword">if</span> (currentRequestOptions.<span class="property">withErrorMessage</span>) &#123;</span><br><span class="line">          <span class="title function_">showMessage</span>(errorMessage);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 统一抛出自定义错误</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(&#123;</span><br><span class="line">          <span class="attr">code</span>: errorCode,</span><br><span class="line">          <span class="attr">message</span>: errorMessage,</span><br><span class="line">          <span class="attr">originalError</span>: error,</span><br><span class="line">        &#125; <span class="keyword">as</span> <span class="title class_">ApiError</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 辅助方法：处理请求结果，统一返回 &#123; data, error &#125; 格式</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">async</span> safeRequest&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">    <span class="attr">requestPromise</span>: <span class="title class_">Promise</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;</span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> requestPromise;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">data</span>: response.<span class="property">data</span>, <span class="attr">error</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// 这里的 e 已经是我们处理过的 ApiError</span></span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">data</span>: <span class="literal">null</span>, <span class="attr">error</span>: e <span class="keyword">as</span> <span class="title class_">ApiError</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// -------------- 公共请求方法 --------------</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> get&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">params</span>?: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">CustomAxiosRequestConfig</span> <span class="comment">// 允许传入自定义的 Axios 配置</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">safeRequest</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">get</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;(url, &#123; params, ...config &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> post&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>?: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;, <span class="comment">// body 参数</span></span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">CustomAxiosRequestConfig</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">safeRequest</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">post</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;(url, data, config)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> put&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>?: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">CustomAxiosRequestConfig</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">safeRequest</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">put</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;(url, data, config)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">delete</span>&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">params</span>?: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">any</span>&gt;,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">CustomAxiosRequestConfig</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">safeRequest</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">delete</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;(url, &#123; params, ...config &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持文件上传 (FormData)</span></span><br><span class="line">  <span class="keyword">public</span> upload&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">    <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">file</span>: <span class="title class_">File</span>,</span><br><span class="line">    <span class="attr">config</span>?: <span class="title class_">CustomAxiosRequestConfig</span></span><br><span class="line">  ): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file); <span class="comment">// 假设后端接收的字段名为 &#x27;file&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">safeRequest</span>(</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">post</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;(url, formData, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        ...config,</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持取消请求</span></span><br><span class="line">  <span class="comment">// 可以通过在调用时传入 CancelTokenSource 来取消：</span></span><br><span class="line">  <span class="comment">// const source = axios.CancelToken.source();</span></span><br><span class="line">  <span class="comment">// request.get(&#x27;/data&#x27;, &#123;&#125;, &#123; cancelToken: source.token &#125;);</span></span><br><span class="line">  <span class="comment">// source.cancel(&#x27;Operation canceled by the user.&#x27;);</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">getCancelTokenSource</span>(): <span class="keyword">typeof</span> axios.<span class="property">CancelToken</span>.<span class="property">source</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> axios.<span class="property">CancelToken</span>.<span class="property">source</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">HttpRequest</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-对外暴露接口-src-api-index-ts"><a href="#3-5-对外暴露接口-src-api-index-ts" class="headerlink" title="3.5 对外暴露接口 (src/api/index.ts)"></a>3.5 对外暴露接口 (<code>src/api/index.ts</code>)</h3><p>创建并导出 HttpRequest 实例。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">HttpRequest</span> <span class="keyword">from</span> <span class="string">&#x27;../services/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_AXIOS_CONFIG</span>, <span class="variable constant_">DEFAULT_REQUEST_OPTIONS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../services/request/config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个请求实例</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="keyword">new</span> <span class="title class_">HttpRequest</span>(<span class="variable constant_">DEFAULT_AXIOS_CONFIG</span>, <span class="variable constant_">DEFAULT_REQUEST_OPTIONS</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果需要支持多 baseURL 或不同拦截器的实例</span></span><br><span class="line"><span class="comment">// export const otherRequest = new HttpRequest(&#123;</span></span><br><span class="line"><span class="comment">//   baseURL: &#x27;http://other-api.com&#x27;,</span></span><br><span class="line"><span class="comment">//   timeout: 5000,</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> request;</span><br></pre></td></tr></table></figure>

<h3 id="3-6-使用示例-src-main-ts-或组件中"><a href="#3-6-使用示例-src-main-ts-或组件中" class="headerlink" title="3.6 使用示例 (src/main.ts 或组件中)"></a>3.6 使用示例 (<code>src/main.ts</code> 或组件中)</h3><p>如何在你的应用中使用这个封装好的 <code>request</code> 实例。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;./api&#x27;</span>; <span class="comment">// 导入封装好的请求实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义请求参数和响应数据的接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserParams</span> &#123;</span><br><span class="line">  <span class="attr">userId</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">name</span>?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">email</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">phone</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PostData</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">content</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PostResult</span> &#123;</span><br><span class="line">  <span class="attr">postId</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：发起 GET 请求</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchUserInfo</span>(<span class="params"><span class="attr">userId</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> request.<span class="property">get</span>&lt;<span class="title class_">UserInfo</span>&gt;(<span class="string">&#x27;/users&#x27;</span>, &#123; userId &#125;, &#123;</span><br><span class="line">    <span class="attr">requestOptions</span>: &#123; <span class="attr">isShowLoading</span>: <span class="literal">true</span> &#125; <span class="comment">// 如果只想某个请求显示 loading</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (data) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户信息:&#x27;</span>, data);</span><br><span class="line">    <span class="comment">// 这里 data 是UserInfo类型</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取用户信息失败:&#x27;</span>, error?.<span class="property">message</span>);</span><br><span class="line">    <span class="comment">// 这里 error 是ApiError类型</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：发起 POST 请求</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">createPost</span>(<span class="params"><span class="attr">post</span>: <span class="title class_">PostData</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> request.<span class="property">post</span>&lt;<span class="title class_">PostResult</span>&gt;(<span class="string">&#x27;/posts&#x27;</span>, post, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123; <span class="string">&#x27;X-Custom-Header&#x27;</span>: <span class="string">&#x27;my-value&#x27;</span> &#125; <span class="comment">// 单独设置某个请求头</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (data) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;发布帖子成功:&#x27;</span>, data);</span><br><span class="line">    <span class="comment">// 这里 data 是PostResult类型</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;发布帖子失败:&#x27;</span>, error?.<span class="property">message</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：文件上传</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadAvatar</span>(<span class="params"><span class="attr">file</span>: <span class="title class_">File</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> request.<span class="property">upload</span>&lt;&#123; <span class="attr">url</span>: <span class="built_in">string</span> &#125;&gt;(<span class="string">&#x27;/upload/avatar&#x27;</span>, file, &#123;</span><br><span class="line">    <span class="attr">requestOptions</span>: &#123; <span class="attr">withErrorMessage</span>: <span class="literal">false</span> &#125; <span class="comment">// 不显示默认错误提示，自己处理</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (data) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;上传成功，文件URL:&#x27;</span>, data.<span class="property">url</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;上传失败:&#x27;</span>, error?.<span class="property">message</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用示例</span></span><br><span class="line"><span class="title function_">fetchUserInfo</span>(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟文件上传</span></span><br><span class="line"><span class="keyword">const</span> dummyFile = <span class="keyword">new</span> <span class="title class_">File</span>([<span class="string">&#x27;dummy content&#x27;</span>], <span class="string">&#x27;avatar.png&#x27;</span>, &#123; <span class="attr">type</span>: <span class="string">&#x27;image/png&#x27;</span> &#125;);</span><br><span class="line"><span class="title function_">uploadAvatar</span>(dummyFile);</span><br><span class="line"></span><br><span class="line"><span class="title function_">createPost</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;My First Post&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Hello, world!&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="四、高级进阶与扩展"><a href="#四、高级进阶与扩展" class="headerlink" title="四、高级进阶与扩展"></a>四、高级进阶与扩展</h2><h3 id="4-1-取消请求"><a href="#4-1-取消请求" class="headerlink" title="4.1 取消请求"></a>4.1 取消请求</h3><p>Axios 原生支持 Cancel Token，可以在组件卸载时取消未完成的请求，避免不必要的副作用和内存泄漏。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 src/services/request/index.ts 中已经提供了 getCancelTokenSource 方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例：</span></span><br><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;./api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>; <span class="comment">// 需要引入 axios 来获取 CancelTokenSource</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> source = axios.<span class="property">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchDataWithCancellation</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> request.<span class="property">get</span>&lt;&#123; <span class="attr">id</span>: <span class="built_in">string</span> &#125;&gt;(<span class="string">&#x27;/long-request&#x27;</span>, &#123;&#125;, &#123;</span><br><span class="line">      <span class="attr">cancelToken</span>: source.<span class="property">token</span>, <span class="comment">// 将 CancelToken 传入请求配置</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data fetched:&#x27;</span>, data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Request failed:&#x27;</span>, error?.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// 检查是否是取消请求的错误</span></span><br><span class="line">    <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request canceled:&#x27;</span>, error.<span class="property">message</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;An unexpected error occurred:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在组件卸载或特定事件发生时取消请求</span></span><br><span class="line"><span class="comment">// source.cancel(&#x27;请求已取消&#x27;);</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-错误类型细化"><a href="#4-2-错误类型细化" class="headerlink" title="4.2 错误类型细化"></a>4.2 错误类型细化</h3><p>可以根据后端返回的错误码或业务状态码进一步细化 <code>ApiError</code> 接口。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/services/request/type.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">CustomBusinessError</span> &#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="string">&#x27;FAIL&#x27;</span> | <span class="string">&#x27;ERROR&#x27;</span>;</span><br><span class="line">  <span class="attr">errorCode</span>: <span class="built_in">number</span>;</span><br><span class="line">  <span class="attr">errorMessage</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">ApiError</span> &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">number</span> | <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">originalError</span>?: <span class="built_in">any</span>;</span><br><span class="line">  <span class="comment">// 如果后端有统一业务错误格式，可以扩展</span></span><br><span class="line">  <span class="attr">businessError</span>?: <span class="title class_">CustomBusinessError</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-多实例管理"><a href="#4-3-多实例管理" class="headerlink" title="4.3 多实例管理"></a>4.3 多实例管理</h3><p>如果你的应用需要访问多个不同 baseURL 的后端服务，可以在 <code>src/api/index.ts</code> 中创建不同的 <code>HttpRequest</code> 实例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api/index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HttpRequest</span> <span class="keyword">from</span> <span class="string">&#x27;../services/request&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">DEFAULT_AXIOS_CONFIG</span>, <span class="variable constant_">DEFAULT_REQUEST_OPTIONS</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../services/request/config&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主 API</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mainRequest = <span class="keyword">new</span> <span class="title class_">HttpRequest</span>(<span class="variable constant_">DEFAULT_AXIOS_CONFIG</span>, <span class="variable constant_">DEFAULT_REQUEST_OPTIONS</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他服务 API</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userService = <span class="keyword">new</span> <span class="title class_">HttpRequest</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">VITE_APP_USER_API</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span>,</span><br><span class="line">&#125;, &#123; <span class="attr">isShowLoading</span>: <span class="literal">false</span> &#125;); <span class="comment">// 用户服务可能不显示全局 loading</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mainRequest;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-文件上传进度"><a href="#4-4-文件上传进度" class="headerlink" title="4.4 文件上传进度"></a>4.4 文件上传进度</h3><p>Axios 支持文件上传进度回调，可以在 <code>config</code> 中设置 <code>onUploadProgress</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在HttpRequest.upload 方法中添加 onUploadProgress</span></span><br><span class="line"><span class="keyword">public</span> upload&lt;T = <span class="built_in">any</span>&gt;(</span><br><span class="line">  <span class="attr">url</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">file</span>: <span class="title class_">File</span>,</span><br><span class="line">  <span class="attr">config</span>?: <span class="title class_">CustomAxiosRequestConfig</span>,</span><br><span class="line">  <span class="attr">onProgress</span>?: <span class="function">(<span class="params"><span class="attr">progressEvent</span>: <span class="title class_">ProgressEvent</span></span>) =&gt;</span> <span class="built_in">void</span> <span class="comment">// 添加进度回调</span></span><br><span class="line">): <span class="title class_">Promise</span>&lt;<span class="title class_">RequestResult</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">  formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">safeRequest</span>(</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">instance</span>.<span class="property">post</span>&lt;<span class="title class_">ApiResponse</span>&lt;T&gt;&gt;(url, formData, &#123;</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onUploadProgress</span>: onProgress, <span class="comment">// 将回调传入</span></span><br><span class="line">      ...config,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">uploadWithProgress</span>(<span class="params"><span class="attr">file</span>: <span class="title class_">File</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> request.<span class="property">upload</span>&lt;&#123; <span class="attr">url</span>: <span class="built_in">string</span> &#125;&gt;(</span><br><span class="line">    <span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">    file,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    <span class="function">(<span class="params">progressEvent</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> percentCompleted = <span class="title class_">Math</span>.<span class="title function_">round</span>((progressEvent.<span class="property">loaded</span> * <span class="number">100</span>) / progressEvent.<span class="property">total</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`上传进度: <span class="subst">$&#123;percentCompleted&#125;</span>%`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>通过 TypeScript 封装 Axios 成通用工具类，我们不仅解决了重复代码的问题，还通过类型系统增强了代码的健壮性和可维护性。</p>
<ul>
<li><strong>类型安全</strong>：确保请求参数和响应数据的类型一致性，减少运行时错误。</li>
<li><strong>统一管理</strong>：集中处理请求配置、拦截器、错误处理，便于项目维护。</li>
<li><strong>灵活性高</strong>：通过 <code>requestOptions</code> 和 <code>CustomAxiosRequestConfig</code> 提供了足够的灵活性来覆盖特殊请求的需求。</li>
<li><strong>可扩展性</strong>：方便未来添加新的功能，如缓存、限流等。</li>
</ul>
<p>这种封装模式在大型企业级项目中非常常见和有效，它能让你的网络请求层变得更加清晰、可控和高效。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/2023/2023-05-01_%E5%9F%BA%E4%BA%8ETypeScript%E5%B0%81%E8%A3%85Axios%E6%88%90%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/">https://blog.tbf1211.xx.kg/2023/2023-05-01_%E5%9F%BA%E4%BA%8ETypeScript%E5%B0%81%E8%A3%85Axios%E6%88%90%E9%80%9A%E7%94%A8%E5%B7%A5%E5%85%B7%E7%B1%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/2023/">2023</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><a class="post-meta__tags" href="/tags/TypeScript/">TypeScript</a><a class="post-meta__tags" href="/tags/Axios/">Axios</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-09.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/2023-05-08_Redis%20%E5%90%84%E7%B1%BB%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3/" title="Redis 各类数据结构指令详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Redis 各类数据结构指令详解</div></div><div class="info-2"><div class="info-item-1"> Redis 是一个开源（BSD 许可）的内存数据结构存储，可用作数据库、缓存和消息代理。它支持多种类型的数据结构，如字符串（strings）、哈希（hashes）、列表（lists）、集合（sets）、有序集合（sorted sets）等。理解并熟练使用这些数据结构及其相关指令，是高效利用 Redis 的关键。  Redis 的强大之处在于其在内存中操作这些丰富的数据结构，使得读写速度极快。掌握每个数据结构的使用场景和对应指令，是进行高性能应用开发的基础。   一、通用键指令 (Generic Commands)这些指令适用于所有数据类型的键。    指令 描述 示例    DEL key [key ...] 删除一个或多个键。 DEL mykey mylist   EXISTS key [key ...] 检查给定键是否存在。返回存在的键的数量。 EXISTS mykey   EXPIRE key seconds 设置键的过期时间（秒）。 EXPIRE mykey 60 (60秒后过期)   TTL key 获取键的剩余过期时间（秒）。-1 表示永久，-2 表示键不存在或已过...</div></div></div></a><a class="pagination-related" href="/2023/2023-04-27_Docker%20Compose%20%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%AE%9A%E4%B9%89%E5%92%8C%E8%BF%90%E8%A1%8C%E5%A4%9A%E5%AE%B9%E5%99%A8%20Docker%20%E5%BA%94%E7%94%A8/" title="Docker Compose 详解：定义和运行多容器 Docker 应用"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-04.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Docker Compose 详解：定义和运行多容器 Docker 应用</div></div><div class="info-2"><div class="info-item-1"> Docker Compose 是一个用于定义和运行多容器 Docker 应用程序的工具。通过一个 YAML 文件（通常命名为 docker-compose.yml），你可以配置应用程序的所有服务（容器）、网络和卷。然后，只需一个命令，就可以从这个配置文件中启动、停止和管理整个应用程序。  在实际的生产环境中，一个完整的应用程序通常由多个服务组成，例如一个 Web 应用可能包含一个 Web 服务器（Nginx&#x2F;Apache）、一个应用服务（Python&#x2F;Node.js&#x2F;Java）、一个数据库（PostgreSQL&#x2F;MySQL）和一个缓存服务（Redis）。手动管理这些独立容器的创建、网络连接和启动顺序非常繁琐且容易出错。Docker Compose 的出现正是为了解决这些多容器应用的管理复杂性。   一、Docker Compose 简介与核心优势Docker Compose 简化了多容器应用的开发、测试和（小规模）部署。它将应用的整个拓扑结构描述在一个文件中，实现了“基础设施即代码”的理念。 Docker Compose 的核心优势：  ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/2023-03-01_React%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B%EF%BC%9A%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2/" title="React入门教程：快速构建交互式用户界面"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-02.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-01</div><div class="info-item-2">React入门教程：快速构建交互式用户界面</div></div><div class="info-2"><div class="info-item-1"> React (通常称为 React.js 或 ReactJS) 是一个由 Facebook 开发并维护的用于构建用户界面 (UI) 的 JavaScript 库。它以其组件化、声明式的编程范式和高效的 虚拟 DOM (Virtual DOM) 机制而闻名。本入门教程将带你领略 React 的核心概念，并指导你搭建第一个 React 应用，让你快速掌握构建交互式前端应用的基础。  “React 并不是一个完整的框架，而是一个专注于 UI 层面的库。它鼓励你将 UI 拆分成独立、可复用的小块（组件），从而让代码更易于管理、开发和测试。学习 React，就是学习如何思考和构建组件。”   一、React 的核心理念1.1 组件化 (Component-Based)React 的核心是组件 (Component)。你可以将复杂的 UI 拆分为独立的、可复用的、封装性良好的小组件。每个组件都有自己的逻辑和外观，它们可以组合起来形成更复杂的 UI。  示例：一个电商网站可以分解为：Header 组件、ProductList 组件、ProductCard 组件、Button 组件、Shopp...</div></div></div></a><a class="pagination-related" href="/2023/2023-07-27_React%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83API%E6%B7%B1%E5%BA%A6%E8%A7%A3%E8%AF%BB/" title="React 详解：核心 API 深度解读"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-27</div><div class="info-item-2">React 详解：核心 API 深度解读</div></div><div class="info-2"><div class="info-item-1"> React (也称为 React.js 或 ReactJS) 是一个由 Facebook 开发并维护的开源 JavaScript 库，用于构建用户界面 (User Interface)。本篇将深入剖析 React 的核心 API，涵盖了从组件定义到各种 Hooks 的详细用法，助您更全面地理解和运用 React。  “React makes it painless to create interactive UIs. Design simple views for each state in your application, and React will efficiently update and render just the right components when your data changes.” —— React Official Documentation   一、React 的核心模块与入口React 库被拆分为两个主要模块：react 和 react-dom。  react: 包含构建组件和定义其行为所需的核心 API（如 Component, use...</div></div></div></a><a class="pagination-related" href="/2023/2023-08-01_TypeScript%20React%E8%AF%A6%E8%A7%A3/" title="TypeScript React 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-09.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-01</div><div class="info-item-2">TypeScript React 详解</div></div><div class="info-2"><div class="info-item-1"> TypeScript + React 是现代前端开发中最强大的组合之一。TypeScript 为 React 应用带来了强大的类型系统，显著提高了代码质量、可维护性和开发效率。它在开发阶段就能捕获许多常见的错误，并提供出色的编辑器支持，使得构建大型、复杂的 React 应用变得更加可靠和愉快。  “Adding TypeScript to your React project can feel like adding a safety net. It catches bugs early, improves code readability, and makes refactoring a breeze, especially as your application grows.”   一、为什么在 React 中使用 TypeScript？React 本身是 JavaScript 库。虽然 JavaScript 灵活性高，但对于大型项目或多人协作，缺乏类型检查可能导致以下问题：  难以发现的运行时错误: 许多类型相关的错误（例如，将一个字符串传递给期望数字的组件属性）只会在运...</div></div></div></a><a class="pagination-related" href="/2023/2023-02-17_Pug(%E5%89%8DJade)%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E8%AF%A6%E8%A7%A3/" title="Pug(前Jade)模板引擎详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-16.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-17</div><div class="info-item-2">Pug(前Jade)模板引擎详解</div></div><div class="info-2"><div class="info-item-1"> Pug（发音 &#x2F;pʌɡ&#x2F;），前身为 Jade，是一个高性能的 Node.js 模板引擎。它以其简洁、富有表现力的语法而闻名，旨在让 HTML 编写变得更加高效和愉快。Pug 摒弃了传统 HTML 的尖括号和闭合标签，转而使用缩进和基于文本的语法，这使得模板文件更小、更易读、也更不易出错。  核心思想：Pug 通过简洁的缩进语法替代冗长的 HTML 标签，提供强大的动态数据渲染、代码重用和条件逻辑功能。   一、Pug 简介1.1 什么是模板引擎？模板引擎是一种将数据填充到预定义模板中以生成最终输出（通常是 HTML 字符串）的工具。它将页面的结构（模板）与数据分离，使得前端开发更加模块化和可维护。 1.2 Pug 的特点 独特语法：使用缩进表示嵌套关系，无需关闭标签。 简洁明了：代码量显著少于对应的 HTML。 强大功能：支持变量、循环、条件判断、Mixin（类似于函数或组件）、包含（文件复用）、布局继承等高级特性。 编译到 HTML：Pug 模板最终会被编译成标准的 HTML。 Node.js 支持：作为 Node.js 的模板引擎，Pug 完美集成于 E...</div></div></div></a><a class="pagination-related" href="/2023/2023-04-17_%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B%E5%8C%96%E8%AF%A6%E8%A7%A3/" title="前端项目工程化详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-25.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-17</div><div class="info-item-2">前端项目工程化详解</div></div><div class="info-2"><div class="info-item-1"> 随着前端应用的复杂度日益增加，单纯依靠人工管理和协作已经无法满足高效、高质量开发的需求。前端工程化应运而生，它旨在通过将软件工程的思想和方法引入前端开发，构建一套系统化、标准化、自动化、体系化的解决方案，以提高开发效率、保障代码质量、降低维护成本。  前端工程化的核心思想是：以自动化取代人力，以工具取代重复劳动，以规范约束散漫。   一、什么是前端工程化？前端工程化是构建、管理和维护前端项目的实践和工具集。它涵盖了从项目初始化、开发、构建、测试到部署的整个生命周期，目标是提升团队协作效率、统一代码风格、保证项目质量、优化产物性能以及实现快速迭代。 它不仅仅是使用几个构建工具，更是一种体系化的思维方式和工作流。 二、为什么需要前端工程化？在没有工程化的时代，前端开发面临诸多挑战：  开发效率低下：手动重复任务（如文件合并、压缩），环境搭建复杂。 代码质量参差不齐：缺乏统一的代码规范和质量检查机制，导致 Bug 增多，难以维护。 团队协作困难：不同成员的代码风格差异大，冲突频繁，交接成本高。 项目性能不佳：缺乏自动化优化手段（如图片压缩、按需加载），页面加载慢。 部署上线复杂：手动...</div></div></div></a><a class="pagination-related" href="/2023/2023-09-19_Sass(SCSS)%E5%92%8CLess%20CSS%E9%A2%84%E5%A4%84%E7%90%86%E5%99%A8%E8%AF%A6%E8%A7%A3/" title="Sass(SCSS)和Less CSS预处理器详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-20.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-19</div><div class="info-item-2">Sass(SCSS)和Less CSS预处理器详解</div></div><div class="info-2"><div class="info-item-1"> Sass (Syntactically Awesome Style Sheets) 和 Less (Leaner Style Sheets) 是目前最流行的两种 CSS 预处理器。它们扩展了 CSS 语言的功能，允许开发者使用变量、混合 (Mixins)、嵌套、函数、继承等编程特性来编写样式，极大地提高了 CSS 的可维护性、代码复用性和开发效率。本篇将详细介绍 Sass 和 Less 的特性、语法以及它们之间的异同。  核心思想：Sass 和 Less 通过添加编程语言特性（如变量、混合、嵌套、函数等），将样式代码模块化、动态化，最终编译为标准 CSS，从而提升 CSS 编写效率和可维护性。   一、CSS 预处理器概述1.1 为什么需要 CSS 预处理器？传统的 CSS 有以下痛点：  重复性：颜色、字体大小等值可能在多处重复，修改时需要修改所有地方。 可维护性差：缺乏变量、函数等概念，难以模块化和抽象。 没有逻辑性：无法进行条件判断、循环等操作。 选择器冗余：深度嵌套的选择器导致代码量庞大。 供应商前缀：手动添加 -webkit-, -moz- 等前缀繁琐且易出错。  C...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">94</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">99</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%B0%81%E8%A3%85-Axios%EF%BC%9F"><span class="toc-text">一、为什么需要封装 Axios？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-text">二、需求分析与设计思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A0%B8%E5%BF%83%E9%9C%80%E6%B1%82"><span class="toc-text">2.1 核心需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="toc-text">2.2 设计思路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">三、代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-text">3.1 项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B-src-services-request-type-ts"><span class="toc-text">3.2 定义类型 (src&#x2F;services&#x2F;request&#x2F;type.ts)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE-src-services-request-config-ts"><span class="toc-text">3.3 默认配置 (src&#x2F;services&#x2F;request&#x2F;config.ts)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-HttpRequest-%E6%A0%B8%E5%BF%83%E5%AE%9E%E7%8E%B0-src-services-request-index-ts"><span class="toc-text">3.4 HttpRequest 核心实现 (src&#x2F;services&#x2F;request&#x2F;index.ts)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E6%8E%A5%E5%8F%A3-src-api-index-ts"><span class="toc-text">3.5 对外暴露接口 (src&#x2F;api&#x2F;index.ts)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-src-main-ts-%E6%88%96%E7%BB%84%E4%BB%B6%E4%B8%AD"><span class="toc-text">3.6 使用示例 (src&#x2F;main.ts 或组件中)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%AB%98%E7%BA%A7%E8%BF%9B%E9%98%B6%E4%B8%8E%E6%89%A9%E5%B1%95"><span class="toc-text">四、高级进阶与扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82"><span class="toc-text">4.1 取消请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E7%BB%86%E5%8C%96"><span class="toc-text">4.2 错误类型细化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%A4%9A%E5%AE%9E%E4%BE%8B%E7%AE%A1%E7%90%86"><span class="toc-text">4.3 多实例管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%BF%9B%E5%BA%A6"><span class="toc-text">4.4 文件上传进度</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">五、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-06_TresJS%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8Vue%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9E%84%E5%BB%BAThree.js%E5%9C%BA%E6%99%AF/" title="TresJS详解：用Vue的方式构建Three.js场景"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TresJS详解：用Vue的方式构建Three.js场景"/></a><div class="content"><a class="title" href="/2025/2025-10-06_TresJS%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8Vue%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9E%84%E5%BB%BAThree.js%E5%9C%BA%E6%99%AF/" title="TresJS详解：用Vue的方式构建Three.js场景">TresJS详解：用Vue的方式构建Three.js场景</a><time datetime="2025-10-05T22:24:00.000Z" title="发表于 2025-10-06 06:24:00">2025-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-10-01_Go%E8%AF%AD%E8%A8%80%E6%8C%87%E5%90%91%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%88(Pointer%20to%20Pointer)%E8%AF%A6%E8%A7%A3/" title="Go语言指向指针的指针(Pointer to Pointer)详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go语言指向指针的指针(Pointer to Pointer)详解"/></a><div class="content"><a class="title" href="/2025/2025-10-01_Go%E8%AF%AD%E8%A8%80%E6%8C%87%E5%90%91%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%88(Pointer%20to%20Pointer)%E8%AF%A6%E8%A7%A3/" title="Go语言指向指针的指针(Pointer to Pointer)详解">Go语言指向指针的指针(Pointer to Pointer)详解</a><time datetime="2025-09-30T22:24:00.000Z" title="发表于 2025-10-01 06:24:00">2025-10-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-09-28_HTMX%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8HTML%E5%B1%9E%E6%80%A7%E7%9B%B4%E6%8E%A5%E9%A9%B1%E5%8A%A8AJAX%E3%80%81CSS%E8%BF%87%E6%B8%A1%E5%92%8CWebSocket/" title="HTMX详解：用HTML属性直接驱动AJAX、CSS过渡和WebSocket"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-08.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTMX详解：用HTML属性直接驱动AJAX、CSS过渡和WebSocket"/></a><div class="content"><a class="title" href="/2025/2025-09-28_HTMX%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8HTML%E5%B1%9E%E6%80%A7%E7%9B%B4%E6%8E%A5%E9%A9%B1%E5%8A%A8AJAX%E3%80%81CSS%E8%BF%87%E6%B8%A1%E5%92%8CWebSocket/" title="HTMX详解：用HTML属性直接驱动AJAX、CSS过渡和WebSocket">HTMX详解：用HTML属性直接驱动AJAX、CSS过渡和WebSocket</a><time datetime="2025-09-27T22:24:00.000Z" title="发表于 2025-09-28 06:24:00">2025-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-09-22_WSL2%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9C%A8Windows%E8%BF%90%E8%A1%8CLinux%E7%9A%84%E6%96%B0%E6%A0%87%E5%87%86/" title="WSL2详解：在Windows运行Linux的新标准"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-23.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WSL2详解：在Windows运行Linux的新标准"/></a><div class="content"><a class="title" href="/2025/2025-09-22_WSL2%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%9C%A8Windows%E8%BF%90%E8%A1%8CLinux%E7%9A%84%E6%96%B0%E6%A0%87%E5%87%86/" title="WSL2详解：在Windows运行Linux的新标准">WSL2详解：在Windows运行Linux的新标准</a><time datetime="2025-09-21T22:24:00.000Z" title="发表于 2025-09-22 06:24:00">2025-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/2025-09-18_GoLang%20Wails%20%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8%20Web%20%E6%8A%80%E6%9C%AF%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8/" title="GoLang Wails 框架详解：用 Web 技术构建桌面应用"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-09.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GoLang Wails 框架详解：用 Web 技术构建桌面应用"/></a><div class="content"><a class="title" href="/2025/2025-09-18_GoLang%20Wails%20%E6%A1%86%E6%9E%B6%E8%AF%A6%E8%A7%A3%EF%BC%9A%E7%94%A8%20Web%20%E6%8A%80%E6%9C%AF%E6%9E%84%E5%BB%BA%E6%A1%8C%E9%9D%A2%E5%BA%94%E7%94%A8/" title="GoLang Wails 框架详解：用 Web 技术构建桌面应用">GoLang Wails 框架详解：用 Web 技术构建桌面应用</a><time datetime="2025-09-17T22:24:00.000Z" title="发表于 2025-09-18 06:24:00">2025-09-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-09.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/tags/2023/" target="_blank" title="📌 2023">📌 2023</a><a href="/tags/2024/" target="_blank" title="❓ 2024">❓ 2024</a><a href="/tags/2025/" target="_blank" title="🚀 2025">🚀 2025</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="分类">分类</a><a href="/tags/" target="_blank" title="标签">标签</a><a href="/categories/" target="_blank" title="时间线">时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="说说">说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2021 - 2025 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.1"></script><script src="/js/main.js?v=5.5.1"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><script src="/self/sakura.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="150,150,150" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script>(() => {
  const option = null
  const config = {"site_uv":true,"site_pv":true,"page_pv":true,"token":"qTvz1SkmPDt785fgh6BpiA5qiFFIVUwxj8Ft+rPW+cdN59v1hXjwRgSmy0+ji9m+oLlcxvo2NfDSMa6epVl3NTlsN3ejCIwWeP8Y51aEJ0Sbem4UexGmJLspB7AkOBId2SdtT6QWEBlGmFIIQgchQ2zAKYxTmc/kpBED5aLSr+3uvmQ9/G7FJQeVFpveDkK0xM1hu36xq4a6/FSeROxtoEp5zabzTWiYTlLsQzIl/NlELnCq3nxK+oo/vl3UQo/oM/rae/gJX/MaVKsgIUCd2ABJogNkx2KTenBIBpbPki5FzOgPh6/z4GPa4HvhNO51DDVG1SEQZooqEYmt/gnybLBWFbN+7liZWw=="}

  const runTrack = () => {
    if (typeof umami !== 'undefined' && typeof umami.track === 'function') {
      umami.track(props => ({ ...props, url: window.location.pathname, title: GLOBAL_CONFIG_SITE.title }))
    } else {
      console.warn('Umami Analytics: umami.track is not available')
    }
  }

  const loadUmamiJS = () => {
    btf.getScript('https://umami.012700.xyz/script.js', {
      'data-website-id': '2a796d6c-6499-42d8-8eb4-d9a2930b0ff3',
      'data-auto-track': 'false',
      ...option
    }).then(() => {
      runTrack()
    }).catch(error => {
      console.error('Umami Analytics: Error loading script', error)
    })
  }

  const getData = async (isPost) => {
    try {
      const now = Date.now()
      const keyUrl = isPost ? `&url=${window.location.pathname}` : ''
      const headerList = { 'Accept': 'application/json' }

      if (true) {
        headerList['Authorization'] = `Bearer ${config.token}`
      } else {
        headerList['x-umami-api-key'] = config.token
      }

      const res = await fetch(`https://umami.012700.xyz/api/websites/2a796d6c-6499-42d8-8eb4-d9a2930b0ff3/stats?startAt=0000000000&endAt=${now}${keyUrl}`, {
        method: "GET",
        headers: headerList
      })

      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`)
      }

      return await res.json()
    } catch (error) {
      console.error('Umami Analytics: Failed to fetch data', error)
      throw error
    }
  }

  const insertData = async () => {
    try {
      if (GLOBAL_CONFIG_SITE.pageType === 'post' && config.page_pv) {
        const pagePV = document.getElementById('umamiPV')
        if (pagePV) {
          const data = await getData(true)
          if (data && data.pageviews && typeof data.pageviews.value !== 'undefined') {
            pagePV.textContent = data.pageviews.value
          } else {
            console.warn('Umami Analytics: Invalid page view data received')
          }
        }
      }

      if (config.site_uv || config.site_pv) {
        const data = await getData(false)

        if (config.site_uv) {
          const siteUV = document.getElementById('umami-site-uv')
          if (siteUV && data && data.visitors && typeof data.visitors.value !== 'undefined') {
            siteUV.textContent = data.visitors.value
          } else if (siteUV) {
            console.warn('Umami Analytics: Invalid site UV data received')
          }
        }

        if (config.site_pv) {
          const sitePV = document.getElementById('umami-site-pv')
          if (sitePV && data && data.pageviews && typeof data.pageviews.value !== 'undefined') {
            sitePV.textContent = data.pageviews.value
          } else if (sitePV) {
            console.warn('Umami Analytics: Invalid site PV data received')
          }
        }
      }
    } catch (error) {
      console.error('Umami Analytics: Failed to insert data', error)
    }
  }

  btf.addGlobalFn('pjaxComplete', runTrack, 'umami_analytics_run_track')
  btf.addGlobalFn('pjaxComplete', insertData, 'umami_analytics_insert')


  loadUmamiJS()

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', insertData)
  } else {
    setTimeout(insertData, 100)
  }
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.1"></script></div></div></body></html>