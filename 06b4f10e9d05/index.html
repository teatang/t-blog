<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>RTSP (Real-Time Streaming Protocol) 详解 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="RTSP (Real-Time Streaming Protocol) 是一种应用层协议，旨在为流媒体服务器提供对实时媒体流的控制功能。它允许客户端远程控制流媒体服务器，例如启动、暂停、快进、倒带或停止媒体流，而无需下载整个文件。RTSP 协议本身不负责传输实际的媒体数据，它主要负责媒体流的会话建立、控制和断开。实际的媒体数据通常由 RTP (Real-time Transport Protoc">
<meta property="og:type" content="article">
<meta property="og:title" content="RTSP (Real-Time Streaming Protocol) 详解">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/06b4f10e9d05/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="RTSP (Real-Time Streaming Protocol) 是一种应用层协议，旨在为流媒体服务器提供对实时媒体流的控制功能。它允许客户端远程控制流媒体服务器，例如启动、暂停、快进、倒带或停止媒体流，而无需下载整个文件。RTSP 协议本身不负责传输实际的媒体数据，它主要负责媒体流的会话建立、控制和断开。实际的媒体数据通常由 RTP (Real-time Transport Protoc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-15.jpg">
<meta property="article:published_time" content="2024-12-15T22:24:00.000Z">
<meta property="article:modified_time" content="2025-12-25T06:50:50.544Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="计算机网络">
<meta property="article:tag" content="网络协议">
<meta property="article:tag" content="2024">
<meta property="article:tag" content="NAS">
<meta property="article:tag" content="RTSP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-15.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "RTSP (Real-Time Streaming Protocol) 详解",
  "url": "https://blog.tbf1211.xx.kg/06b4f10e9d05/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-15.jpg",
  "datePublished": "2024-12-15T22:24:00.000Z",
  "dateModified": "2025-12-25T06:50:50.544Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/06b4f10e9d05/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RTSP (Real-Time Streaming Protocol) 详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">437</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">223</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">80</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-15.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">RTSP (Real-Time Streaming Protocol) 详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">RTSP (Real-Time Streaming Protocol) 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-12-15T22:24:00.000Z" title="发表于 2024-12-16 06:24:00">2024-12-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>RTSP (Real-Time Streaming Protocol)</strong> 是一种应用层协议，旨在为流媒体服务器提供<strong>对实时媒体流的控制功能</strong>。它允许客户端远程控制流媒体服务器，例如启动、暂停、快进、倒带或停止媒体流，而无需下载整个文件。RTSP 协议本身<strong>不负责传输实际的媒体数据</strong>，它主要负责媒体流的会话建立、控制和断开。实际的媒体数据通常由 RTP (Real-time Transport Protocol) 和 RTCP (RTP Control Protocol) 协议进行传输。</p>
</blockquote>
<div class="note info flat"><p>核心思想：<strong>RTSP 就像一个“远程遥控器”，用于指挥流媒体服务器发送或停止媒体数据，而具体的数据传输则交给其他协议（通常是 RTP&#x2F;RTCP）来完成。</strong></p>
</div>
<hr>
<h2 id="一、为什么需要-RTSP？"><a href="#一、为什么需要-RTSP？" class="headerlink" title="一、为什么需要 RTSP？"></a>一、为什么需要 RTSP？</h2><p>在流媒体领域，用户需要对媒体播放进行灵活的控制，类似于操作本地播放器。传统的 HTTP 协议虽然可以用于文件下载，但其“请求-响应”模式并不适合实时流媒体的互动控制：</p>
<ol>
<li><strong>缺乏实时控制能力</strong>：HTTP 主要用于文件传输，不支持播放、暂停、快进、倒带等实时媒体控制操作。</li>
<li><strong>不适合长时间连接</strong>：HTTP 通常是短连接，每次操作都可能需要重新建立连接，效率低下。</li>
<li><strong>无状态性</strong>：HTTP 的无状态特性使得维护媒体播放的上下文（如当前播放位置）变得复杂。</li>
<li><strong>媒体数据与控制混淆</strong>：如果使用 HTTP 传输媒体数据并进行控制，会导致数据与控制信息混杂，难以管理。</li>
</ol>
<p>RTSP 旨在解决这些问题，提供一种专门为流媒体设计的控制协议：</p>
<ul>
<li><strong>集中控制</strong>：提供标准化的命令集，用于控制媒体流的播放状态。</li>
<li><strong>会话管理</strong>：支持有状态的会话，允许客户端和服务器在较长时间内维持媒体播放的上下文。</li>
<li><strong>分离控制与数据</strong>：RTSP 专注于控制，将媒体数据的传输交给 RTP&#x2F;RTCP，使得协议栈职责清晰。</li>
<li><strong>多种传输方式</strong>：支持通过 UDP 或 TCP 传输媒体数据，适应不同的网络环境。</li>
<li><strong>低延迟</strong>：通过实时控制和高效的数据传输，实现低延迟的流媒体体验。</li>
</ul>
<h2 id="二、RTSP-的核心概念与工作原理"><a href="#二、RTSP-的核心概念与工作原理" class="headerlink" title="二、RTSP 的核心概念与工作原理"></a>二、RTSP 的核心概念与工作原理</h2><h3 id="2-1-核心概念"><a href="#2-1-核心概念" class="headerlink" title="2.1 核心概念"></a>2.1 核心概念</h3><ol>
<li><p><strong>客户端-服务器模型</strong>：</p>
<ul>
<li><strong>客户端 (Client)</strong>：发起 RTSP 请求，控制媒体流播放的用户代理（如播放器、监控软件）。</li>
<li><strong>服务器 (Server)</strong>：接收 RTSP 请求，管理媒体文件和媒体流的发送（如流媒体服务器、NVR）。</li>
</ul>
</li>
<li><p><strong>RTSP URL</strong>:</p>
<ul>
<li>用于标识流媒体资源的统一资源定位符，通常以 <code>rtsp://</code> 开头。</li>
<li>示例：<code>rtsp://example.com:554/live/stream1</code></li>
</ul>
</li>
<li><p><strong>会话 (Session)</strong>:</p>
<ul>
<li>RTSP 是一个有状态的协议。客户端和服务器之间通过 <code>Session</code> ID 标识一个特定的媒体播放会话。</li>
<li><code>Session</code> ID 在 <code>SETUP</code> 阶段由服务器生成，并在后续的所有控制请求中携带，以维持上下文。</li>
</ul>
</li>
<li><p><strong>CSeq (Command Sequence)</strong>:</p>
<ul>
<li>每个 RTSP 请求和响应都包含一个 <code>CSeq</code> 头，表示命令序列号。</li>
<li>客户端每发送一个请求，<code>CSeq</code> 值递增。服务器的响应必须包含与请求匹配的 <code>CSeq</code>，用于关联请求和响应。</li>
</ul>
</li>
<li><p><strong>传输协议 (Transport)</strong>:</p>
<ul>
<li>RTSP 本身通常运行在 TCP (端口 554) 上，以确保控制命令的可靠性。</li>
<li>但实际的媒体数据（RTP&#x2F;RTCP）可以在 UDP 或 TCP 上传输，具体通过 <code>SETUP</code> 方法协商。<ul>
<li><strong>UDP (推荐)</strong>：适用于对延迟敏感但允许少量丢包的场景，如实时直播。</li>
<li><strong>TCP (RTP over RTSP&#x2F;Interleaved)</strong>：当 UDP 不可用或需要穿透防火墙时使用，RTP&#x2F;RTCP 数据包被封装在 RTSP 的 TCP 连接中。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>SDP (Session Description Protocol)</strong>:</p>
<ul>
<li>RTSP 通常使用 SDP 来描述媒体会话的详细信息，例如媒体类型（视频、音频）、编码格式、传输协议、端口、时间戳等。</li>
<li><code>DESCRIBE</code> 请求的响应中会包含 SDP 信息。</li>
</ul>
</li>
</ol>
<h3 id="2-2-RTSP-协议栈"><a href="#2-2-RTSP-协议栈" class="headerlink" title="2.2 RTSP 协议栈"></a>2.2 RTSP 协议栈</h3><p>RTSP 协议通常与 RTP 和 RTCP 协议协同工作，形成一个完整的流媒体传输与控制体系。</p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TD
    UserApp[用户应用程序 &#x2F; 播放器] --&gt; RTSP_Client[RTSP 客户端]
    RTSP_Client -- 控制命令 (TCP&#x2F;554) --&gt; RTSP_Server[RTSP 服务器]
    RTSP_Server -- 媒体数据 (UDP&#x2F;TCP) --&gt; RTP_RTCP_Client[RTP&#x2F;RTCP 客户端]
    RTP_RTCP_Client --&gt; UserApp

    subgraph RTSP_Server
        RTSP_Control[RTSP 控制模块]
        RTP_RTCP_Sender[RTP&#x2F;RTCP 发送模块]
        Media_Source[&quot;媒体源 (文件&#x2F;直播流)&quot;]
        RTSP_Control &lt;--&gt; RTP_RTCP_Sender
        RTP_RTCP_Sender --&gt; Media_Source
    end

    subgraph RTSP_Client
        RTSP_Controller[RTSP 控制模块]
        RTP_RTCP_Receiver[RTP&#x2F;RTCP 接收模块]
        RTSP_Controller &lt;--&gt; RTP_RTCP_Receiver
    end
  </pre></div>

<h2 id="三、RTSP-常用方法-Commands-详解"><a href="#三、RTSP-常用方法-Commands-详解" class="headerlink" title="三、RTSP 常用方法 (Commands) 详解"></a>三、RTSP 常用方法 (Commands) 详解</h2><p>RTSP 方法与 HTTP 方法类似，用于客户端向服务器发送特定指令。</p>
<h3 id="3-1-OPTIONS"><a href="#3-1-OPTIONS" class="headerlink" title="3.1 OPTIONS"></a>3.1 <code>OPTIONS</code></h3><ul>
<li><strong>作用</strong>：查询服务器支持的 RTSP 方法。</li>
<li><strong>过程</strong>：客户端发送 <code>OPTIONS</code> 请求，服务器在响应的 <code>Public</code> 头中列出其支持的方法。这是会话开始时常用的第一步。</li>
<li><strong>示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Client Request</span><br><span class="line">OPTIONS rtsp://example.com/stream RTSP/1.0</span><br><span class="line">CSeq: 1</span><br><span class="line"></span><br><span class="line"># Server Response</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 1</span><br><span class="line">Public: OPTIONS, DESCRIBE, SETUP, PLAY, PAUSE, TEARDOWN, GET_PARAMETER</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-2-DESCRIBE"><a href="#3-2-DESCRIBE" class="headerlink" title="3.2 DESCRIBE"></a>3.2 <code>DESCRIBE</code></h3><ul>
<li><strong>作用</strong>：获取媒体流的描述信息，通常以 SDP 格式返回。</li>
<li><strong>过程</strong>：客户端发送 <code>DESCRIBE</code> 请求，服务器响应包含媒体流的详细信息，如包含多少个音视频轨道、每个轨道的编码格式、传输端口建议等。</li>
<li><strong>示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Client Request</span><br><span class="line">DESCRIBE rtsp://example.com/stream RTSP/1.0</span><br><span class="line">CSeq: 2</span><br><span class="line">Accept: application/sdp</span><br><span class="line"></span><br><span class="line"># Server Response</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 2</span><br><span class="line">Content-Base: rtsp://example.com/stream/</span><br><span class="line">Content-Type: application/sdp</span><br><span class="line">Content-Length: 460</span><br><span class="line"></span><br><span class="line">v=0</span><br><span class="line">o=- 1234567890 1234567890 IN IP4 192.168.1.100</span><br><span class="line">s=Example Stream</span><br><span class="line">t=0 0</span><br><span class="line">a=control:*</span><br><span class="line">m=video 0 RTP/AVP 96</span><br><span class="line">a=rtpmap:96 H264/90000</span><br><span class="line">a=fmtp:96 packetization-mode=1;profile-level-id=42001E;sprop-parameter-sets=...</span><br><span class="line">a=control:trackID=0</span><br><span class="line">m=audio 0 RTP/AVP 97</span><br><span class="line">a=rtpmap:97 MPEG4-GENERIC/16000/2</span><br><span class="line">a=fmtp:97 profile-level-id=1;mode=AAC-hbr;sizelength=13;indexlength=3;indexdeltalength=3;config=...</span><br><span class="line">a=control:trackID=1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-3-SETUP"><a href="#3-3-SETUP" class="headerlink" title="3.3 SETUP"></a>3.3 <code>SETUP</code></h3><ul>
<li><strong>作用</strong>：为单个媒体流（音轨或视频轨）建立传输会话，并协商传输参数。</li>
<li><strong>过程</strong>：客户端根据 <code>DESCRIBE</code> 返回的 SDP 信息，为每个媒体轨道发送一个 <code>SETUP</code> 请求。它指定客户端用于接收 RTP&#x2F;RTCP 数据的端口。服务器响应中会包含服务器用于发送数据的端口，以及一个 <code>Session</code> ID。</li>
<li><strong>示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Client Request (for video track)</span><br><span class="line">SETUP rtsp://example.com/stream/trackID=0 RTSP/1.0</span><br><span class="line">CSeq: 3</span><br><span class="line">Transport: RTP/AVP;unicast;client_port=5000-5001</span><br><span class="line"></span><br><span class="line"># Server Response</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 3</span><br><span class="line">Session: 12345678;timeout=60</span><br><span class="line">Transport: RTP/AVP;unicast;client_port=5000-5001;server_port=6000-6001</span><br></pre></td></tr></table></figure>
<em><code>client_port</code> 为客户端接收 RTP&#x2F;RTCP 数据的端口范围 (RTP&#x2F;RTCP)，<code>server_port</code> 为服务器发送 RTP&#x2F;RTCP 数据的端口范围。</em></li>
</ul>
<h3 id="3-4-PLAY"><a href="#3-4-PLAY" class="headerlink" title="3.4 PLAY"></a>3.4 <code>PLAY</code></h3><ul>
<li><strong>作用</strong>：启动媒体流传输。</li>
<li><strong>过程</strong>：客户端发送 <code>PLAY</code> 请求，指定要播放的会话 ID 和可选的播放范围。服务器开始通过 RTP&#x2F;RTCP 传输媒体数据。</li>
<li><strong>示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Client Request</span><br><span class="line">PLAY rtsp://example.com/stream RTSP/1.0</span><br><span class="line">CSeq: 4</span><br><span class="line">Session: 12345678</span><br><span class="line">Range: npt=0- # 从头开始播放</span><br><span class="line"></span><br><span class="line"># Server Response</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 4</span><br><span class="line">Session: 12345678</span><br><span class="line">RTP-Info: url=rtsp://example.com/stream/trackID=0;seq=12345;rtptime=67890,url=rtsp://example.com/stream/trackID=1;seq=54321;rtptime=09876</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-5-PAUSE"><a href="#3-5-PAUSE" class="headerlink" title="3.5 PAUSE"></a>3.5 <code>PAUSE</code></h3><ul>
<li><strong>作用</strong>：暂停媒体流传输。</li>
<li><strong>过程</strong>：客户端发送 <code>PAUSE</code> 请求，服务器暂停发送数据。</li>
<li><strong>示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Client Request</span><br><span class="line">PAUSE rtsp://example.com/stream RTSP/1.0</span><br><span class="line">CSeq: 5</span><br><span class="line">Session: 12345678</span><br><span class="line"></span><br><span class="line"># Server Response</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 5</span><br><span class="line">Session: 12345678</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-6-TEARDOWN"><a href="#3-6-TEARDOWN" class="headerlink" title="3.6 TEARDOWN"></a>3.6 <code>TEARDOWN</code></h3><ul>
<li><strong>作用</strong>：终止媒体会话，并释放所有资源。</li>
<li><strong>过程</strong>：客户端发送 <code>TEARDOWN</code> 请求，服务器停止所有媒体传输，并关闭相关的 RTP&#x2F;RTCP 连接。</li>
<li><strong>示例</strong>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Client Request</span><br><span class="line">TEARDOWN rtsp://example.com/stream RTSP/1.0</span><br><span class="line">CSeq: 6</span><br><span class="line">Session: 12345678</span><br><span class="line"></span><br><span class="line"># Server Response</span><br><span class="line">RTSP/1.0 200 OK</span><br><span class="line">CSeq: 6</span><br><span class="line">Session: 12345678</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-7-其他方法"><a href="#3-7-其他方法" class="headerlink" title="3.7 其他方法"></a>3.7 其他方法</h3><ul>
<li><strong><code>GET_PARAMETER</code> &#x2F; <code>SET_PARAMETER</code></strong>: 用于获取或设置服务器或客户端的参数，例如查询连接状态、服务器负载等。</li>
<li><strong><code>RECORD</code></strong>: 用于将媒体从客户端录制到服务器，在 IP 摄像机和视频会议场景中较常见。</li>
</ul>
<h2 id="四、RTSP-典型会话流程"><a href="#四、RTSP-典型会话流程" class="headerlink" title="四、RTSP 典型会话流程"></a>四、RTSP 典型会话流程</h2><p>以下是一个典型的 RTSP 客户端与服务器交互的序列图：</p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    sequenceDiagram
    participant Client
    participant Server

    Client-&gt;&gt;Server: OPTIONS rtsp:&#x2F;&#x2F;example.com&#x2F;stream RTSP&#x2F;1.0 (CSeq: 1)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 1, Public: OPTIONS, DESCRIBE, SETUP, PLAY, PAUSE, TEARDOWN)

    Client-&gt;&gt;Server: DESCRIBE rtsp:&#x2F;&#x2F;example.com&#x2F;stream RTSP&#x2F;1.0 (CSeq: 2, Accept: application&#x2F;sdp)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 2, Content-Type: application&#x2F;sdp, SDP Body)
    Note right of Server: SDP Body describes media tracks (audio, video, ports, codecs)

    Client-&gt;&gt;Server: SETUP rtsp:&#x2F;&#x2F;example.com&#x2F;stream&#x2F;trackID&#x3D;0 RTSP&#x2F;1.0 (CSeq: 3, Transport: RTP&#x2F;AVP,unicast,client_port&#x3D;5000-5001)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 3, Session: S123,timeout&#x3D;60, Transport: RTP&#x2F;AVP,unicast,client_port&#x3D;5000-5001,server_port&#x3D;6000-6001)

    Client-&gt;&gt;Server: SETUP rtsp:&#x2F;&#x2F;example.com&#x2F;stream&#x2F;trackID&#x3D;1 RTSP&#x2F;1.0 (CSeq: 4, Session: S123, Transport: RTP&#x2F;AVP,unicast,client_port&#x3D;5002-5003)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 4, Session: S123, Transport: RTP&#x2F;AVP,unicast,client_port&#x3D;5002-5003,server_port&#x3D;6002-6003)
    Note right of Server: Each media track gets its own RTP&#x2F;RTCP port pair

    Client-&gt;&gt;Server: PLAY rtsp:&#x2F;&#x2F;example.com&#x2F;stream RTSP&#x2F;1.0 (CSeq: 5, Session: S123, Range: npt&#x3D;0-)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 5, RTP-Info: ...)
    Server--&gt;&gt;Client: Start sending media data via RTP&#x2F;RTCP on negotiated ports

    Client-&gt;&gt;Server: PAUSE rtsp:&#x2F;&#x2F;example.com&#x2F;stream RTSP&#x2F;1.0 (CSeq: 6, Session: S123)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 6)
    Server-&gt;&gt;Client: Stop sending media data

    Client-&gt;&gt;Server: PLAY rtsp:&#x2F;&#x2F;example.com&#x2F;stream RTSP&#x2F;1.0 (CSeq: 7, Session: S123, Range: npt&#x3D;10-)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 7)
    Server-&gt;&gt;Client: Resume sending media data from 10s mark

    Client-&gt;&gt;Server: TEARDOWN rtsp:&#x2F;&#x2F;example.com&#x2F;stream RTSP&#x2F;1.0 (CSeq: 8, Session: S123)
    Server--&gt;&gt;Client: RTSP&#x2F;1.0 200 OK (CSeq: 8)
    Note right of Server: Session S123 terminated, stop all RTP&#x2F;RTCP streams
  </pre></div>

<h2 id="五、RTSP-与其他协议的关系"><a href="#五、RTSP-与其他协议的关系" class="headerlink" title="五、RTSP 与其他协议的关系"></a>五、RTSP 与其他协议的关系</h2><h3 id="5-1-RTP-Real-time-Transport-Protocol"><a href="#5-1-RTP-Real-time-Transport-Protocol" class="headerlink" title="5.1 RTP (Real-time Transport Protocol)"></a>5.1 RTP (Real-time Transport Protocol)</h3><ul>
<li><strong>作用</strong>：RTSP 用于控制媒体流，而 <strong>RTP 负责实时传输媒体数据</strong>（音频、视频）。RTP 提供时间戳、序列号等信息，帮助客户端重构媒体流并处理抖动。</li>
<li><strong>关系</strong>：RTSP 通过 <code>SETUP</code> 方法协商 RTP 的传输参数 (如端口、传输模式)。</li>
</ul>
<h3 id="5-2-RTCP-RTP-Control-Protocol"><a href="#5-2-RTCP-RTP-Control-Protocol" class="headerlink" title="5.2 RTCP (RTP Control Protocol)"></a>5.2 RTCP (RTP Control Protocol)</h3><ul>
<li><strong>作用</strong>：与 RTP 协同工作，用于<strong>传输控制信息和提供 QoS (Quality of Service) 反馈</strong>。RTCP 报告包括发送方&#x2F;接收方报告、丢包率等，用于监控和调整传输质量。</li>
<li><strong>关系</strong>：RTSP 协商 RTP 传输时，通常也会为 RTCP 分配相邻的端口。</li>
</ul>
<h3 id="5-3-SDP-Session-Description-Protocol"><a href="#5-3-SDP-Session-Description-Protocol" class="headerlink" title="5.3 SDP (Session Description Protocol)"></a>5.3 SDP (Session Description Protocol)</h3><ul>
<li><strong>作用</strong>：<strong>描述媒体会话的参数</strong>，包括媒体类型、编码、采样率、传输协议、端口、时间信息等。</li>
<li><strong>关系</strong>：RTSP 的 <code>DESCRIBE</code> 请求响应中，通常会携带 SDP 信息，客户端解析这些信息来了解媒体流的特性。</li>
</ul>
<h3 id="5-4-HTTP-Hypertext-Transfer-Protocol"><a href="#5-4-HTTP-Hypertext-Transfer-Protocol" class="headerlink" title="5.4 HTTP (Hypertext Transfer Protocol)"></a>5.4 HTTP (Hypertext Transfer Protocol)</h3><ul>
<li><strong>作用</strong>：RTSP 在语法和语义上借鉴了 HTTP，例如请求&#x2F;响应模型、头部字段（如 <code>Content-Type</code>、<code>Content-Length</code>）。</li>
<li><strong>关系</strong>：RTSP 专注于流媒体控制，而 HTTP 专注于文档传输。RTSP 比 HTTP 更复杂，因为它需要维护会话状态和支持实时控制命令。</li>
</ul>
<h2 id="六、RTSP-的优缺点与适用场景"><a href="#六、RTSP-的优缺点与适用场景" class="headerlink" title="六、RTSP 的优缺点与适用场景"></a>六、RTSP 的优缺点与适用场景</h2><h3 id="6-1-优点："><a href="#6-1-优点：" class="headerlink" title="6.1 优点："></a>6.1 优点：</h3><ol>
<li><strong>实时控制</strong>：提供丰富的命令集（播放、暂停、快进、倒带等），实现对媒体流的精细控制。</li>
<li><strong>协议分层</strong>：清晰地分离了控制和数据传输，使得协议栈职责明确，易于扩展和维护。</li>
<li><strong>支持多种传输方式</strong>：媒体数据可以通过 UDP (低延迟) 或 TCP (穿透防火墙) 传输，适应不同网络条件。</li>
<li><strong>标准化</strong>：作为 IETF 定义的开放标准 (RFC 2326)，有广泛的实现和互操作性。</li>
<li><strong>低延迟</strong>：特别适用于对延迟要求高的场景，如直播、视频会议、IP 监控。</li>
</ol>
<h3 id="6-2-缺点："><a href="#6-2-缺点：" class="headerlink" title="6.2 缺点："></a>6.2 缺点：</h3><ol>
<li><strong>复杂性</strong>：相对于 HTTP，RTSP&#x2F;RTP&#x2F;RTCP 协议栈更为复杂，实现和调试成本较高。</li>
<li><strong>防火墙和 NAT 穿透问题</strong>：由于 RTP&#x2F;RTCP 通常使用 UDP 传输，且端口是动态协商的，穿透企业防火墙和进行 NAT 转换可能面临挑战。虽然 TCP 封装（RTP over RTSP）可以缓解，但会增加开销。</li>
<li><strong>浏览器不原生支持</strong>：现代浏览器不原生支持 RTSP，需要借助插件 (如 Flash, ActiveX) 或转换到 WebRTC、HLS&#x2F;DASH 等技术才能在 Web 上播放。</li>
<li><strong>生态系统相对缩小</strong>：在 Web 领域，由于 HLS (HTTP Live Streaming) 和 DASH (Dynamic Adaptive Streaming over HTTP) 等基于 HTTP 的流媒体技术普及，RTSP 在部分应用场景中逐渐被取代，尤其是在广域网分发和浏览器播放方面。</li>
</ol>
<h3 id="6-3-适用场景："><a href="#6-3-适用场景：" class="headerlink" title="6.3 适用场景："></a>6.3 适用场景：</h3><ul>
<li><strong>IP 监控和安防领域</strong>：IP 摄像机通常通过 RTSP 提供实时视频流，供 NVR (Network Video Recorder) 或客户端软件接入。</li>
<li><strong>局域网内的实时直播</strong>：在私有网络或控制较好的网络环境中，RTSP 因其低延迟和控制能力而常用于实时音视频传输。</li>
<li><strong>视频会议系统</strong>：虽然 WebRTC 更流行，但传统视频会议系统可能仍使用 RTSP&#x2F;RTP&#x2F;RTCP。</li>
<li><strong>嵌入式设备</strong>：资源有限的嵌入式设备可能更倾向于实现 RTSP 协议。</li>
</ul>
<h2 id="七、安全性考虑"><a href="#七、安全性考虑" class="headerlink" title="七、安全性考虑"></a>七、安全性考虑</h2><p>RTSP 协议本身没有内置强大的安全机制，因此在实际应用中需要额外考虑安全措施。</p>
<ol>
<li><p><strong>认证与授权</strong>：</p>
<ul>
<li><strong>摘要认证 (Digest Authentication)</strong>：RTSP 支持基于 HTTP Digest Authentication 的机制，客户端需要提供用户名和密码进行认证。</li>
<li><strong>令牌 (Token) 认证</strong>：更安全的方式是在 RTSP URL 中嵌入一次性令牌或签名，或通过服务器在 <code>SETUP</code> 阶段生成并验证会话令牌。</li>
<li><strong>会话劫持</strong>：<code>Session</code> ID 的泄露可能导致会话劫持。应确保 <code>Session</code> ID 的随机性和长度足够，并通过安全通道传输。</li>
</ul>
</li>
<li><p><strong>加密传输</strong>：</p>
<ul>
<li><strong>RTSPS (RTSP over SSL&#x2F;TLS)</strong>：类似于 HTTPS，RTSPS 通过在 TCP 连接上封装 SSL&#x2F;TLS 来加密 RTSP 控制命令。</li>
<li><strong>SRTP (Secure Real-time Transport Protocol)</strong>：用于加密 RTP 媒体数据，提供机密性、消息认证和重放保护。这要求在 <code>SETUP</code> 阶段协商加密参数。</li>
<li><strong>重要性</strong>：在公共网络传输敏感媒体内容或控制命令时，加密是必不可少的，以防止窃听和篡改。</li>
</ul>
</li>
<li><p><strong>DDoS 攻击</strong>：</p>
<ul>
<li>恶意客户端可以向 RTSP 服务器发送大量请求，或建立大量会话而不发送 <code>TEARDOWN</code>，耗尽服务器资源。</li>
<li><strong>防护</strong>：速率限制、连接数限制、源 IP 过滤、验证客户端合法性。</li>
</ul>
</li>
<li><p><strong>URL 操纵</strong>：</p>
<ul>
<li>攻击者可能尝试修改 RTSP URL 参数，以访问未授权的媒体流或执行非法操作。</li>
<li><strong>防护</strong>：服务器端对所有 URL 参数进行严格的验证和授权检查。</li>
</ul>
</li>
<li><p><strong>媒体流源认证</strong>：</p>
<ul>
<li>确保媒体流确实来自合法和受信任的源，防止伪造的媒体流注入。</li>
<li><strong>防护</strong>：对媒体流源进行认证，例如通过数字签名或 TLS 证书。</li>
</ul>
</li>
</ol>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>RTSP 协议作为流媒体领域的“遥控器”，为实时音视频的传输提供了强大而灵活的控制机制。它通过与 RTP&#x2F;RTCP 和 SDP 的协同工作，实现了媒体流的会话建立、播放控制和数据传输分离。尽管在 Web 领域面临 HLS&#x2F;DASH 的竞争，RTSP 在 IP 监控、局域网直播和嵌入式设备等特定场景中仍然占据着重要地位。</p>
<p>在部署和使用 RTSP 系统时，开发者和管理员必须充分理解其工作原理，并特别关注安全性问题，通过认证、加密和访问控制等手段，确保媒体流的完整性、机密性和可用性。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/06b4f10e9d05/">https://blog.tbf1211.xx.kg/06b4f10e9d05/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/">网络协议</a><a class="post-meta__tags" href="/tags/2024/">2024</a><a class="post-meta__tags" href="/tags/NAS/">NAS</a><a class="post-meta__tags" href="/tags/RTSP/">RTSP</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-15.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/137d1f5d80b7/" title="CSS 单位详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-07.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">CSS 单位详解</div></div><div class="info-2"><div class="info-item-1"> 在 CSS (Cascading Style Sheets) 中，单位是用来指定数值大小或尺寸的关键部分。无论是设置字体大小、元素宽度、边距还是动画时长，都需要使用合适的单位。CSS 提供了多种单位类型，它们可以分为两大类：绝对单位 和 相对单位。理解这些单位及其适用场景对于构建响应式、可维护的 Web 界面至关重要。  核心思想：CSS 单位是用来量化样式的尺寸或数值，分为绝对单位（如 px, pt）和相对单位（如 em, rem, %, vw, vh）。合理选择和使用这些单位，是实现响应式设计、确保界面在不同设备和上下文下表现一致的关键。   一、绝对单位 (Absolute Length Units)绝对单位表示一个固定的物理量，其大小不会受到视口、父元素字体大小或其他环境因素的影响。它们在不同设备上理论上保持相同大小（物理尺寸），但在屏幕上可能会因为屏幕 DPI (Dots Per Inch) 不同而视觉效果有所差异。 1.1 px (Pixels) 定义：一个像素点。这是 Web 开发中最常用的单位。 特性： 在 CSS 中，px 是一个逻辑像素，不一定对应屏幕上的一...</div></div></div></a><a class="pagination-related" href="/0564a7f3ccd9/" title="Frigate介绍与部署：基于AI的本地视频监控系统"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-26.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Frigate介绍与部署：基于AI的本地视频监控系统</div></div><div class="info-2"><div class="info-item-1"> Frigate 是一个开源的、高性能的本地视频监控系统，它利用 AI （特别是通过 Google Coral TPU 进行边缘计算）来实现实时目标检测，例如检测人、车辆、宠物等。与传统监控系统只是录像不同，Frigate 能够智能识别画面中的物体，并只在检测到感兴趣的事件时进行录像或发送通知，大大减少了存储空间和误报，同时提高了事件分析的效率。  “让你的摄像头变得更智能，只记录你真正关心的事件。”   一、Frigate 是什么？Frigate 是一个基于 FFmpeg 和 TensorFlow 的 AI 目标检测视频监控系统。它的核心思想是利用神经网络在本地对视频流进行实时分析，识别预定义的目标（如人、车），然后根据这些识别结果进行录制、快照捕捉或触发自动化。 核心优势：  本地处理：所有视频流和 AI 推理都在本地完成，保障隐私，不依赖云服务。 实时目标检测：利用 Google Coral TPU 等硬件加速，实现毫秒级的实时检测。 智能录像与快照：只在检测到目标时录制完整的视频片段，并捕捉关键帧快照。 集成度高：与 Home Assistant 深度集成，可以作为强大的...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/aeeb1d5d94e7/" title="WebDAV详解：基于HTTP的分布式文件管理协议"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-32.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-02</div><div class="info-item-2">WebDAV详解：基于HTTP的分布式文件管理协议</div></div><div class="info-2"><div class="info-item-1"> WebDAV (Web Distributed Authoring and Versioning) 是一种基于 HTTP 协议的扩展协议，它允许客户端直接通过 Web 远程地执行文件和文件夹的操作，包括创建、移动、复制、删除、读取以及管理文件属性和锁机制。简而言之，WebDAV 将 Web 服务器从一个简单的内容消费者转变为一个可供用户直接进行创作和协同工作的平台，将 Web 页面视为可编辑的文档集合。  核心思想：WebDAV 在不改变 HTTP 核心语义的前提下，增加了 HTTP 缺乏的文件锁定、属性管理、命名空间管理等功能，使其能够支持分布式文件系统的基本操作。它将传统的“请求-响应”模式扩展为“文档创作-协作”模式。   一、为什么需要 WebDAV？HTTP 的局限性HTTP (Hypertext Transfer Protocol) 在设计之初，主要是为了实现信息的单向传输，即客户端请求资源，服务器提供资源。它的主要方法 (GET, POST, PUT, DELETE, HEAD, OPTIONS) 专注于获取、提交和替换&#x2F;删除单个资源。 然而，对于 We...</div></div></div></a><a class="pagination-related" href="/322d9ce55371/" title="DHCP (动态主机配置协议) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-02.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-08</div><div class="info-item-2">DHCP (动态主机配置协议) 详解</div></div><div class="info-2"><div class="info-item-1"> DHCP (Dynamic Host Configuration Protocol)，即动态主机配置协议，是一个应用层协议，它允许服务器动态地为客户端（例如计算机、智能手机、物联网设备等）分配 IP 地址和其他网络配置参数。DHCP 是目前最常用的网络配置方式，极大地简化了网络管理，避免了手动配置 IP 地址可能出现的冲突和错误。  核心思想：自动化分配 IP 地址和其他网络参数，简化网络管理，提高效率。   一、为什么需要 DHCP？在没有 DHCP 的情况下，每台连接到 TCP&#x2F;IP 网络的设备都需要手动配置以下信息：  IP 地址：设备在网络上的唯一标识。 子网掩码：用于区分 IP 地址的网络部分和主机部分。 默认网关：设备访问外部网络的路由器的 IP 地址。 DNS 服务器地址：用于将域名解析为 IP 地址的服务器。  手动配置的弊端显而易见：  复杂且耗时：对于大型网络，手动配置数百甚至数千台设备的网络参数是一项繁琐且容易出错的工作。 易出错：人为输入错误可能导致网络连接问题或 IP 地址冲突。 IP 地址冲突：如果不小心将同一个 IP 地址分配给多台设备，...</div></div></div></a><a class="pagination-related" href="/0f6de86a0220/" title="STUN (Session Traversal Utilities for NAT) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-12</div><div class="info-item-2">STUN (Session Traversal Utilities for NAT) 详解</div></div><div class="info-2"><div class="info-item-1"> STUN (Session Traversal Utilities for NAT)，即 NAT 会话穿越工具，是一种网络协议，它允许位于NAT (Network Address Translation，网络地址转换) 设备之后的客户端发现其外部（公共）IP 地址和端口号，以及 NAT 设备的类型。STUN 的主要目的是协助建立对等连接 (P2P)，尤其是在 VoIP、视频会议和 WebRTC 等实时通信应用中。  核心思想：帮助内网主机探测 NAT 类型和获取公网 IP:Port，为 P2P 连接做准备。   一、为什么需要 STUN？现代互联网中，IPv4 地址资源日益枯竭，导致大多数终端设备都部署在 NAT 设备（如路由器）之后。NAT 设备通过将内部私有 IP 地址映射到外部公共 IP 地址和端口，允许多个内部设备共享一个公共 IP 地址访问互联网。 然而，NAT 给直接的点对点 (P2P) 通信带来了巨大的挑战：  内网 IP 地址不可路由：内部私有 IP 地址在公共互联网上是不可见的，外部设备无法直接通过私有 IP 地址联系到内部设备。 端口映射不确定：NAT 设备...</div></div></div></a><a class="pagination-related" href="/bd05c017c301/" title="SNI (Server Name Indication) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-32.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-09</div><div class="info-item-2">SNI (Server Name Indication) 详解</div></div><div class="info-2"><div class="info-item-1"> SNI (Server Name Indication) 是 TLS (Transport Layer Security) 协议的一个扩展，它允许客户端在建立 TLS&#x2F;SSL 握手时，在 Client Hello 报文中指定其尝试连接的主机名（域名）。SNI 主要解决了在单个 IP 地址和端口上托管多个 HTTPS 网站（每个网站有不同的域名和证书）的问题。  核心思想：TLS 握手阶段，客户端告诉服务器它想访问哪个域名，这样服务器就知道应该提供哪个域名的证书。   一、为什么需要 SNI？在 SNI 出现之前，建立 HTTPS 连接的过程是这样的：  客户端通过 IP 地址和端口 (通常是 443) 连接到服务器。 服务器接收连接，然后发送其数字证书给客户端。 客户端验证证书，然后建立加密通信。  这里的问题在于，一个服务器 IP 地址可以托管多个网站，每个网站都有其自己的域名。在 HTTPS 中，每个域名都需要一张匹配的 SSL&#x2F;TLS 证书。 没有 SNI 的局限性：  IP 地址瓶颈：服务器在收到客户端的连接请求时，它只知道客户端连接的是哪个 IP ...</div></div></div></a><a class="pagination-related" href="/eae983954311/" title="NAT (Network Address Translation) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-15.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-03</div><div class="info-item-2">NAT (Network Address Translation) 详解</div></div><div class="info-2"><div class="info-item-1"> NAT (Network Address Translation，网络地址转换) 是一种在 IP 数据包通过路由器或防火墙时，修改其 IP 地址信息（有时也包括端口号）的技术。NAT 是 IPv4 时代的核心网络技术之一，它在缓解 IPv4 地址枯竭和提高内部网络安全性方面发挥了不可或缺的作用。  核心思想：NAT 允许一个拥有私有 IP 地址的内部网络通过一个或几个公共 IP 地址与外部网络（如互联网）通信，从而实现地址共享和隐藏内部拓扑。    一、NAT 的背景与重要性1.1 IPv4 地址枯竭原始的 IPv4 地址空间大约为 40 亿个地址。随着互联网和智能设备的普及，全球对 IP 地址的需求爆炸式增长，远超 IPv4 的设计容量。NAT 的出现使得多个设备可以共享一个公有 IP 地址，极大地延缓了 IPv4 地址耗尽的速度。 1.2 网络安全考量通过 NAT，内部网络的私有 IP 地址空间对外部网络是不可见的。外部攻击者无法直接访问内部主机，因为他们只看到 NAT 设备的公共 IP 地址。这为内部网络提供了一层基本的安全屏障。 1.3 灵活的网络设计NAT 允许企业和...</div></div></div></a><a class="pagination-related" href="/45a8b220c3e8/" title="中国移动 CMI 网络详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-01.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-18</div><div class="info-item-2">中国移动 CMI 网络详解</div></div><div class="info-2"><div class="info-item-1"> CMI (China Mobile International)，即中国移动国际网络，是中国移动的国际出口骨干网络。与中国电信的 CN2 和中国联通的 AS4837&#x2F;AS9929 类似，CMI 专注于提供中国移动用户的高质量国际互联服务。它随着中国移动国际业务的扩张而迅速发展，成为连接中国大陆与全球各地的重要网络基础设施之一。  核心思想：CMI 是中国移动为提升其用户国际访问体验而建立的国际骨干网络。它通过建设自有海缆和海外节点，提供相对稳定、大带宽的国际互联通道。   一、为什么需要 CMI？1.1 中国移动网络的挑战在早期的国际互联方面，中国移动（China Mobile）主要依靠租用其他运营商的国际出口带宽，或者将流量转接到中国电信或中国联通的网络进行国际互联。这种方式存在一些固有的问题：  网络质量不稳定：路由路径通常较长，经过的中间运营商和节点多，导致延迟高、丢包率大。 带宽不足：租用带宽的成本和可用性限制，使得在国际流量高峰期容易出现拥堵。 服务不可控：缺乏对国际链路的端到端控制，难以保证服务质量 (QoS)。 成本高昂：长期租用国际带宽的成本较高。  ...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">437</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">223</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">80</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-RTSP%EF%BC%9F"><span class="toc-text">一、为什么需要 RTSP？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81RTSP-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">二、RTSP 的核心概念与工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">2.1 核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-RTSP-%E5%8D%8F%E8%AE%AE%E6%A0%88"><span class="toc-text">2.2 RTSP 协议栈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81RTSP-%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95-Commands-%E8%AF%A6%E8%A7%A3"><span class="toc-text">三、RTSP 常用方法 (Commands) 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-OPTIONS"><span class="toc-text">3.1 OPTIONS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-DESCRIBE"><span class="toc-text">3.2 DESCRIBE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SETUP"><span class="toc-text">3.3 SETUP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-PLAY"><span class="toc-text">3.4 PLAY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-PAUSE"><span class="toc-text">3.5 PAUSE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-TEARDOWN"><span class="toc-text">3.6 TEARDOWN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-text">3.7 其他方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81RTSP-%E5%85%B8%E5%9E%8B%E4%BC%9A%E8%AF%9D%E6%B5%81%E7%A8%8B"><span class="toc-text">四、RTSP 典型会话流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81RTSP-%E4%B8%8E%E5%85%B6%E4%BB%96%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">五、RTSP 与其他协议的关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-RTP-Real-time-Transport-Protocol"><span class="toc-text">5.1 RTP (Real-time Transport Protocol)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-RTCP-RTP-Control-Protocol"><span class="toc-text">5.2 RTCP (RTP Control Protocol)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-SDP-Session-Description-Protocol"><span class="toc-text">5.3 SDP (Session Description Protocol)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-HTTP-Hypertext-Transfer-Protocol"><span class="toc-text">5.4 HTTP (Hypertext Transfer Protocol)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81RTSP-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%E4%B8%8E%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">六、RTSP 的优缺点与适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-text">6.1 优点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-text">6.2 缺点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-text">6.3 适用场景：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91"><span class="toc-text">七、安全性考虑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">八、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/0c48c5fa5942/" title="CFFI (C Foreign Function Interface for Python) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-17.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CFFI (C Foreign Function Interface for Python) 详解"/></a><div class="content"><a class="title" href="/0c48c5fa5942/" title="CFFI (C Foreign Function Interface for Python) 详解">CFFI (C Foreign Function Interface for Python) 详解</a><time datetime="2025-12-23T22:24:00.000Z" title="发表于 2025-12-24 06:24:00">2025-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/03cebd3cc28a/" title="行为驱动开发 (BDD) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="行为驱动开发 (BDD) 详解"/></a><div class="content"><a class="title" href="/03cebd3cc28a/" title="行为驱动开发 (BDD) 详解">行为驱动开发 (BDD) 详解</a><time datetime="2025-12-21T22:24:00.000Z" title="发表于 2025-12-22 06:24:00">2025-12-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/7bb082434be0/" title="测试驱动开发 (TDD) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-09.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="测试驱动开发 (TDD) 详解"/></a><div class="content"><a class="title" href="/7bb082434be0/" title="测试驱动开发 (TDD) 详解">测试驱动开发 (TDD) 详解</a><time datetime="2025-12-19T22:24:00.000Z" title="发表于 2025-12-20 06:24:00">2025-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/24ffc0bedb41/" title="IPFS (InterPlanetary File System) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="IPFS (InterPlanetary File System) 详解"/></a><div class="content"><a class="title" href="/24ffc0bedb41/" title="IPFS (InterPlanetary File System) 详解">IPFS (InterPlanetary File System) 详解</a><time datetime="2025-12-16T22:24:00.000Z" title="发表于 2025-12-17 06:24:00">2025-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/974825c9c64f/" title="L7 负载均衡详解 (Layer 7 Load Balancing Explained)"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="L7 负载均衡详解 (Layer 7 Load Balancing Explained)"/></a><div class="content"><a class="title" href="/974825c9c64f/" title="L7 负载均衡详解 (Layer 7 Load Balancing Explained)">L7 负载均衡详解 (Layer 7 Load Balancing Explained)</a><time datetime="2025-12-14T22:24:00.000Z" title="发表于 2025-12-15 06:24:00">2025-12-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-15.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="📌 2023">📌 2023</a><a href="/archives/2024/" target="_blank" title="❓ 2024">❓ 2024</a><a href="/archives/2025/" target="_blank" title="🚀 2025">🚀 2025</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="分类">分类</a><a href="/tags/" target="_blank" title="标签">标签</a><a href="/categories/" target="_blank" title="时间线">时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="说说">说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2025 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.3"></script></div></div></body></html>