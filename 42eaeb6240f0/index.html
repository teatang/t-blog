<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SAML 2.0 (Security Assertion Markup Language) 详解 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SAML (Security Assertion Markup Language) 是一种基于 XML 的开放标准，用于在安全域之间交换身份验证和授权数据。它主要用于实现单一登录 (Single Sign-On, SSO) 功能，允许用户在一个身份验证服务器（Identity Provider, IdP）上登录一次后，即可访问多个服务提供商 (Service Provider, SP) 上的应用">
<meta property="og:type" content="article">
<meta property="og:title" content="SAML 2.0 (Security Assertion Markup Language) 详解">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/42eaeb6240f0/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="SAML (Security Assertion Markup Language) 是一种基于 XML 的开放标准，用于在安全域之间交换身份验证和授权数据。它主要用于实现单一登录 (Single Sign-On, SSO) 功能，允许用户在一个身份验证服务器（Identity Provider, IdP）上登录一次后，即可访问多个服务提供商 (Service Provider, SP) 上的应用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg">
<meta property="article:published_time" content="2023-12-17T22:24:00.000Z">
<meta property="article:modified_time" content="2026-01-30T10:18:03.454Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="2023">
<meta property="article:tag" content="计算机网络">
<meta property="article:tag" content="网络安全">
<meta property="article:tag" content="身份认证">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SAML 2.0 (Security Assertion Markup Language) 详解",
  "url": "https://blog.tbf1211.xx.kg/42eaeb6240f0/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg",
  "datePublished": "2023-12-17T22:24:00.000Z",
  "dateModified": "2026-01-30T10:18:03.454Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/42eaeb6240f0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SAML 2.0 (Security Assertion Markup Language) 详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">536</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">229</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">84</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-11.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">SAML 2.0 (Security Assertion Markup Language) 详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">SAML 2.0 (Security Assertion Markup Language) 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2023-12-17T22:24:00.000Z" title="发表于 2023-12-18 06:24:00">2023-12-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>15分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>SAML (Security Assertion Markup Language)</strong> 是一种基于 XML 的开放标准，用于在安全域之间交换身份验证和授权数据。它主要用于实现<strong>单一登录 (Single Sign-On, SSO)</strong> 功能，允许用户在一个身份验证服务器（Identity Provider, IdP）上登录一次后，即可访问多个服务提供商 (Service Provider, SP) 上的应用程序，而无需在每个应用程序上重新输入凭据。SAML 2.0 是当前最广泛使用的版本。</p>
</blockquote>
<div class="note info flat"><p>核心思想：<strong>将用户身份验证的职责从各个服务提供商剥离到专门的身份提供商，通过可信的 XML 断言 (Assertion) 在两者之间传递身份和授权信息。</strong></p>
</div>
<hr>
<h2 id="一、为什么需要-SAML？"><a href="#一、为什么需要-SAML？" class="headerlink" title="一、为什么需要 SAML？"></a>一、为什么需要 SAML？</h2><p>随着企业和组织越来越多地使用 SaaS (Software as a Service) 应用和跨域资源，用户常常需要在多个独立的应用程序中重复登录，这不仅降低了用户体验，也增加了密码管理的负担和安全风险。传统的做法是每个应用程序维护自己的用户数据库和认证机制。</p>
<p>SAML 旨在解决这些问题，它提供了一种<strong>联邦身份 (Federated Identity)</strong> 的解决方案，其核心优势包括：</p>
<ul>
<li><strong>单一登录 (SSO)</strong>：显著提升用户体验，只需登录一次即可访问所有集成 SAML 的应用。</li>
<li><strong>企业级的安全性</strong>：通过数字签名和加密保证身份断言的完整性和机密性。</li>
<li><strong>降低成本</strong>：减少了每个服务提供商维护用户账户和认证逻辑的负担。</li>
<li><strong>标准化</strong>：作为开放标准，促进了不同厂商和平台之间的互操作性。</li>
<li><strong>增强审计能力</strong>：集中化的认证日志更容易进行安全审计。</li>
</ul>
<h2 id="二、SAML-核心概念"><a href="#二、SAML-核心概念" class="headerlink" title="二、SAML 核心概念"></a>二、SAML 核心概念</h2><p>理解 SAML 协议需要掌握几个关键角色和概念：</p>
<h3 id="2-1-主体-Principal"><a href="#2-1-主体-Principal" class="headerlink" title="2.1 主体 (Principal)"></a>2.1 主体 (Principal)</h3><p>通常指用户，是请求访问受保护资源的一方。</p>
<h3 id="2-2-身份提供商-Identity-Provider-IdP"><a href="#2-2-身份提供商-Identity-Provider-IdP" class="headerlink" title="2.2 身份提供商 (Identity Provider, IdP)"></a>2.2 身份提供商 (Identity Provider, IdP)</h3><p>负责对用户进行身份验证，并向服务提供商发出包含用户身份和属性的 SAML 断言。IdP 是权威的身份验证源。<br><strong>示例</strong>：企业内部的认证服务器、Okta、Azure AD、Auth0 等。</p>
<h3 id="2-3-服务提供商-Service-Provider-SP"><a href="#2-3-服务提供商-Service-Provider-SP" class="headerlink" title="2.3 服务提供商 (Service Provider, SP)"></a>2.3 服务提供商 (Service Provider, SP)</h3><p>提供受保护资源或服务的应用程序。它依赖 IdP 进行用户身份验证，并根据 IdP 发送的 SAML 断言来决定是否授权用户访问。<br><strong>示例</strong>：Salesforce、Microsoft 365、Dropbox、自定义 Web 应用等。</p>
<h3 id="2-4-SAML-断言-SAML-Assertion"><a href="#2-4-SAML-断言-SAML-Assertion" class="headerlink" title="2.4 SAML 断言 (SAML Assertion)"></a>2.4 SAML 断言 (SAML Assertion)</h3><p>由 IdP 生成并发送给 SP 的 XML 文档。它包含关于主体（用户）的声明，是 SAML 协议的核心。断言是 IdP 身份验证结果和授权信息的可信表达。<br>断言通常由 IdP 进行<strong>数字签名</strong>，以确保其完整性和真实性。</p>
<h3 id="2-5-元数据-Metadata"><a href="#2-5-元数据-Metadata" class="headerlink" title="2.5 元数据 (Metadata)"></a>2.5 元数据 (Metadata)</h3><p>描述 IdP 和 SP 配置信息的 XML 文档，包括它们的实体 ID、端点 URL、支持的绑定、公钥证书等。元数据使得 IdP 和 SP 能够相互发现并安全地进行配置，减少手动配置的错误并增强安全性。</p>
<h2 id="三、SAML-2-0-框架组成"><a href="#三、SAML-2-0-框架组成" class="headerlink" title="三、SAML 2.0 框架组成"></a>三、SAML 2.0 框架组成</h2><p>SAML 2.0 协议由以下主要组件构成：</p>
<h3 id="3-1-SAML-断言-SAML-Assertions"><a href="#3-1-SAML-断言-SAML-Assertions" class="headerlink" title="3.1 SAML 断言 (SAML Assertions)"></a>3.1 SAML 断言 (SAML Assertions)</h3><p>SAML 断言是包含身份验证和授权信息的 XML 声明。主要有三种类型：</p>
<ol>
<li><p><strong>认证断言 (Authentication Assertion)</strong>：</p>
<ul>
<li>声明主体（用户）何时以何种方式通过 IdP 进行了身份验证。</li>
<li>示例：<code>User &#39;alice&#39; authenticated at 2026-01-14T06:20:00Z using Password method.</code></li>
</ul>
</li>
<li><p><strong>属性断言 (Attribute Assertion)</strong>：</p>
<ul>
<li>声明关于主体的特定属性信息，例如用户的姓名、电子邮件地址、角色、部门等。</li>
<li>这些属性信息通常用于 SP 的用户画像建立和权限管理。</li>
<li>示例：<code>User &#39;alice&#39; has attribute &#39;email&#39; with value &#39;alice@example.com&#39;.</code></li>
</ul>
</li>
<li><p><strong>授权决策断言 (Authorization Decision Assertion)</strong>：</p>
<ul>
<li>声明 IdP 对某个主体访问特定资源是否授权的决定。</li>
<li>虽然 SAML 本身不直接执行授权，但它可以传达授权系统的决策。</li>
<li>示例：<code>User &#39;alice&#39; is permitted to access &#39;document_service&#39;.</code></li>
</ul>
</li>
</ol>
<h3 id="3-2-SAML-协议-SAML-Protocols"><a href="#3-2-SAML-协议-SAML-Protocols" class="headerlink" title="3.2 SAML 协议 (SAML Protocols)"></a>3.2 SAML 协议 (SAML Protocols)</h3><p>SAML 协议定义了如何封装 SAML 断言和请求&#x2F;响应消息，以及如何在 IdP 和 SP 之间进行通信。常见的协议包括：</p>
<ul>
<li><strong>身份验证请求协议 (Authentication Request Protocol)</strong>：SP 向 IdP 请求主体身份验证。</li>
<li><strong>断言消费者服务协议 (Assertion Consumer Service Protocol)</strong>：IdP 将身份验证断言发送给 SP。</li>
<li><strong>注销协议 (Logout Protocol)</strong>：用于实现单点注销 (Single Log-Out, SLO)。</li>
</ul>
<h3 id="3-3-SAML-绑定-SAML-Bindings"><a href="#3-3-SAML-绑定-SAML-Bindings" class="headerlink" title="3.3 SAML 绑定 (SAML Bindings)"></a>3.3 SAML 绑定 (SAML Bindings)</h3><p>SAML 绑定定义了 SAML 协议消息如何通过底层的通信或消息传递协议（如 HTTP、SOAP）进行传输。它们描述了消息的编码、如何将其添加到协议层的载荷中，以及如何通过传输机制发送。</p>
<p>常用的绑定包括：</p>
<ul>
<li><strong>HTTP Redirect Binding</strong>：<ul>
<li>SAML 消息以 URL 查询字符串参数的形式传输，通过 HTTP <code>GET</code> 重定向实现。</li>
<li>适用于传输较小的 SAML 请求，因为 URL 长度有限制。</li>
<li>消息通常经过 Base64 和 URL 编码，可能还会被压缩。</li>
</ul>
</li>
<li><strong>HTTP POST Binding</strong>：<ul>
<li>SAML 消息嵌入到 HTML 表单的隐藏字段中，通过 HTTP <code>POST</code> 请求提交。</li>
<li>适用于传输较大的 SAML 消息（如断言），不受 URL 长度限制。</li>
<li>消息通常经过 Base64 编码。</li>
</ul>
</li>
<li><strong>HTTP Artifact Binding</strong>：<ul>
<li>不直接传输 SAML 消息，而是传输一个<strong>引用 (Artifact)</strong>。</li>
<li>接收方（SP&#x2F;IdP）收到 Artifact 后，会通过后台通信（通常是基于 SOAP over HTTP 的 <code>SOAP Binding</code>）向发送方请求实际的 SAML 消息内容。</li>
<li>这种方式避免了敏感信息直接通过浏览器传输，增加了安全性，但增加了通信的复杂性。</li>
</ul>
</li>
</ul>
<h3 id="3-4-SAML-配置集-SAML-Profiles"><a href="#3-4-SAML-配置集-SAML-Profiles" class="headerlink" title="3.4 SAML 配置集 (SAML Profiles)"></a>3.4 SAML 配置集 (SAML Profiles)</h3><p>SAML 配置集（或称剖面）结合特定的 SAML 断言、协议和绑定，定义了用于解决特定用例的完整通信流。它们规定了消息的顺序、格式和底层传输机制。</p>
<p>最常见和最重要的配置集是：</p>
<ul>
<li><strong>Web 浏览器 SSO 配置集 (Web Browser SSO Profile)</strong>：<ul>
<li>用于实现基于 Web 浏览器的单点登录。</li>
<li>可以分为 SP-Initiated (由 SP 发起) 和 IdP-Initiated (由 IdP 发起) 两种流。</li>
<li>通常使用 HTTP Redirect Binding 传输 SAML AuthN Request，使用 HTTP POST 或 HTTP Artifact Binding 传输 SAML Response。</li>
</ul>
</li>
</ul>
<h2 id="四、SAML-2-0-Web-浏览器-SSO-流程详解-SP-Initiated"><a href="#四、SAML-2-0-Web-浏览器-SSO-流程详解-SP-Initiated" class="headerlink" title="四、SAML 2.0 Web 浏览器 SSO 流程详解 (SP-Initiated)"></a>四、SAML 2.0 Web 浏览器 SSO 流程详解 (SP-Initiated)</h2><p>SP-Initiated SSO 是最常见的 SAML SSO 流程，由用户尝试访问 SP 上的受保护资源发起。</p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    sequenceDiagram
    actor User
    participant Browser
    participant SP as Service Provider (SP)
    participant IdP as Identity Provider (IdP)

    User-&gt;&gt;Browser: 1. 尝试访问 SP 上的受保护资源
    Browser-&gt;&gt;SP: 2. 请求受保护资源 (GET &#x2F;secure_app)
    SP-&gt;&gt;Browser: 3. SP 检测到用户未认证，生成 SAML AuthN Request，&lt;br&#x2F;&gt;并使用 IdP 的 SSO 端点进行 HTTP Redirect (302 Found)
    Note over SP,Browser: (SAML AuthN Request 通常用 HTTP Redirect Binding, Base64 &amp; URL 编码)
    Browser-&gt;&gt;IdP: 4. 重定向到 IdP 的 SSO 端点，并携带 SAML AuthN Request
    IdP-&gt;&gt;IdP: 5. IdP 接收请求，验证签名，解析请求内容
    alt 用户未登录 IdP
        IdP-&gt;&gt;User: 6. 提示用户输入登录凭据
        User-&gt;&gt;IdP: 7. 提交登录凭据
        IdP-&gt;&gt;IdP: 8. 验证用户凭据，生成 SAML Session
    end
    IdP-&gt;&gt;IdP: 9. IdP 生成 SAML Response (包含认证断言和属性断言)，&lt;br&#x2F;&gt;并使用 SP 的 ACS (Assertion Consumer Service) URL 进行 HTTP POST Redirect
    Note over IdP,Browser: (SAML Response 通常用 HTTP POST Binding, Base64 编码)
    Browser-&gt;&gt;SP: 10. 通过 HTTP POST 将 SAML Response 提交到 SP 的 ACS 端点
    SP-&gt;&gt;SP: 11. SP 接收 SAML Response，验证其签名 (使用 IdP 公钥)
    SP-&gt;&gt;SP: 12. 解析 SAML 断言，提取用户身份和属性
    SP-&gt;&gt;SP: 13. 创建本地会话 (如设置 Session Cookie)
    SP-&gt;&gt;Browser: 14. 重定向用户到最初请求的资源 (或默认着陆页)
    Browser-&gt;&gt;SP: 15. 请求受保护资源 (携带 SP 会话 Cookie)
    SP-&gt;&gt;User: 16. 返回受保护资源
  </pre></div>

<p><strong>流程细节解析：</strong></p>
<ol>
<li><strong>用户请求</strong>：用户通过浏览器访问 SP 上的受保护资源。</li>
<li><strong>SP 发起认证请求</strong>：SP 检测到用户未登录，生成一个 SAML 身份验证请求 (<code>AuthNRequest</code>)。这个请求包含 SP 的实体 ID、期望的 IdP、以及当 IdP 完成认证后回调的 SP 端点 (<code>AssertionConsumerServiceURL</code>)。SP 使用 IdP 的 SSO 端点 URL 和 <code>HTTP Redirect Binding</code> 将用户重定向到 IdP。</li>
<li><strong>IdP 接收请求并认证用户</strong>：IdP 接收 <code>AuthNRequest</code>，验证其签名（如果SP对请求进行了签名）。如果用户尚未登录 IdP，IdP 会显示登录界面。用户成功登录后，IdP 创建一个用户会话。</li>
<li><strong>IdP 生成 SAML 响应</strong>：IdP 生成一个 <code>SAML Response</code>，其中包含一个或多个 <code>SAML Assertion</code>。断言中包含用户的身份信息（如用户名）、认证时间、认证方法和可选的用户属性。这个 <code>SAML Response</code> 会用 IdP 的私钥进行<strong>数字签名</strong>，以证明其来源和未被篡改。</li>
<li><strong>IdP 返回 SAML 响应</strong>：IdP 使用 SP 的 <code>Assertion Consumer Service (ACS)</code> URL 和 <code>HTTP POST Binding</code> 将 <code>SAML Response</code> 发送给用户浏览器（通过自动提交一个 HTML 表单）。</li>
<li><strong>SP 接收并验证响应</strong>：浏览器将 <code>SAML Response</code> POST 到 SP 的 ACS 端点。SP 接收到响应后，会执行以下关键步骤：<ul>
<li><strong>验证数字签名</strong>：SP 使用 IdP 的公钥验证 <code>SAML Response</code> 的数字签名，确保它确实由 IdP 发出且未被篡改。</li>
<li><strong>验证时间戳</strong>：检查断言是否在有效期内（<code>NotBefore</code> 和 <code>NotOnOrAfter</code>）。</li>
<li><strong>验证接收者</strong>：确认断言是发给当前 SP 的。</li>
<li><strong>安全存储</strong>：保护收到的断言，防止重放攻击。</li>
<li><strong>提取用户信息</strong>：从断言中提取用户的身份信息和属性。</li>
</ul>
</li>
<li><strong>SP 建立会话</strong>：SP 根据断言中的用户信息在自身系统中建立用户会话（如，设置一个 Session Cookie），并将用户重定向到最初请求的资源。</li>
</ol>
<h2 id="五、SAML-2-0-消息实例-简要-XML-结构"><a href="#五、SAML-2-0-消息实例-简要-XML-结构" class="headerlink" title="五、SAML 2.0 消息实例 (简要 XML 结构)"></a>五、SAML 2.0 消息实例 (简要 XML 结构)</h2><p>SAML 消息是复杂的 XML 文档。以下是一个简化后的 SAML 断言 (Assertion) 结构示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">saml2:Assertion</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:saml2</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">ID</span>=<span class="string">&quot;_a75ad07a-9a96-4e58-86d1-1234567890ab&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">IssueInstant</span>=<span class="string">&quot;2026-01-14T06:30:00.000Z&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">Version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml2:Issuer</span>&gt;</span>https://idp.example.com/sso<span class="tag">&lt;/<span class="name">saml2:Issuer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ds:Signature</span> <span class="attr">xmlns:ds</span>=<span class="string">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数字签名：包含签名信息、证书等，用于验证断言的真实性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ds:Signature</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml2:Subject</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">saml2:NameID</span> <span class="attr">Format</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:persistent&quot;</span>&gt;</span>alice<span class="tag">&lt;/<span class="name">saml2:NameID</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">saml2:SubjectConfirmation</span> <span class="attr">Method</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">saml2:SubjectConfirmationData</span> <span class="attr">NotOnOrAfter</span>=<span class="string">&quot;2026-01-14T06:35:00.000Z&quot;</span></span></span><br><span class="line"><span class="tag">                                       <span class="attr">Recipient</span>=<span class="string">&quot;https://sp.example.com/saml/acs&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">saml2:SubjectConfirmation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">saml2:Subject</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml2:Conditions</span> <span class="attr">NotBefore</span>=<span class="string">&quot;2026-01-14T06:29:00.000Z&quot;</span> <span class="attr">NotOnOrAfter</span>=<span class="string">&quot;2026-01-14T06:35:00.000Z&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">saml2:AudienceRestriction</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">saml2:Audience</span>&gt;</span>https://sp.example.com<span class="tag">&lt;/<span class="name">saml2:Audience</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">saml2:AudienceRestriction</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">saml2:Conditions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml2:AuthnStatement</span> <span class="attr">AuthnInstant</span>=<span class="string">&quot;2026-01-14T06:29:50.000Z&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">SessionIndex</span>=<span class="string">&quot;_session123&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">SessionNotOnOrAfter</span>=<span class="string">&quot;2026-01-14T07:30:00.000Z&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">saml2:AuthnContext</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">saml2:AuthnContextClassRef</span>&gt;</span>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport<span class="tag">&lt;/<span class="name">saml2:AuthnContextClassRef</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">saml2:AuthnContext</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">saml2:AuthnStatement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">saml2:AttributeStatement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">saml2:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">NameFormat</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:uri&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">saml2:AttributeValue</span> <span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xs:type</span>=<span class="string">&quot;xs:string&quot;</span>&gt;</span>alice@example.com<span class="tag">&lt;/<span class="name">saml2:AttributeValue</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">saml2:Attribute</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">saml2:Attribute</span> <span class="attr">Name</span>=<span class="string">&quot;role&quot;</span> <span class="attr">NameFormat</span>=<span class="string">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">saml2:AttributeValue</span> <span class="attr">xmlns:xs</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xs:type</span>=<span class="string">&quot;xs:string&quot;</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">saml2:AttributeValue</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">saml2:Attribute</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">saml2:AttributeStatement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">saml2:Assertion</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>关键元素：</strong></p>
<ul>
<li><code>Issuer</code>：断言的签发者（通常是 IdP 的实体 ID）。</li>
<li><code>Signature</code>：用于 IdP 对整个断言进行数字签名，确保完整性和真实性。</li>
<li><code>Subject</code>：关于断言主体（用户）的信息，包含 <code>NameID</code> (用户标识) 和 <code>SubjectConfirmation</code> (如何确认主体身份的方式)。</li>
<li><code>Conditions</code>：断言的有效性条件，如 <code>NotBefore</code> (生效时间)、<code>NotOnOrAfter</code> (失效时间) 和 <code>AudienceRestriction</code> (指定接收方)。</li>
<li><code>AuthnStatement</code>：认证断言，声明用户认证的时间和方式。</li>
<li><code>AttributeStatement</code>：属性断言，包含用户属性信息。</li>
</ul>
<p><strong>Python 库提示：</strong><br>在 Python 中，可以使用 <code>python-saml</code> 或 <code>pysaml2</code> 等库来简化 SAML 消息的生成、解析和签名验证。这些库抽象了底层的 XML 处理和加密细节。</p>
<h2 id="六、SAML-的优缺点"><a href="#六、SAML-的优缺点" class="headerlink" title="六、SAML 的优缺点"></a>六、SAML 的优缺点</h2><h3 id="6-1-优点："><a href="#6-1-优点：" class="headerlink" title="6.1 优点："></a>6.1 优点：</h3><ol>
<li><strong>实现 SSO</strong>：核心优势，提升用户体验和管理效率。</li>
<li><strong>安全性高</strong>：通过数字签名、加密和时间戳等机制，保证消息的完整性、机密性和抗重放性。</li>
<li><strong>开放标准</strong>：互操作性强，被广泛支持，避免厂商锁定。</li>
<li><strong>联邦身份管理</strong>：适用于跨企业、跨组织的身份认证。</li>
<li><strong>不共享用户凭据</strong>：SP 不会直接接触到用户的密码，密码只在 IdP 处验证，提高了安全性。</li>
</ol>
<h3 id="6-2-缺点："><a href="#6-2-缺点：" class="headerlink" title="6.2 缺点："></a>6.2 缺点：</h3><ol>
<li><strong>复杂性高</strong>：SAML 协议基于 XML，消息结构复杂，实现和配置都相对繁琐，容易出错。</li>
<li><strong>XML 臃肿</strong>：XML 消息通常比 JSON 消息更大，可能增加网络传输开销。</li>
<li><strong>调试困难</strong>：由于消息编码、签名、重定向等环节较多，调试和问题排查相对复杂。</li>
<li><strong>不直接支持移动应用</strong>：SAML 设计之初主要针对 Web 浏览器环境。虽然可以通过一些变通方法间接应用于移动端，但不如 OAuth 2.0&#x2F;OIDC 原生支持好。</li>
<li><strong>缺乏原生 REST API 支持</strong>：对于现代基于 RESTful API 的微服务架构，其 XML 消息和重定向机制不如 OAuth 2.0&#x2F;OIDC 这种基于令牌的协议更“自然”。</li>
<li><strong>需元数据交换</strong>：IdP 和 SP 之间需要交换和配置元数据，这本身也是一个配置开销。</li>
</ol>
<h2 id="七、安全性考虑"><a href="#七、安全性考虑" class="headerlink" title="七、安全性考虑"></a>七、安全性考虑</h2><p>尽管 SAML 提供了强大的安全机制，但实施时仍需关注潜在的安全风险：</p>
<ol>
<li><strong>数字签名验证</strong>：SP 必须严格验证所有传入 SAML Response 的数字签名，确保其由可信的 IdP 签发且未被篡改。</li>
<li><strong>IdP 公钥管理</strong>：SP 必须安全地获取和存储 IdP 的公钥证书，并定期更新。</li>
<li><strong>时间戳验证</strong>：检查断言的 <code>NotBefore</code> 和 <code>NotOnOrAfter</code> 时间戳，防止过期或未生效的断言被使用。</li>
<li><strong>受众限制 (Audience Restriction)</strong>：验证断言是否确实是发给当前 SP 的，防止跨 SP 滥用断言。</li>
<li><strong>防止重放攻击 (Replay Attack)</strong>：<ul>
<li>SAML <code>Response</code> 和 <code>Assertion</code> 必须有唯一的 ID。</li>
<li>SP 应该跟踪并存储最近接收到的断言 ID，拒绝任何重复的 ID。</li>
<li>结合时间戳验证，确保只处理最新生成且未超期的断言。</li>
</ul>
</li>
<li><strong>加密</strong>：对包含敏感属性的 SAML 断言进行加密（使用 SP 的公钥加密），以保护其机密性。</li>
<li><strong>传输层安全 (TLS&#x2F;HTTPS)</strong>：所有 SAML 消息传输都必须通过 HTTPS 进行，以防止中间人攻击和数据窃听。</li>
<li><strong>XML 安全漏洞</strong>：注意防范 XXE (XML External Entity) 攻击等 XML 特有的漏洞。</li>
<li><strong>单点注销 (SLO) 的复杂性</strong>：SLO 比 SSO 更难以稳健地实现，因为涉及跨域会话的同步销毁，实际应用中可能并不总是可靠。</li>
</ol>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>SAML 2.0 作为一个成熟的企业级联邦身份标准，在 Web 应用程序的单一登录领域占据了主导地位。它通过定义 IdP 和 SP 之间的标准化通信协议和 XML 消息格式，解决了跨域身份验证和授权的挑战。其基于数字签名和加密的安全机制提供了强大的保障。</p>
<p>尽管 SAML 在配置和实现的复杂性方面存在一定的挑战，且在移动应用和 RESTful API 领域的适用性不如 OAuth 2.0&#x2F;OIDC，但其在传统企业应用和 SaaS 集成场景中的价值依然不可替代。对于构建企业级 SSO 解决方案，深入理解 SAML 2.0 及其安全最佳实践至关重要。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/42eaeb6240f0/">https://blog.tbf1211.xx.kg/42eaeb6240f0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/2023/">2023</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81/">身份认证</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/b9b684a2ebc6/" title="JWT (JSON Web Tokens) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-27.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JWT (JSON Web Tokens) 详解</div></div><div class="info-2"><div class="info-item-1"> JWT (JSON Web Token) 是一个开放标准 (RFC 7519)，它定义了一种简洁、自包含且安全的方式，用于在各方之间安全地传输信息。这些信息通过数字签名进行验证，可以被信任。JWT 通常用作无状态 (Stateless) 认证机制，替代传统的 Session-Cookie 模式。  核心思想：将用户认证信息和少量授权信息编码进 Token 本身，并通过签名确保其不可篡改。 服务端无需存储 Session 状态，只需验证 Token 即可。   一、为什么需要 JWT？传统的基于 Session-Cookie 的认证方式有其局限性：  有状态 (Stateful)：服务端需要存储每个用户的 Session 信息。随着用户量增加，存储和管理 Session 成为负担，特别是分布式部署和微服务架构下，Session 共享和同步变得复杂。 跨域问题：Cookie 默认是同源策略，跨域请求携带 Cookie 会比较复杂，需要复杂的 CORS (Cross-Origin Resource Sharing) 配置。 移动端不友好：移动应用通常不依赖 Cookie，需要更灵活的...</div></div></div></a><a class="pagination-related" href="/a73293a9d623/" title="Golang 匿名函数详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Golang 匿名函数详解</div></div><div class="info-2"><div class="info-item-1"> Golang 匿名函数 (Anonymous Function)，也被称为 函数字面量 (Function Literal)，是指没有明确名称的函数。它们可以在代码中的任何位置定义，并且可以直接执行或赋值给变量。匿名函数是 Go 语言支持函数式编程范式的重要特性之一，尤其在需要定义一次性函数、闭包或作为 Goroutine 和回调函数等场景中发挥着关键作用。  核心思想：将函数定义视为一种值，可以像处理其他类型的值一样处理它：赋值、作为参数传递、作为返回值返回，并且能够捕获其定义范围内的外部变量。   一、匿名函数的定义与基本语法匿名函数的基本语法与普通函数类似，只是省略了函数名。 基本结构： 123func(参数列表) (返回值列表) &#123;    // 函数体&#125;  示例： 123456789101112131415161718192021222324package mainimport &quot;fmt&quot;func main() &#123;    // 1. 直接定义并执行匿名函数    func() &#123;        fmt.Prin...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/b9b684a2ebc6/" title="JWT (JSON Web Tokens) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-27.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-21</div><div class="info-item-2">JWT (JSON Web Tokens) 详解</div></div><div class="info-2"><div class="info-item-1"> JWT (JSON Web Token) 是一个开放标准 (RFC 7519)，它定义了一种简洁、自包含且安全的方式，用于在各方之间安全地传输信息。这些信息通过数字签名进行验证，可以被信任。JWT 通常用作无状态 (Stateless) 认证机制，替代传统的 Session-Cookie 模式。  核心思想：将用户认证信息和少量授权信息编码进 Token 本身，并通过签名确保其不可篡改。 服务端无需存储 Session 状态，只需验证 Token 即可。   一、为什么需要 JWT？传统的基于 Session-Cookie 的认证方式有其局限性：  有状态 (Stateful)：服务端需要存储每个用户的 Session 信息。随着用户量增加，存储和管理 Session 成为负担，特别是分布式部署和微服务架构下，Session 共享和同步变得复杂。 跨域问题：Cookie 默认是同源策略，跨域请求携带 Cookie 会比较复杂，需要复杂的 CORS (Cross-Origin Resource Sharing) 配置。 移动端不友好：移动应用通常不依赖 Cookie，需要更灵活的...</div></div></div></a><a class="pagination-related" href="/ab5735004159/" title="无感刷新Token详解：提升用户体验与系统安全的认证策略"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-15.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-18</div><div class="info-item-2">无感刷新Token详解：提升用户体验与系统安全的认证策略</div></div><div class="info-2"><div class="info-item-1"> 在现代 Web 和移动应用中，基于 Token 的认证方式（如 JWT）已成为主流。它解决了传统 Session-Cookie 认证在分布式系统和跨域场景下的诸多痛点。然而，Token 的有效期问题又带来了新的挑战：如果 Access Token 长期有效，一旦泄露风险巨大；如果短期有效，用户又会频繁因 Token 过期而被迫重新登录，严重影响用户体验。无感刷新 Token (Silent Token Refresh) 正是为了解决这一矛盾而生，它旨在提升安全性、兼顾用户体验，让用户在不感知的情况下，始终保持登录状态。  “无感刷新 Token 的核心思想是：使用一个短期有效的 Access Token 负责日常业务访问，同时使用一个长期有效但受严密保护的 Refresh Token 来在 Access Token 过期时重新获取新的 Access Token，从而实现长期登录且不牺牲安全性的目标。”   一、为什么需要无感刷新 Token？在基于 Token 的认证系统中，通常会涉及到两种 Token：  Access Token (访问令牌)：  用途：用于访问受保护的资源...</div></div></div></a><a class="pagination-related" href="/f6138d30a597/" title="常见网络攻击详解与预防：构建数字安全防线"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-30.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-12</div><div class="info-item-2">常见网络攻击详解与预防：构建数字安全防线</div></div><div class="info-2"><div class="info-item-1"> 随着数字化时代的深入发展，网络已成为我们工作和生活中不可或缺的一部分。然而，伴随而来的网络攻击也日益猖獗，形式多样且破坏力巨大。理解常见的网络攻击类型及其防御方法，对于个人、企业乃至国家层面的网络安全防护至关重要。  核心思想：网络攻击的本质是利用系统、网络、应用或人为的漏洞，破坏信息资产的机密性、完整性、可用性。有效的防御需要结合技术防护、安全管理和人员意识培训。    一、网络攻击概述网络攻击是指以获取、破坏、更改、禁用、窃取或秘密访问计算机系统、基础设施、计算机网络或链接设备为目的的恶意行为。攻击者利用各种技术手段，针对不同层面的漏洞发起攻击，以达到其非法目的。 1.1 攻击目标 数据 (Data)：窃取敏感信息（用户数据、商业机密、知识产权），篡改数据，删除数据。 系统&#x2F;应用 (Systems&#x2F;Applications)：破坏服务可用性（拒绝服务）、获取系统控制权、植入恶意代码。 网络 (Network)：瘫痪网络基础设施、监听网络流量、劫持通信。 用户 (Users)：欺骗、诱导用户泄露信息（钓鱼）、传播谣言或虚假信息。  1.2 攻击动机 经济利...</div></div></div></a><a class="pagination-related" href="/fc0a62ae56f9/" title="OAuth2.0详解：现代授权框架的核心原理与应用"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-07.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-09</div><div class="info-item-2">OAuth2.0详解：现代授权框架的核心原理与应用</div></div><div class="info-2"><div class="info-item-1"> OAuth 2.0（Open Authorization）是一个开放标准，定义了一套授权流程，允许用户（资源所有者）授权第三方应用访问他们在另一个服务提供者（授权服务器）上的受保护资源（资源服务器），而无需将自己的用户名和密码直接提供给第三方应用。它主要解决的是委托授权的问题，即“我授权应用A去访问我在服务B上的某些数据”。  核心区分：OAuth 2.0 是一个授权（Authorization）框架，而不是用来做认证（Authentication）。尽管它常常与认证机制（如 OpenID Connect）结合使用，但其核心职责是授予对资源的访问权限，而非验证用户身份。   一、OAuth 2.0 产生的背景与解决的问题在 OAuth 出现之前，如果一个第三方应用需要访问用户在其他服务（如 Google 相册、GitHub 代码库）上的数据，用户通常需要将自己的账号密码直接告知第三方应用。这种做法带来了严重的安全和便捷性问题：  凭据泄露风险：第三方应用一旦被攻破，或恶意使用，用户的完整凭据就会泄露，导致所有关联服务面临风险。 权限过大：第三方应用获得的是用户的完全控制权，无法...</div></div></div></a><a class="pagination-related" href="/eb77bb139028/" title="网络编程中“流”的详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-17</div><div class="info-item-2">网络编程中“流”的详解</div></div><div class="info-2"><div class="info-item-1"> 在计算机网络编程中，“流 (Stream)”是一个非常核心且抽象的概念，它通常用来描述数据在两个实体之间进行传输时，数据流动的抽象表示。尤其在基于 TCP 协议的网络通信中，“流”的概念至关重要，它模拟了数据的顺序传输和持续性连接。理解“流”有助于开发者更好地掌握网络数据传输的本质，并编写出健壮、高效的网络应用程序。  核心思想：网络编程中的“流”是一种抽象，表示数据像水流一样顺序、持续地从一个端点流向另一个端点，封装了底层网络传输的复杂性。   一、什么是“流”？在网络编程中，“流”可以被理解为：  数据的有序序列 (Ordered Sequence of Data)：数据被发送时按照发送的顺序到达接收方，不会乱序。 持续的数据传输通道 (Continuous Data Flow Channel)：它代表了客户端与服务器之间建立的一种逻辑连接，数据可以在这个连接上持续不断地传输，就像水流一样。 抽象的读写接口 (Abstract Read&#x2F;Write Interface)：开发者通过操作流接口（例如 read()、write()），而不必关心底层数据的分段、组装、路...</div></div></div></a><a class="pagination-related" href="/14fbc43cdbd2/" title="Trojan协议详解：伪装为 HTTPS 的无状态代理协议"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-02.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-17</div><div class="info-item-2">Trojan协议详解：伪装为 HTTPS 的无状态代理协议</div></div><div class="info-2"><div class="info-item-1"> Trojan 是一个开源的代理协议，其核心设计理念是“伪装为最常见的 HTTPS 流量”。它通过模仿 HTTPS 流量的特征，并利用 TLS (Transport Layer Security) 的加密和认证机制，旨在实现几乎无法被识别和阻断的代理连接。Trojan 协议放弃了传统代理协议常见的复杂头部和混淆算法，转而直接将代理数据封装在 TLS 中，并强制要求使用 443 端口和合法 TLS 证书，以最大化其隐蔽性。  核心思想：将代理流量深度伪装为 HTTPS 流量，通过在 443 端口上直接利用 TLS 协议的加密会话来传输代理数据，从而使其在外部看来与正常的 HTTPS 流量几乎无异。   一、Trojan 协议的诞生背景与目标Trojan 协议的出现，是对传统代理协议（如 Shadowsocks、VMess 等）在对抗深度包检测 (DPI) 和主动探测时的局限性的一种回应。主要背景如下：  协议特征识别：许多代理协议，即使经过混淆，仍可能因其特定的协议头部、握手流程、流量模式或不符合 TLS 规范的行为而被识别。 主动探测：审查系统可能会主动连接代理服务器，发送探测包...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">536</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">229</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">84</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-SAML%EF%BC%9F"><span class="toc-text">一、为什么需要 SAML？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81SAML-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">二、SAML 核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%B8%BB%E4%BD%93-Principal"><span class="toc-text">2.1 主体 (Principal)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%BA%AB%E4%BB%BD%E6%8F%90%E4%BE%9B%E5%95%86-Identity-Provider-IdP"><span class="toc-text">2.2 身份提供商 (Identity Provider, IdP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E5%95%86-Service-Provider-SP"><span class="toc-text">2.3 服务提供商 (Service Provider, SP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-SAML-%E6%96%AD%E8%A8%80-SAML-Assertion"><span class="toc-text">2.4 SAML 断言 (SAML Assertion)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%85%83%E6%95%B0%E6%8D%AE-Metadata"><span class="toc-text">2.5 元数据 (Metadata)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81SAML-2-0-%E6%A1%86%E6%9E%B6%E7%BB%84%E6%88%90"><span class="toc-text">三、SAML 2.0 框架组成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-SAML-%E6%96%AD%E8%A8%80-SAML-Assertions"><span class="toc-text">3.1 SAML 断言 (SAML Assertions)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-SAML-%E5%8D%8F%E8%AE%AE-SAML-Protocols"><span class="toc-text">3.2 SAML 协议 (SAML Protocols)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-SAML-%E7%BB%91%E5%AE%9A-SAML-Bindings"><span class="toc-text">3.3 SAML 绑定 (SAML Bindings)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-SAML-%E9%85%8D%E7%BD%AE%E9%9B%86-SAML-Profiles"><span class="toc-text">3.4 SAML 配置集 (SAML Profiles)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81SAML-2-0-Web-%E6%B5%8F%E8%A7%88%E5%99%A8-SSO-%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3-SP-Initiated"><span class="toc-text">四、SAML 2.0 Web 浏览器 SSO 流程详解 (SP-Initiated)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81SAML-2-0-%E6%B6%88%E6%81%AF%E5%AE%9E%E4%BE%8B-%E7%AE%80%E8%A6%81-XML-%E7%BB%93%E6%9E%84"><span class="toc-text">五、SAML 2.0 消息实例 (简要 XML 结构)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81SAML-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">六、SAML 的优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-text">6.1 优点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-text">6.2 缺点：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91"><span class="toc-text">七、安全性考虑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">八、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/8fc7e3e72510/" title="前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-28.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解"/></a><div class="content"><a class="title" href="/8fc7e3e72510/" title="前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解">前端渲染模式：CSR, SSR, SSG, ISR, DPR 详解</a><time datetime="2026-01-27T22:24:00.000Z" title="发表于 2026-01-28 06:24:00">2026-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/5341a0037256/" title="CSS-in-JS 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS-in-JS 详解"/></a><div class="content"><a class="title" href="/5341a0037256/" title="CSS-in-JS 详解">CSS-in-JS 详解</a><time datetime="2026-01-25T22:24:00.000Z" title="发表于 2026-01-26 06:24:00">2026-01-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/0b52cb819619/" title="Git 核心对象：Commit, Tree, Blob 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-07.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git 核心对象：Commit, Tree, Blob 详解"/></a><div class="content"><a class="title" href="/0b52cb819619/" title="Git 核心对象：Commit, Tree, Blob 详解">Git 核心对象：Commit, Tree, Blob 详解</a><time datetime="2026-01-21T22:24:00.000Z" title="发表于 2026-01-22 06:24:00">2026-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1d2a942bda1e/" title="Terraform 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Terraform 详解"/></a><div class="content"><a class="title" href="/1d2a942bda1e/" title="Terraform 详解">Terraform 详解</a><time datetime="2026-01-19T22:24:00.000Z" title="发表于 2026-01-20 06:24:00">2026-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/26cdb2447b3d/" title="WebView 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-12.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WebView 详解"/></a><div class="content"><a class="title" href="/26cdb2447b3d/" title="WebView 详解">WebView 详解</a><time datetime="2026-01-17T22:24:00.000Z" title="发表于 2026-01-18 06:24:00">2026-01-18</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-11.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="🆕 2023">🆕 2023</a><a href="/archives/2024/" target="_blank" title="🆒 2024">🆒 2024</a><a href="/archives/2025/" target="_blank" title="👨‍👩‍👦 2025">👨‍👩‍👦 2025</a><a href="/archives/2026/" target="_blank" title="🆙 2026">🆙 2026</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="📁 分类">📁 分类</a><a href="/tags/" target="_blank" title="🔖 标签">🔖 标签</a><a href="/categories/" target="_blank" title="📽️ 时间线">📽️ 时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="💬 说说">💬 说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const parseViewBox = viewBox => {
    if (!viewBox) return null
    const parts = viewBox.trim().split(/[\s,]+/).map(n => Number(n))
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n))) return null
    return parts
  }

  const getSvgViewBox = svg => {
    const attr = parseViewBox(svg.getAttribute('viewBox'))
    if (attr) return attr

    // Fallback: use bbox to build a viewBox
    try {
      const bbox = svg.getBBox()
      if (bbox && bbox.width && bbox.height) return [bbox.x, bbox.y, bbox.width, bbox.height]
    } catch (e) {
      // getBBox may fail on some edge cases; ignore
    }

    const w = Number(svg.getAttribute('width')) || 0
    const h = Number(svg.getAttribute('height')) || 0
    if (w > 0 && h > 0) return [0, 0, w, h]
    return [0, 0, 100, 100]
  }

  const setSvgViewBox = (svg, vb) => {
    svg.setAttribute('viewBox', `${vb[0]} ${vb[1]} ${vb[2]} ${vb[3]}`)
  }

  const clamp = (v, min, max) => Math.max(min, Math.min(max, v))

  const openSvgInNewTab = ({ source, initViewBox }) => {
    const getClonedSvg = () => {
      if (typeof source === 'string') {
        const template = document.createElement('template')
        template.innerHTML = source.trim()
        const svg = template.content.querySelector('svg')
        return svg ? svg.cloneNode(true) : null
      }
      if (source && typeof source.cloneNode === 'function') {
        return source.cloneNode(true)
      }
      return null
    }

    const clone = getClonedSvg()
    if (!clone) return
    if (initViewBox && initViewBox.length === 4) {
      clone.setAttribute('viewBox', initViewBox.join(' '))
    }
    if (!clone.getAttribute('xmlns')) clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg')
    if (!clone.getAttribute('xmlns:xlink') && clone.outerHTML.includes('xlink:')) {
      clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink')
    }
    // inject background to match current theme
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
    const bg = getComputedStyle(document.body).backgroundColor || (isDark ? '#1e1e1e' : '#ffffff')
    if (!clone.style.background) clone.style.background = bg

    const serializer = new XMLSerializer()
    const svgSource = serializer.serializeToString(clone)
    const htmlSource = `<!doctype html><html><head><meta charset="utf-8" />
      <style>
        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${bg}; }
        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }
      </style>
      </head><body>${svgSource}</body></html>`
    const blob = new Blob([htmlSource], { type: 'text/html;charset=utf-8' })
    const url = URL.createObjectURL(blob)
    window.open(url, '_blank', 'noopener')
    setTimeout(() => URL.revokeObjectURL(url), 30000)
  }

  const attachMermaidViewerButton = wrap => {
    let btn = wrap.querySelector('.mermaid-open-btn')
    if (!btn) {
      btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'mermaid-open-btn'
      wrap.appendChild(btn)
    }

    btn.innerHTML = '<i class="fa fa-search fa-fw" aria-hidden="true"></i>'

    if (!btn.__mermaidViewerBound) {
      btn.addEventListener('click', e => {
        e.preventDefault()
        e.stopPropagation()
        const svg = wrap.__mermaidOriginalSvg || wrap.querySelector('svg')
        if (!svg) return
        const initViewBox = wrap.__mermaidInitViewBox
        if (typeof svg === 'string') {
          openSvgInNewTab({ source: svg, initViewBox })
          return
        }
        openSvgInNewTab({ source: svg, initViewBox })
      })
      btn.__mermaidViewerBound = true
    }
  }

  // Zoom around a point (px, py) in the SVG viewport (in viewBox coordinates)
  const zoomAtPoint = (vb, factor, px, py) => {
    const w = vb[2] * factor
    const h = vb[3] * factor
    const nx = px - (px - vb[0]) * factor
    const ny = py - (py - vb[1]) * factor
    return [nx, ny, w, h]
  }

  const initMermaidGestures = wrap => {
    const svg = wrap.querySelector('svg')
    if (!svg) return

    // Ensure viewBox exists so gestures always work
    const initVb = getSvgViewBox(svg)
    wrap.__mermaidInitViewBox = initVb
    wrap.__mermaidCurViewBox = initVb.slice()
    setSvgViewBox(svg, initVb)

    // Avoid binding multiple times on themeChange/pjax
    if (wrap.__mermaidGestureBound) return
    wrap.__mermaidGestureBound = true

    // Helper: map client (viewport) coordinate -> viewBox coordinate
    const clientToViewBox = (clientX, clientY) => {
      const rect = svg.getBoundingClientRect()
      const vb = wrap.__mermaidCurViewBox || getSvgViewBox(svg)
      const x = vb[0] + (clientX - rect.left) * (vb[2] / rect.width)
      const y = vb[1] + (clientY - rect.top) * (vb[3] / rect.height)
      return { x, y, rect, vb }
    }

    const state = {
      pointers: new Map(),
      startVb: null,
      startDist: 0,
      startCenter: null
    }

    const clampVb = vb => {
      const init = wrap.__mermaidInitViewBox || vb
      const minW = init[2] * 0.1
      const maxW = init[2] * 10
      const minH = init[3] * 0.1
      const maxH = init[3] * 10
      vb[2] = clamp(vb[2], minW, maxW)
      vb[3] = clamp(vb[3], minH, maxH)
      return vb
    }

    const setCurVb = vb => {
      vb = clampVb(vb)
      wrap.__mermaidCurViewBox = vb
      setSvgViewBox(svg, vb)
    }

    const onPointerDown = e => {
      // Allow only primary button for mouse
      if (e.pointerType === 'mouse' && e.button !== 0) return
      svg.setPointerCapture(e.pointerId)
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      if (state.pointers.size === 1) {
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      } else if (state.pointers.size === 2) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        state.startDist = Math.hypot(dx, dy)
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        state.startCenter = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 }
      }
    }

    const onPointerMove = e => {
      if (!state.pointers.has(e.pointerId)) return
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      // Pan with 1 pointer
      if (state.pointers.size === 1 && state.startVb) {
        const p = [...state.pointers.values()][0]
        const prev = { x: e.clientX - e.movementX, y: e.clientY - e.movementY }
        // movementX/Y unreliable on touch, compute from stored last position
        const last = wrap.__mermaidLastSinglePointer || p
        const dxClient = p.x - last.x
        const dyClient = p.y - last.y
        wrap.__mermaidLastSinglePointer = p

        const { rect } = clientToViewBox(p.x, p.y)
        const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        const dx = dxClient * (vb[2] / rect.width)
        const dy = dyClient * (vb[3] / rect.height)
        setCurVb([vb[0] - dx, vb[1] - dy, vb[2], vb[3]])
        return
      }

      // Pinch zoom with 2 pointers
      if (state.pointers.size === 2 && state.startVb && state.startDist > 0) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        const dist = Math.hypot(dx, dy)
        if (!dist) return
        const factor = state.startDist / dist // dist bigger => zoom in (viewBox smaller)

        const cx = (pts[0].x + pts[1].x) / 2
        const cy = (pts[0].y + pts[1].y) / 2
        const centerClient = { x: cx, y: cy }

        const pxy = clientToViewBox(centerClient.x, centerClient.y)
        const cpx = pxy.x
        const cpy = pxy.y

        const vb = zoomAtPoint(state.startVb, factor, cpx, cpy)
        setCurVb(vb)
      }
    }

    const onPointerUpOrCancel = e => {
      state.pointers.delete(e.pointerId)
      if (state.pointers.size === 0) {
        state.startVb = null
        state.startDist = 0
        state.startCenter = null
        wrap.__mermaidLastSinglePointer = null
      } else if (state.pointers.size === 1) {
        // reset single pointer baseline to avoid jump
        wrap.__mermaidLastSinglePointer = [...state.pointers.values()][0]
      }
    }

    // Wheel zoom (mouse/trackpad)
    const onWheel = e => {
      // ctrlKey on mac trackpad pinch; we treat both as zoom
      e.preventDefault()
      const delta = e.deltaY
      const zoomFactor = delta > 0 ? 1.1 : 0.9
      const { x, y } = clientToViewBox(e.clientX, e.clientY)
      const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      setCurVb(zoomAtPoint(vb, zoomFactor, x, y))
    }

    const onDblClick = () => {
      const init = wrap.__mermaidInitViewBox
      if (!init) return
      wrap.__mermaidCurViewBox = init.slice()
      setSvgViewBox(svg, init)
    }

    svg.addEventListener('pointerdown', onPointerDown)
    svg.addEventListener('pointermove', onPointerMove)
    svg.addEventListener('pointerup', onPointerUpOrCancel)
    svg.addEventListener('pointercancel', onPointerUpOrCancel)
    svg.addEventListener('wheel', onWheel, { passive: false })
    svg.addEventListener('dblclick', onDblClick)
  }

  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild

      // Clear old render (themeChange/pjax will rerun)
      const oldSvg = item.querySelector('svg')
      if (oldSvg) oldSvg.remove()
      item.__mermaidGestureBound = false

      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
        if (true) initMermaidGestures(item)
        item.__mermaidOriginalSvg = svg
        if (true) attachMermaidViewerButton(item)
      }


      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>