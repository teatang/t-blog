<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Python 项目管理工具 Poetry 详解 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Poetry 是一款现代化的 Python 项目管理和打包工具。它将依赖管理、虚拟环境管理、打包和发布功能集成在一个直观的命令行界面中。Poetry 的核心理念是提供一个统一的、声明式的项目配置方式，以 pyproject.toml 文件 (遵循 PEP 518 和 PEP 621) 作为所有项目元数据和依赖的唯一真实来源。  核心思想：Poetry 旨在通过一个工具，简化 Python 项目从">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 项目管理工具 Poetry 详解">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/92d90a6caba1/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="Poetry 是一款现代化的 Python 项目管理和打包工具。它将依赖管理、虚拟环境管理、打包和发布功能集成在一个直观的命令行界面中。Poetry 的核心理念是提供一个统一的、声明式的项目配置方式，以 pyproject.toml 文件 (遵循 PEP 518 和 PEP 621) 作为所有项目元数据和依赖的唯一真实来源。  核心思想：Poetry 旨在通过一个工具，简化 Python 项目从">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-23.jpg">
<meta property="article:published_time" content="2025-05-09T22:24:00.000Z">
<meta property="article:modified_time" content="2025-12-04T04:40:07.940Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="项目构建">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="包管理">
<meta property="article:tag" content="2025">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-23.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Python 项目管理工具 Poetry 详解",
  "url": "https://blog.tbf1211.xx.kg/92d90a6caba1/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-23.jpg",
  "datePublished": "2025-05-09T22:24:00.000Z",
  "dateModified": "2025-12-04T04:40:07.940Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/92d90a6caba1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Python 项目管理工具 Poetry 详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">345</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">74</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-23.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">Python 项目管理工具 Poetry 详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Python 项目管理工具 Poetry 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-05-09T22:24:00.000Z" title="发表于 2025-05-10 06:24:00">2025-05-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/">项目构建</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="umamiPV" data-path="/92d90a6caba1/"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>Poetry</strong> 是一款现代化的 Python 项目管理和打包工具。它将<strong>依赖管理、虚拟环境管理、打包和发布</strong>功能集成在一个直观的命令行界面中。Poetry 的核心理念是提供一个统一的、声明式的项目配置方式，以 <code>pyproject.toml</code> 文件 (遵循 PEP 518 和 PEP 621) 作为所有项目元数据和依赖的唯一真实来源。</p>
</blockquote>
<div class="note info flat"><p>核心思想：Poetry 旨在通过一个工具，简化 Python 项目从创建到发布的全生命周期管理，确保<strong>环境隔离、依赖可重现性</strong>和<strong>便捷的打包发布流程</strong>。</p>
</div>
<hr>
<h2 id="一、为什么需要-Poetry？"><a href="#一、为什么需要-Poetry？" class="headerlink" title="一、为什么需要 Poetry？"></a>一、为什么需要 Poetry？</h2><p>传统的 Python 项目管理方式通常涉及多个工具和手动步骤，带来了诸多痛点：</p>
<ul>
<li><strong><code>pip</code> 和 <code>requirements.txt</code> 的局限性</strong>：<ul>
<li><code>requirements.txt</code> 仅记录直接依赖，不处理传递性依赖，容易导致环境不一致。</li>
<li>缺乏强大的依赖解析能力，解决包版本冲突困难。</li>
<li>没有统一的元数据管理，项目信息分散在 <code>setup.py</code>、<code>README.md</code> 等文件中。</li>
</ul>
</li>
<li><strong>虚拟环境管理不便</strong>：<ul>
<li>需要手动创建 <code>venv</code> 或 <code>virtualenv</code>，并手动激活、切换。</li>
<li>项目与虚拟环境的关联不够紧密。</li>
</ul>
</li>
<li><strong>打包和发布复杂</strong>：<ul>
<li>传统的 <code>setuptools</code> 和 <code>setup.py</code> 配置复杂，尤其是对于非标准项目。</li>
<li>发布到 PyPI 需要额外的工具如 <code>twine</code>。</li>
</ul>
</li>
<li><strong>开发环境和生产环境不一致</strong>：<ul>
<li>由于缺乏精确的依赖锁定，开发时能运行的代码在生产环境可能因依赖版本差异而出现问题。</li>
</ul>
</li>
<li><strong>工具碎片化</strong>：开发者需要同时管理 <code>pip</code>、<code>venv</code>、<code>setuptools</code>、<code>twine</code> 等多个工具。</li>
</ul>
<p>Poetry 旨在通过以下方式解决这些问题：</p>
<ul>
<li><strong>一体化解决方案</strong>：将依赖管理、虚拟环境、打包和发布集成到单一工具中。</li>
<li><strong>声明式配置</strong>：使用 <code>pyproject.toml</code> 统一管理项目元数据、依赖、脚本等，清晰明了。</li>
<li><strong>强大的依赖解析</strong>：内置高效的依赖解析器，自动处理版本冲突，生成精确的 <code>poetry.lock</code> 文件。</li>
<li><strong>自动化的虚拟环境管理</strong>：为每个项目自动创建和管理隔离的虚拟环境。</li>
<li><strong>简化打包发布</strong>：提供简单的命令即可构建和发布包。</li>
<li><strong>可重现性</strong>：通过 <code>poetry.lock</code> 确保团队成员和部署环境的依赖完全一致。</li>
</ul>
<h2 id="二、Poetry-的核心特性"><a href="#二、Poetry-的核心特性" class="headerlink" title="二、Poetry 的核心特性"></a>二、Poetry 的核心特性</h2><h3 id="2-1-依赖管理与锁定"><a href="#2-1-依赖管理与锁定" class="headerlink" title="2.1 依赖管理与锁定"></a>2.1 依赖管理与锁定</h3><p>Poetry 使用 <code>pyproject.toml</code> 文件定义项目的直接依赖，并自动解析所有传递性依赖。</p>
<ul>
<li><strong><code>pyproject.toml</code></strong>：作为项目配置的中心，定义了项目名称、版本、描述以及依赖项。</li>
<li><strong><code>poetry.lock</code></strong>：由 Poetry 自动生成和维护，记录了项目及其所有传递性依赖的<strong>精确版本</strong>和哈希值，确保环境的完全可重现性。</li>
</ul>
<h3 id="2-2-虚拟环境管理"><a href="#2-2-虚拟环境管理" class="headerlink" title="2.2 虚拟环境管理"></a>2.2 虚拟环境管理</h3><p>Poetry 为每个项目自动创建和管理一个独立的虚拟环境，通常存储在用户主目录下的 Poetry 缓存中，或者在项目根目录（可配置）。</p>
<ul>
<li><strong>隔离性</strong>：每个项目的依赖都与系统或其他项目完全隔离。</li>
<li><strong>自动化</strong>：无需手动激活，Poetry 命令会自动在正确的虚拟环境中执行。</li>
</ul>
<h3 id="2-3-项目打包与发布"><a href="#2-3-项目打包与发布" class="headerlink" title="2.3 项目打包与发布"></a>2.3 项目打包与发布</h3><p>Poetry 简化了创建 Python 包并将其发布到 PyPI 的过程。</p>
<ul>
<li><strong>构建</strong>：根据 <code>pyproject.toml</code> 中的元数据自动构建 <code>sdist</code> (源码分发) 和 <code>wheel</code> (二进制分发)。</li>
<li><strong>发布</strong>：可以直接将构建好的包发布到 PyPI 或其他私有仓库。</li>
</ul>
<h3 id="2-4-项目脚手架与脚本运行"><a href="#2-4-项目脚手架与脚本运行" class="headerlink" title="2.4 项目脚手架与脚本运行"></a>2.4 项目脚手架与脚本运行</h3><p>Poetry 提供了创建新项目结构的命令，并允许在 <code>pyproject.toml</code> 中定义和运行自定义脚本。</p>
<ul>
<li><strong><code>poetry new</code></strong>：快速生成一个标准的项目目录结构。</li>
<li><strong><code>poetry run</code></strong>：在项目虚拟环境中运行任意命令或脚本。</li>
</ul>
<h2 id="三、安装-Poetry"><a href="#三、安装-Poetry" class="headerlink" title="三、安装 Poetry"></a>三、安装 Poetry</h2><p>官方推荐使用专门的安装脚本，以避免与现有 Python 环境的冲突。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux / macOS / WSL</span></span><br><span class="line">curl -sSL https://install.python-poetry.org | python3 -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows (PowerShell)</span></span><br><span class="line">(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | python -</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 pipx 安装 (如果你已经安装了 pipx)</span></span><br><span class="line">pipx install poetry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">poetry --version</span><br><span class="line"><span class="comment"># Output: Poetry (version 1.x.x)</span></span><br></pre></td></tr></table></figure>
<p>安装完成后，可能需要将 Poetry 的 bin 目录添加到系统 PATH 环境变量中。</p>
<h2 id="四、Poetry-指令详解"><a href="#四、Poetry-指令详解" class="headerlink" title="四、Poetry 指令详解"></a>四、Poetry 指令详解</h2><p>Poetry 的命令行界面设计直观，所有命令都以 <code>poetry</code> 开头。</p>
<h3 id="4-1-项目初始化与创建"><a href="#4-1-项目初始化与创建" class="headerlink" title="4.1 项目初始化与创建"></a>4.1 项目初始化与创建</h3><ul>
<li><code>poetry init</code>: 在现有目录中交互式地初始化一个新 Poetry 项目，生成 <code>pyproject.toml</code> 文件。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> my_project &amp;&amp; <span class="built_in">cd</span> my_project</span><br><span class="line">poetry init <span class="comment"># 按照提示输入项目信息和依赖</span></span><br></pre></td></tr></table></figure></li>
<li><code>poetry new &lt;project_name&gt;</code>: 创建一个具有标准目录结构的新 Poetry 项目。<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">poetry new my_app</span><br><span class="line"><span class="comment"># 这将创建以下结构：</span></span><br><span class="line"><span class="comment"># my_app/</span></span><br><span class="line"><span class="comment"># ├── my_app/</span></span><br><span class="line"><span class="comment"># │   └── __init__.py</span></span><br><span class="line"><span class="comment"># ├── pyproject.toml</span></span><br><span class="line"><span class="comment"># ├── README.md</span></span><br><span class="line"><span class="comment"># └── tests/</span></span><br><span class="line"><span class="comment">#     └── __init__.py</span></span><br><span class="line"><span class="comment">#     └── test_my_app.py</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-2-依赖管理"><a href="#4-2-依赖管理" class="headerlink" title="4.2 依赖管理"></a>4.2 依赖管理</h3><ul>
<li><code>poetry add &lt;package_name&gt; [version_constraint] [options]</code>: 向项目中添加一个依赖包，并自动安装它，同时更新 <code>pyproject.toml</code> 和 <code>poetry.lock</code>。<ul>
<li><code>[version_constraint]</code>: 可以是 <code>~1.0</code> (兼容版本), <code>^1.0</code> (最小兼容版本), <code>&gt;=1.0,&lt;2.0</code>, <code>==1.0</code>, 或 Git URL 等。</li>
<li><code>--group &lt;group_name&gt;</code>: 将包添加为指定组的依赖（例如：<code>dev</code>, <code>test</code>, <code>doc</code>）。Poetry 1.2+ 推荐使用 <code>--group</code>，代替旧版的 <code>--dev</code>。</li>
<li><code>--group dev</code> &#x2F; <code>--dev</code>: (旧版Poetry) 将包添加为开发依赖。</li>
<li><code>--optional</code>: 将包添加为可选依赖。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">poetry add requests                   <span class="comment"># 添加 requests 作为主依赖</span></span><br><span class="line">poetry add <span class="string">&quot;fastapi@^0.100.0&quot;</span>         <span class="comment"># 添加特定版本范围的 fastapi</span></span><br><span class="line">poetry add <span class="string">&quot;uvicorn[standard]@^0.23.0&quot;</span> <span class="comment"># 添加带 extras 的包</span></span><br><span class="line">poetry add pytest --group dev         <span class="comment"># 添加 pytest 作为开发依赖组</span></span><br><span class="line">poetry add black --group dev --optional <span class="comment"># 添加可选的开发依赖</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry remove &lt;package_name&gt; [options]</code>: 从项目中移除一个依赖包，并自动卸载它，同时更新 <code>pyproject.toml</code> 和 <code>poetry.lock</code>。<ul>
<li><code>--group &lt;group_name&gt;</code>: 从指定依赖组中移除。</li>
<li><code>--group dev</code> &#x2F; <code>--dev</code>: (旧版Poetry) 从开发依赖中移除。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poetry remove requests</span><br><span class="line">poetry remove pytest --group dev</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry install [options]</code>: 从 <code>poetry.lock</code> 文件安装所有依赖。如果 <code>poetry.lock</code> 不存在，则根据 <code>pyproject.toml</code> 解析并生成 <code>poetry.lock</code>。<ul>
<li><code>--no-root</code>: 不安装当前项目自身（仅安装依赖）。</li>
<li><code>--sync</code>: 卸载所有锁定文件中不存在的包，使环境与 <code>poetry.lock</code> 完全同步。</li>
<li><code>--only &lt;group&gt;</code>: 只安装指定组的依赖。例如 <code>--only main</code> 只安装主依赖。</li>
<li><code>--with &lt;group1&gt; [--with &lt;group2&gt;]</code>: 除了主依赖外，还安装指定组的依赖。</li>
<li><code>--without &lt;group1&gt; [--without &lt;group2&gt;]</code>: 安装除了指定组之外的所有依赖。</li>
<li><code>--no-dev</code>: (旧版Poetry) 不安装开发依赖。等同于 <code>--without dev</code>。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">poetry install                                  <span class="comment"># 安装所有依赖 (包括默认的开发依赖)</span></span><br><span class="line">poetry install --only main                      <span class="comment"># 只安装主依赖</span></span><br><span class="line">poetry install --with dev,<span class="built_in">test</span>                  <span class="comment"># 安装主依赖和 dev、test 组依赖</span></span><br><span class="line">poetry install --without dev                    <span class="comment"># 不安装 dev 组依赖</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry update [package_name]</code>: 更新依赖包到最新版本。如果未指定包名，则更新所有依赖。会更新 <code>poetry.lock</code> 文件。<ul>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poetry update <span class="comment"># 更新所有依赖</span></span><br><span class="line">poetry update requests <span class="comment"># 只更新 requests 包及其兼容依赖</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry lock [--no-update]</code>: 仅生成或更新 <code>poetry.lock</code> 文件，不安装任何包。<ul>
<li><code>--no-update</code>: 不更新现有的 <code>poetry.lock</code>，只检查 <code>pyproject.toml</code> 和 <code>poetry.lock</code> 是否同步。</li>
</ul>
</li>
</ul>
<h3 id="4-3-环境管理与命令执行"><a href="#4-3-环境管理与命令执行" class="headerlink" title="4.3 环境管理与命令执行"></a>4.3 环境管理与命令执行</h3><ul>
<li><code>poetry run &lt;command&gt; [args...]</code>: 在当前项目虚拟环境中执行任意命令。<ul>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">poetry run python my_script.py</span><br><span class="line">poetry run pytest tests/</span><br><span class="line">poetry run black .</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry shell</code>: 激活当前项目的虚拟环境。进入一个子 shell，所有后续命令都将在该虚拟环境中执行。<ul>
<li>要退出虚拟环境，输入 <code>exit</code>。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">poetry shell</span><br><span class="line"><span class="comment"># (my-project-venv) $ python my_script.py</span></span><br><span class="line"><span class="comment"># (my-project-venv) $ exit</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry env list [--full-path]</code>: 列出当前项目关联的所有虚拟环境。</li>
<li><code>poetry env use &lt;python_executable_or_env_name&gt;</code>: 将当前项目关联到指定的 Python 解释器或虚拟环境。<ul>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poetry <span class="built_in">env</span> use python3.11   <span class="comment"># 使用系统中的 python3.11 创建或切换虚拟环境</span></span><br><span class="line">poetry <span class="built_in">env</span> use /path/to/venv/bin/python <span class="comment"># 使用特定路径的解释器</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry env remove &lt;env_name&gt;</code>: 移除一个或多个虚拟环境。</li>
<li><code>poetry env info [--path]</code>: 显示当前虚拟环境的信息。</li>
<li><code>poetry python</code>: 显示当前项目使用的 Python 解释器的路径。</li>
</ul>
<h3 id="4-4-包信息与检查"><a href="#4-4-包信息与检查" class="headerlink" title="4.4 包信息与检查"></a>4.4 包信息与检查</h3><ul>
<li><code>poetry show [--tree] [--latest] [--outdated]</code>: 显示项目依赖的列表。<ul>
<li><code>--tree</code>: 以树形结构显示依赖关系。</li>
<li><code>--latest</code>: 显示包的最新版本。</li>
<li><code>--outdated</code>: 显示已过时的包。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">poetry show</span><br><span class="line">poetry show --tree</span><br><span class="line">poetry show --outdated</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry check</code>: 检查 <code>pyproject.toml</code> 文件的语法和有效性。</li>
</ul>
<h3 id="4-5-打包与发布"><a href="#4-5-打包与发布" class="headerlink" title="4.5 打包与发布"></a>4.5 打包与发布</h3><ul>
<li><code>poetry build [--format &lt;format&gt;]</code>: 构建项目包的源码分发 (<code>sdist</code>) 和 Wheel 分发 (<code>wheel</code>)。<ul>
<li><code>--format</code>: 指定构建格式，例如 <code>sdist</code>, <code>wheel</code>。</li>
<li>构建结果通常在项目根目录的 <code>dist/</code> 文件夹中。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poetry build</span><br><span class="line">poetry build --format sdist</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry publish [--repository &lt;repo_name&gt;] [--username &lt;username&gt;] [--password &lt;password&gt;]</code>: 将构建好的包发布到 PyPI 或其他配置的仓库。<ul>
<li>在发布前，通常需要使用 <code>poetry config</code> 配置 PyPI 凭据。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">poetry publish --build <span class="comment"># 构建并发布</span></span><br><span class="line">poetry publish --repository my-custom-repo <span class="comment"># 发布到自定义仓库</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="4-6-配置管理"><a href="#4-6-配置管理" class="headerlink" title="4.6 配置管理"></a>4.6 配置管理</h3><ul>
<li><code>poetry config &lt;setting_key&gt; &lt;value&gt;</code>: 设置 Poetry 的配置选项。<ul>
<li><code>--global</code>: 将配置应用于所有项目。</li>
<li><strong>示例</strong>：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">poetry config virtualenvs.in-project <span class="literal">true</span> <span class="comment"># 在项目根目录创建 .venv 虚拟环境</span></span><br><span class="line">poetry config repositories.my-pypi https://my.pypi.org/simple/ <span class="comment"># 添加自定义 PyPI 仓库</span></span><br><span class="line">poetry config pypi-token.pypi &lt;your_pypi_token&gt; <span class="comment"># 配置 PyPI 认证令牌</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>poetry config --list</code>: 列出所有配置项。</li>
</ul>
<h2 id="五、Poetry-的-pyproject-toml-结构"><a href="#五、Poetry-的-pyproject-toml-结构" class="headerlink" title="五、Poetry 的 pyproject.toml 结构"></a>五、Poetry 的 <code>pyproject.toml</code> 结构</h2><p><code>pyproject.toml</code> 是 Poetry 项目的核心配置文件，它是一个TOML (Tom’s Obvious, Minimal Language) 格式的文件。</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pyproject.toml 示例</span></span><br><span class="line"><span class="section">[tool.poetry]</span></span><br><span class="line"><span class="attr">name</span> = <span class="string">&quot;my-awesome-app&quot;</span></span><br><span class="line"><span class="attr">version</span> = <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">description</span> = <span class="string">&quot;一个用Poetry管理的酷炫Python应用&quot;</span></span><br><span class="line"><span class="attr">authors</span> = [<span class="string">&quot;Your Name &lt;you@example.com&gt;&quot;</span>]</span><br><span class="line"><span class="attr">license</span> = <span class="string">&quot;MIT&quot;</span></span><br><span class="line"><span class="attr">readme</span> = <span class="string">&quot;README.md&quot;</span></span><br><span class="line"><span class="attr">packages</span> = [&#123;include = <span class="string">&quot;my_awesome_app&quot;</span>&#125;] <span class="comment"># 明确指定包含哪些包到分发中</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.dependencies]</span></span><br><span class="line"><span class="attr">python</span> = <span class="string">&quot;&gt;=3.9,&lt;4.0&quot;</span> <span class="comment"># Python 版本约束</span></span><br><span class="line"><span class="attr">requests</span> = <span class="string">&quot;^2.28.1&quot;</span>  <span class="comment"># 主依赖</span></span><br><span class="line"><span class="attr">fastapi</span> = &#123;version = <span class="string">&quot;^0.100.0&quot;</span>, optional = <span class="literal">true</span>&#125; <span class="comment"># 可选依赖</span></span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.group.dev.dependencies]</span> <span class="comment"># 开发依赖组 (Poetry 1.2+ 推荐)</span></span><br><span class="line"><span class="attr">pytest</span> = <span class="string">&quot;^7.0&quot;</span></span><br><span class="line"><span class="attr">black</span> = &#123;version = <span class="string">&quot;^23.0&quot;</span>, optional = <span class="literal">true</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">[tool.poetry.group.doc.dependencies]</span> <span class="comment"># 文档依赖组</span></span><br><span class="line"><span class="attr">sphinx</span> = <span class="string">&quot;^5.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[build-system]</span></span><br><span class="line"><span class="attr">requires</span> = [<span class="string">&quot;poetry-core&gt;=1.0.0&quot;</span>]</span><br><span class="line"><span class="attr">build-backend</span> = <span class="string">&quot;poetry.core.masonry.api&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>[tool.poetry]</code>: 定义了项目自身的元数据，如名称、版本、作者、描述、许可证等。</li>
<li><code>[tool.poetry.dependencies]</code>: 定义了项目的运行时（主）依赖。<code>python</code> 键用于指定项目兼容的 Python 版本范围。</li>
<li><code>[tool.poetry.group.&lt;group_name&gt;.dependencies]</code>: 定义了指定依赖组（如 <code>dev</code>, <code>test</code>, <code>doc</code>）的依赖。这些依赖通常不会在生产环境中安装，除非显式指定。</li>
<li><code>[build-system]</code>: 这是 PEP 518 规范的一部分，用于声明构建此项目所需的工具和后端。对于 Poetry 项目，通常是 <code>poetry-core</code>。</li>
</ul>
<h2 id="六、Poetry-工作流"><a href="#六、Poetry-工作流" class="headerlink" title="六、Poetry 工作流"></a>六、Poetry 工作流</h2><p>一个典型的 Poetry 项目开发工作流如下：</p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TD
    A[开始新项目] --&gt; B{poetry new my-project &#x2F; poetry init}
    B --&gt; C[pyproject.toml 生成]
    C --&gt; D{添加依赖}
    D --&gt; E{poetry add &lt;package&gt;}
    E --&gt; F[更新 pyproject.toml &amp; poetry.lock]
    F --&gt; G{设置环境}
    G --&gt; H{poetry install}
    H --&gt; I[创建&#x2F;更新虚拟环境, 安装依赖]
    I --&gt; J{开发&#x2F;测试}
    J --&gt; K{poetry run &lt;command&gt;}
    J --&gt; L{poetry shell}
    J --&gt; M{如有新依赖}
    M -- Y --&gt; D
    M -- N --&gt; N[准备发布]
    N --&gt; O{poetry build}
    O --&gt; P[生成 sdist &amp; wheel]
    P --&gt; Q{poetry publish}
    Q --&gt; R[发布到 PyPI]
  </pre></div>

<h2 id="七、Poetry-的优缺点"><a href="#七、Poetry-的优缺点" class="headerlink" title="七、Poetry 的优缺点"></a>七、Poetry 的优缺点</h2><h3 id="7-1-优点："><a href="#7-1-优点：" class="headerlink" title="7.1 优点："></a>7.1 优点：</h3><ol>
<li><strong>统一的项目管理</strong>：集成了依赖、虚拟环境、打包、发布，简化开发流程。</li>
<li><strong>严格的依赖锁定</strong>：<code>poetry.lock</code> 确保了环境的完全可重现性，解决“在我机器上能跑”的问题。</li>
<li><strong>强大的依赖解析器</strong>：自动处理复杂的依赖版本冲突，减少手动干预。</li>
<li><strong>清晰的配置</strong>：<code>pyproject.toml</code> 作为单一配置源，易于理解和维护。</li>
<li><strong>自动化的虚拟环境</strong>：无需手动管理，Poetry 自动为项目提供隔离环境。</li>
<li><strong>简化打包和发布</strong>：只需几个命令即可完成复杂的打包和发布流程。</li>
<li><strong>现代标准兼容</strong>：拥抱 <code>pyproject.toml</code> (PEP 518, PEP 621) 等最新 Python 规范。</li>
</ol>
<h3 id="7-2-缺点："><a href="#7-2-缺点：" class="headerlink" title="7.2 缺点："></a>7.2 缺点：</h3><ol>
<li><strong>学习曲线</strong>：对于习惯 <code>pip</code> + <code>venv</code> 传统工作流的用户，需要适应新的概念和命令。</li>
<li><strong>性能考量</strong>：对于非常庞大或复杂的依赖图，Poetry 的依赖解析速度可能不如 Rust 编写的工具（如 <code>uv</code>）快。</li>
<li><strong>与传统工具的兼容性</strong>：虽然可以导出 <code>requirements.txt</code> (<code>poetry export</code>)，但与纯 <code>pip</code> 或 <code>setuptools</code> 项目的集成可能需要额外步骤。</li>
<li><strong>生态系统成熟度</strong>：虽然发展迅速，但某些高级或边缘用例可能不如 <code>pip</code> 生态系统那样全面覆盖。</li>
</ol>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>Poetry 是一款极具潜力的 Python 项目管理工具，它通过一体化、声明式和自动化的方法，极大地提升了 Python 项目的开发效率和可维护性。对于追求<strong>开发一致性、环境可重现性</strong>以及<strong>简化打包发布流程</strong>的开发者和团队来说，Poetry 是一个值得深入学习和采用的现代化解决方案。它代表了 Python 项目管理发展的未来方向，使得 Python 开发体验更加流畅和专业。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/92d90a6caba1/">https://blog.tbf1211.xx.kg/92d90a6caba1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA/">项目构建</a><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/%E5%8C%85%E7%AE%A1%E7%90%86/">包管理</a><a class="post-meta__tags" href="/tags/2025/">2025</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-23.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/62acbead38d8/" title="Python 打包工具 uv 详解：下一代包管理器与构建器"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Python 打包工具 uv 详解：下一代包管理器与构建器</div></div><div class="info-2"><div class="info-item-1"> UV 是由 Astral (Ruff 的创建者) 公司开发的一款极速的 Python 包安装器、解析器和虚拟环境管理器。它被设计为 pip、pip-tools 和 virtualenv 的直接替代品，旨在解决 Python 现有包管理工具的速度瓶颈和用户体验问题。UV 完全用 Rust 编写，专注于提供闪电般的性能、一致的行为和可靠的依赖解析，同时兼容 pip 和 virtualenv 的现有工作流。  核心思想：UV 利用 Rust 的高性能和并发能力，提供超快的依赖解析、虚拟环境创建和包安装体验，旨在通过一个统一的、命令与 pip 相似的工具，成为 Python 包管理的新一代标准。   一、为什么需要 UV？Python 的包管理生态系统虽然成熟，但在速度和用户体验方面一直存在痛点：  pip 的速度瓶颈： pip 在解析大型或复杂项目的依赖图时可能会非常缓慢，尤其是在 requirements.txt 中包含大量次级依赖时。 每次安装都需要重新下载已有的包，缺乏高效的缓存机制。   virtualenv &#x2F; venv 的性能： 创建和管理虚拟环境的速度通常不够...</div></div></div></a><a class="pagination-related" href="/84d87a2eca4d/" title="Caddy Web Server详解：现代Web服务器的优雅选择"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Caddy Web Server详解：现代Web服务器的优雅选择</div></div><div class="info-2"><div class="info-item-1"> Caddy 是一款用 Go 语言编写的开源 Web 服务器，以其自动 HTTPS 功能、简洁的配置以及强大的功能而闻名。它被设计成现代 Web 的瑞士军刀，能够胜任静态文件服务、反向代理、负载均衡、API 网关等多种任务，并且在安全性和易用性方面表现出色。  “Caddy 是未来 Web 服务器的样子：默认安全、易于管理、功能强大，并且能够自动处理 HTTPS 证书的申请和续期，让你的网站在几秒钟内上线并享受加密连接。”   一、Caddy 简介1.1 什么是 Caddy？Caddy 是一个高性能、可扩展的 Web 服务器，其核心特性包括：  自动 HTTPS：这是 Caddy 最吸引人的特性之一。对于绝大多数公共可访问的域名，Caddy 可以自动从 Let’s Encrypt 申请、配置和续期 SSL&#x2F;TLS 证书，无需手动干预。 配置简洁：Caddyfile 配置文件语法非常直观易懂，相比 Nginx 和 Apache 更加简洁。 HTTP&#x2F;2 和 HTTP&#x2F;3 支持：Caddy 默认启用 HTTP&#x2F;2，并且是首批支持 QUIC (H...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/62acbead38d8/" title="Python 打包工具 uv 详解：下一代包管理器与构建器"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-12</div><div class="info-item-2">Python 打包工具 uv 详解：下一代包管理器与构建器</div></div><div class="info-2"><div class="info-item-1"> UV 是由 Astral (Ruff 的创建者) 公司开发的一款极速的 Python 包安装器、解析器和虚拟环境管理器。它被设计为 pip、pip-tools 和 virtualenv 的直接替代品，旨在解决 Python 现有包管理工具的速度瓶颈和用户体验问题。UV 完全用 Rust 编写，专注于提供闪电般的性能、一致的行为和可靠的依赖解析，同时兼容 pip 和 virtualenv 的现有工作流。  核心思想：UV 利用 Rust 的高性能和并发能力，提供超快的依赖解析、虚拟环境创建和包安装体验，旨在通过一个统一的、命令与 pip 相似的工具，成为 Python 包管理的新一代标准。   一、为什么需要 UV？Python 的包管理生态系统虽然成熟，但在速度和用户体验方面一直存在痛点：  pip 的速度瓶颈： pip 在解析大型或复杂项目的依赖图时可能会非常缓慢，尤其是在 requirements.txt 中包含大量次级依赖时。 每次安装都需要重新下载已有的包，缺乏高效的缓存机制。   virtualenv &#x2F; venv 的性能： 创建和管理虚拟环境的速度通常不够...</div></div></div></a><a class="pagination-related" href="/8d6f5f56de5e/" title="Python Setuptools 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-07.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-27</div><div class="info-item-2">Python Setuptools 详解</div></div><div class="info-2"><div class="info-item-1"> Setuptools 是一个强大的 Python 库，用于简化 Python 项目的打包 (packaging)、分发 (distribution) 和安装 (installation)。它是 distutils 库的增强版，提供了一系列高级功能，如声明项目元数据、自动发现包、安装依赖项、创建可执行脚本和支持插件机制等。Setuptools 已经成为 Python 项目管理和分发的事实标准 (de facto standard)。  核心思想：将 Python 代码、资源文件、元数据和依赖项封装成标准化的发行包 (Source Distribution 或 Wheel)，方便用户通过 pip 等工具安装和管理，从而实现代码的轻松共享和复用。   一、为什么需要 Setuptools？在 Python 项目开发中，尤其当项目需要被他人使用、共享或部署到不同环境时，会遇到以下问题：  代码复用与分发：如何将自己的 Python 代码模块化，并方便地分享给他人使用？简单地复制粘贴文件显然不是一个可持续的方案。 依赖管理：我的项目依赖了哪些第三方库？如何确保用户在安装我的项目时，这些依...</div></div></div></a><a class="pagination-related" href="/53e63dc49a04/" title="PyInstaller 深度解析与指令详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-25</div><div class="info-item-2">PyInstaller 深度解析与指令详解</div></div><div class="info-2"><div class="info-item-1"> PyInstaller 是一个将 Python 应用程序及其所有依赖项（包括 Python 解释器本身、所有第三方库、数据文件等）打包成一个独立的、可执行的二进制文件的工具。其核心目标是简化 Python 应用程序的分发，使得最终用户无需安装 Python 环境或任何依赖即可直接运行程序。  核心思想：将 Python 应用程序及其所有运行时依赖“冻结”为一个独立的软件包，通常是一个可执行文件（.exe、可执行二进制文件等）或一个包含可执行文件和相关资源的目录。   一、为什么需要 PyInstaller？Python 应用程序的部署和分发常常面临以下挑战：  用户环境依赖：最终用户需要安装正确版本的 Python 解释器，并手动安装所有项目所需的第三方库。这对于非技术用户而言门槛较高。 环境差异性：不同操作系统、不同 Python 版本或不同库版本之间的兼容性问题可能导致应用程序在某些环境中无法正常运行。 依赖管理复杂性：应用程序依赖的库可能有很多，手动追踪和安装这些依赖既繁琐又容易出错。 源代码暴露：直接分发 Python 脚本会暴露源代码，这对于商业应用或知识产权保护而言...</div></div></div></a><a class="pagination-related" href="/2565d3c3db01/" title="Go语言embed包详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-12</div><div class="info-item-2">Go语言embed包详解</div></div><div class="info-2"><div class="info-item-1"> Go 标准库从 Go 1.16 版本开始引入了 embed 1 包。这个包提供了一种简单、声明式的方式，允许开发者将静态文件（如 HTML 模板、CSS、JavaScript、图片、配置文件等）直接嵌入到 Go 可执行文件中。这意味着你可以通过一个独立的二进制文件分发所有应用程序所需的资源，而无需额外管理外部文件，极大地简化了部署和分发过程。  核心思想：将应用程序的外部资源（静态文件）编译进最终的二进制文件，实现“单一二进制文件”的发布和部署，消除外部文件依赖带来的复杂性。   一、为什么需要 embed 包？在 embed 包之前，Go 语言应用程序处理静态资源通常有以下几种方式：  外部文件：将静态文件与可执行文件放在一起分发。这会带来：  部署复杂性：需要确保文件结构正确，并处理文件丢失或路径错误的问题。 文件篡改风险：外部文件容易被修改，可能影响程序的行为或安全性。 分发不便：每次更新都需要同步可执行文件和所有相关资源文件。   go:embed 第三方库：许多第三方库（如 go-bindata, packr）实现了文件嵌入功能。这些库虽然有效，但通常需要一些额外的构...</div></div></div></a><a class="pagination-related" href="/18a421861554/" title="Golang 项目的 Makefile 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-17</div><div class="info-item-2">Golang 项目的 Makefile 详解</div></div><div class="info-2"><div class="info-item-1"> Makefile 是一种自动化构建工具，它通过定义文件之间的依赖关系和生成这些文件的命令，帮助开发者管理和自动化项目中的各种任务。尽管 Golang 自身提供了强大的内置工具链 (go build, go test, go run 等)，Makefile 在 Go 项目中依然扮演着重要角色，尤其是在需要协调多个任务、管理复杂构建流程、实现跨平台编译、集成外部工具或自动化部署脚本的场景下。  核心思想：将一系列 go 命令、Shell 脚本以及其他工具的调用封装成可复用的、有依赖关系的任务，实现一键式项目管理和自动化。   一、为什么 Go 项目需要 Makefile？Go 语言的工具链设计得非常出色，go build 能够自动处理依赖，go test 能够运行测试，go run 可以直接运行源代码。那么，为什么我们还需要 Makefile 呢？  任务编排与自动化： 一个 Go 项目通常不仅仅是编译代码。它可能涉及代码格式化 (go fmt)、静态分析 (go vet, golangci-lint)、代码生成 (go generate)、测试、构建 Docker 镜像、部署、清...</div></div></div></a><a class="pagination-related" href="/f200f6bfe5fa/" title="Golang 特殊注释 (Special Comments) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-05.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-15</div><div class="info-item-2">Golang 特殊注释 (Special Comments) 详解</div></div><div class="info-2"><div class="info-item-1"> 在 Go 语言中，除了我们日常用于解释代码逻辑的普通注释 // 和 /* */ 之外，还存在一些具有特殊含义的注释。这些特殊注释通常以 //go: 或 // + 开头，它们并不是为程序员阅读而生，而是作为指令直接与 Go 工具链（编译器、链接器、go generate 等）交互，用于控制编译行为、生成代码、导入 C 代码，或者提供额外的信息。  核心思想：特殊注释是 Go 工具链的“命令”，用于扩展 Go 语言的能力，例如嵌入文件、生成代码、与 C 语言交互或进行性能优化。   一、Go 特殊注释的分类与作用Go 的特殊注释大致可以分为几类：  编译器指令 (Build Constraints)：控制哪些文件或代码块在特定条件下编译。 代码生成指令 (go generate)：标记需要执行特定外部工具来生成代码的位置。 cgo 指令：用于 Go 和 C&#x2F;C++ 代码之间的互操作。 embed 指令：将静态文件嵌入到 Go 二进制文件中 (Go 1.16+)。 运行时或工具指令：用于性能分析、内存管理等内部或高级用途。  接下来的章节将详细介绍这些特殊注释。 二、//g...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">345</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">206</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">74</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Poetry%EF%BC%9F"><span class="toc-text">一、为什么需要 Poetry？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Poetry-%E7%9A%84%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-text">二、Poetry 的核心特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%E4%B8%8E%E9%94%81%E5%AE%9A"><span class="toc-text">2.1 依赖管理与锁定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86"><span class="toc-text">2.2 虚拟环境管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83"><span class="toc-text">2.3 项目打包与发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E9%A1%B9%E7%9B%AE%E8%84%9A%E6%89%8B%E6%9E%B6%E4%B8%8E%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C"><span class="toc-text">2.4 项目脚手架与脚本运行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85-Poetry"><span class="toc-text">三、安装 Poetry</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Poetry-%E6%8C%87%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-text">四、Poetry 指令详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E5%88%9B%E5%BB%BA"><span class="toc-text">4.1 项目初始化与创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-text">4.2 依赖管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E7%8E%AF%E5%A2%83%E7%AE%A1%E7%90%86%E4%B8%8E%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text">4.3 环境管理与命令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%8C%85%E4%BF%A1%E6%81%AF%E4%B8%8E%E6%A3%80%E6%9F%A5"><span class="toc-text">4.4 包信息与检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E6%89%93%E5%8C%85%E4%B8%8E%E5%8F%91%E5%B8%83"><span class="toc-text">4.5 打包与发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-text">4.6 配置管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Poetry-%E7%9A%84-pyproject-toml-%E7%BB%93%E6%9E%84"><span class="toc-text">五、Poetry 的 pyproject.toml 结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Poetry-%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="toc-text">六、Poetry 工作流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Poetry-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">七、Poetry 的优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-text">7.1 优点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-text">7.2 缺点：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">八、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/15920229f914/" title="Supabase 深度解析"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-06.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Supabase 深度解析"/></a><div class="content"><a class="title" href="/15920229f914/" title="Supabase 深度解析">Supabase 深度解析</a><time datetime="2025-12-02T22:24:00.000Z" title="发表于 2025-12-03 06:24:00">2025-12-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1ae20d2726d8/" title="MiniRTC 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MiniRTC 详解"/></a><div class="content"><a class="title" href="/1ae20d2726d8/" title="MiniRTC 详解">MiniRTC 详解</a><time datetime="2025-11-28T22:24:00.000Z" title="发表于 2025-11-29 06:24:00">2025-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/be24ef88e59a/" title="WebRTC 技术详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-25.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WebRTC 技术详解"/></a><div class="content"><a class="title" href="/be24ef88e59a/" title="WebRTC 技术详解">WebRTC 技术详解</a><time datetime="2025-11-27T22:24:00.000Z" title="发表于 2025-11-28 06:24:00">2025-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/53e63dc49a04/" title="PyInstaller 深度解析与指令详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PyInstaller 深度解析与指令详解"/></a><div class="content"><a class="title" href="/53e63dc49a04/" title="PyInstaller 深度解析与指令详解">PyInstaller 深度解析与指令详解</a><time datetime="2025-11-24T22:24:00.000Z" title="发表于 2025-11-25 06:24:00">2025-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/61fddda6a7a8/" title="Go 语言 GC (Garbage Collection) 机制详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Go 语言 GC (Garbage Collection) 机制详解"/></a><div class="content"><a class="title" href="/61fddda6a7a8/" title="Go 语言 GC (Garbage Collection) 机制详解">Go 语言 GC (Garbage Collection) 机制详解</a><time datetime="2025-11-23T22:24:00.000Z" title="发表于 2025-11-24 06:24:00">2025-11-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-23.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="📌 2023">📌 2023</a><a href="/archives/2024/" target="_blank" title="❓ 2024">❓ 2024</a><a href="/archives/2025/" target="_blank" title="🚀 2025">🚀 2025</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="分类">分类</a><a href="/tags/" target="_blank" title="标签">标签</a><a href="/categories/" target="_blank" title="时间线">时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="说说">说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2025 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script>(() => {
  const option = null
  const config = {"site_uv":true,"site_pv":true,"page_pv":true,"token":"qTvz1SkmPDt785fgh6BpiA5qiFFIVUwxj8Ft+rPW+cdN59v1hXjwRgSmy0+ji9m+oLlcxvo2NfDSMa6epVl3NTlsN3ejCIwWeP8Y51aEJ0Sbem4UexGmJLspB7AkOBId2SdtT6QWEBlGmFIIQgchQ2zAKYxTmc/kpBED5aLSr+3uvmQ9/G7FJQeVFpveDkK0xM1hu36xq4a6/FSeROxtoEp5zabzTWiYTlLsQzIl/NlELnCq3nxK+oo/vl3UQo/oM/rae/gJX/MaVKsgIUCd2ABJogNkx2KTenBIBpbPki5FzOgPh6/z4GPa4HvhNO51DDVG1SEQZooqEYmt/gnybLBWFbN+7liZWw=="}

  const runTrack = () => {
    if (typeof umami !== 'undefined' && typeof umami.track === 'function') {
      umami.track(props => ({ ...props, url: window.location.pathname, title: GLOBAL_CONFIG_SITE.title }))
    } else {
      console.warn('Umami Analytics: umami.track is not available')
    }
  }

  const loadUmamiJS = () => {
    btf.getScript('https://umami.012700.xyz/script.js', {
      'data-website-id': '2a796d6c-6499-42d8-8eb4-d9a2930b0ff3',
      'data-auto-track': 'false',
      ...option
    }).then(() => {
      runTrack()
    }).catch(error => {
      console.error('Umami Analytics: Error loading script', error)
    })
  }

  const getData = async (isPost) => {
    try {
      const now = Date.now()
      const keyUrl = isPost ? `&url=${window.location.pathname}` : ''
      const headerList = { 'Accept': 'application/json' }

      if (true) {
        headerList['Authorization'] = `Bearer ${config.token}`
      } else {
        headerList['x-umami-api-key'] = config.token
      }

      const res = await fetch(`https://umami.012700.xyz/api/websites/2a796d6c-6499-42d8-8eb4-d9a2930b0ff3/stats?startAt=0000000000&endAt=${now}${keyUrl}`, {
        method: "GET",
        headers: headerList
      })

      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`)
      }

      return await res.json()
    } catch (error) {
      console.error('Umami Analytics: Failed to fetch data', error)
      throw error
    }
  }

  const insertData = async () => {
    try {
      if (GLOBAL_CONFIG_SITE.pageType === 'post' && config.page_pv) {
        const pagePV = document.getElementById('umamiPV')
        if (pagePV) {
          const data = await getData(true)
          if (data && data.pageviews && typeof data.pageviews.value !== 'undefined') {
            pagePV.textContent = data.pageviews.value
          } else {
            console.warn('Umami Analytics: Invalid page view data received')
          }
        }
      }

      if (config.site_uv || config.site_pv) {
        const data = await getData(false)

        if (config.site_uv) {
          const siteUV = document.getElementById('umami-site-uv')
          if (siteUV && data && data.visitors && typeof data.visitors.value !== 'undefined') {
            siteUV.textContent = data.visitors.value
          } else if (siteUV) {
            console.warn('Umami Analytics: Invalid site UV data received')
          }
        }

        if (config.site_pv) {
          const sitePV = document.getElementById('umami-site-pv')
          if (sitePV && data && data.pageviews && typeof data.pageviews.value !== 'undefined') {
            sitePV.textContent = data.pageviews.value
          } else if (sitePV) {
            console.warn('Umami Analytics: Invalid site PV data received')
          }
        }
      }
    } catch (error) {
      console.error('Umami Analytics: Failed to insert data', error)
    }
  }

  btf.addGlobalFn('pjaxComplete', runTrack, 'umami_analytics_run_track')
  btf.addGlobalFn('pjaxComplete', insertData, 'umami_analytics_insert')


  loadUmamiJS()

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', insertData)
  } else {
    setTimeout(insertData, 100)
  }
})()</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.2"></script></div></div></body></html>