---
title: Serverless 详解
date: 2024-01-10 06:24:00
tags:
  - 2024
  - Serverless
  - 云服务
categories:
  - 开发工具
  - 云服务
---

> **Serverless (无服务器)** 是一种云计算的执行模型，它允许开发者构建和运行应用程序而无需管理服务器。在这种模型下，云服务提供商负责服务器的调配、维护和扩展，开发者只需关注自己的代码逻辑。Serverless 并不是指“没有服务器”，而是指“开发者不需要关心服务器”。它通常包含两种核心服务模式：**函数即服务 (Function-as-a-Service, FaaS)** 和 **后端即服务 (Backend-as-a-Service, BaaS)**。

{% note info %}
核心思想：**将基础设施管理完全交给云服务商，开发者只需编写代码并部署，按实际使用量付费，实现极致的弹性伸缩和降低运维成本。**
{% endnote %}
------

## 一、为什么需要 Serverless？

传统的应用部署模型（物理机、虚拟机、容器）都需要开发者或运维团队投入大量精力进行服务器管理：

*   **资源调配**：预估并配置合适的 CPU、内存、存储。
*   **操作系统管理**：安装、打补丁、更新。
*   **运行时环境**：安装语言运行时、库、依赖。
*   **扩展性**：根据流量变化手动或自动伸缩服务器集群。
*   **高可用性**：设置负载均衡、故障转移机制。
*   **监控与日志**：部署监控 agent，收集日志。

这些“非功能性需求”占据了开发者大量时间。Serverless 旨在解决这些痛点，让开发者能够：

1.  **专注于代码**：将所有基础设施管理的负担转移给云服务提供商。
2.  **降低运营成本**：只为实际执行的代码付费，避免资源闲置浪费。
3.  **实现自动伸缩**：根据请求量自动调整资源，无需手动配置。
4.  **提高开发效率**：快速迭代、部署和上线。
5.  **简化运维**：减少服务器维护、补丁更新、安全加固等工作。

## 二、Serverless 的核心组成

Serverless 主要由 FaaS 和 BaaS 两部分构成：

### 2.1 函数即服务 (Function-as-a-Service, FaaS)

FaaS 是 Serverless 的核心，它允许开发者将应用逻辑拆分成一个个独立的、短生命周期的函数，并部署到云平台。

*   **事件驱动**：函数通常由特定事件触发，例如 HTTP 请求、数据库变更、文件上传、消息队列事件、定时任务等。
*   **无状态**：为了方便伸缩和管理，FaaS 函数通常设计为无状态的。如果需要状态，则通过外部服务（如数据库、缓存）来管理。
*   **按需执行**：函数只在被调用时才运行，执行完毕后资源被释放。
*   **自动伸缩**：云平台会根据事件的并发量自动创建或销毁函数实例。
*   **微计费**：按照函数的实际运行时间、内存消耗和调用次数计费。

**典型 FaaS 产品：**

*   **AWS Lambda**
*   **Google Cloud Functions**
*   **Azure Functions**
*   **Cloudflare Workers** (属于边缘函数范畴，也是 FaaS)
*   **Vercel Edge Functions** (同上)

### 2.2 后端即服务 (Backend-as-a-Service, BaaS)

BaaS 提供了预构建的、开箱即用的后端服务，开发者可以直接通过 API 调用这些服务，而无需自己构建和管理。

*   **无需编写后端代码**：针对通用功能（如用户认证、数据库、文件存储、推送通知），BaaS 提供了现成的解决方案。
*   **简化开发**：开发者可以直接使用客户端 SDK 与 BaaS 服务交互。
*   **与 FaaS 协同**：BaaS 服务常常作为 FaaS 函数的存储、身份验证等后端支持。

**典型 BaaS 产品：**

*   **AWS DynamoDB (NoSQL 数据库)**
*   **AWS S3 (对象存储)**
*   **Firebase (Google 提供的综合 BaaS 平台，包括实时数据库、认证、存储等)**
*   **Supabase (Firebase 的开源替代品，基于 PostgreSQL)**
*   **Auth0 (身份认证服务)**

## 三、Serverless 的架构模式

Serverless 架构通常是事件驱动的，由多个函数和 BaaS 服务协同工作。

{% mermaid %}
graph TD
    A[用户] --> B(API Gateway / Load Balancer)
    B -- HTTP 请求 --> C["FaaS 函数 (例如: AWS Lambda)"]
    C -- 触发其他事件 --> D["消息队列 (例如: SQS)"]
    C -- 存储/读取数据 --> E["数据库 (例如: DynamoDB, PostgreSQL)"]
    C -- 存储文件 --> F["对象存储 (例如: S3)"]
    C -- 认证/授权 --> G["身份认证服务 (例如: Cognito, Auth0)"]
    D -- 触发 --> H[另一个 FaaS 函数]
    H -- 写入数据 --> E

    subgraph 外部事件源
        I[文件上传事件] --> J[FaaS 函数]
        K[数据库变更事件] --> L[FaaS 函数]
        M[定时任务] --> N[FaaS 函数]
    end
    J --> E
    L --> E
    N --> E
{% endmermaid %}

**示例流程：**

1.  **用户通过 Web 或移动应用发起 HTTP 请求。**
2.  **API Gateway 接收请求，并将其路由到对应的 FaaS 函数。**
3.  **FaaS 函数执行业务逻辑**：
    *   可能调用认证服务验证用户身份。
    *   可能从数据库读取或写入数据。
    *   可能触发另一个 FaaS 函数或将消息发送到消息队列进行异步处理。
4.  **FaaS 函数返回响应给 API Gateway，最终返回给用户。**

## 四、Serverless 的优势与局限性

### 4.1 优势：

1.  **极低的运维成本 (Zero Server Management)**：开发者无需关心服务器的购买、配置、部署、扩展和维护。
2.  **按实际使用付费 (Pay-per-Execution)**：只为代码实际执行的时间和资源付费，没有闲置成本。对于流量波动大的应用，可以显著降低成本。
3.  **自动弹性伸缩 (Automatic Scalability)**：根据请求量自动伸缩，无需手动配置，轻松应对峰值流量。
4.  **提高开发效率 (Faster Development)**：开发者可以专注于业务逻辑，快速迭代和部署功能。
5.  **天然的高可用性 (High Availability)**：云服务提供商通常在多个可用区部署 FaaS 函数，实现高可用。
6.  **简化部署**：通常只需上传代码，无需构建复杂的部署包。

### 4.2 局限性：

1.  **冷启动 (Cold Start)**：当一个函数长时间未被调用时，云平台会释放其资源。下次调用时，需要重新加载代码和运行时环境，导致第一次请求的延迟增加（即冷启动）。
2.  **运行时限制**：函数通常有执行时间、内存、CPU 等资源限制，不适合长时间运行或计算密集型任务。
3.  **无状态限制**：需要仔细设计以确保函数是无状态的，如果需要状态，必须依赖外部服务，增加了架构复杂性。
4.  **调试与监控挑战**：分布式架构和短暂的函数生命周期使得调试和监控变得更具挑战性。
5.  **供应商锁定 (Vendor Lock-in)**：不同云平台的 FaaS API 和工具链存在差异，迁移成本可能较高。
6.  **成本不可预测性**：虽然单次调用成本低，但对于极端高流量的应用，总成本可能超出预期，需要仔细监控。
7.  **本地开发环境**：在本地模拟完整的 Serverless 环境可能比较困难。

## 五、Serverless 的适用场景

Serverless 非常适合以下类型的应用和工作负载：

1.  **Web 应用与 API 后端**：尤其适用于流量波动大、需要快速响应的微服务或 RESTful API。
2.  **事件驱动的数据处理**：
    *   **实时文件处理**：如文件上传到 S3 后自动触发函数进行图片缩放、视频转码。
    *   **数据库变更触发**：如用户数据更新后自动发送通知、同步数据。
    *   **日志处理与分析**：实时处理日志数据。
3.  **定时任务**：如每日报告生成、数据清理、备份任务。
4.  **Webhook 处理**：接收和处理来自第三方服务的 Webhook 事件。
5.  **物联网 (IoT) 后端**：处理来自 IoT 设备的数据流和命令。
6.  **聊天机器人与语音助手**：处理用户请求，调用后端逻辑。
7.  **媒体处理**：音视频转码、图像识别等。

## 六、Serverless 的发展趋势

1.  **容器化与 Serverless 结合**：FaaS 平台底层越来越多地采用容器技术，甚至出现支持直接部署容器镜像的 Serverless 平台 (如 AWS Fargate, Google Cloud Run)，结合了容器的灵活性和 Serverless 的免运维。
2.  **边缘 Serverless (Edge Functions)**：将 Serverless 函数部署到 CDN 边缘节点，进一步降低延迟，提升用户体验，处理地理位置敏感的逻辑。
3.  **更强的状态管理能力**：随着如 Cloudflare Durable Objects 等服务的出现，Serverless 正在探索更优雅的状态管理方式。
4.  **可视化编排与工作流**：通过服务编排工具 (如 AWS Step Functions) 协调多个 Serverless 函数和 BaaS 服务，构建复杂的业务流程。
5.  **开发者工具链优化**：更完善的本地开发、调试和测试工具，以及更强大的 CI/CD 集成。

## 七、总结

Serverless 是一种变革性的云计算模型，它极大地简化了基础设施管理，使开发者能够将更多精力投入到业务创新中。通过 FaaS 和 BaaS 的结合，Serverless 提供了前所未有的弹性、可伸缩性和成本效益。尽管存在冷启动、调试复杂性等挑战，但随着技术的不断发展和生态系统的日益完善，Serverless 无疑将成为未来云计算架构的重要组成部分，并在越来越多的场景中发挥关键作用。