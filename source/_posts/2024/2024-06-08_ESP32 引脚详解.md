---
title: ESP32 引脚详解
date: 2024-06-08 06:24:00
tags:
  - 2024
  - ESP32单片机
  - 嵌入式系统
  - 硬件编程
categories:
  - 嵌入式系统
  - ESP32单片机
---

> **ESP32 引脚** (GPIO - General Purpose Input/Output) 是 ESP32 芯片与外部世界交互的物理接口。理解每个引脚的功能、特性及其限制，对于成功开发 ESP32 项目至关重要。ESP32 拥有丰富的引脚资源，支持多种功能复用，如数字 I/O、模拟 I/O、PWM、串行通信、触摸传感器等，使其能够连接各种传感器、执行器和外部模块。

{% note info %}
核心思想：**并非所有标号的引脚都可用作通用 GPIO，部分引脚有特定的启动行为或内部连接，需要遵循特定的使用规则以避免问题。** 精心设计引脚分配是稳定 ESP32 应用的关键。
{% endnote %}
------

## 一、ESP32 引脚概述

ESP32 (以 ESP32-WROOM-32 系列模组为例) 通常会引出 30-38 个引脚。这些引脚中的大部分是可用于通用输入输出 (GPIO) 的，但也有一些引脚具有特殊功能或在启动时有特定状态。

**重要概念：**

*   **GPIO 号**：对应于芯片内部的引脚编号 (如 GPIO0, GPIO1, ..., GPIO39)。
*   **开发板丝印**：开发板上印刷的引脚名称，通常会是 GPIO 号，但有时也会是功能或简化名称（如 `TX0`, `RX0`, `SDA`, `SCL`, `VP`, `VN`）。
*   **功能复用 (Pin Multiplexing)**：一个物理引脚可以根据配置实现多种功能（例如，GPIO16 既可以是普通的数字输出，也可以是 UART2 的 RX 引脚）。

## 二、ESP32 引脚分类与关键特性

我们可以将 ESP32 的引脚大致分为几类，并了解它们的重要特性。

### 2.1 通用数字 I/O 引脚 (GPIO)

ESP32 拥有多达 34 个可用 GPIO 引脚 (具体数目因芯片封装而异)。它们可以配置为输入或输出，并支持内部上拉 (Pull-up) 或下拉 (Pull-down) 电阻。

*   **输出模式**：可用于控制 LED、继电器、电机驱动等。
*   **输入模式**：可用于读取按键、开关、数字传感器输出等。
*   **内部上拉/下拉**：软件可配置，方便接缝按键等无需外接电阻的场景。

**可用的通用 GPIO (典型)：**

*   **GPIO0 - GPIO39** (部分编号不可用或有特殊用途)
*   **推荐作为通用 I/O 的引脚**：
    *   **GPIO1-3, 5, 12-19, 21-23, 25-27, 32-39**

### 2.2 模拟输入引脚 (ADC - Analog-to-Digital Converter)

ESP32 集成了 2 个 12 位 SAR (Successive Approximation Register) ADC，总共提供 18 个独立的模拟输入通道。

*   **精度**：12 位意味着可以将模拟电压信号转换为 0-4095 的数字值。
*   **电压范围**：通常为 0V 到 VDD (通常 3.3V)。但 ESP32 的 ADC 在高输入电压下可能存在非线性问题，需要校准或使用分压电路。
*   **ADC1 和 ADC2 控制器**：
    *   **ADC1 (8 个通道)**：可在 Wi-Fi/蓝牙活动时使用。
    *   **ADC2 (10 个通道)**：**在 Wi-Fi 使用时不可用**，因为 ADC2 被 Wi-Fi 驱动占用。如果您的应用需要同时使用 Wi-Fi 和大量模拟输入，请优先使用 ADC1 的引脚。
*   **GPIO 编码与 ADC 通道**：
    *   ADC1_CH0 -> GPIO36 (VP)
    *   ADC1_CH1 -> GPIO37
    *   ADC1_CH2 -> GPIO38
    *   ADC1_CH3 -> GPIO39 (VN)
    *   ADC1_CH4 -> GPIO32
    *   ADC1_CH5 -> GPIO33
    *   ADC1_CH6 -> GPIO34
    *   ADC1_CH7 -> GPIO35
    *   ADC2_CH0 -> GPIO4
    *   ADC2_CH1 -> GPIO0
    *   ... (其他 ADC2 通道)

### 2.3 模拟输出引脚 (DAC - Digital-to-Analog Converter)

ESP32 集成了 2 个 8 位 DAC，可用于生成模拟电压信号。

*   **精度**：8 位意味着可以输出 0-255 个不同的电压等级。
*   **电压范围**：0V 到 VDD (3.3V)。
*   **引脚**：
    *   **DAC1 -> GPIO25**
    *   **DAC2 -> GPIO26**

### 2.4 触摸传感器引脚 (Touch Sensors)

ESP32 内置 10 个电容式触摸传感器，可用于检测人体的触摸。

*   **原理**：通过测量引脚上的电容变化来检测触摸。
*   **引脚**：
    *   **T0 -> GPIO4**
    *   **T1 -> GPIO2**
    *   **T2 -> GPIO15**
    *   **T3 -> GPIO13**
    *   **T4 -> GPIO12**
    *   **T5 -> GPIO14**
    *   **T6 -> GPIO27**
    *   **T7 -> GPIO33**
    *   **T8 -> GPIO32**
    *   **T9 -> GPIO3** (⚠️ GPIO3 通常用于 UART0 RX)

### 2.5 PWM (脉冲宽度调制) 引脚

ESP32 的 LEDC (LED Controller) 外设支持 16 个独立的 PWM 通道，可以映射到几乎任何 GPIO 引脚。

*   **功能**：用于电机调速、LED 亮度调节、模拟信号生成等。
*   **独立通道**：每个通道可以独立设置频率、分辨率和占空比。

### 2.6 通信接口引脚

ESP32 拥有多个硬件通信接口，可以复用到不同的 GPIO 上。

*   **UART (通用异步收发传输器)**：
    *   **UART0**：通常用于程序烧录和调试输出 (TX0: GPIO1, RX0: GPIO3)。**不建议作为通用 I/O 使用**。
    *   **UART1**：TX1: GPIO10, RX1: GPIO9。
    *   **UART2**：TX2: GPIO17, RX2: GPIO16。
*   **SPI (串行外设接口)**：
    *   **SPI0/SPI1**：内部用于连接 Flash。
    *   **SPI2 (HSPI)**：可以作为通用 SPI，引脚可配置 (例如 MOSI: GPIO13, MISO: GPIO12, SCK: GPIO14, CS: GPIO15)。
    *   **SPI3 (VSPI)**：可以作为通用 SPI，引脚可配置 (例如 MOSI: GPIO23, MISO: GPIO19, SCK: GPIO18, CS: GPIO5)。
*   **I2C (集成电路互联)**：
    *   ESP32 有 2 个 I2C 控制器，SDA 和 SCL 引脚可以任意配置到任何可用的 GPIO (推荐使用 GPIO21 和 GPIO22 作为默认 I2C 引脚)。
*   **I2S (集成电路间声频总线)**：2 个 I2S 接口，用于音频输入/输出。引脚可配置。

### 2.7 关键功能引脚与注意事项

有些引脚在芯片启动、烧录或连接外部 Flash 时有特殊作用，它们的行为需要特别注意：

#### 2.7.1 启动模式相关引脚 🙏 **非常重要！**

 estos GPIO son críticos para el modo de arranque del ESP32.

*   **GPIO2**：
    *   **启动时**：**芯片上电或复位时，如果 GPIO2 为低电平，则进入 UART 下载模式 (Boot mode)**。
    *   **因此，在正常运行模式下，GPIO2 在上电时应避免拉低。** 许多开发板将内置 LED 接到 GPIO2，通过上拉电阻使其默认高电平。
    *   同时也是 ADC2_CH2 和 T1 触摸引脚。
*   **GPIO0**：
    *   **启动时**：**如果 GPIO0 为低电平，则进入 UART 下载模式 (Boot mode)**。
    *   **因此，在正常运行模式下，GPIO0 在上电时应为高电平。** 按下 Boot 键通常是短接 GPIO0 到地。
    *   同时也是 ADC2_CH9 和 T0 触摸引脚。
*   **GPIO4** (新版本 ESP32 DevKitC v4 板上作为 Boot 按键的引脚)
    *   与 GPIO0 类似，也是 Boot 按钮。

**总结启动模式：**
| 状态       | GPIO0 | GPIO2 | Flash 运行模式 |
| :--------- | :---- | :---- | :------------- |
| **正常启动**   | HIGH  | HIGH (或悬空) | 从 Flash 启动   |
| **下载模式**   | LOW   | HIGH (或悬空) | 等待 UART 下载 |

#### 2.7.2 内部连接或受限引脚

*   **GPIO6 - GPIO11**：
    *   这些引脚内部连接到 ESP32 的 **SPI Flash** 接口。
    *   **不建议用作通用 GPIO**，因为它们会影响外部 Flash 的正常工作，且在 Wi-Fi 运行时会有很高的噪声。
    *   **在外部 Flash 模组上，这些引脚通常不引出**。
*   **GPIO34 - GPIO39**：
    *   **只能作为输入引脚** (Input-only GPIOs)。它们没有内部上拉/下拉电阻。
    *   **同时也是 ADC1 的通道**。
    *   由于是输入专用，无法设置为输出模式来驱动任何器件。

#### 2.7.3 其他特殊引脚

*   **EN** (Enable)：芯片使能引脚，通常内置上拉电阻。拉低该引脚会使芯片复位或进入低功耗状态。
*   **TX0 (GPIO1), RX0 (GPIO3)**：
    *   默认用于 USB 转串口芯片的通信，方便固件烧录和串口输出调试信息。
    *   **强烈不建议将其用于其他通用目的**，除非您不使用串口调试或烧录功能，否则会干扰串口通信。
    *   GPIO3 也是 T9 触摸引脚和 ADC1_CH0。
*   **GPIO12 (MTDI)**：
    *   **启动时**：**如果 GPIO12 为高电平，则 Flash 以 1.8V 电压启动**。如果 Flash 支持不同电压，需要注意。对于大多数 3.3V Flash，它应该保持低电平。
    *   某些板子上可能连接到 PSRAM 或其他外设。
    *   同时也是 ADC2_CH5 和 T4 触摸引脚。

### 2.8 ESP32 引脚概览图 (示意)

以下是一个简化和概念性的 ESP32 芯片引脚功能概览图，而非具体的开发板布局。实际开发板会引出部分重要的 GPIO。

{% mermaid %}
graph LR
    A[ESP32 Chip] --> B1["GPIO 0-39 (Digital I/O)"]
    A --> B2["ADC Channels (Analog-in)"]
    A --> B3["DAC Channels (Analog-out)"]
    A --> B4[Touch Sensors]
    A --> B5["PWM (LEDC)"]
    A --> B6[UART/SPI/I2C/I2S]
    A --> B7[Boot Mode Pins]
    A --> B8[Flash SPI Pins]
    A --> B9[Input-only GPIOs]

    B1 --> C1[Output: LED, Relay control]
    B1 --> C2[Input: Button, Digital Sensor]

    B2 --> D1["ADC1 (8 ch.): GPIO32-39, Wi-Fi OK"]
    B2 --> D2["ADC2 (10 ch.): GPIO0,2,4,12-16,25-27, Wi-Fi Busy"]

    B3 --> E1[DAC1: GPIO25]
    B3 --> E2[DAC2: GPIO26]

    B4 --> F1[T0-T9: GPIO0,2,4,12,13,14,15,27,32,33]

    B5 --> G1[16 Channels, any GPIO]

    B6 --> H1["UART0: TX0(GPIO1), RX0(GPIO3)"]
    B6 --> H2["UART1: TX1(GPIO10), RX1(GPIO9)"]
    B6 --> H3["UART2: TX2(GPIO17), RX2(GPIO16)"]
    B6 --> H4["SPI (HSPI/VSPI): MISO, MOSI, SCK, CS (Configurable)"]
    B6 --> H5["I2C: SDA, SCL (Configurable, e.g., GPIO21, GPIO22)"]
    B6 --> H6["I2S: (Configurable)"]

    B7 --> J1[GPIO0: Low for Boot Mode]
    B7 --> J2[GPIO2: Low for Boot Mode]
    B7 --> J3[GPIO12: Flash voltage selection]

    B8 --> K1[GPIO6-11: Connected to Flash, Avoid using]

    B9 --> L1[GPIO34-39: Input only, no internal pull-up/down]
  
    style J1 fill:#FFCCCC,stroke:#FF0000,stroke-width:2px;
    style J2 fill:#FFDDCC,stroke:#FF8800,stroke-width:2px;
    style J3 fill:#FFDDCC,stroke:#FF8800,stroke-width:2px;
    style K1 fill:#DDDDDD,stroke:#888888,stroke-width:2px;
    style L1 fill:#DDDDDD,stroke:#888888,stroke-width:2px;
    classDef important_alert fill:#FFCCCC,stroke:#FF0000,stroke-dasharray: 5 5;
    class J1,J2,J3,K1,L1 important_alert;
{% endmermaid %}

## 三、ESP32 在 Arduino 语法中的引脚使用

在 Arduino 环境中，引脚通常直接通过其 GPIO 编号来引用。

### 3.1 数字 I/O

```cpp
const int LED_PIN = 2; // 使用 GPIO2 作为 LED 控制引脚

void setup() {
  Serial.begin(115200);
  pinMode(LED_PIN, OUTPUT); // 设置 GPIO2 为输出模式
}

void loop() {
  digitalWrite(LED_PIN, HIGH); // 点亮 LED
  Serial.println("LED ON");
  delay(1000);
  digitalWrite(LED_PIN, LOW);  // 熄灭 LED
  Serial.println("LED OFF");
  delay(1000);
}
```

### 3.2 模拟输入 (ADC)

```cpp
const int TEMP_SENSOR_PIN = 34; // 连接到 GPIO34 (ADC1_CH6)

void setup() {
  Serial.begin(115200);
  // ADC1 的引脚在 Wi-Fi 活跃时也可使用
  // 注意：ESP32 的 ADC 默认是 12 位
  analogReadResolution(12); // 设置读取分辨率为 12 位 (0-4095)
}

void loop() {
  int sensorValue = analogRead(TEMP_SENSOR_PIN);
  Serial.print("Analog value: ");
  Serial.println(sensorValue);

  // 如果需要将数字值转换为电压
  float voltage = sensorValue * (3.3 / 4095.0);
  Serial.print("Voltage: ");
  Serial.println(voltage);

  delay(1000);
}
```

### 3.3 模拟输出 (DAC)

```cpp
const int AUDIO_OUT_PIN = 25; // DAC1 连接到 GPIO25

void setup() {
  Serial.begin(115200);
  // DAC 不需要 pinMode 设置，直接使用 dacWrite()
}

void loop() {
  // 从 0 逐渐升高到 255 (8 位 DAC)
  for (int value = 0; value <= 255; value++) {
    dacWrite(AUDIO_OUT_PIN, value);
    delay(5);
  }
  // 从 255 逐渐降低到 0
  for (int value = 255; value >= 0; value--) {
    dacWrite(AUDIO_OUT_PIN, value);
    delay(5);
  }
}
```

### 3.4 触摸传感器

```cpp
const int TOUCH_SENSOR_PIN = 4; // T0 连接到 GPIO4

void setup() {
  Serial.begin(115200);
  Serial.println("Touch sensor test on GPIO4");
  // 触摸引脚不需要 pinMode
}

void loop() {
  int touchValue = touchRead(TOUCH_SENSOR_PIN);
  Serial.print("Touch value: ");
  Serial.println(touchValue);

  // 根据实际测试结果调整阈值
  if (touchValue < 50) { // 假设触摸时读数低于 50
    Serial.println("TOUCH DETECTED!");
  }
  delay(200);
}
```

### 3.5 I2C 通信

```cpp
#include <Wire.h> // ESP32 I2C 库

// 推荐的 I2C 引脚，但可自定义
const int SDA_PIN = 21;
const int SCL_PIN = 22;

void setup() {
  Serial.begin(115200);
  Wire.begin(SDA_PIN, SCL_PIN); // 初始化 I2C 总线，指定 SDA 和 SCL 引脚
  Serial.println("I2C Scanner");
  Serial.print("Scanning...");

  byte error, address;
  int nDevices = 0;

  for (address = 1; address < 127; address++) {
    Wire.beginTransmission(address);
    error = Wire.endTransmission();

    if (error == 0) {
      Serial.print("I2C device found at address 0x");
      if (address < 16) Serial.print("0");
      Serial.print(address, HEX);
      Serial.println("  !");
      nDevices++;
    } else if (error == 4) {
      Serial.print("Unknown error at address 0x");
      if (address < 16) Serial.print("0");
      Serial.println(address, HEX);
    }
  }

  if (nDevices == 0) {
    Serial.println("No I2C devices found\n");
  } else {
    Serial.println("done\n");
  }
}

void loop() {
  // nothing to do
}
```

## 四、选择引脚的最佳实践

在设计 ESP32 电路时，引脚选择至关重要：

1.  **避开启动模式引脚**：GPIO0、GPIO2、GPIO12 在上电启动时有特殊要求。除非您明确知道其影响并有外部电路确保其状态，否则尽量避免在这些引脚上连接外部上拉/下拉电阻或具有强驱动能力且默认状态与启动模式要求冲突的器件。
2.  **避开 Flash SPI 引脚**：GPIO6-GPIO11 连接到内部 Flash，**绝对不要用作通用 I/O**。
3.  **注意输入专用引脚**：GPIO34-GPIO39 只能作为输入。当需要输出功能时，不要选择这些引脚。
4.  **注意 ADC2 的限制**：如果您的应用同时使用 Wi-Fi/蓝牙，并且需要读取模拟信号，**优先使用 ADC1 (GPIO32-39) 的通道**。
5.  **避免 UART0 引脚**：GPIO1 (TX0) 和 GPIO3 (RX0) 默认用于串口通信。如果用于其他功能，会干扰烧录和调试，通常不推荐。
6.  **优先使用独立外设引脚**：对于 I2C、SPI、UART 等外设，虽然引脚可配置，但通常有一些“习惯性”或“推荐”的引脚组合 (例如 I2C 的 GPIO21/22)，可以减少冲突。
7.  **参考开发板原理图**：您使用的 ESP32 开发板（如 ESP32 DevKitC、NodeMCU-32S）会将其一些 GPIO 引脚连接到板载功能（如内置 LED、Boot 按钮），并可能预留一些引脚用于特定的模块。务必查阅您开发板的原理图。
8.  **考虑功耗**：如果需要深度睡眠，注意哪些引脚可以作为唤醒源 (Ext0/Ext1)，以及哪些引脚的状态在深度睡眠期间会保留。

## 五、总结

ESP32 强大的引脚功能是其核心优势之一，但其复杂性和功能复用也给开发者带来了挑战。理解不同引脚的电气特性、功能分类、在启动时的行为以及它们之间的潜在冲突是高效开发 ESP32 应用的关键。始终参考乐鑫科技的官方数据手册、您所使用开发板的原理图，并在选择引脚时遵循**避开限制**和**最佳实践**的原则，将有助于构建稳定、可靠且功能完整的 ESP32 项目。