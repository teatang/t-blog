---
title: 交换机 (Switch) 详解
date: 2024-07-30 06:24:00
tags:
  - 2024
  - 网络技术
  - 网络设备
  - 硬件相关
categories:
  - 硬件相关
---

> **交换机 (Switch)** 是一种工作在 OSI 模型数据链路层（第二层）或更高层（如第三层）的网络设备。它的主要功能是连接局域网 (LAN) 中的多个网络设备（计算机、服务器、打印机等），并根据 MAC 地址智能地转发数据帧，从而在物理上分割冲突域，优化网络性能。与传统的集线器 (Hub) 相比，交换机能够提供更高的网络效率和更好的安全性。

{% note info %}
核心功能：根据 MAC 地址智能转发数据帧，隔离冲突域，提高局域网效率。
{% endnote %}
------

## 一、什么是交换机？

交换机，全称是**以太网交换机 (Ethernet Switch)**，是现代局域网 (LAN) 中最常见的连接设备。它拥有多个端口，每个端口都可以连接一个独立的网络设备或子网。当数据帧到达交换机的一个端口时，交换机会检查数据帧中的目标 MAC 地址，并将其精确地转发到目标设备所连接的端口，而不是像集线器那样泛洪到所有端口。

**交换机在网络中的作用：**

*   **连接设备**：将多台计算机、服务器、网络打印机等设备连接到同一个局域网中。
*   **数据转发**：根据学习到的 MAC 地址信息，实现数据帧的智能、高效转发。
*   **隔离冲突域**：每个交换机端口都构成一个独立的冲突域，有效减少了网络拥堵。
*   **支持多种功能**：提供如 VLAN、QoS、端口聚合、PoE 等高级功能，满足不同网络需求。

## 二、交换机的工作原理

交换机主要工作在 OSI 模型的数据链路层（第二层），其核心工作机制基于 MAC 地址。

### 2.1 MAC 地址学习 (MAC Address Learning)

当交换机启动并接收到数据帧时，它会执行 MAC 地址学习以构建其内部的 **MAC 地址表 (MAC Address Table)**，也称为 **CAM 表 (Content Addressable Memory table)**。

1.  **检查源 MAC 地址**：当一个数据帧从某个端口进入交换机时，交换机会读取数据帧的**源 MAC 地址**。
2.  **记录映射关系**：交换机将这个源 MAC 地址与接收该数据帧的**端口号**进行绑定，并将其记录在 MAC 地址表中。
3.  **老化时间**：MAC 地址表中的条目通常有超时时间（老化时间）。如果在一定时间内没有再次接收到来自该 MAC 地址的数据帧，该条目将被删除，以避免存储过时信息，并适应网络拓扑的变化。

{% mermaid %}
sequenceDiagram
    participant DeviceA as 设备A (MAC_A)
    participant DeviceB as 设备B (MAC_B)
    participant Switch as 交换机
    participant Port1 as 端口1
    participant Port2 as 端口2

    DeviceA->>Port1: 发送数据帧 (源MAC: MAC_A, 目的MAC: MAC_B)
    activate Switch
    Switch->>Switch: 1. 检查帧源MAC地址 (MAC_A)
    Switch->>Switch: 2. 学习：MAC_A <-> 端口1
    Switch->>Switch: 3. 更新MAC地址表
    Switch->>Switch: 4. 检查帧目的MAC地址 (MAC_B)
    alt MAC_B 在表中
        Switch->>Port2: 5a. 转发到对应端口 (MAC_B<->端口2)
        Port2->>DeviceB: 6a. 接收数据帧
    else MAC_B 不在表中 or 是广播地址
        Switch->>AllPortsExceptSource: 5b. 泛洪 (除接收端口外)
        Port2->>DeviceB: 6b. 接收泛洪数据 (如ARP请求)
    end
    deactivate Switch
{% endmermaid %}

### 2.2 帧转发、过滤与泛洪 (Frame Forwarding, Filtering, Flooding)

在学习到 MAC 地址后，交换机根据数据帧的**目的 MAC 地址**执行以下操作：

*   **转发 (Forwarding)**：
    如果目的 MAC 地址在 MAC 地址表中找到，并且对应的端口不是数据帧进入的端口，交换机就将数据帧只转发到与目的 MAC 地址绑定的那个特定端口。这是最理想的情况，实现了单播通信。
*   **过滤 (Filtering)**：
    如果目的 MAC 地址在 MAC 地址表中找到，并且对应的端口就是数据帧进入的端口（例如，设备A向设备A自己发送数据包，或者数据包被某设备捕获后又重新发回），交换机就不会再将数据帧转发到其他端口，直接丢弃该数据帧，避免不必要的网络流量。
*   **泛洪 (Flooding)**：
    如果目的 MAC 地址不在 MAC 地址表中，或者目的 MAC 地址是一个**广播地址 (Broadcast MAC, FF:FF:FF:FF:FF:FF)**，交换机则会将数据帧发送到除接收端口之外的所有其他端口。这种行为称为泛洪。泛洪常用于 ARP 请求 (Address Resolution Protocol) 或其他广播通信，通过泛洪，目标设备有机会响应，从而使交换机学习到其 MAC 地址。

### 2.3 冲突域与广播域 (Collision Domain vs. Broadcast Domain)

**冲突域 (Collision Domain)**：指网络中所有设备竞争同一传输介质的范围。当两个或多个设备同时发送数据时，就会发生碰撞。
*   **集线器 (Hub)**：所有连接到集线器的设备都处于同一个巨大的冲突域中。
*   **交换机 (Switch)**：通过全双工通信和微区段化，交换机的**每个端口都形成一个独立的冲突域**。这意味着连接到不同交换机端口的设备可以同时发送和接收数据而不会发生冲突，大大提高了网络效率。

**广播域 (Broadcast Domain)**：指网络中所有设备都能接收到彼此广播帧的范围。
*   **交换机**：默认情况下，所有连接到同一个交换机（或多个未划分 VLAN 的交换机连接在一起）的设备都位于**同一个广播域**中。广播帧会泛洪到所有端口。
*   **路由器 (Router)**：隔离广播域。每个路由器端口连接的网络都属于一个独立的广播域。
*   **VLAN (虚拟局域网)**：可以在交换机上逻辑地划分广播域，将一个物理交换机划分为多个虚拟交换机。

## 三、交换机的关键特性与技术

现代交换机不仅仅是简单的二层转发设备，还集成了许多高级功能以满足复杂的网络需求。

### 3.1 VLAN (虚拟局域网, Virtual Local Area Network)

*   **定义**：VLAN 是一种将物理上连接在同一台交换机（或多台交换机）上的设备，逻辑上划分为多个独立广播域的技术。不同 VLAN 之间的设备不能直接通信，需要通过路由器进行转发。
*   **作用**：提高网络安全性（隔离不同部门的流量）、降低广播流量、简化网络管理、灵活组网。
*   **原理**：通过在以太网帧中添加 VLAN 标签 (Tagging，如 IEEE 802.1Q) 来标识帧所属的 VLAN。

### 3.2 STP (生成树协议, Spanning Tree Protocol)

*   **定义**：STP (IEEE 802.1D) 是一种用于在以太网交换网络中消除环路，从而防止广播风暴和 MAC 地址表震荡的协议。
*   **作用**：通过阻塞冗余链路，创建无环路的逻辑拓扑，同时提供链路冗余，提高网络的可靠性。
*   **原理**：交换机之间交换 BPDUs (Bridge Protocol Data Units) 来选举根桥 (Root Bridge)，并计算到达根桥的最短路径，阻塞非路径上的冗余端口。
*   **变体**：RSTP (Rapid STP) 提供了更快的收敛速度，MSTP (Multiple STP) 支持基于 VLAN 的多个生成树实例。

### 3.3 LAG (链路聚合组, Link Aggregation Group) / EtherChannel

*   **定义**：将多个物理以太网链路捆绑成一个逻辑链路的技术。
*   **作用**：增加链路带宽（负载均衡）和提高链路冗余（链路故障时流量自动切换到其他成员链路）。
*   **标准**：IEEE 802.3ad (LACP - Link Aggregation Control Protocol)。

### 3.4 PoE (以太网供电, Power over Ethernet)

*   **定义**：PoE 允许以太网交换机通过标准以太网电缆为网络设备（如无线接入点、IP 摄像头、VoIP 电话）提供电力。
*   **作用**：简化布线，降低部署成本，提高部署灵活性。
*   **标准**：IEEE 802.3af (PoE), 802.3at (PoE+), 802.3bt (PoE++)。

### 3.5 QoS (服务质量, Quality of Service)

*   **定义**：QoS 是一系列技术，用于在网络拥塞时优先处理某些类型的网络流量，确保关键应用的性能。
*   **作用**：保证语音、视频等对延迟和带宽敏感的应用有更好的体验。
*   **原理**：通过流量分类、标记、整形、调度等机制实现。

### 3.6 端口镜像 (Port Mirroring) / SPAN (Switched Port Analyzer)

*   **定义**：将一个或多个源端口的流量复制到另一个目的端口，而不影响源端口的正常通信。
*   **作用**：用于网络监控、故障诊断、入侵检测等。

### 3.7 安全特性

*   **端口安全 (Port Security)**：限制每个交换机端口允许学习的 MAC 地址数量，或指定特定 MAC 地址才能访问。
*   **DHCP Snooping**：防止恶意 DHCP 服务器攻击，确保 DHCP 报文的合法性。
*   **ARP Inspection (动态 ARP 检测)**：防止 ARP 欺骗攻击，验证 ARP 请求和响应的合法性。
*   **ACL (访问控制列表, Access Control List)**：基于 MAC 地址、IP 地址、端口号等信息对流量进行过滤和控制。

## 四、交换机的分类

交换机可以根据管理方式、OSI 层级、结构和在网络中的位置进行多种分类。

### 4.1 按管理方式

*   **非网管型交换机 (Unmanaged Switch)**：
    *   **特点**：即插即用，无需任何配置，价格便宜。
    *   **适用场景**：小型家庭网络或办公室，需求简单。
*   **网管型交换机 (Managed Switch)**：
    *   **特点**：提供命令行界面 (CLI)、Web 界面、SNMP 等管理方式，支持 VLAN、QoS、STP 等高级功能。
    *   **适用场景**：中大型企业网络、数据中心，需要精细控制和高级功能。

### 4.2 按 OSI 层级

*   **二层交换机 (Layer 2 Switch)**：
    *   **特点**：基于 MAC 地址转发数据帧，工作在数据链路层。是最常见的交换机类型。
    *   **作用**：隔离冲突域，提供高速帧转发。
*   **三层交换机 (Layer 3 Switch)**：
    *   **特点**：不仅具备二层交换功能，还具备路由功能，能够进行基于 IP 地址的报文转发。
    *   **作用**：在大型局域网中实现不同 VLAN 之间的路由，或作为小型网络的边缘路由器，提供更快的内部路由速度。
*   **多层交换机 (Multilayer Switch)**：
    *   **特点**：能够工作在 OSI 模型更多层（如四层甚至七层），进行更复杂的流量分类和处理（基于 TCP/UDP 端口、应用协议等）。
    *   **作用**：用于更高级的流量管理、负载均衡、应用优化等场景。

### 4.3 按结构

*   **固定配置型交换机 (Fixed-Configuration Switch)**：
    *   **特点**：端口数量、类型以及功能都是固定的，不可扩展。
    *   **适用场景**：成本敏感、端口需求明确的场景。
*   **模块化型交换机 (Modular Switch)**：
    *   **特点**：具有扩展槽，可以通过添加不同功能的模块（如不同端口密度的以太网模块、光纤模块、电源模块）来增加端口数量或功能。
    *   **适用场景**：大型企业网络、数据中心，需要高可扩展性、高密度和灵活性。

### 4.4 按网络层次（三层网络架构）

在大型网络设计中，通常采用三层架构：接入层、汇聚层和核心层。

*   **接入层交换机 (Access Layer Switch)**：
    *   **位置**：直接连接终端设备（PC、服务器、IP 电话、AP）。
    *   **功能**：提供端口密度、PoE、端口安全等功能。
*   **汇聚层交换机 (Distribution Layer Switch)**：
    *   **位置**：连接接入层交换机和核心层交换机，提供接入层设备的二层转发和汇聚，以及三层路由功能。
    *   **功能**：VLAN 间路由、策略路由、ACL、LACP、STP。
*   **核心层交换机 (Core Layer Switch)**：
    *   **位置**：网络的骨干，连接所有汇聚层交换机，提供高速、低延迟的转发通路。
    *   **功能**：高带宽、高可靠性、快速路由交换。

{% mermaid %}
graph TD
    A[核心层交换机] --> B1[汇聚层交换机1]
    A --> B2[汇聚层交换机2]

    B1 --> C1[接入层交换机1]
    B1 --> C2[接入层交换机2]
    B2 --> C3[接入层交换机3]
    B2 --> C4[接入层交换机4]

    C1 --> D1[终端设备A]
    C1 --> D2[终端设备B]
    C2 --> D3[终端设备C]
    C2 --> D4[终端设备D]
    C3 --> D5[终端设备E]
    C4 --> D6[终端设备F]

    subgraph Core Layer
        A
    end

    subgraph Distribution Layer
        B1
        B2
    end

    subgraph Access Layer
        C1
        C2
        C3
        C4
    end

    subgraph End Devices
        D1
        D2
        D3
        D4
        D5
        D6
    end
{% endmermaid %}

## 五、交换机的优势

与早期的集线器相比，交换机带来了显著的优势：

1.  **提高网络性能**：通过隔离冲突域，避免了数据碰撞，每个端口可以独立进行全双工通信，显著提升了局域网的吞吐量和整体性能。
2.  **增强网络安全**：MAC 地址学习和单播转发减少了不必要的流量泛洪，结合 VLAN、端口安全等特性，可以逻辑隔离网络，提高数据安全性。
3.  **灵活的网络管理**：网管型交换机提供了丰富的配置选项，使得网络管理员可以对流量、优先级、带宽等进行精细控制。
4.  **支持高级功能**：VLAN 划分、链路聚合、PoE 供电、QoS 等功能，满足了企业和数据中心日益增长的复杂需求。
5.  **降低网络成本**：虽然单个交换机可能比集线器贵，但其提升的效率和节省的故障排除时间最终会降低总体拥有成本。

## 六、交换机与集线器、路由器的区别

理解交换机，最好将其与集线器和路由器进行对比：

| 特性     | 集线器 (Hub)               | 交换机 (Switch)                    | 路由器 (Router)                    |
| :------- | :------------------------- | :--------------------------------- | :--------------------------------- |
| **OSI 层** | 物理层 (Layer 1)           | 数据链路层 (Layer 2)                 | 网络层 (Layer 3)                   |
| **转发依据** | 无（信号放大）             | MAC 地址                             | IP 地址                              |
| **冲突域** | 单一冲突域（所有端口）     | 每个端口一个独立冲突域             | 每个端口一个独立冲突域             |
| **广播域** | 单一广播域（所有端口）     | 单一广播域（默认，可VLAN划分）     | 每个端口一个独立广播域             |
| **数据单位** | 比特流                     | 数据帧                               | 数据包                               |
| **功能**   | 信号放大与广播             | 智能转发、VLAN、STP、QoS 等          | 路由选择、广域网互连、NAT、防火墙等 |
| **互连对象** | 局域网内设备               | 局域网内设备、多台交换机、路由器   | 广域网、不同IP子网的局域网           |
| **典型应用** | 旧有技术，现代网络极少使用 | 局域网内部连接，构建企业网络骨干   | 连接不同网络、实现互联网访问       |

## 七、应用场景

交换机是现代网络中无处不在的设备，其应用场景极其广泛：

*   **企业局域网**：连接办公室的电脑、服务器、打印机等设备，构建高速、可靠的内部网络。
*   **数据中心**：作为服务器和存储设备之间的高速连接，支持虚拟化和云计算环境。
*   **家庭网络**：当家庭设备较多，需要连接多台电脑、智能电视、游戏机等时，交换机提供额外的有线端口。
*   **监控系统**：PoE 交换机为 IP 摄像头供电并传输视频数据。
*   **无线覆盖**：PoE 交换机为无线 AP (Access Point) 供电并传输数据，构建无线网络。
*   **工业自动化**：工业级交换机在恶劣环境下提供可靠的网络连接。

## 总结

交换机作为局域网的核心连接设备，通过 MAC 地址的智能学习和转发机制，有效地隔离了冲突域，显著提升了网络效率和数据传输速度。其丰富的特性，如 VLAN、STP、LAG、PoE 和 QoS 等，使其能够满足从小型家庭网络到大型企业数据中心等各种复杂场景的需求。理解交换机的工作原理和分类，对于构建、维护和优化现代网络至关重要。