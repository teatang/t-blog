<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>GraphQL 详解 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="GraphQL 是一种由 Facebook 于 2012 年开发并在 2015 年公开发布的 API 查询语言 (Query Language for APIs) 和 运行时 (Runtime)。它为客户端提供了精确指定所需数据结构的能力，并通过一个单一的、强类型定义的模式来描述数据。相较于传统的 RESTful API，GraphQL 旨在更高效、灵活地获取数据，尤其适用于复杂的数据模型和快速">
<meta property="og:type" content="article">
<meta property="og:title" content="GraphQL 详解">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/039944c379a6/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="GraphQL 是一种由 Facebook 于 2012 年开发并在 2015 年公开发布的 API 查询语言 (Query Language for APIs) 和 运行时 (Runtime)。它为客户端提供了精确指定所需数据结构的能力，并通过一个单一的、强类型定义的模式来描述数据。相较于传统的 RESTful API，GraphQL 旨在更高效、灵活地获取数据，尤其适用于复杂的数据模型和快速">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg">
<meta property="article:published_time" content="2024-08-30T22:24:00.000Z">
<meta property="article:modified_time" content="2026-01-29T10:03:28.098Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="前端技术">
<meta property="article:tag" content="2024">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "GraphQL 详解",
  "url": "https://blog.tbf1211.xx.kg/039944c379a6/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg",
  "datePublished": "2024-08-30T22:24:00.000Z",
  "dateModified": "2026-01-29T10:03:28.098Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/039944c379a6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'GraphQL 详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">533</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">229</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">84</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-11.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">GraphQL 详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">GraphQL 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2024-08-30T22:24:00.000Z" title="发表于 2024-08-31 06:24:00">2024-08-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/Web%E6%8A%80%E6%9C%AF/">Web技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>GraphQL</strong> 是一种由 <strong>Facebook</strong> 于 2012 年开发并在 2015 年公开发布的 <strong>API 查询语言 (Query Language for APIs)</strong> 和 <strong>运行时 (Runtime)</strong>。它为客户端提供了精确指定所需数据结构的能力，并通过一个单一的、强类型定义的模式来描述数据。相较于传统的 RESTful API，GraphQL 旨在更高效、灵活地获取数据，尤其适用于复杂的数据模型和快速迭代的前端应用。</p>
</blockquote>
<div class="note info flat"><p><strong>核心思想</strong>：由<strong>客户端决定</strong>需要什么数据，服务端根据客户端的请求<strong>精确地返回</strong>所需数据，不多也不少，从而解决传统 REST API 中常见的 <strong>过请求 (Over-fetching)</strong> 和 <strong>欠请求 (Under-fetching)</strong> 问题。</p>
</div>
<hr>
<h2 id="一、为什么需要-GraphQL？对-REST-API-的挑战"><a href="#一、为什么需要-GraphQL？对-REST-API-的挑战" class="headerlink" title="一、为什么需要 GraphQL？对 REST API 的挑战"></a>一、为什么需要 GraphQL？对 REST API 的挑战</h2><p>传统的 RESTful API 在构建可伸缩和高效率的现代应用时面临一些挑战：</p>
<ol>
<li><strong>过请求 (Over-fetching)</strong>：客户端经常获取到比实际需要更多的数据。例如，当只需要用户的姓名和邮箱时，一个 <code>GET /users/&#123;id&#125;</code> 接口可能返回用户的所有字段，包括地址、创建日期等不必要的信息。这导致带宽浪费和额外的处理开销。</li>
<li><strong>欠请求 (Under-fetching) 与多次请求</strong>：为了获取一个完整页面的数据，客户端可能需要向多个 REST 端点发送请求。例如，获取一篇文章及其作者信息和评论列表，可能需要 <code>GET /articles/&#123;id&#125;</code>、<code>GET /users/&#123;authorId&#125;</code>、<code>GET /articles/&#123;id&#125;/comments</code> 等多个请求。这增加了网络往返时间 (RTT) 和客户端逻辑复杂性。</li>
<li><strong>多端适应性差</strong>：不同的客户端（如 Web、iOS、Android）可能需要相同资源的不同子集。维护多个针对特定客户端的 REST 端点会导致服务端代码重复和复杂性增加。</li>
<li><strong>版本控制复杂</strong>：随着业务发展，API 字段的增删改是常态。传统 REST API 通常通过 URL 版本控制（如 <code>v1</code>, <code>v2</code>）来处理，但这会增加服务端维护成本，并要求客户端适配新的版本。</li>
<li><strong>缺乏清晰的文档</strong>：REST API 的文档通常需要手动维护，容易过时。</li>
</ol>
<p>GraphQL 通过提供一个单一的、可查询的端点和强类型系统来解决这些问题。客户端只需发送一个请求，便可精确地指定所需的数据，服务端则根据请求动态地构建响应。</p>
<h2 id="二、GraphQL-核心概念"><a href="#二、GraphQL-核心概念" class="headerlink" title="二、GraphQL 核心概念"></a>二、GraphQL 核心概念</h2><p>GraphQL 的核心是一套强大的类型系统和一种声明式的数据获取方式。</p>
<h3 id="2-1-Schema-模式"><a href="#2-1-Schema-模式" class="headerlink" title="2.1 Schema (模式)"></a>2.1 Schema (模式)</h3><p>GraphQL API 的核心是它的 <strong>Schema</strong>。Schema 描述了客户端可以查询什么数据、可以修改什么数据以及数据之间的关系。它使用 <strong>GraphQL Schema Definition Language (SDL)</strong> 来定义，是一种强类型、自文档化的契约。</p>
<p><strong>关键点：</strong></p>
<ul>
<li><strong>强类型</strong>：Schema 定义了所有可用的类型和它们之间的字段及关系。</li>
<li><strong>自文档化</strong>：由于其结构化和强类型特性，GraphQL Schema 可以自动生成、提供清晰的 API 文档。</li>
<li><strong>单入口</strong>：一个 GraphQL 服务只有一个端点，所有数据操作都通过该端点进行。</li>
</ul>
<p><strong>示例 (SDL)：</strong></p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个 User 类型</span></span><br><span class="line"><span class="keyword">type</span> User <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="symbol">id</span><span class="punctuation">:</span> ID<span class="punctuation">!</span>         <span class="comment"># ID 类型，! 表示非空</span></span><br><span class="line">  <span class="symbol">name</span><span class="punctuation">:</span> String<span class="punctuation">!</span>   <span class="comment"># String 类型，非空</span></span><br><span class="line">  <span class="symbol">email</span><span class="punctuation">:</span> String</span><br><span class="line">  <span class="symbol">posts</span><span class="punctuation">:</span> <span class="punctuation">[</span>Post<span class="punctuation">!</span><span class="punctuation">]</span>  <span class="comment"># 关联 Post 类型数组，数组元素非空</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个 Post 类型</span></span><br><span class="line"><span class="keyword">type</span> Post <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="symbol">id</span><span class="punctuation">:</span> ID<span class="punctuation">!</span></span><br><span class="line">  <span class="symbol">title</span><span class="punctuation">:</span> String<span class="punctuation">!</span></span><br><span class="line">  <span class="symbol">content</span><span class="punctuation">:</span> String</span><br><span class="line">  <span class="symbol">author</span><span class="punctuation">:</span> User<span class="punctuation">!</span>   <span class="comment"># 关联 User 类型，非空</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Query 类型是所有查询操作的入口点</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">Query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  user<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span> ID<span class="punctuation">!</span><span class="punctuation">)</span><span class="punctuation">:</span> User         <span class="comment"># 根据ID查询单个用户</span></span><br><span class="line">  <span class="symbol">users</span><span class="punctuation">:</span> <span class="punctuation">[</span>User<span class="punctuation">!</span><span class="punctuation">]</span><span class="punctuation">!</span>             <span class="comment"># 查询所有用户</span></span><br><span class="line">  post<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span> ID<span class="punctuation">!</span><span class="punctuation">)</span><span class="punctuation">:</span> Post</span><br><span class="line">  <span class="symbol">posts</span><span class="punctuation">:</span> <span class="punctuation">[</span>Post<span class="punctuation">!</span><span class="punctuation">]</span><span class="punctuation">!</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Mutation 类型是所有数据修改操作的入口点</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">Mutation</span> <span class="punctuation">&#123;</span></span><br><span class="line">  createUser<span class="punctuation">(</span><span class="symbol">name</span><span class="punctuation">:</span> String<span class="punctuation">!</span>, <span class="symbol">email</span><span class="punctuation">:</span> String<span class="punctuation">)</span><span class="punctuation">:</span> User<span class="punctuation">!</span></span><br><span class="line">  createPost<span class="punctuation">(</span><span class="symbol">title</span><span class="punctuation">:</span> String<span class="punctuation">!</span>, <span class="symbol">content</span><span class="punctuation">:</span> String, <span class="symbol">authorId</span><span class="punctuation">:</span> ID<span class="punctuation">!</span><span class="punctuation">)</span><span class="punctuation">:</span> Post<span class="punctuation">!</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-类型系统"><a href="#2-2-类型系统" class="headerlink" title="2.2 类型系统"></a>2.2 类型系统</h3><p>GraphQL 内置了一系列基础类型，并且支持自定义类型。</p>
<ol>
<li><p><strong>Scalar Types (标量类型)</strong>：最原子化的数据类型，不能再分解为更小的部分。</p>
<ul>
<li><code>ID</code>：唯一的标识符，通常序列化为 String。</li>
<li><code>String</code>：UTF-8 字符串。</li>
<li><code>Int</code>：带符号的 32 位整数。</li>
<li><code>Float</code>：带符号的双精度浮点数。</li>
<li><code>Boolean</code>：布尔值 (<code>true</code> 或 <code>false</code>)。</li>
<li>自定义标量类型 (如 <code>Date</code>, <code>JSON</code>)。</li>
</ul>
</li>
<li><p><strong>Object Types (对象类型)</strong>：表示应用程序中的一种对象，包含一组字段。每个字段都有名称和类型。</p>
<ul>
<li>例如 <code>User</code>, <code>Post</code>。</li>
</ul>
</li>
<li><p><strong>List (列表)</strong>：字段可以返回列表类型的数据，用方括号 <code>[]</code> 表示。</p>
<ul>
<li>例如 <code>posts: [Post!]</code> 表示一个非空的 <code>Post</code> 列表，其中每个 <code>Post</code> 也非空。</li>
</ul>
</li>
<li><p><strong>Non-Null (非空)</strong>：用 <code>!</code> 表示字段或列表元素不能为 <code>null</code>。</p>
<ul>
<li>例如 <code>id: ID!</code> 表示 <code>id</code> 字段必须有值。</li>
</ul>
</li>
<li><p><strong>Enum Types (枚举类型)</strong>：特殊标量类型，限制字段只能是预定义值集中的一个。</p>
<ul>
<li><code>enum Role &#123; ADMIN, MEMBER, GUEST &#125;</code></li>
</ul>
</li>
<li><p><strong>Interface Types (接口类型)</strong>：定义一组字段，<strong>实现该接口</strong>的对象类型必须包含这些字段。</p>
<ul>
<li><code>interface Node &#123; id: ID! &#125;</code></li>
<li><code>type User implements Node &#123; id: ID!, name: String! &#125;</code></li>
</ul>
</li>
<li><p><strong>Union Types (联合类型)</strong>：表示某个字段可以返回几种不同的对象类型中的一种。</p>
<ul>
<li><code>union SearchResult = User | Comment | Post</code></li>
</ul>
</li>
<li><p><strong>Input Object Types (输入对象类型)</strong>：用于 Mutation 操作中传递复杂参数。与普通对象类型类似，但其字段不能有参数或引用非输入类型。</p>
<ul>
<li><code>input CreateUserInput &#123; name: String!, email: String &#125;</code></li>
</ul>
</li>
</ol>
<h3 id="2-3-Query-查询"><a href="#2-3-Query-查询" class="headerlink" title="2.3 Query (查询)"></a>2.3 Query (查询)</h3><p>Query 是 GraphQL 中用于<strong>读取数据</strong>的操作。客户端可以指定所需字段的深度和广度。</p>
<ul>
<li><strong>字段选择</strong>：客户端只请求它需要的字段。</li>
<li><strong>嵌套字段</strong>：可以一次性请求相关联的深层数据。</li>
<li><strong>参数</strong>：字段可以接受参数来过滤或排序数据。</li>
<li><strong>别名 (Aliases)</strong>：允许给查询中的字段取不同的名字，解决字段名冲突或进行多次查询。</li>
<li><strong>片段 (Fragments)</strong>：可复用的字段集合，提高查询的可读性和可维护性。</li>
<li><strong>指令 (Directives)</strong>：<code>@include</code> 和 <code>@skip</code>，根据条件包含或跳过某个字段。</li>
</ul>
<h3 id="2-4-Mutation-修改"><a href="#2-4-Mutation-修改" class="headerlink" title="2.4 Mutation (修改)"></a>2.4 Mutation (修改)</h3><p>Mutation 是 GraphQL 中用于<strong>修改数据</strong>的操作，包括创建 (create)、更新 (update) 和删除 (delete)。Mutation 的结构与 Query 类似，但它是有顺序执行的，且通常使用 <strong>Input Object Type</strong> 来传递参数。</p>
<h3 id="2-5-Subscription-订阅"><a href="#2-5-Subscription-订阅" class="headerlink" title="2.5 Subscription (订阅)"></a>2.5 Subscription (订阅)</h3><p>Subscription 是一种特殊类型的操作，用于<strong>实时获取数据更新</strong>。客户端可以订阅某个事件，一旦该事件发生，服务端就会将最新的数据推送到客户端。通常基于 WebSocket 协议实现。</p>
<h3 id="2-6-Resolver-解析器"><a href="#2-6-Resolver-解析器" class="headerlink" title="2.6 Resolver (解析器)"></a>2.6 Resolver (解析器)</h3><p>Resolver 是 GraphQL 服务端的<strong>核心逻辑</strong>。当客户端发送一个 Query 或 Mutation 时，GraphQL 引擎会解析请求，并针对模式中的每个字段调用相应的 Resolver 函数。Resolver 负责从各种数据源（数据库、微服务、文件系统、第三方 API 等）获取实际数据并返回。</p>
<p><strong>例如，对于 <code>Query.user(id: ID!): User</code> 字段，会有一个 <code>user</code> 解析器，它接收 <code>id</code> 参数，然后从数据库中查找对应用户并返回。</strong></p>
<h2 id="三、GraphQL-与-RESTful-API-对比"><a href="#三、GraphQL-与-RESTful-API-对比" class="headerlink" title="三、GraphQL 与 RESTful API 对比"></a>三、GraphQL 与 RESTful API 对比</h2><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">GraphQL</th>
<th align="left">RESTful API</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>数据获取</strong></td>
<td align="left">客户端精确指定，单次请求获取多资源</td>
<td align="left">通常固定结构，可能需要多次请求获取相关资源</td>
</tr>
<tr>
<td align="left"><strong>端点数量</strong></td>
<td align="left">单一端点 (<code>/graphql</code>)</td>
<td align="left">多个端点，每个资源通常对应一个 URL (e.g., <code>/users</code>, <code>/posts</code>)</td>
</tr>
<tr>
<td align="left"><strong>数据结构</strong></td>
<td align="left">强类型 Schema，自文档化</td>
<td align="left">弱类型，通常通过 Swagger&#x2F;OpenAPI 文档描述</td>
</tr>
<tr>
<td align="left"><strong>版本控制</strong></td>
<td align="left">通过修改 Schema 演进，客户端可选择不请求新字段</td>
<td align="left">通常通过 URL 版本号 (<code>/v1</code>, <code>/v2</code>)</td>
</tr>
<tr>
<td align="left"><strong>过&#x2F;欠请求</strong></td>
<td align="left">不存在，精确获取所需数据</td>
<td align="left">普遍存在过请求和欠请求</td>
</tr>
<tr>
<td align="left"><strong>实时性</strong></td>
<td align="left">内置 Subscription 支持实时数据</td>
<td align="left">通常通过 WebSockets 或 SSE 独立实现</td>
</tr>
<tr>
<td align="left"><strong>HTTP 方法</strong></td>
<td align="left">通常使用 HTTP POST 请求</td>
<td align="left">充分利用 HTTP 方法 (GET, POST, PUT, DELETE, PATCH)</td>
</tr>
<tr>
<td align="left"><strong>缓存</strong></td>
<td align="left">客户端&#x2F;应用级缓存，HTTP 缓存较少利用</td>
<td align="left">充分利用 HTTP 缓存 (状态码，ETag 等)</td>
</tr>
<tr>
<td align="left"><strong>学习曲线</strong></td>
<td align="left">相对较陡峭，需要理解 Schema 和 Resolver</td>
<td align="left">相对平缓，遵循通用 HTTP 协议</td>
</tr>
<tr>
<td align="left"><strong>生态系统</strong></td>
<td align="left">发展迅速，但相对年轻 (Apollo, Relay)</td>
<td align="left">成熟，工具链丰富</td>
</tr>
</tbody></table>
<h2 id="四、GraphQL-操作示例"><a href="#四、GraphQL-操作示例" class="headerlink" title="四、GraphQL 操作示例"></a>四、GraphQL 操作示例</h2><p>为了演示，我们使用 Python 及其 <code>graphene</code> 库来构建一个简单的 GraphQL 服务。</p>
<h3 id="4-1-定义-GraphQL-类型和-Schema-Python"><a href="#4-1-定义-GraphQL-类型和-Schema-Python" class="headerlink" title="4.1 定义 GraphQL 类型和 Schema (Python)"></a>4.1 定义 GraphQL 类型和 Schema (Python)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> graphene</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 User 类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(graphene.ObjectType):</span><br><span class="line">    <span class="built_in">id</span> = graphene.ID()</span><br><span class="line">    name = graphene.String()</span><br><span class="line">    email = graphene.String()</span><br><span class="line">    <span class="comment"># 假设 Post 类型稍后定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 Post 类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Post</span>(graphene.ObjectType):</span><br><span class="line">    <span class="built_in">id</span> = graphene.ID()</span><br><span class="line">    title = graphene.String()</span><br><span class="line">    content = graphene.String()</span><br><span class="line">    author = graphene.Field(User) <span class="comment"># 关联 User 类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟数据源</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Database</span>:</span><br><span class="line">    users = &#123;</span><br><span class="line">        <span class="string">&quot;1&quot;</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;alice@example.com&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;2&quot;</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;bob@example.com&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    posts = &#123;</span><br><span class="line">        <span class="string">&quot;101&quot;</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;101&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;My First Post&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Hello World!&quot;</span>, <span class="string">&quot;author_id&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;102&quot;</span>: &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;102&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;GraphQL Basics&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Learning GraphQL...&quot;</span>, <span class="string">&quot;author_id&quot;</span>: <span class="string">&quot;2&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Resolver for Post.author</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resolve_post_author</span>(<span class="params">self, post</span>):</span><br><span class="line">        author_id = post[<span class="string">&quot;author_id&quot;</span>]</span><br><span class="line">        user_data = <span class="variable language_">self</span>.users.get(author_id)</span><br><span class="line">        <span class="keyword">return</span> User(**user_data) <span class="keyword">if</span> user_data <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Resolver for Query.user and Query.users</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">self, <span class="built_in">id</span></span>):</span><br><span class="line">        user_data = <span class="variable language_">self</span>.users.get(<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">return</span> User(**user_data) <span class="keyword">if</span> user_data <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_all_users</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> [User(**u) <span class="keyword">for</span> u <span class="keyword">in</span> <span class="variable language_">self</span>.users.values()]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Resolver for Query.post and Query.posts</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_post</span>(<span class="params">self, <span class="built_in">id</span></span>):</span><br><span class="line">        post_data = <span class="variable language_">self</span>.posts.get(<span class="built_in">id</span>)</span><br><span class="line">        <span class="keyword">if</span> post_data:</span><br><span class="line">            <span class="comment"># Inject resolver to handle author field</span></span><br><span class="line">            post_obj = Post(**post_data)</span><br><span class="line">            post_obj.author = <span class="variable language_">self</span>.resolve_post_author(post_data)</span><br><span class="line">            <span class="keyword">return</span> post_obj</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_all_posts</span>(<span class="params">self</span>):</span><br><span class="line">        posts_list = []</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> <span class="variable language_">self</span>.posts.values():</span><br><span class="line">            post_obj = Post(**p)</span><br><span class="line">            post_obj.author = <span class="variable language_">self</span>.resolve_post_author(p) <span class="comment"># Assign author here (simplified)</span></span><br><span class="line">            posts_list.append(post_obj)</span><br><span class="line">        <span class="keyword">return</span> posts_list</span><br><span class="line"></span><br><span class="line">db = Database()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 Query 类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Query</span>(graphene.ObjectType):</span><br><span class="line">    user = graphene.Field(User, <span class="built_in">id</span>=graphene.ID(required=<span class="literal">True</span>))</span><br><span class="line">    users = graphene.<span class="type">List</span>(User)</span><br><span class="line">    post = graphene.Field(Post, <span class="built_in">id</span>=graphene.ID(required=<span class="literal">True</span>))</span><br><span class="line">    posts = graphene.<span class="type">List</span>(Post)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resolve_user</span>(<span class="params">root, info, <span class="built_in">id</span></span>):</span><br><span class="line">        <span class="keyword">return</span> db.get_user(<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resolve_users</span>(<span class="params">root, info</span>):</span><br><span class="line">        <span class="keyword">return</span> db.get_all_users()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resolve_post</span>(<span class="params">root, info, <span class="built_in">id</span></span>):</span><br><span class="line">        <span class="keyword">return</span> db.get_post(<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">resolve_posts</span>(<span class="params">root, info</span>):</span><br><span class="line">        <span class="keyword">return</span> db.get_all_posts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 Mutation 类型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateUser</span>(graphene.Mutation):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Arguments</span>:</span><br><span class="line">        name = graphene.String(required=<span class="literal">True</span>)</span><br><span class="line">        email = graphene.String()</span><br><span class="line"></span><br><span class="line">    Output = User</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mutate</span>(<span class="params">root, info, name, email=<span class="literal">None</span></span>):</span><br><span class="line">        new_id = <span class="built_in">str</span>(<span class="built_in">len</span>(db.users) + <span class="number">1</span>)</span><br><span class="line">        user_data = &#123;<span class="string">&quot;id&quot;</span>: new_id, <span class="string">&quot;name&quot;</span>: name, <span class="string">&quot;email&quot;</span>: email&#125;</span><br><span class="line">        db.users[new_id] = user_data</span><br><span class="line">        <span class="keyword">return</span> User(**user_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mutation</span>(graphene.ObjectType):</span><br><span class="line">    create_user = CreateUser.Field()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建 Schema</span></span><br><span class="line">schema = graphene.Schema(query=Query, mutation=Mutation)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实际应用中，可以通过一个HTTP接口暴露这个schema</span></span><br><span class="line"><span class="comment"># from flask import Flask, request</span></span><br><span class="line"><span class="comment"># from flask_graphql import GraphQLView</span></span><br><span class="line"><span class="comment"># app = Flask(__name__)</span></span><br><span class="line"><span class="comment"># app.add_url_rule(</span></span><br><span class="line"><span class="comment">#     &#x27;/graphql&#x27;,</span></span><br><span class="line"><span class="comment">#     view_func=GraphQLView.as_view(&#x27;graphql&#x27;, schema=schema, graphiql=True) # graphiql=True 提供一个交互式IDE</span></span><br><span class="line"><span class="comment"># )</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-Query-示例"><a href="#4-2-Query-示例" class="headerlink" title="4.2 Query 示例"></a>4.2 Query 示例</h3><p><strong>1. 查询所有用户，只获取 <code>id</code> 和 <code>name</code>：</strong></p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> <span class="punctuation">&#123;</span></span><br><span class="line">  users <span class="punctuation">&#123;</span></span><br><span class="line">    id</span><br><span class="line">    name</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>模拟客户端请求 (HTTP POST):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://localhost:5000/graphql&quot;</span> <span class="comment"># 假设GraphQL服务运行在5000端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Query</span></span><br><span class="line">query_all_users = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">query &#123;</span></span><br><span class="line"><span class="string">  users &#123;</span></span><br><span class="line"><span class="string">    id</span></span><br><span class="line"><span class="string">    name</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">response = requests.post(url, json=&#123;<span class="string">&quot;query&quot;</span>: query_all_users&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Query All Users Response:&quot;</span>, json.dumps(response.json(), indent=<span class="number">2</span>))</span><br><span class="line"><span class="comment"># Example Output (actual server needed to run):</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   &quot;data&quot;: &#123;</span></span><br><span class="line"><span class="comment">#     &quot;users&quot;: [</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         &quot;id&quot;: &quot;1&quot;,</span></span><br><span class="line"><span class="comment">#         &quot;name&quot;: &quot;Alice&quot;</span></span><br><span class="line"><span class="comment">#       &#125;,</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         &quot;id&quot;: &quot;2&quot;,</span></span><br><span class="line"><span class="comment">#         &quot;name&quot;: &quot;Bob&quot;</span></span><br><span class="line"><span class="comment">#       &#125;</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>2. 查询特定用户及其所有文章的标题和作者姓名：</strong></p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">query</span> GetUserAndPosts <span class="punctuation">&#123;</span></span><br><span class="line">  user<span class="punctuation">(</span><span class="symbol">id</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id</span><br><span class="line">    name</span><br><span class="line">    email</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  posts <span class="punctuation">&#123;</span></span><br><span class="line">    id</span><br><span class="line">    title</span><br><span class="line">    author <span class="punctuation">&#123;</span></span><br><span class="line">      name</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>模拟客户端请求 (HTTP POST):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://localhost:5000/graphql&quot;</span> <span class="comment"># 假设GraphQL服务运行在5000端口</span></span><br><span class="line"></span><br><span class="line">query_user_and_posts = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">query GetUserAndPosts &#123;</span></span><br><span class="line"><span class="string">  user(id: &quot;1&quot;) &#123;</span></span><br><span class="line"><span class="string">    id</span></span><br><span class="line"><span class="string">    name</span></span><br><span class="line"><span class="string">    email</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  posts &#123;</span></span><br><span class="line"><span class="string">    id</span></span><br><span class="line"><span class="string">    title</span></span><br><span class="line"><span class="string">    author &#123;</span></span><br><span class="line"><span class="string">      name</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">response = requests.post(url, json=&#123;<span class="string">&quot;query&quot;</span>: query_user_and_posts&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nQuery User and Posts Response:&quot;</span>, json.dumps(response.json(), indent=<span class="number">2</span>))</span><br><span class="line"><span class="comment"># Example Output:</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   &quot;data&quot;: &#123;</span></span><br><span class="line"><span class="comment">#     &quot;user&quot;: &#123;</span></span><br><span class="line"><span class="comment">#       &quot;id&quot;: &quot;1&quot;,</span></span><br><span class="line"><span class="comment">#       &quot;name&quot;: &quot;Alice&quot;,</span></span><br><span class="line"><span class="comment">#       &quot;email&quot;: &quot;alice@example.com&quot;</span></span><br><span class="line"><span class="comment">#     &#125;,</span></span><br><span class="line"><span class="comment">#     &quot;posts&quot;: [</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         &quot;id&quot;: &quot;101&quot;,</span></span><br><span class="line"><span class="comment">#         &quot;title&quot;: &quot;My First Post&quot;,</span></span><br><span class="line"><span class="comment">#         &quot;author&quot;: &#123;</span></span><br><span class="line"><span class="comment">#           &quot;name&quot;: &quot;Alice&quot;</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;,</span></span><br><span class="line"><span class="comment">#       &#123;</span></span><br><span class="line"><span class="comment">#         &quot;id&quot;: &quot;102&quot;,</span></span><br><span class="line"><span class="comment">#         &quot;title&quot;: &quot;GraphQL Basics&quot;,</span></span><br><span class="line"><span class="comment">#         &quot;author&quot;: &#123;</span></span><br><span class="line"><span class="comment">#           &quot;name&quot;: &quot;Bob&quot;</span></span><br><span class="line"><span class="comment">#         &#125;</span></span><br><span class="line"><span class="comment">#       &#125;</span></span><br><span class="line"><span class="comment">#     ]</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-Mutation-示例"><a href="#4-3-Mutation-示例" class="headerlink" title="4.3 Mutation 示例"></a>4.3 Mutation 示例</h3><p><strong>1. 创建一个新用户：</strong></p>
<figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mutation</span> CreateNewUser <span class="punctuation">&#123;</span></span><br><span class="line">  createUser<span class="punctuation">(</span><span class="symbol">name</span><span class="punctuation">:</span> <span class="string">&quot;Charlie&quot;</span>, <span class="symbol">email</span><span class="punctuation">:</span> <span class="string">&quot;charlie@example.com&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    id</span><br><span class="line">    name</span><br><span class="line">    email</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>模拟客户端请求 (HTTP POST):</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://localhost:5000/graphql&quot;</span> <span class="comment"># 假设GraphQL服务运行在5000端口</span></span><br><span class="line"></span><br><span class="line">mutation_create_user = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">mutation CreateNewUser &#123;</span></span><br><span class="line"><span class="string">  createUser(name: &quot;Charlie&quot;, email: &quot;charlie@example.com&quot;) &#123;</span></span><br><span class="line"><span class="string">    id</span></span><br><span class="line"><span class="string">    name</span></span><br><span class="line"><span class="string">    email</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">response = requests.post(url, json=&#123;<span class="string">&quot;query&quot;</span>: mutation_create_user&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nMutation Create User Response:&quot;</span>, json.dumps(response.json(), indent=<span class="number">2</span>))</span><br><span class="line"><span class="comment"># Example Output:</span></span><br><span class="line"><span class="comment"># &#123;</span></span><br><span class="line"><span class="comment">#   &quot;data&quot;: &#123;</span></span><br><span class="line"><span class="comment">#     &quot;createUser&quot;: &#123;</span></span><br><span class="line"><span class="comment">#       &quot;id&quot;: &quot;3&quot;,</span></span><br><span class="line"><span class="comment">#       &quot;name&quot;: &quot;Charlie&quot;,</span></span><br><span class="line"><span class="comment">#       &quot;email&quot;: &quot;charlie@example.com&quot;</span></span><br><span class="line"><span class="comment">#     &#125;</span></span><br><span class="line"><span class="comment">#   &#125;</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-4-GraphQL-请求流程图"><a href="#4-4-GraphQL-请求流程图" class="headerlink" title="4.4 GraphQL 请求流程图"></a>4.4 GraphQL 请求流程图</h3><div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    sequenceDiagram
    participant Client
    participant GraphQL_Server as GraphQL Server (Schema, Resolvers)
    participant Data_Sources as Data Sources (DB, REST, Microservices)

    Client-&gt;&gt;GraphQL_Server: 1. 发送 GraphQL Query&#x2F;Mutation (HTTP POST &#x2F;graphql)
    GraphQL_Server-&gt;&gt;GraphQL_Server: 2. 解析 Query&#x2F;Mutation 和验证请求
    GraphQL_Server-&gt;&gt;GraphQL_Server: 3. 根据 Schema 匹配相应的 Resolver
    loop For each field in the query
        GraphQL_Server-&gt;&gt;Data_Sources: 4. 调用 Resolver 获取数据
        Data_Sources--&gt;&gt;GraphQL_Server: 5. 返回字段数据
    end
    GraphQL_Server-&gt;&gt;GraphQL_Server: 6. 聚合所有数据，构建符合请求结构的结果
    GraphQL_Server--&gt;&gt;Client: 7. 返回 JSON 格式的数据
  </pre></div>

<h2 id="五、GraphQL-的优缺点与适用场景"><a href="#五、GraphQL-的优缺点与适用场景" class="headerlink" title="五、GraphQL 的优缺点与适用场景"></a>五、GraphQL 的优缺点与适用场景</h2><h3 id="5-1-优点："><a href="#5-1-优点：" class="headerlink" title="5.1 优点："></a>5.1 优点：</h3><ol>
<li><strong>精确数据获取 (No Over-fetching&#x2F;Under-fetching)</strong>：客户端只获取所需数据，节省带宽，提高传输效率。</li>
<li><strong>减少请求次数</strong>：通过一个请求获取多个相关资源，减少 RTT。</li>
<li><strong>强大的类型系统</strong>：Schema 提供了严格的数据契约和自动生成文档，便于开发和团队协作。</li>
<li><strong>接口易于演进</strong>：通过修改 Schema 即可在不破坏现有客户端的情况下添加新字段或类型，无需版本控制。</li>
<li><strong>前端开发效率高</strong>：客户端可以自由组合查询，无需等待后端修改接口。</li>
<li><strong>聚合数据能力</strong>：轻松从多个后端服务或数据库聚合数据。</li>
<li><strong>实时数据 (Subscriptions)</strong>：内置对实时推送的支持。</li>
</ol>
<h3 id="5-2-缺点："><a href="#5-2-缺点：" class="headerlink" title="5.2 缺点："></a>5.2 缺点：</h3><ol>
<li><strong>更高的学习曲线</strong>：对于不熟悉的数据处理模式，GQL 的概念和工具链需要一定学习成本。</li>
<li><strong>缓存复杂性</strong>：传统 RESTful API 可以利用 HTTP 缓存机制（GET 请求、状态码、ETag等），而 GraphQL 的请求通常是 POST 且每次内容不同，难以直接利用 HTTP 缓存。需要自定义客户端缓存方案（如 Apollo 缓存）。</li>
<li><strong>文件上传处理</strong>：GraphQL 标准本身不直接支持文件上传，需要依赖multipart&#x2F;form-data等额外方案。</li>
<li><strong>性能优化挑战 (N+1 问题)</strong>：如果 Resolver 未经优化，对嵌套字段的查询可能导致大量数据库查询（N+1 问题）。需要 DataLoader 等工具来批量处理。</li>
<li><strong>服务端复杂性增加</strong>：需要实现复杂的解析器来处理来自各种数据源的数据。</li>
<li><strong>Rate Limiting 和安全</strong>：由于查询的灵活性，需要更精细的查询深度&#x2F;复杂度限制机制来防范 DoS 攻击。</li>
</ol>
<h3 id="5-3-适用场景："><a href="#5-3-适用场景：" class="headerlink" title="5.3 适用场景："></a>5.3 适用场景：</h3><ul>
<li><strong>复杂的数据模型</strong>：当数据源众多、关系复杂，且前端需要多样化的数据组合时。</li>
<li><strong>移动应用和单页应用 (SPA)</strong>：需要高度优化的数据加载，减少网络请求和带宽消耗。</li>
<li><strong>微服务架构的聚合层</strong>：作为前端和多个微服务之间的中间层，将数据聚合为一个统一的 API。</li>
<li><strong>快速迭代的项目</strong>：前端需求变化频繁，GQL 可以让前端开发更独立，减少前后端沟通成本。</li>
<li><strong>公共数据提供 (API Gateway)</strong>：为多个消费者提供对外统一的数据访问接口。</li>
</ul>
<p><strong>不适用场景：</strong></p>
<ul>
<li><strong>简单 API 或 CRUD 需求</strong>：如果数据结构非常扁平，且客户端需求固定，REST API 可能更简单高效。</li>
<li><strong>不希望引入新概念到团队</strong>：如果团队对 GQL 不熟悉且没有长期投入计划。</li>
</ul>
<h2 id="六、安全性考虑"><a href="#六、安全性考虑" class="headerlink" title="六、安全性考虑"></a>六、安全性考虑</h2><p>尽管 GraphQL 提供了强大的数据查询能力，但在安全性方面也需要特别关注：</p>
<ol>
<li><strong>认证与授权</strong>：GraphQL 本身不提供身份认证和授权机制，需要与常规的认证系统（如 JWT、OAuth2）结合。在 Resolver 层进行权限检查是最佳实践。</li>
<li><strong>查询深度与复杂度限制</strong>：恶意的或不优化的查询可能导致服务器资源耗尽。<ul>
<li><strong>深度限制 (Depth Limiting)</strong>：限制查询的最大嵌套层级。</li>
<li><strong>复杂度限制 (Complexity Limiting)</strong>：为每个字段分配一个“成本”，并限制总成本。</li>
</ul>
</li>
<li><strong>数据过滤与验证</strong>：确保客户端提供的输入数据符合预期，防止 SQL 注入、XSS 等攻击。</li>
<li><strong>错误处理</strong>：提供有意义但不泄露敏感信息的错误消息。</li>
<li><strong>HTTPS&#x2F;SSL</strong>：所有 GraphQL 通信都应通过 HTTPS 进行加密，防止数据在传输过程中被窃听。</li>
<li><strong>日志与监控</strong>：记录 GraphQL 请求和响应，以便审计和故障排除。</li>
<li><strong>敏感信息披露</strong>：避免在 schema 或错误消息中无意中暴露敏感的后端结构或数据。</li>
</ol>
<h2 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a>七、总结</h2><p>GraphQL 是一种强大且灵活的 API 技术，它通过赋予客户端对数据查询的更大控制权，解决了传统 REST API 在数据获取效率和多端适应性方面的诸多挑战。它特别适合需要复杂数据模型、快速迭代和优化的现代 Web 及移动应用。然而，采用 GraphQL 也意味着需要解决缓存、性能优化和安全方面的新挑战。仔细评估项目需求和团队能力，是决定采用 GraphQL 的关键。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/039944c379a6/">https://blog.tbf1211.xx.kg/039944c379a6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><a class="post-meta__tags" href="/tags/2024/">2024</a><a class="post-meta__tags" href="/tags/API/">API</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/33b687b11065/" title="GoLang gRPC 详解：构建高性能、跨语言的微服务"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-19.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">GoLang gRPC 详解：构建高性能、跨语言的微服务</div></div><div class="info-2"><div class="info-item-1"> Golang (Go) 因其并发特性、高效的运行时和优秀的网络编程能力，成为开发高性能后端服务，特别是微服务和 RPC 服务的热门选择。gRPC 作为 Google 主导的 RPC 框架，与 Go 语言有着天然的契合。本文将详细介绍如何使用 Go 语言开发 gRPC 项目，包括环境搭建、.proto 文件定义、代码生成、客户端与服务器实现，以及高级特性。  前置条件： 读者需要对 Go 语言有基本的了解，并已安装 Go 开发环境。   一、环境准备在开始 Go gRPC 项目开发之前，需要安装以下工具：  Go 语言环境：确保 Go 已正确安装，并配置好 GOPATH 和 GOROOT。1go version Protobuf 编译器 (protoc)：用于将 .proto 文件编译成 Go 代码。 下载地址：Protocol Buffers GitHub Releases 根据操作系统下载对应版本，解压后将 bin 目录添加到系统 PATH 环境变量中。 验证安装：1protoc --version   Go gRPC 插件：用于 protoc 生成 Go 语言的 gRPC ...</div></div></div></a><a class="pagination-related" href="/d70d4a8192e7/" title="椭圆曲线密码学 (ECC) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-23.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">椭圆曲线密码学 (ECC) 详解</div></div><div class="info-2"><div class="info-item-1"> 椭圆曲线密码学 (Elliptic Curve Cryptography, ECC) 是一种基于椭圆曲线数学理论的公钥加密算法 (Public-Key Cryptosystem)。它提供了一种替代传统 RSA 和 Diffie-Hellman 的强大加密方法，其核心优势在于在更短的密钥长度下提供同等或更高的安全强度。ECC 的安全性基于椭圆曲线离散对数问题 (Elliptic Curve Discrete Logarithm Problem, ECDLP) 的计算复杂性。  核心思想：利用椭圆曲线上的点运算构建单向函数，使得正向计算容易，逆向计算（ECDLP）困难，从而实现非对称加密。   一、为什么需要 ECC？传统的公钥密码算法如 RSA 和 Diffie-Hellman 的安全性基于大整数分解问题 (FIP) 和离散对数问题 (DLP)。随着计算能力的提升，为了维持相同的安全级别，RSA 和 DH 的密钥长度需要不断增加（例如，从 1024 位到 2048 位，再到 3072 位）。这会带来以下问题：  性能开销：更长的密钥意味着更复杂的数学运算，导致加密、解密和签名验证...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/3286b8aa1630/" title="The Elm Architecture (TEA) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-30</div><div class="info-item-2">The Elm Architecture (TEA) 详解</div></div><div class="info-2"><div class="info-item-1"> The Elm Architecture (TEA) 是一种用于构建交互式 Web 应用程序的函数式架构模式。它最初由 Elm 语言社区设计和推广，但其核心思想和模式因其可预测性、可测试性和易于理解性而非常成功，并被广泛借鉴和应用于其他前端框架和语言，如 React (特别是 Redux)、Vue (Vuex)、ReasonML (Redux-Like)、甚至 Swift (The Composable Architecture) , Rust (Relm) 和 Golang (bubbletea) 等。  核心思想：将应用程序状态、状态更新逻辑和 UI 渲染逻辑清晰地分离为三个核心部分：Model、Update 和 View，并通过一个单向数据流进行管理。   一、为什么需要 The Elm Architecture？在传统的命令式或面向对象编程中，UI 应用程序的状态管理往往是复杂且容易出错的部分：  状态分散：应用程序状态可能散布在各个组件中，难以追踪和同步。 多向数据流：数据可以在组件之间以多种方式流动，导致难以预测状态变化。 调试困难：当出现 bug 时，很难确定是哪...</div></div></div></a><a class="pagination-related" href="/eb25fa9967e4/" title="FiraCode字体实用教程"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-14</div><div class="info-item-2">FiraCode字体实用教程</div></div><div class="info-2"><div class="info-item-1"> 在编程和文本编辑领域，字体的选择对于开发者来说至关重要。一款优秀的编程字体不仅能提供良好的可读性，还能提升编码体验。其中，Fira Code 以其独特的字形连字 (Typographic Ligatures) 特性，在开发者社区中广受欢迎，成为许多程序员的首选。  核心思想：Fira Code 是一款基于 Mozilla 开发的 Fira Mono 等宽字体，它最大的特点是为编程中常见的字符序列（如 -&gt;, =&gt;, ==, !== 等）提供了美观的、语义化的字形连字（ligatures）。这些连字将多个字符组合成一个更具可读性和视觉统一性的符号，从而改善代码的可读性和美观性。   一、Fira Code 简介 项目起源: Fira Code 是基于 Mozilla 的 Fira Mono 字体开发而来的。Fira Mono 是一款优秀且可读性强的等宽字体，Fira Code 在此基础上增加了连字特性。 等宽字体: 作为一款编程字体，Fira Code 是等宽的 (Monospaced)，这意味着所有字符（包括空格）占据相同的宽度，这对于代码对齐和避免视觉混乱至关重要...</div></div></div></a><a class="pagination-related" href="/5d69a3774b10/" title="Node.js worker_threads 模块详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-08.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-19</div><div class="info-item-2">Node.js worker_threads 模块详解</div></div><div class="info-2"><div class="info-item-1"> Node.js 的 worker_threads 模块 允许开发者在 Node.js 应用程序中创建真正的多线程。传统上，Node.js 是单线程的，其事件循环处理 I&#x2F;O 密集型任务非常高效，但在面对 CPU 密集型任务时，单线程模型会导致事件循环阻塞，从而影响应用程序的响应性。worker_threads 模块正是为了解决这一痛点而引入的，它使得 Node.js 能够更好地利用多核 CPU 资源，执行并行计算，而不会阻塞主事件循环。  核心思想：将 CPU 密集型任务从主线程卸载到独立的 Worker 线程中执行，从而防止主事件循环被阻塞，保持应用程序的响应性和吞吐量。 每个 Worker 线程拥有独立的 V8 实例、事件循环和内存空间，通过消息传递进行通信。   一、为什么需要 worker_threads？Node.js 以其非阻塞 I&#x2F;O 模型而闻名，这得益于其单线程的事件循环。对于网络请求、文件读写等 I&#x2F;O 密集型操作，Node.js 可以通过异步回调或 Promise 迅速处理大量并发请求。然而，这种模型在处理以下情况时会遇到瓶颈：...</div></div></div></a><a class="pagination-related" href="/2d02d2ae2866/" title="PostCSS详解：一个用JavaScript转换CSS的工具"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-06.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-18</div><div class="info-item-2">PostCSS详解：一个用JavaScript转换CSS的工具</div></div><div class="info-2"><div class="info-item-1"> PostCSS 是一个使用 JavaScript 工具和插件来转换 CSS 代码的平台。它本身不是一个 CSS 预处理器（如 Sass、Less），也不是一个 CSS 后处理器，而是一个CSS 处理引擎。它的强大之处在于其插件生态系统，能够让你根据需求自定义 CSS 的转换流程。  PostCSS 的核心理念：提供 CSS 的 AST (Abstract Syntax Tree)，让开发者可以通过插件以 JavaScript 的强大能力处理 CSS。   一、什么是 PostCSS？想象一下，你有一个工具箱，里面有各种功能不同的螺丝刀、扳手、锤子。PostCSS 就是这个工具箱本身，它提供了一个开放的结构，你可以往里面放各种插件（工具）。每个插件都负责一个特定的任务，比如给 CSS 属性自动添加浏览器前缀、将未来的 CSS 语法转换为当前可用的语法、优化 CSS 代码等等。 PostCSS 的工作流程大致如下：  解析 (Parse)：PostCSS 接收原始 CSS 代码字符串。 生成 AST (Abstract Syntax Tree)：将 CSS 代码解析成一个抽象语法树...</div></div></div></a><a class="pagination-related" href="/137d1f5d80b7/" title="CSS 单位详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-16.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-18</div><div class="info-item-2">CSS 单位详解</div></div><div class="info-2"><div class="info-item-1"> 在 CSS (Cascading Style Sheets) 中，单位是用来指定数值大小或尺寸的关键部分。无论是设置字体大小、元素宽度、边距还是动画时长，都需要使用合适的单位。CSS 提供了多种单位类型，它们可以分为两大类：绝对单位 和 相对单位。理解这些单位及其适用场景对于构建响应式、可维护的 Web 界面至关重要。  核心思想：CSS 单位是用来量化样式的尺寸或数值，分为绝对单位（如 px, pt）和相对单位（如 em, rem, %, vw, vh）。合理选择和使用这些单位，是实现响应式设计、确保界面在不同设备和上下文下表现一致的关键。   一、绝对单位 (Absolute Length Units)绝对单位表示一个固定的物理量，其大小不会受到视口、父元素字体大小或其他环境因素的影响。它们在不同设备上理论上保持相同大小（物理尺寸），但在屏幕上可能会因为屏幕 DPI (Dots Per Inch) 不同而视觉效果有所差异。 1.1 px (Pixels) 定义：一个像素点。这是 Web 开发中最常用的单位。 特性： 在 CSS 中，px 是一个逻辑像素，不一定对应屏幕上的一...</div></div></div></a><a class="pagination-related" href="/549d8932b3c5/" title="CSS 函数详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-32.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-20</div><div class="info-item-2">CSS 函数详解</div></div><div class="info-2"><div class="info-item-1"> 在 CSS 中，函数允许我们在样式表中执行计算、变换、引用值或生成特定效果，而不仅仅是使用静态的颜色或数值。它们为 CSS 带来了更强大的动态性和灵活性，使得响应式设计、复杂布局和动画效果的实现变得更加简洁和高效。理解和掌握 CSS 函数是成为高级前端开发者的关键一步。  核心思想：CSS 函数是内置的或用户定义的指令，用于在样式表中执行计算、转换、引用值或生成特定效果，从而增加 CSS 的动态性和灵活性。它们可以接受参数，并返回一个 CSS 值，是实现复杂样式和响应式设计的强大工具。   一、CSS 函数的分类CSS 函数可以大致分为以下几类：  数学函数 (Mathematical Functions)：用于执行算术运算，如 calc()。 转换函数 (Transform Functions)：用于对元素进行 2D 或 3D 转换，如 translate(), rotate(), scale()。 颜色函数 (Color Functions)：用于定义或操作颜色，如 rgb(), hsl(), rgba(), hsla(), color-mix()。 渐变函数 (Gradi...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">533</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">229</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">84</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-GraphQL%EF%BC%9F%E5%AF%B9-REST-API-%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-text">一、为什么需要 GraphQL？对 REST API 的挑战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81GraphQL-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">二、GraphQL 核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Schema-%E6%A8%A1%E5%BC%8F"><span class="toc-text">2.1 Schema (模式)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.2 类型系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Query-%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.3 Query (查询)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Mutation-%E4%BF%AE%E6%94%B9"><span class="toc-text">2.4 Mutation (修改)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Subscription-%E8%AE%A2%E9%98%85"><span class="toc-text">2.5 Subscription (订阅)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-Resolver-%E8%A7%A3%E6%9E%90%E5%99%A8"><span class="toc-text">2.6 Resolver (解析器)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81GraphQL-%E4%B8%8E-RESTful-API-%E5%AF%B9%E6%AF%94"><span class="toc-text">三、GraphQL 与 RESTful API 对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81GraphQL-%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B"><span class="toc-text">四、GraphQL 操作示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%9A%E4%B9%89-GraphQL-%E7%B1%BB%E5%9E%8B%E5%92%8C-Schema-Python"><span class="toc-text">4.1 定义 GraphQL 类型和 Schema (Python)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Query-%E7%A4%BA%E4%BE%8B"><span class="toc-text">4.2 Query 示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-Mutation-%E7%A4%BA%E4%BE%8B"><span class="toc-text">4.3 Mutation 示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-GraphQL-%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-text">4.4 GraphQL 请求流程图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81GraphQL-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%E4%B8%8E%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">五、GraphQL 的优缺点与适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-text">5.1 优点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-text">5.2 缺点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-text">5.3 适用场景：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91"><span class="toc-text">六、安全性考虑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">七、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/5341a0037256/" title="CSS-in-JS 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-02.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS-in-JS 详解"/></a><div class="content"><a class="title" href="/5341a0037256/" title="CSS-in-JS 详解">CSS-in-JS 详解</a><time datetime="2026-01-25T22:24:00.000Z" title="发表于 2026-01-26 06:24:00">2026-01-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/0b52cb819619/" title="Git 核心对象：Commit, Tree, Blob 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-28.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git 核心对象：Commit, Tree, Blob 详解"/></a><div class="content"><a class="title" href="/0b52cb819619/" title="Git 核心对象：Commit, Tree, Blob 详解">Git 核心对象：Commit, Tree, Blob 详解</a><time datetime="2026-01-21T22:24:00.000Z" title="发表于 2026-01-22 06:24:00">2026-01-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1d2a942bda1e/" title="Terraform 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-29.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Terraform 详解"/></a><div class="content"><a class="title" href="/1d2a942bda1e/" title="Terraform 详解">Terraform 详解</a><time datetime="2026-01-19T22:24:00.000Z" title="发表于 2026-01-20 06:24:00">2026-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/26cdb2447b3d/" title="WebView 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-26.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WebView 详解"/></a><div class="content"><a class="title" href="/26cdb2447b3d/" title="WebView 详解">WebView 详解</a><time datetime="2026-01-17T22:24:00.000Z" title="发表于 2026-01-18 06:24:00">2026-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/e62a1e8acade/" title="AI 辅助编程的关键要点与代码幻觉防范"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI 辅助编程的关键要点与代码幻觉防范"/></a><div class="content"><a class="title" href="/e62a1e8acade/" title="AI 辅助编程的关键要点与代码幻觉防范">AI 辅助编程的关键要点与代码幻觉防范</a><time datetime="2026-01-15T22:24:00.000Z" title="发表于 2026-01-16 06:24:00">2026-01-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-11.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="🆕 2023">🆕 2023</a><a href="/archives/2024/" target="_blank" title="🆒 2024">🆒 2024</a><a href="/archives/2025/" target="_blank" title="👨‍👩‍👦 2025">👨‍👩‍👦 2025</a><a href="/archives/2026/" target="_blank" title="🆙 2026">🆙 2026</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="📁 分类">📁 分类</a><a href="/tags/" target="_blank" title="🔖 标签">🔖 标签</a><a href="/categories/" target="_blank" title="📽️ 时间线">📽️ 时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="💬 说说">💬 说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const parseViewBox = viewBox => {
    if (!viewBox) return null
    const parts = viewBox.trim().split(/[\s,]+/).map(n => Number(n))
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n))) return null
    return parts
  }

  const getSvgViewBox = svg => {
    const attr = parseViewBox(svg.getAttribute('viewBox'))
    if (attr) return attr

    // Fallback: use bbox to build a viewBox
    try {
      const bbox = svg.getBBox()
      if (bbox && bbox.width && bbox.height) return [bbox.x, bbox.y, bbox.width, bbox.height]
    } catch (e) {
      // getBBox may fail on some edge cases; ignore
    }

    const w = Number(svg.getAttribute('width')) || 0
    const h = Number(svg.getAttribute('height')) || 0
    if (w > 0 && h > 0) return [0, 0, w, h]
    return [0, 0, 100, 100]
  }

  const setSvgViewBox = (svg, vb) => {
    svg.setAttribute('viewBox', `${vb[0]} ${vb[1]} ${vb[2]} ${vb[3]}`)
  }

  const clamp = (v, min, max) => Math.max(min, Math.min(max, v))

  const openSvgInNewTab = ({ source, initViewBox }) => {
    const getClonedSvg = () => {
      if (typeof source === 'string') {
        const template = document.createElement('template')
        template.innerHTML = source.trim()
        const svg = template.content.querySelector('svg')
        return svg ? svg.cloneNode(true) : null
      }
      if (source && typeof source.cloneNode === 'function') {
        return source.cloneNode(true)
      }
      return null
    }

    const clone = getClonedSvg()
    if (!clone) return
    if (initViewBox && initViewBox.length === 4) {
      clone.setAttribute('viewBox', initViewBox.join(' '))
    }
    if (!clone.getAttribute('xmlns')) clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg')
    if (!clone.getAttribute('xmlns:xlink') && clone.outerHTML.includes('xlink:')) {
      clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink')
    }
    // inject background to match current theme
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
    const bg = getComputedStyle(document.body).backgroundColor || (isDark ? '#1e1e1e' : '#ffffff')
    if (!clone.style.background) clone.style.background = bg

    const serializer = new XMLSerializer()
    const svgSource = serializer.serializeToString(clone)
    const htmlSource = `<!doctype html><html><head><meta charset="utf-8" />
      <style>
        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${bg}; }
        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }
      </style>
      </head><body>${svgSource}</body></html>`
    const blob = new Blob([htmlSource], { type: 'text/html;charset=utf-8' })
    const url = URL.createObjectURL(blob)
    window.open(url, '_blank', 'noopener')
    setTimeout(() => URL.revokeObjectURL(url), 30000)
  }

  const attachMermaidViewerButton = wrap => {
    let btn = wrap.querySelector('.mermaid-open-btn')
    if (!btn) {
      btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'mermaid-open-btn'
      wrap.appendChild(btn)
    }

    btn.innerHTML = '<i class="fa fa-search fa-fw" aria-hidden="true"></i>'

    if (!btn.__mermaidViewerBound) {
      btn.addEventListener('click', e => {
        e.preventDefault()
        e.stopPropagation()
        const svg = wrap.__mermaidOriginalSvg || wrap.querySelector('svg')
        if (!svg) return
        const initViewBox = wrap.__mermaidInitViewBox
        if (typeof svg === 'string') {
          openSvgInNewTab({ source: svg, initViewBox })
          return
        }
        openSvgInNewTab({ source: svg, initViewBox })
      })
      btn.__mermaidViewerBound = true
    }
  }

  // Zoom around a point (px, py) in the SVG viewport (in viewBox coordinates)
  const zoomAtPoint = (vb, factor, px, py) => {
    const w = vb[2] * factor
    const h = vb[3] * factor
    const nx = px - (px - vb[0]) * factor
    const ny = py - (py - vb[1]) * factor
    return [nx, ny, w, h]
  }

  const initMermaidGestures = wrap => {
    const svg = wrap.querySelector('svg')
    if (!svg) return

    // Ensure viewBox exists so gestures always work
    const initVb = getSvgViewBox(svg)
    wrap.__mermaidInitViewBox = initVb
    wrap.__mermaidCurViewBox = initVb.slice()
    setSvgViewBox(svg, initVb)

    // Avoid binding multiple times on themeChange/pjax
    if (wrap.__mermaidGestureBound) return
    wrap.__mermaidGestureBound = true

    // Helper: map client (viewport) coordinate -> viewBox coordinate
    const clientToViewBox = (clientX, clientY) => {
      const rect = svg.getBoundingClientRect()
      const vb = wrap.__mermaidCurViewBox || getSvgViewBox(svg)
      const x = vb[0] + (clientX - rect.left) * (vb[2] / rect.width)
      const y = vb[1] + (clientY - rect.top) * (vb[3] / rect.height)
      return { x, y, rect, vb }
    }

    const state = {
      pointers: new Map(),
      startVb: null,
      startDist: 0,
      startCenter: null
    }

    const clampVb = vb => {
      const init = wrap.__mermaidInitViewBox || vb
      const minW = init[2] * 0.1
      const maxW = init[2] * 10
      const minH = init[3] * 0.1
      const maxH = init[3] * 10
      vb[2] = clamp(vb[2], minW, maxW)
      vb[3] = clamp(vb[3], minH, maxH)
      return vb
    }

    const setCurVb = vb => {
      vb = clampVb(vb)
      wrap.__mermaidCurViewBox = vb
      setSvgViewBox(svg, vb)
    }

    const onPointerDown = e => {
      // Allow only primary button for mouse
      if (e.pointerType === 'mouse' && e.button !== 0) return
      svg.setPointerCapture(e.pointerId)
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      if (state.pointers.size === 1) {
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      } else if (state.pointers.size === 2) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        state.startDist = Math.hypot(dx, dy)
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        state.startCenter = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 }
      }
    }

    const onPointerMove = e => {
      if (!state.pointers.has(e.pointerId)) return
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      // Pan with 1 pointer
      if (state.pointers.size === 1 && state.startVb) {
        const p = [...state.pointers.values()][0]
        const prev = { x: e.clientX - e.movementX, y: e.clientY - e.movementY }
        // movementX/Y unreliable on touch, compute from stored last position
        const last = wrap.__mermaidLastSinglePointer || p
        const dxClient = p.x - last.x
        const dyClient = p.y - last.y
        wrap.__mermaidLastSinglePointer = p

        const { rect } = clientToViewBox(p.x, p.y)
        const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        const dx = dxClient * (vb[2] / rect.width)
        const dy = dyClient * (vb[3] / rect.height)
        setCurVb([vb[0] - dx, vb[1] - dy, vb[2], vb[3]])
        return
      }

      // Pinch zoom with 2 pointers
      if (state.pointers.size === 2 && state.startVb && state.startDist > 0) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        const dist = Math.hypot(dx, dy)
        if (!dist) return
        const factor = state.startDist / dist // dist bigger => zoom in (viewBox smaller)

        const cx = (pts[0].x + pts[1].x) / 2
        const cy = (pts[0].y + pts[1].y) / 2
        const centerClient = { x: cx, y: cy }

        const pxy = clientToViewBox(centerClient.x, centerClient.y)
        const cpx = pxy.x
        const cpy = pxy.y

        const vb = zoomAtPoint(state.startVb, factor, cpx, cpy)
        setCurVb(vb)
      }
    }

    const onPointerUpOrCancel = e => {
      state.pointers.delete(e.pointerId)
      if (state.pointers.size === 0) {
        state.startVb = null
        state.startDist = 0
        state.startCenter = null
        wrap.__mermaidLastSinglePointer = null
      } else if (state.pointers.size === 1) {
        // reset single pointer baseline to avoid jump
        wrap.__mermaidLastSinglePointer = [...state.pointers.values()][0]
      }
    }

    // Wheel zoom (mouse/trackpad)
    const onWheel = e => {
      // ctrlKey on mac trackpad pinch; we treat both as zoom
      e.preventDefault()
      const delta = e.deltaY
      const zoomFactor = delta > 0 ? 1.1 : 0.9
      const { x, y } = clientToViewBox(e.clientX, e.clientY)
      const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      setCurVb(zoomAtPoint(vb, zoomFactor, x, y))
    }

    const onDblClick = () => {
      const init = wrap.__mermaidInitViewBox
      if (!init) return
      wrap.__mermaidCurViewBox = init.slice()
      setSvgViewBox(svg, init)
    }

    svg.addEventListener('pointerdown', onPointerDown)
    svg.addEventListener('pointermove', onPointerMove)
    svg.addEventListener('pointerup', onPointerUpOrCancel)
    svg.addEventListener('pointercancel', onPointerUpOrCancel)
    svg.addEventListener('wheel', onWheel, { passive: false })
    svg.addEventListener('dblclick', onDblClick)
  }

  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild

      // Clear old render (themeChange/pjax will rerun)
      const oldSvg = item.querySelector('svg')
      if (oldSvg) oldSvg.remove()
      item.__mermaidGestureBound = false

      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
        if (true) initMermaidGestures(item)
        item.__mermaidOriginalSvg = svg
        if (true) attachMermaidViewerButton(item)
      }


      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>