<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Drizzle ORM 详解 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Drizzle ORM 是一个为 TypeScript&#x2F;JavaScript 设计的现代、轻量级、完全类型安全 (fully type-safe) 的 ORM (Object Relational Mapper)。它旨在提供一个高度接近 SQL 的 API，同时利用 TypeScript 的类型系统，在编译时捕获数据库相关的错误，并在运行时生成高效的 SQL 语句。Drizzle OR">
<meta property="og:type" content="article">
<meta property="og:title" content="Drizzle ORM 详解">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/849bb413f728/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="Drizzle ORM 是一个为 TypeScript&#x2F;JavaScript 设计的现代、轻量级、完全类型安全 (fully type-safe) 的 ORM (Object Relational Mapper)。它旨在提供一个高度接近 SQL 的 API，同时利用 TypeScript 的类型系统，在编译时捕获数据库相关的错误，并在运行时生成高效的 SQL 语句。Drizzle OR">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg">
<meta property="article:published_time" content="2025-06-22T22:24:00.000Z">
<meta property="article:modified_time" content="2026-01-04T09:13:31.571Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="前端技术">
<meta property="article:tag" content="ORM">
<meta property="article:tag" content="2025">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Drizzle ORM 详解",
  "url": "https://blog.tbf1211.xx.kg/849bb413f728/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-11.jpg",
  "datePublished": "2025-06-22T22:24:00.000Z",
  "dateModified": "2026-01-04T09:13:31.571Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/849bb413f728/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')

          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Drizzle ORM 详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">455</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">226</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">81</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-11.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">Drizzle ORM 详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Drizzle ORM 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2025-06-22T22:24:00.000Z" title="发表于 2025-06-23 06:24:00">2025-06-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/%E5%BA%93/">库</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>Drizzle ORM</strong> 是一个为 TypeScript&#x2F;JavaScript 设计的现代、轻量级、<strong>完全类型安全 (fully type-safe)</strong> 的 ORM (Object Relational Mapper)。它旨在提供一个高度接近 SQL 的 API，同时利用 TypeScript 的类型系统，在编译时捕获数据库相关的错误，并在运行时生成高效的 SQL 语句。Drizzle ORM 强调性能、开发者体验和对底层 SQL 的透明度。</p>
</blockquote>
<div class="note info flat"><p>核心思想：<strong>将数据库 schema 定义为 TypeScript 代码，并通过其表达式语言在编译时实现对 SQL 查询的完全类型安全检查，同时保持生成 SQL 的高效性与可读性。</strong> 它更像是一个类型安全的 SQL 查询构建器，而非传统的重型 ORM。</p>
</div>
<hr>
<blockquote>
<p><strong>重要提示</strong>: Drizzle ORM 是为 TypeScript&#x2F;JavaScript 生态系统设计的。因此，本文档中的所有代码示例都将使用 <strong>TypeScript</strong> 语言。这与之前关于 Go 或 Python 库的示例有所不同，以确保示例的实用性和相关性。</p>
</blockquote>
<h2 id="一、为什么需要-Drizzle-ORM？"><a href="#一、为什么需要-Drizzle-ORM？" class="headerlink" title="一、为什么需要 Drizzle ORM？"></a>一、为什么需要 Drizzle ORM？</h2><p>在 TypeScript&#x2F;JavaScript 应用中与关系型数据库交互时，开发者常面临以下痛点：</p>
<ol>
<li><strong>类型安全缺失</strong>：传统上，SQL 字符串是在运行时构造和执行的，无法在编译时检查列名拼写错误、类型不匹配等问题，容易导致运行时错误。</li>
<li><strong>ORM 的“魔术”和性能开销</strong>：许多传统 ORM 隐藏了底层 SQL 的复杂性，虽然简化了开发，但可能生成低效的 SQL，且难以调试。开发者对生成的查询缺乏控制。</li>
<li><strong>模式同步与迁移</strong>：手动管理数据库模式的创建和变更（迁移）过程繁琐且容易出错。</li>
<li><strong>跨数据库兼容性</strong>：不同的数据库有细微的 SQL 语法差异，需要 ORM 进行适配。</li>
<li><strong>开发者体验</strong>：希望在享受 TypeScript 带来的类型安全和自动补全的同时，能以接近原生 SQL 的方式操作数据库。</li>
</ol>
<p>Drizzle ORM 旨在通过以下方式解决这些问题：</p>
<ul>
<li><strong>编译时类型安全</strong>：从数据库模式到查询结果，整个过程都是类型安全的。在编写查询时即可获得自动补全和错误提示。</li>
<li><strong>“SQL-like” API</strong>：提供一个高度接近 SQL 语法的表达式语言，让熟悉 SQL 的开发者能够快速上手，并对生成的 SQL 拥有更大控制权。</li>
<li><strong>轻量与高性能</strong>：生成简洁高效的 SQL，没有过多的运行时开销。</li>
<li><strong>Drizzle Kit CLI</strong>：提供强大的命令行工具，用于数据库模式内省 (introspection)、迁移生成和管理。</li>
<li><strong>多数据库支持</strong>：支持 PostgreSQL (Neon, Supabase, Vercel Postgres, AWS RDS), MySQL, SQLite (Bun SQLite, Turso, Cloudflare D1)。</li>
</ul>
<h2 id="二、Drizzle-ORM-的核心概念"><a href="#二、Drizzle-ORM-的核心概念" class="headerlink" title="二、Drizzle ORM 的核心概念"></a>二、Drizzle ORM 的核心概念</h2><p>Drizzle ORM 围绕几个关键概念构建，理解它们是高效使用 Drizzle 的基础。</p>
<ol>
<li><p><strong>Schema Definition (模式定义)</strong>:</p>
<ul>
<li><strong>定义</strong>：使用 Drizzle 提供的 DSL (Domain Specific Language) 在 TypeScript 代码中定义数据库的表、列、索引和关系。</li>
<li><strong>作用</strong>：作为事实的单一来源 (Single Source of Truth)，用于生成 SQL 语句、进行类型推断和生成数据库迁移。</li>
</ul>
</li>
<li><p><strong>DB Instance (数据库实例)</strong>:</p>
<ul>
<li><strong>定义</strong>：通过 Drizzle 的 <code>drizzle-orm</code> 包提供的 <code>drizzle()</code> 函数，传入数据库驱动的连接对象，创建的 Drizzle ORM 数据库客户端实例。</li>
<li><strong>作用</strong>：是执行所有 Drizzle ORM 操作的入口点。</li>
</ul>
</li>
<li><p><strong>Drizzle Kit (CLI 工具)</strong>:</p>
<ul>
<li><strong>定义</strong>：一个命令行工具，用于处理 Drizzle ORM 的模式管理任务。</li>
<li><strong>作用</strong>：<strong>内省</strong>现有数据库模式并生成 TypeScript Schema 文件；<strong>生成</strong>数据库迁移文件以同步代码中的 Schema 变更到数据库；<strong>推送</strong> Schema 变更到数据库。</li>
</ul>
</li>
<li><p><strong>SQL Expression Language (SQL 表达式语言)</strong>:</p>
<ul>
<li><strong>定义</strong>：Drizzle ORM 提供的用于构建查询的 TypeScript 函数和操作符集合，它们与 SQL 关键字和操作符一对一对应。</li>
<li><strong>作用</strong>：在 TypeScript 代码中以类型安全的方式编写 <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> 等 SQL 语句。</li>
</ul>
</li>
<li><p><strong>Relations (关系)</strong>:</p>
<ul>
<li><strong>定义</strong>：在 Schema 文件中定义表之间的关系，如一对一、一对多、多对多。</li>
<li><strong>作用</strong>：允许在查询时轻松地<code>with</code>相关联的数据，进行连接查询。</li>
</ul>
</li>
<li><p><strong>Transactions (事务)</strong>:</p>
<ul>
<li><strong>定义</strong>：一组原子性的数据库操作，要么全部成功，要么全部失败。</li>
<li><strong>作用</strong>：确保数据的一致性和完整性。</li>
</ul>
</li>
</ol>
<h2 id="三、Drizzle-ORM-架构与工作流程"><a href="#三、Drizzle-ORM-架构与工作流程" class="headerlink" title="三、Drizzle ORM 架构与工作流程"></a>三、Drizzle ORM 架构与工作流程</h2><p>Drizzle ORM 的设计理念是**“编译器优先” (Compiler-First)**，这意味着它在编译时利用 TypeScript 的类型系统进行大量检查和推断。</p>
<h3 id="3-1-架构图"><a href="#3-1-架构图" class="headerlink" title="3.1 架构图"></a>3.1 架构图</h3><div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TD
    subgraph Application
        AppCode[TypeScript&#x2F;JavaScript Application Code]
    end

    subgraph Drizzle ORM Framework
        AppCode --&gt; SchemaDef[&quot;Schema Definition (.ts files)&quot;]
        AppCode --&gt; DrizzleORM[&quot;Drizzle ORM API (select, insert, update, delete, etc.)&quot;]
        DrizzleORM -- &quot;Generates&quot; --&gt; SQLStatements[Optimized SQL Statements]
    end

    subgraph Drizzle Kit CLI
        direction LR
        SchemaDef --&gt;|Used by| DrizzleKit[Drizzle Kit CLI]
        ExistingDB[(Existing Database)] --&gt;|Introspects &amp; Generates Schema| DrizzleKit
        DrizzleKit --&gt;|Generates&#x2F;Pushes| Migrations[Database Migrations]
    end

    subgraph Database Interaction
        SQLStatements -- &quot;Executed by&quot; --&gt; DBClient[&quot;Database Driver Client (e.g., node-postgres, better-sqlite3)&quot;]
        DBClient &lt;--&gt; Database[&quot;Relational Database (PostgreSQL, MySQL, SQLite)&quot;]
    end

    AppCode -- &quot;Creates &amp; Uses&quot; --&gt; DBClient
    Migrations --&gt; Database
  </pre></div>

<h3 id="3-2-工作流程-Schema-到数据操作"><a href="#3-2-工作流程-Schema-到数据操作" class="headerlink" title="3.2 工作流程 (Schema 到数据操作)"></a>3.2 工作流程 (Schema 到数据操作)</h3><p>一个典型的 Drizzle ORM 工作流程如下：</p>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    sequenceDiagram
    participant Dev as 开发者
    participant Schema as Schema 定义 (.ts)
    participant DrizzleKit as Drizzle Kit CLI
    participant DB as 数据库
    participant App as 应用程序

    Dev-&gt;&gt;Schema: 1. 定义数据库 Schema (Tables, Columns, Relations)
    Dev-&gt;&gt;DrizzleKit: 2. 生成初始迁移 (drizzle-kit generate)
    DrizzleKit-&gt;&gt;DB: 3. 应用迁移到数据库 (drizzle-kit migrate &#x2F; push)
    Dev-&gt;&gt;App: 4. 在应用程序中实例化 Drizzle DB 客户端

    App-&gt;&gt;App: 5. 编写 Drizzle ORM 查询 (select, insert, update, delete)
    Note over App: TypeScript 编译器在编写时提供类型安全和自动补全

    App-&gt;&gt;DB: 6. Drizzle ORM 生成并执行 SQL 语句
    DB--&gt;&gt;App: 7. 返回原始数据库结果

    App-&gt;&gt;App: 8. Drizzle ORM 将结果类型化，供应用程序使用
  </pre></div>

<h2 id="四、Drizzle-ORM-入门与基本用法"><a href="#四、Drizzle-ORM-入门与基本用法" class="headerlink" title="四、Drizzle ORM 入门与基本用法"></a>四、Drizzle ORM 入门与基本用法</h2><h3 id="4-1-安装"><a href="#4-1-安装" class="headerlink" title="4.1 安装"></a>4.1 安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装核心 Drizzle ORM 库</span></span><br><span class="line">npm install drizzle-orm</span><br><span class="line"><span class="comment"># 或 yarn add drizzle-orm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Drizzle Kit CLI (用于 schema 管理和迁移)</span></span><br><span class="line">npm install -D drizzle-kit</span><br><span class="line"><span class="comment"># 或 yarn add -D drizzle-kit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装数据库驱动 (根据你使用的数据库选择)</span></span><br><span class="line"><span class="comment"># PostgreSQL:</span></span><br><span class="line">npm install pg</span><br><span class="line"><span class="comment"># MySQL:</span></span><br><span class="line">npm install mysql2</span><br><span class="line"><span class="comment"># SQLite (例如 with better-sqlite3 for Node.js):</span></span><br><span class="line">npm install better-sqlite3</span><br></pre></td></tr></table></figure>

<h3 id="4-2-配置-drizzle-config-ts"><a href="#4-2-配置-drizzle-config-ts" class="headerlink" title="4.2 配置 drizzle.config.ts"></a>4.2 配置 <code>drizzle.config.ts</code></h3><p>在项目根目录创建 <code>drizzle.config.ts</code> (或 <code>.js</code>) 文件，用于 Drizzle Kit 配置。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// drizzle.config.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Config</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle-kit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">schema</span>: <span class="string">&quot;./src/schema.ts&quot;</span>, <span class="comment">// 指向你的 schema 定义文件</span></span><br><span class="line">  <span class="attr">out</span>: <span class="string">&quot;./drizzle&quot;</span>,          <span class="comment">// 迁移文件输出目录</span></span><br><span class="line">  <span class="attr">driver</span>: <span class="string">&quot;pg&quot;</span>,              <span class="comment">// 或 &quot;mysql2&quot;, &quot;sqlite&quot;</span></span><br><span class="line">  <span class="attr">dbCredentials</span>: &#123;</span><br><span class="line">    <span class="attr">connectionString</span>: process.<span class="property">env</span>.<span class="property">DATABASE_URL</span>!, <span class="comment">// 你的数据库连接字符串</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">verbose</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">strict</span>: <span class="literal">true</span>,</span><br><span class="line">&#125; <span class="keyword">satisfies</span> <span class="title class_">Config</span>;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-数据库连接与-Schema-定义"><a href="#4-3-数据库连接与-Schema-定义" class="headerlink" title="4.3 数据库连接与 Schema 定义"></a>4.3 数据库连接与 Schema 定义</h3><p>首先，在 <code>src/db.ts</code> 或类似文件中设置数据库连接：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/db.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; drizzle &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle-orm/postgres-js&#x27;</span>; <span class="comment">// 根据你的驱动选择，例如 &#x27;drizzle-orm/node-postgres&#x27;</span></span><br><span class="line"><span class="keyword">import</span> postgres <span class="keyword">from</span> <span class="string">&#x27;postgres&#x27;</span>; <span class="comment">// 导入具体的数据库驱动</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> schema <span class="keyword">from</span> <span class="string">&#x27;./schema&#x27;</span>; <span class="comment">// 导入你的 schema 定义</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从环境变量获取连接字符串</span></span><br><span class="line"><span class="keyword">const</span> connectionString = process.<span class="property">env</span>.<span class="property">DATABASE_URL</span>!;</span><br><span class="line"><span class="keyword">if</span> (!connectionString) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;DATABASE_URL is not set&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 PostgreSQL 客户端</span></span><br><span class="line"><span class="keyword">const</span> client = <span class="title function_">postgres</span>(connectionString);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将客户端与 Drizzle ORM 绑定，并导入 schema</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> db = <span class="title function_">drizzle</span>(client, &#123; schema &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例：用于演示的异步连接关闭函数（实际应用可能在应用退出时调用）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">closeDbConnection</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> client.<span class="title function_">end</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Database client disconnected.&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，在 <code>src/schema.ts</code> 定义你的数据库模式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/schema.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; pgTable, serial, text, varchar, timestamp, <span class="built_in">boolean</span>, pgEnum &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle-orm/pg-core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; relations &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle-orm&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个枚举类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userRoleEnum = <span class="title function_">pgEnum</span>(<span class="string">&#x27;user_role&#x27;</span>, [<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;editor&#x27;</span>, <span class="string">&#x27;viewer&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 users 表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> users = <span class="title function_">pgTable</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="title function_">serial</span>(<span class="string">&#x27;id&#x27;</span>).<span class="title function_">primaryKey</span>(),</span><br><span class="line">  <span class="attr">name</span>: <span class="title function_">varchar</span>(<span class="string">&#x27;name&#x27;</span>, &#123; <span class="attr">length</span>: <span class="number">256</span> &#125;).<span class="title function_">notNull</span>(),</span><br><span class="line">  <span class="attr">email</span>: <span class="title function_">varchar</span>(<span class="string">&#x27;email&#x27;</span>, &#123; <span class="attr">length</span>: <span class="number">256</span> &#125;).<span class="title function_">unique</span>().<span class="title function_">notNull</span>(),</span><br><span class="line">  <span class="attr">role</span>: <span class="title function_">userRoleEnum</span>(<span class="string">&#x27;role&#x27;</span>).<span class="title function_">notNull</span>().<span class="title function_">default</span>(<span class="string">&#x27;viewer&#x27;</span>),</span><br><span class="line">  <span class="attr">isActive</span>: <span class="title function_">boolean</span>(<span class="string">&#x27;is_active&#x27;</span>).<span class="title function_">default</span>(<span class="literal">true</span>),</span><br><span class="line">  <span class="attr">createdAt</span>: <span class="title function_">timestamp</span>(<span class="string">&#x27;created_at&#x27;</span>).<span class="title function_">defaultNow</span>(),</span><br><span class="line">  <span class="attr">updatedAt</span>: <span class="title function_">timestamp</span>(<span class="string">&#x27;updated_at&#x27;</span>).<span class="title function_">defaultNow</span>().$onUpdate(<span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">Date</span>()), <span class="comment">// 自动更新</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义 posts 表</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> posts = <span class="title function_">pgTable</span>(<span class="string">&#x27;posts&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="title function_">serial</span>(<span class="string">&#x27;id&#x27;</span>).<span class="title function_">primaryKey</span>(),</span><br><span class="line">  <span class="attr">title</span>: <span class="title function_">varchar</span>(<span class="string">&#x27;title&#x27;</span>, &#123; <span class="attr">length</span>: <span class="number">256</span> &#125;).<span class="title function_">notNull</span>(),</span><br><span class="line">  <span class="attr">content</span>: <span class="title function_">text</span>(<span class="string">&#x27;content&#x27;</span>),</span><br><span class="line">  <span class="attr">userId</span>: <span class="title function_">serial</span>(<span class="string">&#x27;user_id&#x27;</span>).<span class="title function_">references</span>(<span class="function">() =&gt;</span> users.<span class="property">id</span>, &#123; <span class="attr">onDelete</span>: <span class="string">&#x27;cascade&#x27;</span> &#125;).<span class="title function_">notNull</span>(), <span class="comment">// 外键关联 users.id</span></span><br><span class="line">  <span class="attr">publishedAt</span>: <span class="title function_">timestamp</span>(<span class="string">&#x27;published_at&#x27;</span>),</span><br><span class="line">  <span class="attr">createdAt</span>: <span class="title function_">timestamp</span>(<span class="string">&#x27;created_at&#x27;</span>).<span class="title function_">defaultNow</span>(),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义表之间的关系</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> usersRelations = <span class="title function_">relations</span>(users, <span class="function">(<span class="params">&#123; many &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">posts</span>: <span class="title function_">many</span>(posts), <span class="comment">// 一个用户有多个帖子 (一对多)</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> postsRelations = <span class="title function_">relations</span>(posts, <span class="function">(<span class="params">&#123; one &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">author</span>: <span class="title function_">one</span>(users, &#123;</span><br><span class="line">    <span class="attr">fields</span>: [posts.<span class="property">userId</span>],</span><br><span class="line">    <span class="attr">references</span>: [users.<span class="property">id</span>],</span><br><span class="line">  &#125;), <span class="comment">// 一个帖子属于一个作者 (多对一)</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<h2 id="五、Drizzle-ORM-各种-SQL-操作方法详解"><a href="#五、Drizzle-ORM-各种-SQL-操作方法详解" class="headerlink" title="五、Drizzle ORM 各种 SQL 操作方法详解"></a>五、Drizzle ORM 各种 SQL 操作方法详解</h2><p>以下示例将演示 Drizzle ORM 的 CRUD (Create, Read, Update, Delete) 操作，以及更高级的查询功能。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/examples.ts (假设 db 实例已从 src/db.ts 导入)</span></span><br><span class="line"><span class="keyword">import</span> &#123; db, closeDbConnection &#125; <span class="keyword">from</span> <span class="string">&#x27;./db&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; users, posts, userRoleEnum &#125; <span class="keyword">from</span> <span class="string">&#x27;./schema&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; eq, like, desc, asc, and, or, not, gt, lt, gte, lte, sql &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle-orm&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">runDrizzleExamples</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;--- Drizzle ORM 操作示例 ---&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// --- Ⅰ. 创建数据 (INSERT) ---</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- Ⅰ. 创建数据 (INSERT) ---&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 插入单个用户</span></span><br><span class="line">    <span class="keyword">const</span> [alice] = <span class="keyword">await</span> db.<span class="title function_">insert</span>(users).<span class="title function_">values</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;Alice Smith&#x27;</span>,</span><br><span class="line">      <span class="attr">email</span>: <span class="string">&#x27;alice@example.com&#x27;</span>,</span><br><span class="line">      <span class="attr">role</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">    &#125;).<span class="title function_">returning</span>(); <span class="comment">// .returning() 返回插入的行</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入用户 Alice:&quot;</span>, alice);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 插入多个用户</span></span><br><span class="line">    <span class="keyword">const</span> newUsers = <span class="keyword">await</span> db.<span class="title function_">insert</span>(users).<span class="title function_">values</span>([</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;Bob Johnson&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;bob@example.com&#x27;</span>, <span class="attr">role</span>: <span class="string">&#x27;editor&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">&#x27;Charlie Brown&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;charlie@example.com&#x27;</span>, <span class="attr">isActive</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    ]).<span class="title function_">returning</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入用户 Bob 和 Charlie:&quot;</span>, newUsers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 插入帖子并关联用户</span></span><br><span class="line">    <span class="keyword">if</span> (alice) &#123;</span><br><span class="line">      <span class="keyword">const</span> [alicePost1] = <span class="keyword">await</span> db.<span class="title function_">insert</span>(posts).<span class="title function_">values</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;My First Post&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;This is Alice\&#x27;s first great post!&#x27;</span>,</span><br><span class="line">        <span class="attr">userId</span>: alice.<span class="property">id</span>,</span><br><span class="line">      &#125;).<span class="title function_">returning</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入 Alice 的帖子 1:&quot;</span>, alicePost1);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> [alicePost2] = <span class="keyword">await</span> db.<span class="title function_">insert</span>(posts).<span class="title function_">values</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Another Article by Alice&#x27;</span>,</span><br><span class="line">        <span class="attr">content</span>: <span class="string">&#x27;Exploring Drizzle ORM features.&#x27;</span>,</span><br><span class="line">        <span class="attr">userId</span>: alice.<span class="property">id</span>,</span><br><span class="line">      &#125;).<span class="title function_">returning</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入 Alice 的帖子 2:&quot;</span>, alicePost2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> [bobUser] = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">name</span>, <span class="string">&#x27;Bob Johnson&#x27;</span>)).<span class="title function_">limit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (bobUser) &#123;</span><br><span class="line">        <span class="keyword">await</span> db.<span class="title function_">insert</span>(posts).<span class="title function_">values</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;Bob\&#x27;s Tech Review&#x27;</span>,</span><br><span class="line">            <span class="attr">content</span>: <span class="string">&#x27;Reviewing the latest gadgets.&#x27;</span>,</span><br><span class="line">            <span class="attr">userId</span>: bobUser.<span class="property">id</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;插入 Bob 的帖子。&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (<span class="attr">error</span>: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">code</span> === <span class="string">&#x27;23505&#x27;</span>) &#123; <span class="comment">// PostgreSQL 唯一约束错误代码</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;插入数据失败：&quot;</span>, error.<span class="property">message</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;插入数据时发生未知错误：&quot;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// --- Ⅱ. 读取数据 (SELECT) ---</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- Ⅱ. 读取数据 (SELECT) ---&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 查询所有用户</span></span><br><span class="line">  <span class="keyword">const</span> allUsers = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;所有用户:&quot;</span>, allUsers);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2. 带条件的查询 (WHERE)</span></span><br><span class="line">  <span class="comment">// `eq` (equals), `gt` (greater than), `lt` (less than), `like` 等</span></span><br><span class="line">  <span class="keyword">const</span> aliceOnly = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">email</span>, <span class="string">&#x27;alice@example.com&#x27;</span>));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;查询用户 Alice:&quot;</span>, aliceOnly);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> activeUsers = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">isActive</span>, <span class="literal">true</span>));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;活跃用户:&quot;</span>, activeUsers);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 3. 组合条件 (AND, OR, NOT)</span></span><br><span class="line">  <span class="keyword">const</span> editorsOrAdmins = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">where</span>(</span><br><span class="line">    <span class="title function_">or</span>(</span><br><span class="line">      <span class="title function_">eq</span>(users.<span class="property">role</span>, <span class="string">&#x27;editor&#x27;</span>),</span><br><span class="line">      <span class="title function_">eq</span>(users.<span class="property">role</span>, <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;编辑或管理员:&quot;</span>, editorsOrAdmins);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> activeAdmins = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">where</span>(</span><br><span class="line">    <span class="title function_">and</span>(</span><br><span class="line">      <span class="title function_">eq</span>(users.<span class="property">role</span>, <span class="string">&#x27;admin&#x27;</span>),</span><br><span class="line">      <span class="title function_">eq</span>(users.<span class="property">isActive</span>, <span class="literal">true</span>)</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;活跃管理员:&quot;</span>, activeAdmins);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 4. 选择特定列 (Projection)</span></span><br><span class="line">  <span class="keyword">const</span> userEmails = <span class="keyword">await</span> db.<span class="title function_">select</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: users.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">email</span>: users.<span class="property">email</span></span><br><span class="line">  &#125;).<span class="title function_">from</span>(users);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;只查询用户姓名和邮箱:&quot;</span>, userEmails);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5. 排序 (ORDER BY)</span></span><br><span class="line">  <span class="keyword">const</span> usersSortedByName = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">orderBy</span>(<span class="title function_">asc</span>(users.<span class="property">name</span>));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;按姓名升序排序的用户:&quot;</span>, usersSortedByName);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> latestUsers = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">orderBy</span>(<span class="title function_">desc</span>(users.<span class="property">createdAt</span>)).<span class="title function_">limit</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;最新注册的2个用户:&quot;</span>, latestUsers);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 6. 限制与偏移 (LIMIT, OFFSET)</span></span><br><span class="line">  <span class="keyword">const</span> paginatedUsers = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(users).<span class="title function_">orderBy</span>(<span class="title function_">asc</span>(users.<span class="property">id</span>)).<span class="title function_">limit</span>(<span class="number">2</span>).<span class="title function_">offset</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;分页查询 (跳过1个，获取2个):&quot;</span>, paginatedUsers);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 7. 连接查询 (JOINs) - 使用 Relations (with)</span></span><br><span class="line">  <span class="comment">// Drizzle ORM 推荐使用 with() 语法加载关联数据，而非手动写 JOIN</span></span><br><span class="line">  <span class="keyword">const</span> usersWithPosts = <span class="keyword">await</span> db.<span class="property">query</span>.<span class="property">users</span>.<span class="title function_">findMany</span>(&#123;</span><br><span class="line">    <span class="attr">with</span>: &#123;</span><br><span class="line">      <span class="attr">posts</span>: <span class="literal">true</span>, <span class="comment">// 加载所有关联的帖子</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;用户及其关联的帖子 (使用 with):&quot;</span>, usersWithPosts);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你也可以进行更细粒度的控制，例如只查询帖子的 title</span></span><br><span class="line">  <span class="keyword">const</span> usersWithPostTitles = <span class="keyword">await</span> db.<span class="property">query</span>.<span class="property">users</span>.<span class="title function_">findMany</span>(&#123;</span><br><span class="line">    <span class="attr">with</span>: &#123;</span><br><span class="line">      <span class="attr">posts</span>: &#123;</span><br><span class="line">        <span class="attr">columns</span>: &#123;</span><br><span class="line">          <span class="attr">title</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">publishedAt</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;用户及其帖子标题 (使用 with + columns):&quot;</span>, usersWithPostTitles);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果需要更复杂的 JOIN 逻辑，例如 LEFT JOIN 且过滤：</span></span><br><span class="line">  <span class="keyword">const</span> postsAndAuthors = <span class="keyword">await</span> db.<span class="title function_">select</span>(&#123;</span><br><span class="line">    <span class="attr">postTitle</span>: posts.<span class="property">title</span>,</span><br><span class="line">    <span class="attr">authorName</span>: users.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">authorEmail</span>: users.<span class="property">email</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">from</span>(posts)</span><br><span class="line">  .<span class="title function_">leftJoin</span>(users, <span class="title function_">eq</span>(posts.<span class="property">userId</span>, users.<span class="property">id</span>)); <span class="comment">// 手动指定 JOIN 条件</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;帖子及其作者 (使用 leftJoin):&quot;</span>, postsAndAuthors);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 8. 聚合函数 (Aggregation) 与分组 (GROUP BY)</span></span><br><span class="line">  <span class="comment">// count(), sum(), avg(), min(), max()</span></span><br><span class="line">  <span class="comment">// 导入聚合函数</span></span><br><span class="line">  <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;drizzle-orm&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userPostCounts = <span class="keyword">await</span> db.<span class="title function_">select</span>(&#123;</span><br><span class="line">    <span class="attr">userName</span>: users.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">postCount</span>: <span class="title function_">count</span>(posts.<span class="property">id</span>),</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">from</span>(users)</span><br><span class="line">  .<span class="title function_">leftJoin</span>(posts, <span class="title function_">eq</span>(users.<span class="property">id</span>, posts.<span class="property">userId</span>))</span><br><span class="line">  .<span class="title function_">groupBy</span>(users.<span class="property">id</span>, users.<span class="property">name</span>) <span class="comment">// 必须包含所有非聚合的 SELECT 列</span></span><br><span class="line">  .<span class="title function_">orderBy</span>(<span class="title function_">desc</span>(<span class="title function_">count</span>(posts.<span class="property">id</span>)));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;各用户发帖数量:&quot;</span>, userPostCounts);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 9. 原始 SQL (Raw SQL)</span></span><br><span class="line">  <span class="comment">// 当 Drizzle ORM 的表达式语言无法满足需求时，可以直接执行原始 SQL</span></span><br><span class="line">  <span class="keyword">const</span> rawQueryResult = <span class="keyword">await</span> db.<span class="title function_">execute</span>(sql<span class="string">`SELECT name, email FROM users WHERE role = <span class="subst">$&#123;<span class="string">&#x27;editor&#x27;</span>&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">// 注意：db.execute 返回的是原始数据库驱动的结果，类型可能不确定</span></span><br><span class="line">  <span class="comment">// 你可以使用 db.all(sql`...`) 或 db.get(sql`...`) 获取类型化结果 (如果驱动支持)</span></span><br><span class="line">  <span class="comment">// 或者使用 sql`...`.as(UserSchema) 协助类型推断 (高级用法)</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原始 SQL 查询结果:&quot;</span>, rawQueryResult);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// --- Ⅲ. 更新数据 (UPDATE) ---</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- Ⅲ. 更新数据 (UPDATE) ---&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [updatedAlice] = <span class="keyword">await</span> db.<span class="title function_">update</span>(users)</span><br><span class="line">    .<span class="title function_">set</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Alice Wonderland&#x27;</span>, <span class="attr">updatedAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>() &#125;)</span><br><span class="line">    .<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">email</span>, <span class="string">&#x27;alice@example.com&#x27;</span>))</span><br><span class="line">    .<span class="title function_">returning</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;更新用户 Alice:&quot;</span>, updatedAlice);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [updatedBob] = <span class="keyword">await</span> db.<span class="title function_">update</span>(users)</span><br><span class="line">    .<span class="title function_">set</span>(&#123; <span class="attr">isActive</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">    .<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">name</span>, <span class="string">&#x27;Bob Johnson&#x27;</span>))</span><br><span class="line">    .<span class="title function_">returning</span>(&#123; <span class="attr">id</span>: users.<span class="property">id</span>, <span class="attr">name</span>: users.<span class="property">name</span>, <span class="attr">isActive</span>: users.<span class="property">isActive</span> &#125;); <span class="comment">// 只返回特定列</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;更新用户 Bob 的活跃状态:&quot;</span>, updatedBob);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// --- Ⅳ. 删除数据 (DELETE) ---</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- Ⅳ. 删除数据 (DELETE) ---&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> [deletedCharlie] = <span class="keyword">await</span> db.<span class="title function_">delete</span>(users)</span><br><span class="line">    .<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">name</span>, <span class="string">&#x27;Charlie Brown&#x27;</span>))</span><br><span class="line">    .<span class="title function_">returning</span>(&#123; <span class="attr">id</span>: users.<span class="property">id</span>, <span class="attr">name</span>: users.<span class="property">name</span> &#125;);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;删除用户 Charlie:&quot;</span>, deletedCharlie);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 因为 posts.userId 设置了 onDelete: &#x27;cascade&#x27;，删除用户时其帖子也会被删除</span></span><br><span class="line">  <span class="keyword">const</span> [deletedBob] = <span class="keyword">await</span> db.<span class="title function_">delete</span>(users)</span><br><span class="line">    .<span class="title function_">where</span>(<span class="title function_">eq</span>(users.<span class="property">name</span>, <span class="string">&#x27;Bob Johnson&#x27;</span>))</span><br><span class="line">    .<span class="title function_">returning</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;删除用户 Bob (级联删除其帖子):&quot;</span>, deletedBob);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> remainingPosts = <span class="keyword">await</span> db.<span class="title function_">select</span>().<span class="title function_">from</span>(posts);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;删除 Bob 后剩余的帖子:&quot;</span>, remainingPosts);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// --- Ⅴ. 事务 (Transactions) ---</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;\n--- Ⅴ. 事务 (Transactions) ---&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> db.<span class="title function_">transaction</span>(<span class="title function_">async</span> (tx) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> [userD] = <span class="keyword">await</span> tx.<span class="title function_">insert</span>(users).<span class="title function_">values</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;David Lee&#x27;</span>, <span class="attr">email</span>: <span class="string">&#x27;david@example.com&#x27;</span> &#125;).<span class="title function_">returning</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;事务中插入用户 David:&quot;</span>, userD);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (userD) &#123;</span><br><span class="line">        <span class="keyword">await</span> tx.<span class="title function_">insert</span>(posts).<span class="title function_">values</span>(&#123; <span class="attr">title</span>: <span class="string">&#x27;David\&#x27;s First Post&#x27;</span>, <span class="attr">userId</span>: userD.<span class="property">id</span> &#125;);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;事务中插入 David 的帖子。&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 模拟一个错误，这将导致整个事务回滚</span></span><br><span class="line">      <span class="comment">// throw new Error(&quot;模拟事务失败&quot;);</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;事务成功提交！&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;事务回滚:&quot;</span>, (error <span class="keyword">as</span> <span class="title class_">Error</span>).<span class="property">message</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 关闭数据库连接</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">closeDbConnection</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确保在 Node.js 环境下运行</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">require</span>.<span class="property">main</span> === <span class="variable language_">module</span>) &#123;</span><br><span class="line">  <span class="comment">// DATABASE_URL 环境变量需要在运行前设置</span></span><br><span class="line">  <span class="comment">// 例如：export DATABASE_URL=&quot;postgresql://user:password@host:port/database&quot;</span></span><br><span class="line">  <span class="comment">// 或者在 .env 文件中设置并通过 dotenv 加载</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).<span class="title function_">config</span>();</span><br><span class="line">  <span class="title function_">runDrizzleExamples</span>().<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六、数据库迁移-Drizzle-Kit"><a href="#六、数据库迁移-Drizzle-Kit" class="headerlink" title="六、数据库迁移 (Drizzle Kit)"></a>六、数据库迁移 (Drizzle Kit)</h2><p>Drizzle Kit CLI 工具是 Drizzle ORM 生态系统的重要组成部分，它负责管理数据库模式的演进。</p>
<ol>
<li><p><strong>生成迁移文件</strong>:<br>当你修改了 <code>src/schema.ts</code> 文件后，运行以下命令会比较当前 Schema 和上次的快照，并生成一个新的迁移文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx drizzle-kit generate:pg <span class="comment"># 或 generate:mysql, generate:sqlite</span></span><br></pre></td></tr></table></figure>
<p>这会在 <code>drizzle</code> 目录下创建一个带有时间戳的 <code>.ts</code> 文件，其中包含 Drizzle ORM 自动生成的 SQL 语句（如 <code>CREATE TABLE</code>, <code>ALTER TABLE</code>）。</p>
</li>
<li><p><strong>应用迁移</strong>:<br>在你的应用程序中，你需要编写一个脚本来执行这些生成的迁移文件。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts/migrate.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; migrate &#125; <span class="keyword">from</span> <span class="string">&#x27;drizzle-orm/postgres-js/migrator&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; db, closeDbConnection &#125; <span class="keyword">from</span> <span class="string">&#x27;../src/db&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Running migrations...&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">migrate</span>(db, &#123; <span class="attr">migrationsFolder</span>: <span class="string">&#x27;./drizzle&#x27;</span> &#125;); <span class="comment">// 传入 Drizzle 客户端实例和迁移文件目录</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Migrations finished!&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">closeDbConnection</span>();</span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>().<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Migration failed:&#x27;</span>, err);</span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>然后运行此脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ts-node scripts/migrate.ts <span class="comment"># 或 node scripts/migrate.js (如果已编译)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>模式推送 (Schema Push)</strong>:<br>对于开发环境，如果你想快速同步 Schema 变更而不需要生成迁移文件，可以使用 <code>push</code> 命令。它会直接将 Schema 状态推送到数据库（会删除不存在于 Schema 中的表）。<strong>注意：不推荐在生产环境使用。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx drizzle-kit push:pg <span class="comment"># 或 push:mysql, push:sqlite</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="七、Drizzle-ORM-的优缺点与适用场景"><a href="#七、Drizzle-ORM-的优缺点与适用场景" class="headerlink" title="七、Drizzle ORM 的优缺点与适用场景"></a>七、Drizzle ORM 的优缺点与适用场景</h2><h3 id="7-1-优点："><a href="#7-1-优点：" class="headerlink" title="7.1 优点："></a>7.1 优点：</h3><ol>
<li><strong>极致的类型安全</strong>：从 Schema 定义到查询结果，全程类型推断和检查，极大减少运行时错误。</li>
<li><strong>“SQL-like” API</strong>：学习曲线平缓，熟悉 SQL 的开发者可以快速上手，对生成的 SQL 有清晰的认识和控制。</li>
<li><strong>高性能与轻量</strong>：生成的 SQL 简洁高效，运行时开销极小，是性能敏感应用的理想选择。</li>
<li><strong>Drizzle Kit CLI 强大</strong>：自动化 Schema 内省和迁移管理，提升开发效率。</li>
<li><strong>现代化的开发体验</strong>：利用 TypeScript 的优势，提供优秀的自动补全、重构支持。</li>
<li><strong>多数据库支持</strong>：广泛支持主流关系型数据库。</li>
<li><strong>异步支持</strong>：原生支持 <code>async/await</code>，与现代 JS&#x2F;TS 生态系统完美融合。</li>
</ol>
<h3 id="7-2-缺点："><a href="#7-2-缺点：" class="headerlink" title="7.2 缺点："></a>7.2 缺点：</h3><ol>
<li><strong>相对新颖</strong>：相较于 TypeORM、Prisma 等成熟 ORM，Drizzle ORM 出现时间较晚，社区规模和生态系统仍在快速成长中。</li>
<li><strong>非传统 ORM 理念</strong>：不提供 Active Record 模式，操作围绕 SQL 表达式展开，可能不适合偏爱高层抽象和对象模型的开发者。</li>
<li><strong>缺乏缓存层</strong>：Drizzle ORM 是一个 SQL 查询构建器，它不提供内置的查询缓存或一级&#x2F;二级缓存，这通常需要开发者自行实现或集成。</li>
<li><strong>学习某些高级特性</strong>：虽然基础查询 SQL-like，但某些高级表达式（如复杂的 CTE、窗口函数）可能需要时间来适应 Drizzle 的 DSL 语法。</li>
</ol>
<h3 id="7-3-适用场景："><a href="#7-3-适用场景：" class="headerlink" title="7.3 适用场景："></a>7.3 适用场景：</h3><ul>
<li><strong>追求类型安全的 TypeScript&#x2F;JavaScript 应用</strong>：无论是前端 (Next.js server components, Remix) 还是后端 (Node.js, Bun)。</li>
<li><strong>对性能有较高要求，不希望 ORM 引入额外开销的项目</strong>。</li>
<li><strong>偏好 SQL 语法，希望对底层查询有更强控制的开发者</strong>。</li>
<li><strong>微服务架构</strong>：轻量级和高性能的特点使其成为微服务中数据访问层的理想选择。</li>
<li><strong>需要频繁管理数据库模式变更的项目</strong>：Drizzle Kit 的迁移功能非常便捷。</li>
</ul>
<h2 id="八、安全性考虑"><a href="#八、安全性考虑" class="headerlink" title="八、安全性考虑"></a>八、安全性考虑</h2><p>使用 Drizzle ORM 开发数据库应用时，虽然 Drizzle 本身在防止某些攻击方面提供了帮助，但开发者仍需关注以下安全实践：</p>
<ol>
<li><strong>SQL 注入防护 (由 Drizzle 自动处理)</strong>：<ul>
<li>Drizzle ORM 的查询构建器会<strong>自动参数化查询</strong>，这意味着它会将所有动态值作为参数传递给数据库，而不是直接拼接到 SQL 字符串中。这从根本上防止了 SQL 注入攻击。</li>
<li>即使使用 <code>sql</code> 模板字面量执行原始 SQL，Drizzle 也支持安全的参数化方式：<code>sql</code> <code>SELECT * FROM users WHERE name = $&#123;userName&#125;</code>。</li>
</ul>
</li>
<li><strong>数据库连接字符串安全</strong>：<ul>
<li><strong>绝不</strong>将数据库连接字符串硬编码到代码中。</li>
<li>使用环境变量 (<code>.env</code> 文件, 操作系统环境变量) 来存储敏感的连接信息。</li>
<li>在生产环境中，应使用专门的秘密管理服务 (如 AWS Secrets Manager, Azure Key Vault, HashiCorp Vault)。</li>
</ul>
</li>
<li><strong>输入验证与过滤</strong>：<ul>
<li>在将用户输入传递给 Drizzle ORM 查询之前，始终在应用程序层进行严格的<strong>输入验证和清理</strong>。这有助于防止意外的或恶意的数据进入数据库，例如：<ul>
<li>检查数据类型、长度、格式。</li>
<li>防止 XSS (Cross-Site Scripting) 攻击 (如果数据最终会显示在前端)。</li>
</ul>
</li>
</ul>
</li>
<li><strong>最小权限原则</strong>：<ul>
<li>为应用程序连接数据库所使用的用户账号，配置<strong>最小必要权限</strong>。例如，如果应用只需要读写特定表，不要赋予其删除整个数据库的权限。</li>
</ul>
</li>
<li><strong>事务管理</strong>：<ul>
<li>对于涉及多个相互依赖的数据库操作，务必使用 Drizzle ORM 提供的<strong>事务</strong> (<code>db.transaction()</code>) 来确保数据的一致性和原子性，防止部分操作成功而导致数据不完整。</li>
</ul>
</li>
<li><strong>错误处理</strong>：<ul>
<li>捕获并适当地处理数据库操作可能抛出的错误，避免向用户暴露敏感的数据库错误信息。</li>
</ul>
</li>
<li><strong>依赖项安全</strong>：<ul>
<li>保持 Drizzle ORM 及其数据库驱动 (<code>pg</code>, <code>mysql2</code>, <code>better-sqlite3</code> 等) 更新到最新版本，以获取安全补丁和性能改进。</li>
</ul>
</li>
</ol>
<h2 id="九、总结"><a href="#九、总结" class="headerlink" title="九、总结"></a>九、总结</h2><p>Drizzle ORM 凭借其独特的 TypeScript 优先、类型安全和 SQL-like 的设计理念，正在迅速成为现代 JavaScript&#x2F;TypeScript 数据库开发的有力竞争者。它成功地在 ORM 的易用性和原生 SQL 的控制力之间取得了平衡，同时提供了卓越的性能和开发者体验。对于追求代码质量、类型安全和数据库操作透明度的项目，Drizzle ORM 提供了一个强大而优雅的解决方案。理解并熟练运用其 Schema 定义、SQL 表达式语言以及 Drizzle Kit 工具，将极大地提升你的数据层开发效率和应用健壮性。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/849bb413f728/">https://blog.tbf1211.xx.kg/849bb413f728/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><a class="post-meta__tags" href="/tags/ORM/">ORM</a><a class="post-meta__tags" href="/tags/2025/">2025</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/5d24249ca672/" title="孕妇产后脱发原因详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">孕妇产后脱发原因详解</div></div><div class="info-2"><div class="info-item-1"> 产后脱发是困扰许多新妈妈的常见问题。在宝宝出生后的3-6个月，许多妈妈会发现自己的头发“大把大把”地掉，甚至会担心自己会因此而秃顶。这种现象在医学上称为产后休止期脱发 (Postpartum Telogen Effluvium)。虽然看起来非常严重，但它通常是一个生理性过程，了解其背后的原因有助于新妈妈们消除焦虑，并采取适当的护理措施。  核心思想：产后脱发主要是由于孕期和产后体内激素水平的急剧变化引起的，辅以营养不足、精神压力、睡眠缺乏等因素共同作用。这种脱发通常是暂时的，并在产后6-12个月内逐渐恢复。   一、什么是产后脱发？产后脱发是指女性在分娩后一段时间内出现的异常脱发现象。它与雄激素性脱发不同，通常表现为弥漫性脱发，即头发均匀地脱落，而不是局部秃斑。其特点是休止期脱发，即毛囊过早进入休止期并脱落。 1.1 头发的生长周期为了更好地理解产后脱发，我们首先需要了解头发的正常生长周期：  生长期 (Anagen Phase)：头发活跃生长的阶段，持续2-7年。大部分（约85-90%）的头发处于这一阶段。 退行期 (Catagen Phase)：生长停止，毛囊开始萎缩，持续...</div></div></div></a><a class="pagination-related" href="/d244228688e5/" title="HLS (HTTP Live Streaming) 协议详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">HLS (HTTP Live Streaming) 协议详解</div></div><div class="info-2"><div class="info-item-1"> HLS (HTTP Live Streaming) 是 Apple 公司在 2009 年推出的一种基于 HTTP 的自适应比特率流媒体传输协议。它将整个媒体流切割成一系列小的、基于 HTTP 的文件片段，通常是 MPEG-2 Transport Stream (TS) 格式。客户端下载这些片段，并通过一个被称为 “manifest” 或 “playlist” 的 M3U8 文件来获取片段的顺序和可用的比特率版本。HLS 最初是为了在 iOS 设备上播放流媒体而设计，但由于其简单、CDN 友好以及自适应比特率等优势，现已成为互联网上最流行的流媒体协议之一。  核心思想：将视频内容切分成小段（TS 文件），用 M3U8 文件描述这些片段的顺序和不同质量版本，客户端通过 HTTP 渐进下载和播放，并根据网络状况动态切换视频质量。   一、为什么需要 HLS？在 HLS 出现之前，传统的流媒体协议如 RTMP (Real-Time Messaging Protocol) 依赖于特定的服务器和协议栈，需要专门的流媒体服务器，并且在防火墙和 CDN 部署方面存在一些挑战。HLS 的出现旨在...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/914c30a1659f/" title="Three.js 进阶教程：从核心概念到高级应用"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-26.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-14</div><div class="info-item-2">Three.js 进阶教程：从核心概念到高级应用</div></div><div class="info-2"><div class="info-item-1"> Three.js 不仅仅是一个库，它是一个通往 3D 世界的大门。通过它，我们可以在 Web 浏览器中构建出令人惊叹的交互式体验。本教程将带你超越入门，深入了解 Three.js 的核心组件、工作原理以及一些高级技巧，助你构建更复杂、更酷炫的 3D 应用。  “深入 Three.js，你将发现 Web 前端的无限可能性。”   一、Three.js 核心工作流回顾与进阶在入门教程中，我们介绍了 Three.js 的“四大件”：场景 (Scene)、相机 (Camera)、渲染器 (Renderer) 和物体 (Object &#x3D; Geometry + Material)。它们是构建任何 Three.js 应用的基础。 1.1 渲染管线概览     graph TD     A[JavaScript Code （Three.js）] --&gt; B(初始化: Scene, Camera, Renderer);     B --&gt; C(创建 Mesh: Geometry + Material);     C --&gt; D(添加 Lights);     C --...</div></div></div></a><a class="pagination-related" href="/2565d3c3db01/" title="Go语言embed包详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-14.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-12</div><div class="info-item-2">Go语言embed包详解</div></div><div class="info-2"><div class="info-item-1"> Go 标准库从 Go 1.16 版本开始引入了 embed 1 包。这个包提供了一种简单、声明式的方式，允许开发者将静态文件（如 HTML 模板、CSS、JavaScript、图片、配置文件等）直接嵌入到 Go 可执行文件中。这意味着你可以通过一个独立的二进制文件分发所有应用程序所需的资源，而无需额外管理外部文件，极大地简化了部署和分发过程。  核心思想：将应用程序的外部资源（静态文件）编译进最终的二进制文件，实现“单一二进制文件”的发布和部署，消除外部文件依赖带来的复杂性。   一、为什么需要 embed 包？在 embed 包之前，Go 语言应用程序处理静态资源通常有以下几种方式：  外部文件：将静态文件与可执行文件放在一起分发。这会带来：  部署复杂性：需要确保文件结构正确，并处理文件丢失或路径错误的问题。 文件篡改风险：外部文件容易被修改，可能影响程序的行为或安全性。 分发不便：每次更新都需要同步可执行文件和所有相关资源文件。   go:embed 第三方库：许多第三方库（如 go-bindata, packr）实现了文件嵌入功能。这些库虽然有效，但通常需要一些额外的构...</div></div></div></a><a class="pagination-related" href="/902d004f5ccc/" title="浏览器指纹 (Browser Fingerprinting) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-13.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-15</div><div class="info-item-2">浏览器指纹 (Browser Fingerprinting) 详解</div></div><div class="info-2"><div class="info-item-1"> 浏览器指纹 (Browser Fingerprinting) 是一种用于识别或追踪用户在线行为的技术，即使在用户清除了 cookies、使用无痕模式甚至更换 IP 地址之后，它也能尝试标识出唯一的用户或设备。与 cookies 不同，浏览器指纹不是存储在用户设备上的数据，而是通过收集用户浏览器的各种配置和设置信息来生成的。  “你的浏览器就像你的手纹一样，看似普通，却独一无二。”   一、什么是浏览器指纹？浏览器指纹是指网站或在线服务通过收集用户浏览器和设备的大量可公开信息（如操作系统、浏览器类型和版本、屏幕分辨率、字体、插件、MIME 类型、时区、语言设置、GPU 信息、Canvas 渲染结果、AudioContext 信息等），并将这些信息综合起来生成一个近似唯一的“指纹”，从而在一定概率上识别单个用户或设备的技术。 这个“指纹”的强大之处在于其持久性和隐蔽性，用户很难通过常规手段进行清除或规避。 二、浏览器指纹的工作原理网站通过 JavaScript 或其他客户端脚本，在用户访问时执行一系列操作来获取其浏览器和设备特征。这些特征包括： 1. HTTP 请求头信息 (HTT...</div></div></div></a><a class="pagination-related" href="/c1df397eedad/" title="TypeScript 各版本新特性详解 (TypeScript 1.0 至 最新稳定版)"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-15.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-17</div><div class="info-item-2">TypeScript 各版本新特性详解 (TypeScript 1.0 至 最新稳定版)</div></div><div class="info-2"><div class="info-item-1"> TypeScript 是由 Microsoft 开发和维护的一种开源编程语言。它是 JavaScript 的一个超集，添加了可选的静态类型、类、接口等特性，旨在提高大型应用开发的效率和可维护性。自 2012 年首次发布以来，TypeScript 社区每月或每季度发布一个新版本，不断引入新的语言特性、编译器优化、工具改进和类型系统增强。理解这些版本特性对于 TypeScript 开发者来说至关重要，它能帮助我们编写更健壮、更现代化且更易于维护的代码。  核心思想： TypeScript 的版本迭代始终围绕着“提升开发者体验、增强类型安全性、更好地支持 JavaScript 新特性、改进工具链”这些目标，旨在弥合 JavaScript 的动态性与大型应用开发对静态分析需求的差距。   一、TypeScript 1.0 - 1.8：早期奠基与核心功能TypeScript 在早期版本主要关注语言的稳定、核心功能的完善以及与 JavaScript 的兼容性。 1.1 TypeScript 1.0 (2014-04-02) 第一个稳定版本：标志着 TypeScript 正式可以用于生产环境...</div></div></div></a><a class="pagination-related" href="/cdecf00b2f41/" title="GoLang Wails 框架详解：用 Web 技术构建桌面应用"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-18</div><div class="info-item-2">GoLang Wails 框架详解：用 Web 技术构建桌面应用</div></div><div class="info-2"><div class="info-item-1"> Wails 是一个 Go 语言编写的框架，用于使用 Go 语言的强大后端能力和熟悉的 Web 前端技术（HTML、CSS、JavaScript&#x2F;TypeScript、以及任何前端框架如 React、Vue、Angular、Svelte 等）构建轻量级、高性能、原生的跨平台桌面应用程序。它与 Tauri 类似，都是 Electron 的替代品，但 Wails 的核心优势在于其后端是 Go 语言，这对于 Go 开发者来说更具亲和力。  核心思想：将现代 Web 前端技术与 Go 语言编写的原生后端无缝结合，通过操作系统的 WebView 渲染 UI，实现高性能、低资源消耗且易于 Go 开发者上手的桌面应用开发。    一、为什么选择 Wails？与 Electron 相比，Wails 提供了一系列优势，特别吸引 Go 语言开发者：  极小的捆包体积：Wails 应用同样不捆绑 Chromium 或 Node.js 运行时。它利用操作系统自带的 WebView 控件（如 Windows 上的 WebView2&#x2F;EdgeHTML、macOS 上的 WKWebView...</div></div></div></a><a class="pagination-related" href="/f200f6bfe5fa/" title="Golang 特殊注释 (Special Comments) 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-11.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-15</div><div class="info-item-2">Golang 特殊注释 (Special Comments) 详解</div></div><div class="info-2"><div class="info-item-1"> 在 Go 语言中，除了我们日常用于解释代码逻辑的普通注释 // 和 /* */ 之外，还存在一些具有特殊含义的注释。这些特殊注释通常以 //go: 或 // + 开头，它们并不是为程序员阅读而生，而是作为指令直接与 Go 工具链（编译器、链接器、go generate 等）交互，用于控制编译行为、生成代码、导入 C 代码，或者提供额外的信息。  核心思想：特殊注释是 Go 工具链的“命令”，用于扩展 Go 语言的能力，例如嵌入文件、生成代码、与 C 语言交互或进行性能优化。   一、Go 特殊注释的分类与作用Go 的特殊注释大致可以分为几类：  编译器指令 (Build Constraints)：控制哪些文件或代码块在特定条件下编译。 代码生成指令 (go generate)：标记需要执行特定外部工具来生成代码的位置。 cgo 指令：用于 Go 和 C&#x2F;C++ 代码之间的互操作。 embed 指令：将静态文件嵌入到 Go 二进制文件中 (Go 1.16+)。 运行时或工具指令：用于性能分析、内存管理等内部或高级用途。  接下来的章节将详细介绍这些特殊注释。 二、//g...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">455</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">226</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">81</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Drizzle-ORM%EF%BC%9F"><span class="toc-text">一、为什么需要 Drizzle ORM？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Drizzle-ORM-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">二、Drizzle ORM 的核心概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Drizzle-ORM-%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">三、Drizzle ORM 架构与工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-text">3.1 架构图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-Schema-%E5%88%B0%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="toc-text">3.2 工作流程 (Schema 到数据操作)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Drizzle-ORM-%E5%85%A5%E9%97%A8%E4%B8%8E%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-text">四、Drizzle ORM 入门与基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AE%89%E8%A3%85"><span class="toc-text">4.1 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E9%85%8D%E7%BD%AE-drizzle-config-ts"><span class="toc-text">4.2 配置 drizzle.config.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E4%B8%8E-Schema-%E5%AE%9A%E4%B9%89"><span class="toc-text">4.3 数据库连接与 Schema 定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Drizzle-ORM-%E5%90%84%E7%A7%8D-SQL-%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95%E8%AF%A6%E8%A7%A3"><span class="toc-text">五、Drizzle ORM 各种 SQL 操作方法详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB-Drizzle-Kit"><span class="toc-text">六、数据库迁移 (Drizzle Kit)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Drizzle-ORM-%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%E4%B8%8E%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">七、Drizzle ORM 的优缺点与适用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BC%98%E7%82%B9%EF%BC%9A"><span class="toc-text">7.1 优点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E7%BC%BA%E7%82%B9%EF%BC%9A"><span class="toc-text">7.2 缺点：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="toc-text">7.3 适用场景：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AE%89%E5%85%A8%E6%80%A7%E8%80%83%E8%99%91"><span class="toc-text">八、安全性考虑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">九、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/3059cdc5f529/" title="Golang sqlc 框架详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-32.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang sqlc 框架详解"/></a><div class="content"><a class="title" href="/3059cdc5f529/" title="Golang sqlc 框架详解">Golang sqlc 框架详解</a><time datetime="2026-01-01T22:24:00.000Z" title="发表于 2026-01-02 06:24:00">2026-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/4e0d929e572f/" title="如何防止 Golang Goroutine 泄漏"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-08.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何防止 Golang Goroutine 泄漏"/></a><div class="content"><a class="title" href="/4e0d929e572f/" title="如何防止 Golang Goroutine 泄漏">如何防止 Golang Goroutine 泄漏</a><time datetime="2025-12-30T22:24:00.000Z" title="发表于 2025-12-31 06:24:00">2025-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/0c48c5fa5942/" title="CFFI (C Foreign Function Interface for Python) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CFFI (C Foreign Function Interface for Python) 详解"/></a><div class="content"><a class="title" href="/0c48c5fa5942/" title="CFFI (C Foreign Function Interface for Python) 详解">CFFI (C Foreign Function Interface for Python) 详解</a><time datetime="2025-12-23T22:24:00.000Z" title="发表于 2025-12-24 06:24:00">2025-12-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/03cebd3cc28a/" title="行为驱动开发 (BDD) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="行为驱动开发 (BDD) 详解"/></a><div class="content"><a class="title" href="/03cebd3cc28a/" title="行为驱动开发 (BDD) 详解">行为驱动开发 (BDD) 详解</a><time datetime="2025-12-21T22:24:00.000Z" title="发表于 2025-12-22 06:24:00">2025-12-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/7bb082434be0/" title="测试驱动开发 (TDD) 详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-15.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="测试驱动开发 (TDD) 详解"/></a><div class="content"><a class="title" href="/7bb082434be0/" title="测试驱动开发 (TDD) 详解">测试驱动开发 (TDD) 详解</a><time datetime="2025-12-19T22:24:00.000Z" title="发表于 2025-12-20 06:24:00">2025-12-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-11.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="🆕 2023">🆕 2023</a><a href="/archives/2024/" target="_blank" title="🆒 2024">🆒 2024</a><a href="/archives/2025/" target="_blank" title="👨‍👩‍👦 2025">👨‍👩‍👦 2025</a><a href="/archives/2026/" target="_blank" title="🆙 2026">🆙 2026</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="📁 分类">📁 分类</a><a href="/tags/" target="_blank" title="🔖 标签">🔖 标签</a><a href="/categories/" target="_blank" title="📽️ 时间线">📽️ 时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="💬 说说">💬 说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.7/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.3"></script></div></div></body></html>