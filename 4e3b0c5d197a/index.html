<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Web Components 详解 | 1024 维度</title><meta name="author" content="TeaTang"><meta name="copyright" content="TeaTang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Web Components 是一套 W3C 标准，旨在让开发者能够创建可复用、封装的自定义 HTML 元素。这套技术允许开发者构建完全独立于任何框架的、原生的组件，并在任何现代 Web 应用中使用它们。Web Components 弥合了因浏览器原生功能不足而导致需要引入大型 JavaScript 框架来构建组件的差距。  核心思想：将 Web 页面构建的基石从浏览器内置元素扩展到可由开发者自">
<meta property="og:type" content="article">
<meta property="og:title" content="Web Components 详解">
<meta property="og:url" content="https://blog.tbf1211.xx.kg/4e3b0c5d197a/index.html">
<meta property="og:site_name" content="1024 维度">
<meta property="og:description" content="Web Components 是一套 W3C 标准，旨在让开发者能够创建可复用、封装的自定义 HTML 元素。这套技术允许开发者构建完全独立于任何框架的、原生的组件，并在任何现代 Web 应用中使用它们。Web Components 弥合了因浏览器原生功能不足而导致需要引入大型 JavaScript 框架来构建组件的差距。  核心思想：将 Web 页面构建的基石从浏览器内置元素扩展到可由开发者自">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-04.jpg">
<meta property="article:published_time" content="2026-02-07T22:24:00.000Z">
<meta property="article:modified_time" content="2026-02-28T09:37:21.892Z">
<meta property="article:author" content="TeaTang">
<meta property="article:tag" content="Web技术">
<meta property="article:tag" content="前端技术">
<meta property="article:tag" content="2026">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.tbf1211.xx.kg/img/cover/default_cover-04.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Web Components 详解",
  "url": "https://blog.tbf1211.xx.kg/4e3b0c5d197a/",
  "image": "https://blog.tbf1211.xx.kg/img/cover/default_cover-04.jpg",
  "datePublished": "2026-02-07T22:24:00.000Z",
  "dateModified": "2026-02-28T09:37:21.892Z",
  "author": [
    {
      "@type": "Person",
      "name": "TeaTang",
      "url": "https://blog.tbf1211.xx.kg"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon-1.ico"><link rel="canonical" href="https://blog.tbf1211.xx.kg/4e3b0c5d197a/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><meta name="google-site-verification" content="NdIUXAOVyGnnBhcrip0ksCawbdAzT0hlBZDE9u4jx6k"/><meta name="msvalidate.01" content="567E47D75E8DCF1282B9623AD914701E"/><meta name="baidu-site-verification" content="code-pE5rnuxcfD"/><link rel="stylesheet" href="/css/index.css?v=5.5.4"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const hour = new Date().getHours()
          const isNight = hour <= 6 || hour >= 7
          if (theme === undefined) isNight ? activateDarkMode() : activateLightMode()
          else theme === 'light' ? activateLightMode() : activateDarkMode()
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":true,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400,"highlightFullpage":true,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: TeaTang","link":"链接: ","source":"来源: 1024 维度","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.13.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Web Components 详解',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://jsd.012700.xyz"><link href="/self/btf.css" rel="stylesheet"><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="1024 维度" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">567</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">85</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/cover/default_cover-04.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">1024 维度</span></a><a class="nav-page-title" href="/"><span class="site-name">Web Components 详解</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 我的轨迹</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/2023/"><i class="fa-fw fa-solid fa-bug"></i><span> 2023</span></a></li><li><a class="site-page child" href="/archives/2024/"><i class="fa-fw fa-solid fa-code"></i><span> 2024</span></a></li><li><a class="site-page child" href="/archives/2025/"><i class="fa-fw fa-solid fa-network-wired"></i><span> 2025</span></a></li><li><a class="site-page child" href="/archives/2026/"><i class="fa-fw fa-solid fa-code-branch"></i><span> 2026</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo"><i class="fa-fw fas fa-comment"></i><span> 说说</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Web Components 详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2026-02-07T22:24:00.000Z" title="发表于 2026-02-08 06:24:00">2026-02-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/Web%E6%8A%80%E6%9C%AF/">Web技术</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p><strong>Web Components</strong> 是一套 W3C 标准，旨在让开发者能够创建可复用、封装的自定义 HTML 元素。这套技术允许开发者构建完全独立于任何框架的、原生的组件，并在任何现代 Web 应用中使用它们。Web Components 弥合了因浏览器原生功能不足而导致需要引入大型 JavaScript 框架来构建组件的差距。</p>
</blockquote>
<div class="note info flat"><p>核心思想：将 Web 页面构建的基石从浏览器内置元素扩展到可由开发者自定义的元素，实现组件级别的标准化封装和复用。</p>
</div>

<hr>
<h2 id="一、为什么需要-Web-Components？"><a href="#一、为什么需要-Web-Components？" class="headerlink" title="一、为什么需要 Web Components？"></a>一、为什么需要 Web Components？</h2><p>在现代 Web 开发中，组件化已成为构建复杂用户界面的核心范式。React、Vue、Angular 等流行 JavaScript 框架都提供了强大的组件化能力。然而，这些框架的组件通常是特定于框架的，这意味着：</p>
<ul>
<li><strong>框架锁定 (Framework Lock-in)</strong>：用一个框架开发的组件可能难以在另一个框架或纯 JavaScript 项目中复用。</li>
<li><strong>浏览器兼容性问题</strong>：许多框架提供的组件化能力是基于其运行时实现的，而非浏览器原生支持。</li>
<li><strong>重复造轮子</strong>：每个框架都需要开发自己的组件模型和生命周期管理，增加了学习成本和维护负担。</li>
</ul>
<p>Web Components 的出现正是为了解决这些问题，提供浏览器原生的组件化能力，使得：</p>
<ul>
<li><strong>跨框架兼容性</strong>：用 Web Components 构建的组件可以在任何框架或库中使用，甚至在纯 JavaScript&#x2F;HTML 项目中也能无缝集成。</li>
<li><strong>代码封装与复用</strong>：组件拥有独立的标记、样式和行为，不易与其他代码冲突，提高了代码的可维护性和复用性。</li>
<li><strong>标准驱动</strong>：基于浏览器原生标准，无需额外运行时，减少了项目依赖和包体积。</li>
<li><strong>未来可期</strong>：随着浏览器对新 Web 标准的不断支持，Web Components 将获得更好的性能和生态系统集成。</li>
</ul>
<h2 id="二、Web-Components-的四大核心技术"><a href="#二、Web-Components-的四大核心技术" class="headerlink" title="二、Web Components 的四大核心技术"></a>二、Web Components 的四大核心技术</h2><p>Web Components 并非单一技术，而是由四项独立的 W3C 标准组合而成，它们协同工作，共同实现了组件化目标。</p>
<h3 id="2-1-Custom-Elements-自定义元素"><a href="#2-1-Custom-Elements-自定义元素" class="headerlink" title="2.1 Custom Elements (自定义元素)"></a>2.1 Custom Elements (自定义元素)</h3><p><strong>Custom Elements</strong> 规范允许开发者定义新的 HTML 标签。这些自定义标签具有自定义的行为和生命周期，并且可以像任何其他 HTML 元素一样被使用。</p>
<ul>
<li><strong>概念:</strong><ul>
<li><strong>Autonomous Custom Elements (自治自定义元素)</strong>：完全独立，继承自 <code>HTMLElement</code>。例如 <code>&lt;my-button&gt;</code>。</li>
<li><strong>Customized Built-in Elements (自定义内置元素)</strong>：继承自现有 HTML 元素（如按钮、段落），并扩展其功能。例如 <code>&lt;button is=&quot;my-custom-button&quot;&gt;</code>。目前浏览器支持度不如自治自定义元素。</li>
</ul>
</li>
<li><strong>命名要求:</strong><ul>
<li>自定义元素名称必须包含连字符 (<code>-</code>)。例如 <code>my-element</code> 是合法的，<code>myelement</code> 是非法的。这是为了避免与未来可能出现的 HTML 元素名称冲突。</li>
</ul>
</li>
<li><strong>生命周期回调:</strong><ul>
<li><code>constructor()</code>: 当元素被创建或升级时调用。</li>
<li><code>connectedCallback()</code>: 当元素被添加到文档 DOM 时调用，例如被插入到页面。</li>
<li><code>disconnectedCallback()</code>: 当元素从文档 DOM 中被移除时调用。</li>
<li><code>adoptedCallback()</code>: 当元素被移动到新的文档时调用（例如通过 <code>document.adoptNode</code>）。</li>
<li><code>attributeChangedCallback(name, oldValue, newValue)</code>: 当元素的属性（在 <code>observedAttributes</code> 数组中声明的）被添加、移除或更改时调用。</li>
</ul>
</li>
</ul>
<h3 id="2-2-Shadow-DOM-影子-DOM"><a href="#2-2-Shadow-DOM-影子-DOM" class="headerlink" title="2.2 Shadow DOM (影子 DOM)"></a>2.2 Shadow DOM (影子 DOM)</h3><p><strong>Shadow DOM</strong> 规范提供了一种将 DOM 子树（以及其中的样式）封装到元素内部的方式，使其与主文档的 DOM 保持独立。这意味着 Shadow DOM 内部的结构和样式不会影响外部文档，外部文档的样式也默认不会影响 Shadow DOM 内部。这实现了组件的<strong>样式和结构封装</strong>，避免了全局 CSS 污染。</p>
<ul>
<li><strong>Shadow Root (影子根)</strong>：每个 Shadow DOM 都有一个影子根，它是真实 DOM 和 Shadow DOM 之间的连接点。元素可以附加一个影子根。</li>
<li><strong>Host (宿主元素)</strong>：附加了 Shadow DOM 的那个元素被称为宿主元素。</li>
<li><strong>封装性:</strong><ul>
<li><strong>样式封装</strong>：Shadow DOM 内的样式默认只作用于内部，不会泄露到外部。外部样式通常不会穿透到 Shadow DOM 内部（除了少数继承属性如 <code>font-family</code>, <code>color</code>）。</li>
<li><strong>DOM 封装</strong>：Shadow DOM 内的节点不会被主文档的 <code>querySelector</code> 等方法直接选中。它们是独立的渲染树。</li>
</ul>
</li>
</ul>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TD
    %% 节点定义
    A[html]
    B[body]
    C[&quot;main-component&quot;]
    F[&quot;div (Regular DOM)&quot;]

    %% 结构连接
    A --&gt; B
    B --&gt; C
    C --&gt; F

    %% Shadow DOM 部分使用子图包裹，增强视觉隔离
    subgraph ShadowBoundary [Shadow DOM 边界]
        direction TB
        SD([&quot;#shadow-root (open)&quot;])
        D[div]
        E[p]
        SD --&gt; D
        SD --&gt; E
    end

    %% 连接到 Shadow Root
    C -. Attaches .-&gt; SD

  </pre></div>
<ul>
<li><strong>开放 Shadow Root (<code>mode: &#39;open&#39;</code>)</strong>：允许 JavaScript 从外部访问 Shadow DOM。</li>
<li><strong>封闭 Shadow Root (<code>mode: &#39;closed&#39;</code>)</strong>：不允许 JavaScript 从外部访问 Shadow DOM。</li>
</ul>
<h3 id="2-3-HTML-Templates-和"><a href="#2-3-HTML-Templates-和" class="headerlink" title="2.3 HTML Templates (&lt;template&gt; 和 &lt;slot&gt;)"></a>2.3 HTML Templates (<code>&lt;template&gt;</code> 和 <code>&lt;slot&gt;</code>)</h3><p><strong>HTML Templates</strong> 规范 (<code>&lt;template&gt;</code> 和 <code>&lt;slot&gt;</code> 元素) 允许在 HTML 中定义可被克隆和复用的标记结构，但这些结构在页面加载时不会被立即渲染。</p>
<ul>
<li><p><strong><code>&lt;template&gt;</code> 元素:</strong></p>
<ul>
<li>用于声明一段不会立即渲染的 HTML 代码片段。</li>
<li>其内容会被浏览器解析，但不会作为 DOM 渲染，也不会加载图片或执行脚本。</li>
<li>可以通过 JavaScript 访问其 <code>content</code> 属性来获取一个 <code>DocumentFragment</code>，然后克隆并插入到 Shadow DOM 或其他 DOM 中。</li>
</ul>
</li>
<li><p><strong><code>&lt;slot&gt;</code> 元素:</strong></p>
<ul>
<li>用于在 Shadow DOM 内部创建<strong>占位符</strong>。</li>
<li>允许父组件将自己的内容“注入”到子组件的 Shadow DOM 中的指定位置。这称为<strong>内容分发 (Content Distribution)</strong>。</li>
<li><code>name</code> 属性可以用于命名插槽，以便父组件可以将特定内容插入到特定的命名插槽中。没有 <code>name</code> 属性的插槽是默认插槽。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Component Definition (inside Shadow DOM) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"><span class="comment">/* ... */</span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span> <span class="comment">&lt;!-- Default slot --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Component Usage --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-card</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Card Title<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is the card content.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span>&gt;</span>Card Footer<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">my-card</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-4-ES-Modules-ES-模块"><a href="#2-4-ES-Modules-ES-模块" class="headerlink" title="2.4 ES Modules (ES 模块)"></a>2.4 ES Modules (ES 模块)</h3><p>虽然不是 Web Components 标准的一部分，但 <strong>ES Modules (JavaScript 模块)</strong> 在现代 Web Components 开发中扮演着关键角色。它们提供了标准化的方式来导入和导出 JavaScript 代码，使得 Web Components 的定义可以组织成模块，方便复用、管理依赖和延迟加载。</p>
<ul>
<li><strong>无需构建工具</strong>：可以直接在浏览器中使用 <code>&lt;script type=&quot;module&quot;&gt;&lt;/script&gt;</code> 来加载组件。</li>
<li><strong>依赖管理</strong>：方便导入其他模块或库。</li>
</ul>
<h2 id="三、Web-Components-的工作原理-创建与使用"><a href="#三、Web-Components-的工作原理-创建与使用" class="headerlink" title="三、Web Components 的工作原理 (创建与使用)"></a>三、Web Components 的工作原理 (创建与使用)</h2><p>创建一个 Web Component 通常包括以下几个步骤：</p>
<ol>
<li><strong>定义组件的 HTML 模板和样式 (可选):</strong> 使用 <code>&lt;template&gt;</code> 元素来定义组件的结构和样式。</li>
<li><strong>创建 Custom Element 类:</strong> 定义一个 JavaScript 类，它扩展了 <code>HTMLElement</code>。<ul>
<li>在类的 <code>constructor</code> 中附加 Shadow DOM (如果需要)。</li>
<li>将模板内容克隆并插入到 Shadow DOM 中。</li>
<li>实现生命周期回调函数 (如 <code>connectedCallback</code>, <code>attributeChangedCallback</code>)。</li>
</ul>
</li>
<li><strong>注册 Custom Element:</strong> 使用 <code>customElements.define()</code> 方法将你定义的类与一个自定义的 HTML 标签名关联起来。</li>
<li><strong>在 HTML 中使用:</strong> 像使用任何内置 HTML 标签一样使用你的自定义元素。</li>
</ol>
<div class="mermaid-wrap"><pre class="mermaid-src" data-config="{}" hidden>
    graph TB
    %% --- 定义层 ---
    subgraph Definition [&quot;1. Class Definition (JS)&quot;]
        direction LR
        Base([HTMLElement]) -- extends --&gt; MyClass[MyCustomElement Class]
        
        subgraph Lifecycle [&quot;Lifecycle Callbacks&quot;]
            MyClass --&gt; CB1[constructor]
            MyClass --&gt; CB2[connectedCallback]
            MyClass --&gt; CB3[attributeChanged]
        end
    end

    %% --- 模板层 ---
    subgraph Template [&quot;2. Template &amp; Shadow DOM&quot;]
        direction TB
        Tpl[&lt; template &gt;] -- cloneNode --&gt; Frag[[DocumentFragment]]
        Frag -- append --&gt; SR#shadow-root
    end

    %% --- 关联逻辑 ---
    MyClass -- &quot;calls .attachShadow()&quot; --&gt; SR

    %% --- 注册与使用层 ---
    subgraph Registration [&quot;3. Registration &amp; Usage&quot;]
        direction TB
        Reg[[customElements.define]]
        HTML[index.html]
        Tag[my-custom-element]
    end

    %% --- 全局流向 ---
    MyClass --&gt; Reg
    Reg -- &quot;notifies parser&quot; --&gt; HTML
    HTML -- &quot;instantiates&quot; --&gt; Tag
    Tag -- &quot;renders via&quot; --&gt; SR

    %% --- 样式美化 ---
    style MyClass fill:#bb86fc,color:#000,font-weight:bold
    style SR fill:#03dac6,color:#000,stroke-width:2px
    style Tag fill:#cf6679,color:#000,font-weight:bold
    style Reg fill:#018786,color:#fff
    
    classDef callback fill:#2d2d2d,stroke:#03dac6,stroke-dasharray: 5 5,color:#03dac6
    class CB1,CB2,CB3 callback
  </pre></div>

<h2 id="四、与主流前端框架的比较"><a href="#四、与主流前端框架的比较" class="headerlink" title="四、与主流前端框架的比较"></a>四、与主流前端框架的比较</h2><table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">Web Components</th>
<th align="left">React&#x2F;Vue&#x2F;Angular</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>基础</strong></td>
<td align="left">浏览器原生标准</td>
<td align="left">特定框架的生态系统和运行时</td>
</tr>
<tr>
<td align="left"><strong>互操作性</strong></td>
<td align="left">极佳，可与任何框架或纯 JS 互用</td>
<td align="left">通常仅限于同一框架内部，跨框架复用困难</td>
</tr>
<tr>
<td align="left"><strong>封装性</strong></td>
<td align="left">Shadow DOM 提供原生样式和 DOM 封装</td>
<td align="left">通常利用 CSS Modules, JSS 或约定进行封装</td>
</tr>
<tr>
<td align="left"><strong>学习曲线</strong></td>
<td align="left">熟悉标准后直接使用，但生态工具相对不成熟</td>
<td align="left">需要学习框架特有的概念、API 和最佳实践</td>
</tr>
<tr>
<td align="left"><strong>性能</strong></td>
<td align="left">原生浏览器性能，无框架运行时开销</td>
<td align="left">框架会引入一定的运行时开销和虚拟 DOM  diff 成本</td>
</tr>
<tr>
<td align="left"><strong>工具链&#x2F;生态</strong></td>
<td align="left">仍在发展中，但不断成熟</td>
<td align="left">极其丰富和成熟的工具链、库和社区支持</td>
</tr>
<tr>
<td align="left"><strong>数据管理</strong></td>
<td align="left">没有内置的数据流管理方案，需要自行实现或结合其他库</td>
<td align="left">各自有成熟的状态管理方案 (Redux, Vuex, Ngrx)</td>
</tr>
<tr>
<td align="left"><strong>SSR&#x2F;SSG</strong></td>
<td align="left">原生支持，但需要额外处理 Shadow DOM 的渲染</td>
<td align="left">通常有完善的 SSR&#x2F;SSG 解决方案</td>
</tr>
<tr>
<td align="left"><strong>应用场景</strong></td>
<td align="left">可复用 UI 库、设计系统、微前端、遗留系统整合</td>
<td align="left">几乎所有前端应用，特别是复杂SPA</td>
</tr>
</tbody></table>
<p>Web Components 旨在成为一个“低层级”的浏览器 API，提供构建组件的基础能力。而像 React、Vue 这样的框架则是在这个基础上提供了更高级的抽象、数据流管理、路由、状态管理等“高层级”的开发体验。它们并非互相替代，而是可以互相补充。许多框架现在也提供了更好的方式来集成和使用 Web Components。</p>
<h2 id="五、浏览器支持"><a href="#五、浏览器支持" class="headerlink" title="五、浏览器支持"></a>五、浏览器支持</h2><p>目前，所有主流现代浏览器（Chrome, Firefox, Safari, Edge）都已全面支持 Web Components 的四大核心标准。</p>
<ul>
<li>Custom Elements: 100%</li>
<li>Shadow DOM: 100%</li>
<li>HTML Templates: 100%</li>
<li>ES Modules: 100%</li>
</ul>
<p>对于旧版浏览器，可以通过 Polyfills 来提供支持，但这会增加额外的文件大小和运行时开销。</p>
<h2 id="六、Web-Components-的挑战"><a href="#六、Web-Components-的挑战" class="headerlink" title="六、Web Components 的挑战"></a>六、Web Components 的挑战</h2><p>尽管 Web Components 提供了强大的原生组件化能力，但也面临一些挑战：</p>
<ul>
<li><strong>CSS 样式穿透和主题化</strong>：Shadow DOM 的样式封装性虽然是优点，但在某些场景下（如需要全局主题、样式继承或动态改变内部样式）可能会带来不便。需要使用 CSS 变量 (<code>--var</code>) 或 Shadow Parts (<code>::part()</code>) 等技术来解决。</li>
<li><strong>服务器端渲染 (SSR)</strong>：在服务器端渲染 Web Components 相对复杂，尤其是在处理 Shadow DOM 时，需要额外的工具和策略确保客户端能够正确“hydrate”组件。</li>
<li><strong>工具链与生态系统</strong>：相较于主流前端框架，Web Components 的工具链（如测试、Linting、Bundling）和库生态系统仍在发展中，不如框架丰富和成熟。</li>
<li><strong>开发体验</strong>：纯原生 Web Components 的开发体验可能不如框架提供的抽象那样简洁和高效，特别是对于状态管理和响应式更新。</li>
<li><strong>状态管理</strong>：Web Components 自身不提供内置的状态管理方案，开发者需要自行选择或实现。</li>
</ul>
<h2 id="七、代码示例"><a href="#七、代码示例" class="headerlink" title="七、代码示例"></a>七、代码示例</h2><p>我们将创建一个简单的计数器 Web Component，它包含一个显示计数的文本和一个按钮来增加计数。</p>
<p><strong>文件结构:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my-counter-component/</span><br><span class="line">├── index.html</span><br><span class="line">└── counter-element.js</span><br></pre></td></tr></table></figure>

<p><strong><code>index.html</code>:</strong></p>
<p>这个 HTML 文件会导入并使用我们的自定义计数器组件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Web Components Counter Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f0f0f0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="comment">/* 外部样式，不影响 Shadow DOM 内部 */</span></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span><span class="selector-class">.external-text</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: steelblue;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入自定义元素模块 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;counter-element.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;external-text&quot;</span>&gt;</span>This is an external paragraph.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用我们自定义的计数器元素 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-counter</span> <span class="attr">initial-count</span>=<span class="string">&quot;5&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-counter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-counter</span> <span class="attr">initial-count</span>=<span class="string">&quot;10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">my-counter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><code>counter-element.js</code>:</strong></p>
<p>这是我们自定义计数器组件的定义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义我们的自定义元素类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCounter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HTMLElement</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 定义构造函数，元素被创建时调用</span></span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(); <span class="comment">// 必须调用 super() 来初始化父类 HTMLElement</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 附加 Shadow DOM</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">attachShadow</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;open&#x27;</span> &#125;); <span class="comment">// mode: &#x27;open&#x27; 允许外部 JavaScript 访问 Shadow DOM</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义组件的模板</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">template</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;template&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">template</span>.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;style&gt;</span></span><br><span class="line"><span class="string">                /* Shadow DOM 内部样式，不会泄露到外部 */</span></span><br><span class="line"><span class="string">                :host &#123; /* :host 选择器指的是宿主元素（&lt;my-counter&gt; 自身） */</span></span><br><span class="line"><span class="string">                    display: inline-flex;</span></span><br><span class="line"><span class="string">                    align-items: center;</span></span><br><span class="line"><span class="string">                    background-color: #fff;</span></span><br><span class="line"><span class="string">                    border: 1px solid #ddd;</span></span><br><span class="line"><span class="string">                    padding: 10px 15px;</span></span><br><span class="line"><span class="string">                    border-radius: 5px;</span></span><br><span class="line"><span class="string">                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span></span><br><span class="line"><span class="string">                    margin: 10px;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                .count-display &#123;</span></span><br><span class="line"><span class="string">                    font-size: 1.5em;</span></span><br><span class="line"><span class="string">                    color: #333;</span></span><br><span class="line"><span class="string">                    margin-right: 15px;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                button &#123;</span></span><br><span class="line"><span class="string">                    background-color: #007bff;</span></span><br><span class="line"><span class="string">                    color: white;</span></span><br><span class="line"><span class="string">                    border: none;</span></span><br><span class="line"><span class="string">                    padding: 8px 15px;</span></span><br><span class="line"><span class="string">                    border-radius: 4px;</span></span><br><span class="line"><span class="string">                    cursor: pointer;</span></span><br><span class="line"><span class="string">                    font-size: 1em;</span></span><br><span class="line"><span class="string">                    transition: background-color 0.2s;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                button:hover &#123;</span></span><br><span class="line"><span class="string">                    background-color: #0056b3;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                button:active &#123;</span></span><br><span class="line"><span class="string">                    background-color: #004085;</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &lt;/style&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;count-display&quot;&gt;Count: &lt;span&gt;0&lt;/span&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;button&gt;Increment&lt;/button&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 克隆模板内容并添加到 Shadow DOM</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">template</span>.<span class="property">content</span>.<span class="title function_">cloneNode</span>(<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取Shadow DOM中的元素</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">countDisplay</span> = <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.count-display span&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">incrementButton</span> = <span class="variable language_">this</span>.<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化内部状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_count</span> = <span class="number">0</span>; <span class="comment">// 使用下划线表示私有属性约定</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定事件监听器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">incrementButton</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_increment</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 定义元素观察的属性</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">get</span> <span class="title function_">observedAttributes</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;initial-count&#x27;</span>]; <span class="comment">// 声明要观察的属性</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 生命周期回调：当元素被添加到文档 DOM 时调用</span></span><br><span class="line">    <span class="title function_">connectedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;MyCounter added to DOM.&#x27;</span>);</span><br><span class="line">        <span class="comment">// 从属性中获取 initial-count，如果存在</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">hasAttribute</span>(<span class="string">&#x27;initial-count&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">count</span> = <span class="built_in">parseInt</span>(<span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;initial-count&#x27;</span>), <span class="number">10</span>) || <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 生命周期回调：当元素从文档 DOM 中被移除时调用</span></span><br><span class="line">    <span class="title function_">disconnectedCallback</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;MyCounter removed from DOM.&#x27;</span>);</span><br><span class="line">        <span class="comment">// 清理事件监听器等</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">incrementButton</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="variable language_">this</span>.<span class="property">_increment</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 生命周期回调：当 observedAttributes 中的属性发生变化时调用</span></span><br><span class="line">    <span class="title function_">attributeChangedCallback</span>(<span class="params">name, oldValue, newValue</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (name === <span class="string">&#x27;initial-count&#x27;</span> &amp;&amp; oldValue !== newValue) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">count</span> = <span class="built_in">parseInt</span>(newValue, <span class="number">10</span>) || <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 定义一个 getter/setter for count</span></span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">count</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">_count</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">count</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">_count</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">countDisplay</span>.<span class="property">textContent</span> = <span class="variable language_">this</span>.<span class="property">_count</span>; <span class="comment">// 更新显示</span></span><br><span class="line">        <span class="comment">// 可以派发自定义事件通知外部</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> <span class="title class_">CustomEvent</span>(<span class="string">&#x27;count-changed&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">detail</span>: &#123; <span class="attr">count</span>: <span class="variable language_">this</span>.<span class="property">_count</span> &#125;,</span><br><span class="line">            <span class="attr">bubbles</span>: <span class="literal">true</span>, <span class="comment">// 事件可以冒泡</span></span><br><span class="line">            <span class="attr">composed</span>: <span class="literal">true</span> <span class="comment">// 事件可以穿透 Shadow DOM 边界</span></span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 内部方法，增加计数</span></span><br><span class="line">    <span class="title function_">_increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">count</span>++; <span class="comment">// 调用 setter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. 注册自定义元素</span></span><br><span class="line"><span class="comment">// 第一个参数是自定义标签名（必须包含连字符），第二个是你的类</span></span><br><span class="line">customElements.<span class="title function_">define</span>(<span class="string">&#x27;my-counter&#x27;</span>, <span class="title class_">MyCounter</span>);</span><br></pre></td></tr></table></figure>

<p><strong>运行方式:</strong></p>
<ol>
<li>将上述两个文件（<code>index.html</code> 和 <code>counter-element.js</code>）保存在同一个文件夹中。</li>
<li>用现代浏览器打开 <code>index.html</code> 文件。</li>
</ol>
<p>您将看到页面上出现两个独立的计数器组件。每个计数器都有自己的内部计数状态和样式，并且互不影响。点击每个计数器的“Increment”按钮，只会影响该组件自身的计数。</p>
<p>这个例子展示了：</p>
<ul>
<li>如何使用 <code>class extends HTMLElement</code> 定义自定义元素。</li>
<li>如何使用 <code>this.attachShadow(&#123; mode: &#39;open&#39; &#125;)</code> 附加 Shadow DOM 来封装样式和结构。</li>
<li>如何使用 <code>&lt;template&gt;</code> 元素来定义组件的内部 HTML 结构和 <code>&lt;style&gt;</code>。</li>
<li>如何通过 <code>static get observedAttributes()</code> 和 <code>attributeChangedCallback</code> 来观察和响应 HTML 属性的变化。</li>
<li>如何通过 <code>connectedCallback</code> 和 <code>disconnectedCallback</code> 处理组件的生命周期。</li>
<li>如何在自定义元素内部处理事件 (<code>click</code> 事件)。</li>
<li>如何通过 <code>dispatchEvent</code> 派发自定义事件，与外部（或其他组件）进行通信。</li>
</ul>
<h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>Web Components 提供了一套原生、标准化的组件化解决方案，使开发者能够构建可复用、封装的自定义 HTML 元素。它的四大核心技术——Custom Elements、Shadow DOM、HTML Templates 和 ES Modules——共同为前端应用带来了前所未有的组件互操作性和架构灵活性。</p>
<p>尽管 Web Components 在生态系统成熟度、工具链和某些开发体验方面仍有改进空间，但其作为浏览器原生标准，为构建设计系统、微前端架构和跨框架组件库提供了坚实的基础。通过理解并掌握 Web Components，开发者可以创建更加健壮、可维护且面向未来的 Web 应用。它不是要取代现有前端框架，而是作为这些框架之下的一个强大基石，为构建更开放、更可组合的 Web 生态系统铺平道路。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg">TeaTang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.tbf1211.xx.kg/4e3b0c5d197a/">https://blog.tbf1211.xx.kg/4e3b0c5d197a/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://blog.tbf1211.xx.kg" target="_blank">1024 维度</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web%E6%8A%80%E6%9C%AF/">Web技术</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/">前端技术</a><a class="post-meta__tags" href="/tags/2026/">2026</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/default_cover-04.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/28d59ad3e642/" title="Apache Avro 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-03.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Apache Avro 详解</div></div><div class="info-2"><div class="info-item-1"> Apache Avro 是一个数据序列化系统和远程过程调用 (RPC) 框架，起源于 Apache Hadoop 项目。它的核心目标是提供一个高效、紧凑、跨语言的数据交换和持久化存储解决方案，尤其适用于大数据环境和需要强大Schema 演进 (Schema Evolution) 支持的场景。Avro 通过 JSON 定义数据结构（Schema），但实际数据以紧凑的二进制格式存储，兼顾了可读性与传输效率。  核心思想：以 JSON 定义 Schema (模式) 实现跨语言的数据结构描述，以紧凑二进制格式序列化数据，并通过读写 Schema 差异自动处理数据兼容性，实现高效灵活的数据交换。    一、为什么需要 Avro？在分布式系统和大数据领域，数据交换和存储是核心挑战。传统的数据格式如 JSON 或 XML 虽然具有良好的可读性，但在数据量巨大时，它们的文件体积和解析效率往往成为瓶颈。而其他二进制格式如 Protocol Buffers 或 Thrift 虽然效率高，但通常需要代码生成，且在 Schema 演进和动态语言支持方面存在一些局限性。 Avro 的出现旨在解决这些问题...</div></div></div></a><a class="pagination-related" href="/ecb44ccf1b04/" title="婴儿早期语音发展中的“Mama”与“Baba”现象探究"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">婴儿早期语音发展中的“Mama”与“Baba”现象探究</div></div><div class="info-2"><div class="info-item-1"> “Mama”与“Baba”现象 是指婴儿在早期语言发展阶段，普遍性地、常常是其最早发出的两个具有清晰音节结构的声音，通常被成年人解读为对父母的呼唤。这一现象并非偶然，而是语言学、发展心理学、认知科学以及社会互动等多方面因素共同作用的结果。本报告将从多个维度深入剖析婴儿为何会普遍性地发出这些特定的音节。  核心观点：婴儿发出“Mama”和“Baba”并非一开始就带有明确的指代意义，而是生理发音机制的便捷性、认知发展阶段的特性以及社会环境的强化作用共同促成的。    一、语音学与生理学基础：发音的便捷性婴儿的口腔肌肉和发音器官在早期处于发育阶段，其运动控制能力有限。从语音学角度来看，“m”、“b”和“a”这些音素的结合，对于尚未完全掌握复杂发音技巧的婴儿而言，具有极高的生理便捷性。 1.1 双唇音（Bilabial Consonants）的易发性双唇音（Bilabial Consonants） 指的是发音时双唇闭合或接近，气流通过或振动双唇产生的辅音。例如：  &#x2F;m&#x2F;：鼻腔双唇音 (bilabial nasal)，发音时双唇闭合，软腭下降，气流通过鼻腔。这是所有...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/88fea7b52158/" title="Gzip 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-16.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-30</div><div class="info-item-2">Gzip 详解</div></div><div class="info-2"><div class="info-item-1"> Gzip 是一种广泛使用的数据压缩格式和文件格式，以及基于此格式的软件应用。它主要用于减小文件体积，以便在存储或传输时节省空间和带宽。在Web领域，Gzip压缩是提升网页加载速度、优化用户体验的关键技术之一。  核心概念：Gzip利用了DEFLATE算法对数据进行无损压缩，其优势在于压缩效率高、解压速度快，并被几乎所有现代浏览器和Web服务器广泛支持。    一、Gzip 概述与目的Gzip（GNU zip）最初是作为Unix系统中compress程序的替代品而开发的，旨在提供更高效的压缩算法。它的核心目标是：  减少文件存储空间：对于磁盘上的文件，Gzip可以显著减小其占用的存储空间。 加快数据传输速度：在网络传输中，尤其是Web传输（HTTP&#x2F;HTTPS），通过压缩数据可以减少传输量，从而降低带宽消耗并缩短数据抵达客户端的时间。 节省带宽成本：对于提供大量数据的服务提供商，减少传输数据量直接 translates to 降低带宽费用。  二、Gzip 的工作原理：DEFLATE 算法Gzip 压缩的核心是 DEFLATE 算法，它是一种无损数据压缩算法，结合了两种...</div></div></div></a><a class="pagination-related" href="/f81355a662b8/" title="ECMAScript ShadowRealm 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-02</div><div class="info-item-2">ECMAScript ShadowRealm 详解</div></div><div class="info-2"><div class="info-item-1"> ShadowRealm 是一个 ECMAScript 提案（目前处于 Stage 3 阶段），旨在为 JavaScript 提供一种新的代码隔离机制。它允许在当前 Realm 中创建一个与主 Realm 具有分离的全局对象 (global object) 和 内置对象 (intrinsic objects) 集合的“影子 Realm”。通过 ShadowRealm，开发者可以在一个安全的、受控的环境中执行不受信任的代码或隔离不同的应用程序组件，提供类似于 iframe 但在 JS 层面更细粒度的沙箱能力。  核心思想：ShadowRealm 创建了一个轻量级的 JavaScript 执行环境沙箱。它提供了一套独立的全局对象和内置对象，但共享相同的事件循环 (event loop) 和微任务队列 (microtask queue)。这种隔离有助于提高代码安全性、隔离第三方库、避免全局污染，并为模块化和可插拔架构提供更强大的支持。   一、为什么需要 ShadowRealm？在 JavaScript 生态系统中，代码隔离一直是一个重要的需求，尤其是在以下场景中：  运行不受信任的代...</div></div></div></a><a class="pagination-related" href="/b519dd676c66/" title="PWA (Progressive Web Apps) 深度解析"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-05</div><div class="info-item-2">PWA (Progressive Web Apps) 深度解析</div></div><div class="info-2"><div class="info-item-1"> PWA (Progressive Web Apps - 渐进式 Web 应用) 是一种利用现代 Web 技术，将 Web 应用提升至接近原生应用体验的新方法。它旨在结合 Web 的广阔可达性与原生应用的丰富功能，为用户提供可靠 (Reliable)、快速 (Fast)、沉浸式 (Engaging) 的体验。PWA 不仅仅是一种技术，更是一套开发理念和最佳实践。  核心思想：PWA 的目标是让 Web 应用具备类似原生应用的体验和功能，同时保留 Web 的优点（无需安装、易于发现、跨平台）。这主要通过 Service Worker 实现离线能力和性能优化，通过 Web App Manifest 实现安装和应用体验，以及通过 HTTPS 确保安全性来达成。   一、为什么需要 PWA？(Web 与原生应用的融合)传统 Web 应用和原生移动应用各有优缺点：  传统 Web 应用 (网站)： 优点：无需安装、易于发现、跨平台、更新灵活、共享方便。 缺点：依赖网络、加载慢、无离线功能、无法添加到主屏幕、无法发送推送通知、用户体验与原生应用有差距。   原生移动应用： 优点：性能好、可离...</div></div></div></a><a class="pagination-related" href="/402798405a2e/" title="如何从 HTTP 请求中获取用户 IP 地址详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-20.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-26</div><div class="info-item-2">如何从 HTTP 请求中获取用户 IP 地址详解</div></div><div class="info-2"><div class="info-item-1"> 用户 IP 地址 (Internet Protocol Address) 是互联网上设备的唯一标识符，对于网络服务而言，获取用户 IP 地址是常见需求。它在诸多场景中扮演着关键角色，如日志记录、地理位置定位、安全分析、流量统计、反欺诈和访问控制等。然而，由于现代网络架构中广泛使用代理服务器、负载均衡器和 CDN (内容分发网络)，直接获取用户的真实 IP 地址并非总是直截了当。本文将详细探讨如何从 HTTP 请求中正确、安全地获取用户 IP 地址，并提供 Go 语言示例。  核心思想：获取用户 IP 地址的关键在于理解 HTTP 请求的 RemoteAddr (直接连接客户端的 IP) 和一系列 X-Forwarded-For, X-Real-IP 等非标准但广泛使用的 HTTP 头。正确解析这些信息需要结合部署环境（是否存在代理、CDN）及安全考量。   一、IP 地址及其获取的重要性1.1 什么是 IP 地址？IP 地址是分配给连接到计算机网络的设备的数字标签，用于在网络中标识和定位设备。它分为 IPv4（如 192.168.1.1）和 IPv6（如 2001:0db8:8...</div></div></div></a><a class="pagination-related" href="/e04a0bc3926c/" title="BFCache (Back-Forward Cache) 深度详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-09.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-06</div><div class="info-item-2">BFCache (Back-Forward Cache) 深度详解</div></div><div class="info-2"><div class="info-item-1"> 在 Web 性能优化领域，用户感知的加载速度至关重要。除了常规的网络和渲染优化外，浏览器还有一种强大的特性可以显著提升用户体验，尤其是在用户进行前进&#x2F;后退导航时的加载速度——这就是 BFCache (Back-Forward Cache)，即“往返缓存”或“后退&#x2F;前进缓存”。BFCache 允许浏览器将整个页面（包括 DOM 状态、JavaScript 堆以及当前页面的状态）存储在内存中，以便用户在通过浏览器后退 (Back) 或前进 (Forward) 按钮导航时，能够瞬间恢复到离开时的状态，而无需重新加载页面。  核心思想：BFCache 是一种浏览器优化策略，它将用户离开的整个页面状态（而非仅仅是资源）存储在内存中，以便用户通过“后退&#x2F;前进”按钮再次访问时能够实现即时页面恢复，极大地提升了导航体验。   一、什么是 BFCache？BFCache 是一种用于瞬时页面加载的浏览器缓存机制，其核心思想是：当用户从一个页面 A 导航到页面 B，如果用户随后点击了浏览器的“后退”按钮返回页面 A，浏览器不会重新发送网络请求、重新解析 DOM、重新执行...</div></div></div></a><a class="pagination-related" href="/1ae20d2726d8/" title="MiniRTC 详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-22.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-29</div><div class="info-item-2">MiniRTC 详解</div></div><div class="info-2"><div class="info-item-1"> MiniRTC 是一个概念性框架，旨在简化实时通信 (Real-Time Communication, RTC) 的复杂性，通过关注核心原理和最小化实现，帮助开发者理解 RTC 的工作机制，或在特定受控环境下构建轻量级的实时交互系统。它通常指的是对 WebRTC 等复杂框架的简化实现或教学模型，而非一个特定的标准或库。  核心思想：剥离 WebRTC 等标准 RTC 框架的复杂性，专注于信令交换、点对点连接建立和数据&#x2F;媒体传输的核心流程，以便于学习和在特定场景下进行定制化开发。   一、为什么需要 MiniRTC？WebRTC (Web Real-Time Communication) 是一个强大的开放标准，提供了在浏览器和移动应用之间进行实时语音、视频和数据通信的能力。然而，WebRTC 本身非常复杂，涉及众多协议、API 和技术细节，例如：  复杂的 API 和配置：WebRTC 提供了丰富的 API，但正确使用它们并进行各种配置（如编解码器、网络条件适应性）需要深入理解。 网络穿透 (NAT Traversal)：这是 RTC 最具挑战性的部分之一，需要依靠 S...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">TeaTang</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">567</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">85</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/teatang"><i class="fab fa-github"></i><span>GitHub主页</span></a><div class="card-info-social-icons"><a class="social-icon" href="mailto:tea.tang1211@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">网站更多功能即将上线，敬请期待！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-Web-Components%EF%BC%9F"><span class="toc-text">一、为什么需要 Web Components？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Web-Components-%E7%9A%84%E5%9B%9B%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="toc-text">二、Web Components 的四大核心技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Custom-Elements-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0"><span class="toc-text">2.1 Custom Elements (自定义元素)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Shadow-DOM-%E5%BD%B1%E5%AD%90-DOM"><span class="toc-text">2.2 Shadow DOM (影子 DOM)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-HTML-Templates-%E5%92%8C"><span class="toc-text">2.3 HTML Templates (&lt;template&gt; 和 &lt;slot&gt;)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-ES-Modules-ES-%E6%A8%A1%E5%9D%97"><span class="toc-text">2.4 ES Modules (ES 模块)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Web-Components-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-%E5%88%9B%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-text">三、Web Components 的工作原理 (创建与使用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%8E%E4%B8%BB%E6%B5%81%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6%E7%9A%84%E6%AF%94%E8%BE%83"><span class="toc-text">四、与主流前端框架的比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81"><span class="toc-text">五、浏览器支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Web-Components-%E7%9A%84%E6%8C%91%E6%88%98"><span class="toc-text">六、Web Components 的挑战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-text">七、代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">八、总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/cd5b6fd178d8/" title="go.sum 文件中特殊哈希计算详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-29.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="go.sum 文件中特殊哈希计算详解"/></a><div class="content"><a class="title" href="/cd5b6fd178d8/" title="go.sum 文件中特殊哈希计算详解">go.sum 文件中特殊哈希计算详解</a><time datetime="2026-02-23T22:24:00.000Z" title="发表于 2026-02-24 06:24:00">2026-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/d819fc26cbc7/" title="共识算法详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="共识算法详解"/></a><div class="content"><a class="title" href="/d819fc26cbc7/" title="共识算法详解">共识算法详解</a><time datetime="2026-02-19T22:24:00.000Z" title="发表于 2026-02-20 06:24:00">2026-02-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1c5cbb334a2a/" title="计算机中熵的详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-01.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机中熵的详解"/></a><div class="content"><a class="title" href="/1c5cbb334a2a/" title="计算机中熵的详解">计算机中熵的详解</a><time datetime="2026-02-17T22:24:00.000Z" title="发表于 2026-02-18 06:24:00">2026-02-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/9ed85cc18e8a/" title="CSP并发模型详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSP并发模型详解"/></a><div class="content"><a class="title" href="/9ed85cc18e8a/" title="CSP并发模型详解">CSP并发模型详解</a><time datetime="2026-02-15T22:24:00.000Z" title="发表于 2026-02-16 06:24:00">2026-02-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/0d177e0002e6/" title="程序错误处理详解"><img src="/img/loading.gif" data-lazy-src="/img/cover/default_cover-24.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序错误处理详解"/></a><div class="content"><a class="title" href="/0d177e0002e6/" title="程序错误处理详解">程序错误处理详解</a><time datetime="2026-02-13T22:24:00.000Z" title="发表于 2026-02-14 06:24:00">2026-02-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/cover/default_cover-04.jpg);"><div class="footer-flex"><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">我的轨迹</div><div class="footer-flex-content"><a href="/archives/2023/" target="_blank" title="🆕 2023">🆕 2023</a><a href="/archives/2024/" target="_blank" title="🆒 2024">🆒 2024</a><a href="/archives/2025/" target="_blank" title="👨‍👩‍👦 2025">👨‍👩‍👦 2025</a><a href="/archives/2026/" target="_blank" title="🆙 2026">🆙 2026</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">维度</div><div class="footer-flex-content"><a href="/categories/" target="_blank" title="📁 分类">📁 分类</a><a href="/tags/" target="_blank" title="🔖 标签">🔖 标签</a><a href="/categories/" target="_blank" title="📽️ 时间线">📽️ 时间线</a></div></div></div><div class="footer-flex-items"><div class="footer-flex-item"><div class="footer-flex-title">其他</div><div class="footer-flex-content"><a href="/shuoshuo" target="_blank" title="💬 说说">💬 说说</a></div></div></div></div><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By TeaTang</span><span class="framework-info"><span class="footer-separator">|</span><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.4"></script><script src="/js/main.js?v=5.5.4"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.9/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const parseViewBox = viewBox => {
    if (!viewBox) return null
    const parts = viewBox.trim().split(/[\s,]+/).map(n => Number(n))
    if (parts.length !== 4 || parts.some(n => Number.isNaN(n))) return null
    return parts
  }

  const getSvgViewBox = svg => {
    const attr = parseViewBox(svg.getAttribute('viewBox'))
    if (attr) return attr

    // Fallback: use bbox to build a viewBox
    try {
      const bbox = svg.getBBox()
      if (bbox && bbox.width && bbox.height) return [bbox.x, bbox.y, bbox.width, bbox.height]
    } catch (e) {
      // getBBox may fail on some edge cases; ignore
    }

    const w = Number(svg.getAttribute('width')) || 0
    const h = Number(svg.getAttribute('height')) || 0
    if (w > 0 && h > 0) return [0, 0, w, h]
    return [0, 0, 100, 100]
  }

  const setSvgViewBox = (svg, vb) => {
    svg.setAttribute('viewBox', `${vb[0]} ${vb[1]} ${vb[2]} ${vb[3]}`)
  }

  const clamp = (v, min, max) => Math.max(min, Math.min(max, v))

  const openSvgInNewTab = ({ source, initViewBox }) => {
    const getClonedSvg = () => {
      if (typeof source === 'string') {
        const template = document.createElement('template')
        template.innerHTML = source.trim()
        const svg = template.content.querySelector('svg')
        return svg ? svg.cloneNode(true) : null
      }
      if (source && typeof source.cloneNode === 'function') {
        return source.cloneNode(true)
      }
      return null
    }

    const clone = getClonedSvg()
    if (!clone) return
    if (initViewBox && initViewBox.length === 4) {
      clone.setAttribute('viewBox', initViewBox.join(' '))
    }
    if (!clone.getAttribute('xmlns')) clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg')
    if (!clone.getAttribute('xmlns:xlink') && clone.outerHTML.includes('xlink:')) {
      clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink')
    }
    // inject background to match current theme
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark'
    const bg = getComputedStyle(document.body).backgroundColor || (isDark ? '#1e1e1e' : '#ffffff')
    if (!clone.style.background) clone.style.background = bg

    const serializer = new XMLSerializer()
    const svgSource = serializer.serializeToString(clone)
    const htmlSource = `<!doctype html><html><head><meta charset="utf-8" />
      <style>
        html, body { width: 100%; height: 100%; margin: 0; display: flex; align-items: center; justify-content: center; background: ${bg}; }
        svg { max-width: 100%; max-height: 100%; height: auto; width: auto; }
      </style>
      </head><body>${svgSource}</body></html>`
    const blob = new Blob([htmlSource], { type: 'text/html;charset=utf-8' })
    const url = URL.createObjectURL(blob)
    window.open(url, '_blank', 'noopener')
    setTimeout(() => URL.revokeObjectURL(url), 30000)
  }

  const attachMermaidViewerButton = wrap => {
    let btn = wrap.querySelector('.mermaid-open-btn')
    if (!btn) {
      btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'mermaid-open-btn'
      wrap.appendChild(btn)
    }

    btn.innerHTML = '<i class="fa fa-search fa-fw" aria-hidden="true"></i>'

    if (!btn.__mermaidViewerBound) {
      btn.addEventListener('click', e => {
        e.preventDefault()
        e.stopPropagation()
        const svg = wrap.__mermaidOriginalSvg || wrap.querySelector('svg')
        if (!svg) return
        const initViewBox = wrap.__mermaidInitViewBox
        if (typeof svg === 'string') {
          openSvgInNewTab({ source: svg, initViewBox })
          return
        }
        openSvgInNewTab({ source: svg, initViewBox })
      })
      btn.__mermaidViewerBound = true
    }
  }

  // Zoom around a point (px, py) in the SVG viewport (in viewBox coordinates)
  const zoomAtPoint = (vb, factor, px, py) => {
    const w = vb[2] * factor
    const h = vb[3] * factor
    const nx = px - (px - vb[0]) * factor
    const ny = py - (py - vb[1]) * factor
    return [nx, ny, w, h]
  }

  const initMermaidGestures = wrap => {
    const svg = wrap.querySelector('svg')
    if (!svg) return

    // Ensure viewBox exists so gestures always work
    const initVb = getSvgViewBox(svg)
    wrap.__mermaidInitViewBox = initVb
    wrap.__mermaidCurViewBox = initVb.slice()
    setSvgViewBox(svg, initVb)

    // Avoid binding multiple times on themeChange/pjax
    if (wrap.__mermaidGestureBound) return
    wrap.__mermaidGestureBound = true

    // Helper: map client (viewport) coordinate -> viewBox coordinate
    const clientToViewBox = (clientX, clientY) => {
      const rect = svg.getBoundingClientRect()
      const vb = wrap.__mermaidCurViewBox || getSvgViewBox(svg)
      const x = vb[0] + (clientX - rect.left) * (vb[2] / rect.width)
      const y = vb[1] + (clientY - rect.top) * (vb[3] / rect.height)
      return { x, y, rect, vb }
    }

    const state = {
      pointers: new Map(),
      startVb: null,
      startDist: 0,
      startCenter: null
    }

    const clampVb = vb => {
      const init = wrap.__mermaidInitViewBox || vb
      const minW = init[2] * 0.1
      const maxW = init[2] * 10
      const minH = init[3] * 0.1
      const maxH = init[3] * 10
      vb[2] = clamp(vb[2], minW, maxW)
      vb[3] = clamp(vb[3], minH, maxH)
      return vb
    }

    const setCurVb = vb => {
      vb = clampVb(vb)
      wrap.__mermaidCurViewBox = vb
      setSvgViewBox(svg, vb)
    }

    const onPointerDown = e => {
      // Allow only primary button for mouse
      if (e.pointerType === 'mouse' && e.button !== 0) return
      svg.setPointerCapture(e.pointerId)
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      if (state.pointers.size === 1) {
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      } else if (state.pointers.size === 2) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        state.startDist = Math.hypot(dx, dy)
        state.startVb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        state.startCenter = { x: (pts[0].x + pts[1].x) / 2, y: (pts[0].y + pts[1].y) / 2 }
      }
    }

    const onPointerMove = e => {
      if (!state.pointers.has(e.pointerId)) return
      state.pointers.set(e.pointerId, { x: e.clientX, y: e.clientY })

      // Pan with 1 pointer
      if (state.pointers.size === 1 && state.startVb) {
        const p = [...state.pointers.values()][0]
        const prev = { x: e.clientX - e.movementX, y: e.clientY - e.movementY }
        // movementX/Y unreliable on touch, compute from stored last position
        const last = wrap.__mermaidLastSinglePointer || p
        const dxClient = p.x - last.x
        const dyClient = p.y - last.y
        wrap.__mermaidLastSinglePointer = p

        const { rect } = clientToViewBox(p.x, p.y)
        const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
        const dx = dxClient * (vb[2] / rect.width)
        const dy = dyClient * (vb[3] / rect.height)
        setCurVb([vb[0] - dx, vb[1] - dy, vb[2], vb[3]])
        return
      }

      // Pinch zoom with 2 pointers
      if (state.pointers.size === 2 && state.startVb && state.startDist > 0) {
        const pts = [...state.pointers.values()]
        const dx = pts[0].x - pts[1].x
        const dy = pts[0].y - pts[1].y
        const dist = Math.hypot(dx, dy)
        if (!dist) return
        const factor = state.startDist / dist // dist bigger => zoom in (viewBox smaller)

        const cx = (pts[0].x + pts[1].x) / 2
        const cy = (pts[0].y + pts[1].y) / 2
        const centerClient = { x: cx, y: cy }

        const pxy = clientToViewBox(centerClient.x, centerClient.y)
        const cpx = pxy.x
        const cpy = pxy.y

        const vb = zoomAtPoint(state.startVb, factor, cpx, cpy)
        setCurVb(vb)
      }
    }

    const onPointerUpOrCancel = e => {
      state.pointers.delete(e.pointerId)
      if (state.pointers.size === 0) {
        state.startVb = null
        state.startDist = 0
        state.startCenter = null
        wrap.__mermaidLastSinglePointer = null
      } else if (state.pointers.size === 1) {
        // reset single pointer baseline to avoid jump
        wrap.__mermaidLastSinglePointer = [...state.pointers.values()][0]
      }
    }

    // Wheel zoom (mouse/trackpad)
    const onWheel = e => {
      // ctrlKey on mac trackpad pinch; we treat both as zoom
      e.preventDefault()
      const delta = e.deltaY
      const zoomFactor = delta > 0 ? 1.1 : 0.9
      const { x, y } = clientToViewBox(e.clientX, e.clientY)
      const vb = (wrap.__mermaidCurViewBox || getSvgViewBox(svg)).slice()
      setCurVb(zoomAtPoint(vb, zoomFactor, x, y))
    }

    const onDblClick = () => {
      const init = wrap.__mermaidInitViewBox
      if (!init) return
      wrap.__mermaidCurViewBox = init.slice()
      setSvgViewBox(svg, init)
    }

    svg.addEventListener('pointerdown', onPointerDown)
    svg.addEventListener('pointermove', onPointerMove)
    svg.addEventListener('pointerup', onPointerUpOrCancel)
    svg.addEventListener('pointercancel', onPointerUpOrCancel)
    svg.addEventListener('wheel', onWheel, { passive: false })
    svg.addEventListener('dblclick', onDblClick)
  }

  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild

      // Clear old render (themeChange/pjax will rerun)
      const oldSvg = item.querySelector('svg')
      if (oldSvg) oldSvg.remove()
      item.__mermaidGestureBound = false

      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
        if (false) initMermaidGestures(item)
        item.__mermaidOriginalSvg = svg
        if (true) attachMermaidViewerButton(item)
      }


      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.2/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js@4.5.1/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script></div><script data-pjax src="/self/btf.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="ture"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,200,200" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js" defer="defer"></script><script>document.addEventListener('DOMContentLoaded', () => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      true
        ? pjax.loadUrl('/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})</script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.4"></script></div></div></body></html>